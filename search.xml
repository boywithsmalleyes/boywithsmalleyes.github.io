<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Lifecycle æºç åˆ†æž]]></title>
    <url>%2F2020%2F09%2F17%2FLifecycle-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[å¼€å§‹æ˜¯åºŸè¯ï¼ˆç¿»è¯‘è‡ªæºç ï¼‰å®šä¹‰äº†ä¸€ä¸ª Android ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ã€‚ Fragmentå’ŒFragmentActivityç±»å®žçŽ°LifecycleOwneræŽ¥å£ï¼Œ å¹¶å¯ä»¥é€šè¿‡ getLifecycle() æ–¹æ³•æ¥è®¿é—®ç”Ÿå‘½å‘¨æœŸã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥å®žçŽ°LifecycleOwneråœ¨è‡ªå·±çš„ç±»ã€‚ 1234// åœ¨æ­¤ç±»äº‹ä»¶åŽåˆ†å‘ LifecycleOwner çš„ç›¸å…³æ–¹æ³•çš„è¿”å›žæ—¶ã€‚ Lifecycle.Event.ON_CREATE ï¼Œ Lifecycle.Event.ON_START ï¼Œ Lifecycle.Event.ON_RESUME// åœ¨æ­¤ç±»äº‹ä»¶åœ¨ä¹‹å‰åˆ†æ´¾LifecycleOwnerè¢«ç§°ä¸ºçš„ç›¸å…³æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œ Lifecycle.Event.ON_STARTåŽä¼šè¢«åˆ†æ´¾onStartå›žæŠ¥ï¼Œ Lifecycle.Event.ON_STOPä¹‹å‰å°†æ´¾å‡ºonStopè¢«è°ƒç”¨ã€‚ è¿™ç»™ä½ ä¸€å®šçš„ä¿è¯åœ¨å…¶å›½å®¶çš„ä¸»äººåœ¨ä¸åœ¨ã€‚Lifecycle.Event.ON_PAUSE ï¼Œ Lifecycle.Event.ON_STOP ï¼Œ Lifecycle.Event.ON_DESTROY å¦‚æžœæ‚¨ä½¿ç”¨Java 8 è¯­è¨€ ï¼Œç„¶åŽä½¿ç”¨DefaultLifecycleObserver è§‚å¯Ÿäº‹ä»¶ã€‚ éœ€è¦å°†&quot;androidx.lifecycle:common-java8:&lt;version&gt;&quot; å¢žåŠ åˆ°ä½ çš„ build.gradle æ–‡ä»¶ä¸­ã€‚ 123456class TestObserver implements DefaultLifecycleObserver &#123; @Override public void onCreate(LifecycleOwner owner) &#123; // your code &#125;&#125; å¦‚æžœä½ ä½¿ç”¨çš„Java 7 è¯­è¨€ ï¼Œä½¿ç”¨çš„æ³¨è§£è§‚å¯Ÿç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚ ä¸€æ—¦Javaçš„8è¯­è¨€æˆä¸ºåœ¨Androidä¸Šçš„ä¸»æµï¼Œæ³¨é‡Šå°†è¢«å¼ƒç”¨ï¼Œæ‰€ä»¥DefaultLifecycleObserverå’Œæ³¨é‡Šä¹‹é—´ï¼Œåˆ™é¡»åå‘ DefaultLifecycleObserverã€‚ 1234class TestObserver implements LifecycleObserver &#123; @OnLifecycleEvent(ON_STOP) void onStopped() &#123;&#125;&#125; è§‚æµ‹æ–¹æ³•å¯ä»¥æŽ¥æ”¶é›¶ä¸ªæˆ–ä¸€ä¸ªå‚æ•°ã€‚ å¦‚æžœä½¿ç”¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»åž‹å¿…é¡»ä¸ºLifecycleOwner ã€‚ å¸¦æ³¨é‡Šçš„æ–¹æ³•Lifecycle.Event.ON_ANY å¯ä»¥æŽ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®ƒå¿…é¡»æ˜¯ç±»åž‹çš„Lifecycle.Eventã€‚ 123456class TestObserver implements LifecycleObserver &#123; @OnLifecycleEvent(ON_CREATE) void onCreated(LifecycleOwner source) &#123;&#125; @OnLifecycleEvent(ON_ANY) void onAny(LifecycleOwner source, Event event) &#123;&#125;&#125; æä¾›è¿™äº›é¢å¤–çš„å‚æ•°å¯ä»¥è®©æ‚¨æ–¹ä¾¿åœ°è§‚å¯Ÿåˆ°å¤šä¸ªä¾›åº”å•†å’Œäº‹ä»¶ï¼Œè€Œæ— éœ€æ‰‹åŠ¨è·Ÿè¸ªä»–ä»¬ã€‚ é‚£æˆ‘èƒ½åšä»€ä¹ˆå‘¢è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±åº”è¯¥æƒ³åˆ°ä¸€äº›åœ¨å¼€å‘ä¸­å¸¸å¸¸ä¸è¢«æˆ‘ä»¬å¿½è§†ï¼Œä½†åˆä¸æ€Žä¹ˆä½¿ç”¨çš„ä¸œè¥¿ å‹ç›Ÿç»Ÿè®¡ åœ¨å‹ç›Ÿç»Ÿè®¡ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šåœ¨ BaseActivity ä¸­æ’å…¥å‹ç›Ÿå¯¹é¡µé¢æµè½¬çš„ç»Ÿè®¡, onStart() onResume() onPause() onStop() ç­‰ï¼Œç„¶è€Œè¿™é‡Œæœ‰ä¸€ç‚¹ä¸å¥½çš„æ˜¯ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡å’Œå…¬å…±ç»„ä»¶è€¦åˆåœ¨äº†ä¸€èµ·ã€‚ å¹²è´§~~~æ¥äº† é‚£ä¹ˆè§£å†³ä¸Šè¿°é—®é¢˜çš„æ–¹æ¡ˆå°±æ¥äº†ï¼Œæˆ‘ä»¬é€šè¿‡å®žçŽ° LifecycleObserver ï¼Œé€šè¿‡æ ‡è¯†å£°æ˜Žå‘¨æœŸæ–¹æ³•ä¹‹åŽï¼Œä»…éœ€ä¸€å¥ addObserver(this) ï¼Œå°±å¯ä»¥å°† Activity æˆ– Fragment çš„å£°æ˜Žå‘¨æœŸæ–¹æ³•ä¸Žæˆ‘ä»¬å®šä¹‰çš„ Observer æ–¹æ³•å…³è”èµ·æ¥ã€‚é€šè¿‡æ„ŸçŸ¥ Activity æˆ– Fragment çš„å£°æ˜Žå‘¨æœŸæ–¹æ³•ï¼Œå®žçŽ°å‹ç›Ÿç»Ÿè®¡ï¼Œæ­¤æ—¶å°±å°†ä¸šåŠ¡æ•´ä½“ä¸Ž BaseActivity æŠ½ç¦»å¼€ï¼Œæ˜¯çš„å…¬å…±ç»„ä»¶å˜å¾—æ›´ç®€æ´ä¸€äº›ã€‚ å½“ç„¶ï¼Œè¿™åªæ˜¯ Lifecycle çš„ä¸€ç§ç®€å•åº”ç”¨ï¼Œå…¶ä»–çš„ä½¿ç”¨æ–¹æ³•è¿˜æ˜¯éœ€è¦æˆ‘ä»¬ä¸æ–­çš„åŽ»æŽ¢ç´¢ã€‚ æºç åˆ†æžLifecycle UML æƒ³ç†è§£ä¸€ä¸ªä¸œè¥¿ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯åŽ»é˜…è¯»å®ƒï¼Œ è¿™æ˜¯å¼€å‘å¤šå¹´æ€»ç»“å‡ºçš„ä¸€å¥è¯ã€‚ é‚£ä¹ˆé€šè¿‡ä¸Šé¢çš„ UML ç±»å›¾å…³ç³»ï¼Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹å‡ºï¼Œ Lifecycle çš„å†…å®¹å¹¶ä¸æ˜¯å¾ˆå¤šã€‚ä½†å®ƒæ€Žä¹ˆå°±ä¼šè¿™ä¹ˆå¼ºå¤§å‘¢ã€‚ ComponentActivity &amp; ReportFragmentå°±ç®—æ²¡çœ‹è¿‡æºç ï¼ŒçŸ¥é“Lifecycle çš„äººï¼Œä¹Ÿåº”è¯¥å¬è¯´ä¸ªï¼Œè¿™æ˜¯è¦ç»™å£°æ˜Žå‘¨æœŸç›‘æŽ§ç±»ï¼Œé‚£ä¹ˆæ—¢ç„¶å’Œç”Ÿå‘½å‘¨æœŸæœ‰å…³ï¼Œé‚£è‡ªç„¶æ˜¯å’Œ Activity æœ‰å…³ï¼Œé€šè¿‡AppCompatActivity ç±»ï¼Œæˆ‘ä»¬å‘ä¸ŠæŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° ComponentActivity è¿™ä¸ªç±»ï¼Œå®žçŽ°äº† LifecycleOwner æŽ¥å£ï¼Œå¹¶è¿”å›žäº†ä¸€ä¸ª mLifecycleRegistry 12345678// ComponentActivity ç±»åˆå§‹åŒ–æ˜¯ï¼Œåˆ›å»ºäº†ä¸€ä¸ª LifecycleRegistryï¼Œå¹¶å°†è‡ªå·±ä¼ å…¥è¿‡åŽ»private final LifecycleRegistry mLifecycleRegistry = new LifecycleRegistry(this);// LifecycleOwner æŽ¥å£ï¼Œæä¾›äº†ä¸€ä¸ª getLifecycle() æ–¹æ³•@Overridepublic Lifecycle getLifecycle()&#123; return mLifecycleRegistry;&#125; åœ¨ ComponentActivity çš„æž„é€ æ–¹æ³•é‡Œï¼Œé€‚é…äº†ä¸åŒçš„å¹³å°ç‰ˆæœ¬ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940public ComponentActivity() &#123; Lifecycle lifecycle = getLifecycle(); //noinspection ConstantConditions if (lifecycle == null) &#123; throw new IllegalStateException("getLifecycle() returned null in ComponentActivity's " + "constructor. Please make sure you are lazily constructing your Lifecycle " + "in the first call to getLifecycle() rather than relying on field " + "initialization."); &#125; if (Build.VERSION.SDK_INT &gt;= 19) &#123; getLifecycle().addObserver(new LifecycleEventObserver() &#123; @Override public void onStateChanged(@NonNull LifecycleOwner source, @NonNull Lifecycle.Event event) &#123; if (event == Lifecycle.Event.ON_STOP) &#123; Window window = getWindow(); final View decor = window != null ? window.peekDecorView() : null; if (decor != null) &#123; decor.cancelPendingInputEvents(); &#125; &#125; &#125; &#125;); &#125; getLifecycle().addObserver(new LifecycleEventObserver() &#123; @Override public void onStateChanged(@NonNull LifecycleOwner source, @NonNull Lifecycle.Event event) &#123; if (event == Lifecycle.Event.ON_DESTROY) &#123; if (!isChangingConfigurations()) &#123; getViewModelStore().clear(); &#125; &#125; &#125; &#125;); if (19 &lt;= SDK_INT &amp;&amp; SDK_INT &lt;= 23) &#123; getLifecycle().addObserver(new ImmLeaksCleaner(this)); &#125;&#125; é€šè¿‡æž„é€ æ–¹æ³•ï¼Œæœ‰æ²¡æœ‰å‘çŽ°ä¸€ä¸ªå¾ˆé‡è¦çš„ä¿¡æ¯ï¼Œ addObserver()ï¼Œ ç”±æ­¤ï¼Œæˆ‘ä»¬ä¸éš¾çœ‹å‡º ï¼ŒLifecycleRegister çš„ä¸€ä¸ªé‡è¦çš„æ–¹æ³•å°±æ˜¯ addObserver() ã€‚ç¿»é˜…ç±»ç»“æž„äº†è§£åˆ° LifecycleRegister æ˜¯ Lifecycle æ´¾ç”Ÿçš„ä¸€ä¸ªå­ç±»ï¼Œæœ‰å…³æ‰€æœ‰å’Œå£°æ˜Žå‘¨æœŸæœ‰å…³çš„å†…å®¹ï¼Œéƒ½å’Œè¿™ä¸ªç±»æœ‰å…³ã€‚ æˆ‘ä»¬å…ˆä¸ç€æ€¥çœ‹ LifecycleRegisterï¼Œç»§ç»­çœ‹ CompontentActivity ç±»ï¼Œæ—¢ç„¶æ˜¯ä¸ª Activity é‚£ä¹ˆä¸€å®šä¼šæœ‰åˆ›å»ºè¿‡ç¨‹ï¼Œå›žçœ‹ onCreate() æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ä¸€ä¸ªæœ‰è¶£çš„ä¸œè¥¿ï¼š 123456789101112131415/** * &#123;@inheritDoc&#125; * * If your ComponentActivity is annotated with &#123;@link ContentView&#125;, this will * call &#123;@link #setContentView(int)&#125; for you. */@Overrideprotected void onCreate(@Nullable Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); mSavedStateRegistryController.performRestore(savedInstanceState); ReportFragment.injectIfNeededIn(this); if (mContentLayoutId != 0) &#123; setContentView(mContentLayoutId); &#125;&#125; ReportFragment.injectIfNeededIn(this) å’¦ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ ä½ æ˜¯è°ï¼Œä½ åœ¨è¿™å„¿åšä»€ä¹ˆã€‚ åˆ«æ…Œï¼Œè¿›åŽ»çœ‹ã€‚ ReportFragment12345678910public static void injectIfNeededIn(Activity activity) &#123; // ProcessLifecycleOwner should always correctly work and some activities may not extend // FragmentActivity from support lib, so we use framework fragments for activities android.app.FragmentManager manager = activity.getFragmentManager(); if (manager.findFragmentByTag(REPORT_FRAGMENT_TAG) == null) &#123; manager.beginTransaction().add(new ReportFragment(), REPORT_FRAGMENT_TAG).commit(); // Hopefully, we are the first to make a transaction. manager.executePendingTransactions(); &#125;&#125; å’¦ï¼Ÿï¼Ÿï¼Ÿï¼Ÿä¸ºä»€ä¹ˆè¦åœ¨æˆ‘çš„ Activity ä¸Šæ·»åŠ ä¸€ä¸ª Fragmentï¼Œ ç¿»éä»£ç ï¼Œæˆ‘ä»¬ä¹Ÿæœªè§åˆ°ä»»ä½•å¸ƒå±€ï¼Œä½ æ˜¯ä¸€ä¸ªç©ºçš„ ï¼ŒðŸ˜±ðŸ˜±ðŸ˜±ï¼Œ å¤ªå¯æ€•äº†ï¼ æŒ‰ç…§ Fragment çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ dispatch()1234567891011121314151617181920212223242526272829303132333435363738394041@Overridepublic void onActivityCreated(Bundle savedInstanceState) &#123; super.onActivityCreated(savedInstanceState); dispatchCreate(mProcessListener); dispatch(Lifecycle.Event.ON_CREATE);&#125;@Overridepublic void onStart() &#123; super.onStart(); dispatchStart(mProcessListener); dispatch(Lifecycle.Event.ON_START);&#125;@Overridepublic void onResume() &#123; super.onResume(); dispatchResume(mProcessListener); dispatch(Lifecycle.Event.ON_RESUME);&#125;@Overridepublic void onPause() &#123; super.onPause(); dispatch(Lifecycle.Event.ON_PAUSE);&#125;@Overridepublic void onStop() &#123; super.onStop(); dispatch(Lifecycle.Event.ON_STOP);&#125;@Overridepublic void onDestroy() &#123; super.onDestroy(); dispatch(Lifecycle.Event.ON_DESTROY); // just want to be sure that we won't leak reference to an activity mProcessListener = null;&#125; æœ‰æ²¡æœ‰å‘çŽ°ï¼Œ åˆæœ‰ä¸€ä¸ªæ–¹æ³•è¢«é‡å¤çš„åˆ©ç”¨ï¼Œæ²¡é”™ï¼Œå°±æ˜¯dispatch(Lifecycle.Event event) è€Œä¸”ä¼ å…¥çš„å‚æ•°ï¼Œåˆå’Œ Activity çš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒ. handleLifecycleEvent()1234567891011121314private void dispatch(Lifecycle.Event event) &#123; Activity activity = getActivity(); if (activity instanceof LifecycleRegistryOwner) &#123; ((LifecycleRegistryOwner) activity).getLifecycle().handleLifecycleEvent(event); return; &#125; if (activity instanceof LifecycleOwner) &#123; Lifecycle lifecycle = ((LifecycleOwner) activity).getLifecycle(); if (lifecycle instanceof LifecycleRegistry) &#123; ((LifecycleRegistry) lifecycle).handleLifecycleEvent(event); &#125; &#125;&#125; è™½ç„¶ç»è¿‡äº†ä¸¤ä¸ªåˆ¤æ–­ï¼Œä½†è¿™æ²¡å…³ç³»ï¼Œå› ä¸ºè¿™æ˜¯ç³»ç»Ÿå¸®åŠ©æˆ‘ä»¬åšçš„é€‚é…å·¥ä½œï¼Œæ— è®ºå¦‚ä½•ï¼Œä»–ä»¬é˜Ÿä¸­éƒ½è°ƒç”¨äº† handleLifecycleEvent(event) æ–¹æ³•ï¼Œåˆè’™è”½äº†ä¸ï¼Œè¿™é‡Œå•¥ä¹Ÿæ²¡å¹²ï¼Œå°±è·‘äº†ã€‚ ä½ è·‘ï¼Œé‚£æˆ‘å°±è¿½ï¼ LifecycleRegister123456789101112131415161718192021222324252627/** * Sets the current state and notifies the observers. * &lt;p&gt; * Note that if the &#123;@code currentState&#125; is the same state as the last call to this method, * calling this method has no effect. * * @param event The event that was received */public void handleLifecycleEvent(@NonNull Lifecycle.Event event) &#123; State next = getStateAfter(event); moveToState(next);&#125;private void moveToState(State next) &#123; if (mState == next) &#123; return; &#125; mState = next; if (mHandlingEvent || mAddingObserverCounter != 0) &#123; mNewEventOccurred = true; // we will figure out what to do on upper level. return; &#125; mHandlingEvent = true; sync(); mHandlingEvent = false;&#125; ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬ç¿»è¯‘ä¸‹æ³¨é‡Š è®¾ç½®å½“å‰çŠ¶æ€ï¼Œå¹¶é€šçŸ¥è§‚å¯Ÿè€… æ³¨æ„ï¼Œå¦‚æžœå½“å‰çŠ¶æ€å’Œä¸Šä¸€æ¬¡æ–¹æ³•è°ƒç”¨æ—¶ç›¸åŒï¼Œé‚£ä¹ˆè¿™æ¬¡è°ƒç”¨åˆ™æ— æ•ˆ getStateAfter()çŽ°åœ¨æˆ‘ä»¬æ¥åˆ†æžæºç ï¼ŒgetStateAfter(event) è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆè¿›åŽ»çœ‹ä¸‹åšäº†ä»€ä¹ˆï¼š 1234567891011121314151617static State getStateAfter(Event event) &#123; switch (event) &#123; case ON_CREATE: case ON_STOP: return CREATED; case ON_START: case ON_PAUSE: return STARTED; case ON_RESUME: return RESUMED; case ON_DESTROY: return DESTROYED; case ON_ANY: break; &#125; throw new IllegalArgumentException("Unexpected event value " + event);&#125; åŽŸæ¥æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œé€šè¿‡ä¼ å…¥çš„ Event äº‹ä»¶ï¼Œæ‰¾åˆ°å½“å‰äº‹ä»¶å¯¹åº”çš„ä¸‹ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸçŠ¶æ€ State æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æ²¡æœ‰åˆ†æž moveToState(State next), ä»Žå‡½æ•°åä¸Šï¼Œå¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªçŠ¶æ€ç§»åŠ¨çš„æ–¹æ³•ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬è¿›å…¥æ–¹æ³•å†…å¯ä»¥çœ‹åˆ° 123if (mState == next) &#123; return;&#125; å¦‚æžœå½“å‰çŠ¶æ€å’Œä¸‹ä¸€ä¸ªï¼ˆæ“ä½œåŽçš„ï¼‰çŠ¶æ€ä¸€è‡´ï¼Œåˆ™ç›´æŽ¥ return è¿™ä¹Ÿæ˜ ç…§äº†æ³¨é‡Šä¸­çš„é‚£å¥è¯ã€‚ sync()ç»§ç»­å°±æ˜¯å°†æ“ä½œçš„ä¸‹ä¸€ä¸ªçŠ¶æ€åšäº†ä¸€æ¬¡è®°å½•ï¼Œä¸­é—´çš„ä¸€äº›åˆ¤æ–­æ¡ä»¶æˆ‘ä»¬ä¸çœ‹ï¼Œé¡ºåºçš„ä¼šçœ‹åˆ°ä¸€ä¸ª sync() æ–¹æ³•ï¼Œå’¦ï¼Œè¿™åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ===&gt; çŠ¶æ€åŒæ­¥ 12345678910111213141516171819202122232425262728293031/** * Custom list that keeps observers and can handle removals / additions during traversal. * * Invariant: at any moment of time for observer1 &amp; observer2: * if addition_order(observer1) &lt; addition_order(observer2), then * state(observer1) &gt;= state(observer2), */private FastSafeIterableMap&lt;LifecycleObserver, ObserverWithState&gt; mObserverMap = new FastSafeIterableMap&lt;&gt;();// happens only on the top of stack (never in reentrance),// so it doesn't have to take in account parentsprivate void sync() &#123; LifecycleOwner lifecycleOwner = mLifecycleOwner.get(); if (lifecycleOwner == null) &#123; throw new IllegalStateException("LifecycleOwner of this LifecycleRegistry is already" + "garbage collected. It is too late to change lifecycle state."); &#125; while (!isSynced()) &#123; mNewEventOccurred = false; // no need to check eldest for nullability, because isSynced does it for us. if (mState.compareTo(mObserverMap.eldest().getValue().mState) &lt; 0) &#123; backwardPass(lifecycleOwner); &#125; Entry&lt;LifecycleObserver, ObserverWithState&gt; newest = mObserverMap.newest(); if (!mNewEventOccurred &amp;&amp; newest != null &amp;&amp; mState.compareTo(newest.getValue().mState) &gt; 0) &#123; forwardPass(lifecycleOwner); &#125; &#125; mNewEventOccurred = false;&#125; è¿™é‡Œå‡ºçŽ°äº†ä¸€ä¸ªæ–°ä¸œè¥¿ mObserverMap å‘ä¸Šæˆ‘ä»¬æ‰¾ä»–çš„å®ƒç±»åž‹ï¼Œè¿™é‡Œå¯¹æ•°æ®ç»“æž„ä¸åšç ”ç©¶ï¼Œç®€å•è¯´ä¸€ä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¹¶æä¾›äº†ä¸€ä¸ª map åšç¼“å†²åŒºï¼Œä¸”æä¾›äº†ä¸€ä¸ªå¯ä»¥å¿«é€Ÿè¿­ä»£çš„ç»“æž„ã€‚ ç»§ç»­åˆ†æžæºç  mState.compareTo(mObserverMap.eldest().getValue().mState) &lt; 0 ä»Žç¼“å­˜çš„è§‚å¯Ÿè€…ä¸­æ‹¿å‡ºæœ€æ—§çš„çŠ¶æ€ï¼Œä¸Žå½“å‰çŠ¶æ€è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æžœå°äºŽ 0ï¼Œ è¯´æ˜Žè§‚å¯Ÿè€…çš„çŠ¶æ€æå‰äºŽå½“å‰çŠ¶æ€ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œä¸€ä¸ªbackwardPass(lifecycleOwner) æ–¹æ³•ï¼Œè®©è§‚å¯Ÿè€…çš„çŠ¶æ€å›žé€€åˆ°å½“å‰çŠ¶æ€ä¸Š mState.compareTo(newest.getValue().mState) &gt; 0 è¿™ä¸ªåˆ¤æ–­æ­£å¥½å’Œä¸Šé¢ç›¸åï¼Œè¯´æ˜Žå½“å‰çš„è§‚å¯Ÿè€…çŠ¶æ€è½åŽäºŽå½“å‰çŠ¶æ€ï¼Œé‚£ä¹ˆå°±è®©è§‚å¯Ÿè€…çš„çŠ¶æ€è¿½ä¸Šå½“å‰çŠ¶æ€ï¼Œæ‰§è¡Œ forwardPass(lifecycleOwner) Lifecycle State Sequenceé€šè¿‡åˆ†æž forwardPass å’Œ backwardPass æ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹åˆ°å…¶å†…éƒ¨åˆè°ƒç”¨äº†ä¸¤ä¸ªæ–¹æ³•, downEvent å’Œ upEventï¼Œæˆ‘ä»¬ç§°å‘¼ä¸ºå‡çº§äº‹ä»¶å’Œé™çº§äº‹ä»¶ 123456789101112131415161718192021222324252627282930private static Event downEvent(State state) &#123; switch (state) &#123; case INITIALIZED: throw new IllegalArgumentException(); case CREATED: return ON_DESTROY; case STARTED: return ON_STOP; case RESUMED: return ON_PAUSE; case DESTROYED: throw new IllegalArgumentException(); &#125; throw new IllegalArgumentException("Unexpected state value " + state); &#125; private static Event upEvent(State state) &#123; switch (state) &#123; case INITIALIZED: case DESTROYED: return ON_CREATE; case CREATED: return ON_START; case STARTED: return ON_RESUME; case RESUMED: throw new IllegalArgumentException(); &#125; throw new IllegalArgumentException("Unexpected state value " + state); &#125; é€šè¿‡ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬æ€»ç»“å‡º Lifecycle ä¸­ State å’Œ Event çš„æ—¶åºå…³ç³»ï¼Œå¦‚ä¸‹å›¾ åŒæ—¶æˆ‘ä»¬ä¹Ÿå›žé¡¾ä¸€ä¸‹ï¼ŒgetStateAfter() æ–¹æ³•ï¼Œå¯¹äº‹ä»¶å’ŒçŠ¶æ€çš„åˆ¤æ–­ï¼Œä¹Ÿå°±æ˜Žç™½äº†çŠ¶æ€å’Œäº‹ä»¶çš„å…³ç³»ã€‚ dispatchEvent123456789101112131415161718192021222324252627282930private void forwardPass(LifecycleOwner lifecycleOwner) &#123; Iterator&lt;Entry&lt;LifecycleObserver, ObserverWithState&gt;&gt; ascendingIterator = mObserverMap.iteratorWithAdditions(); while (ascendingIterator.hasNext() &amp;&amp; !mNewEventOccurred) &#123; Entry&lt;LifecycleObserver, ObserverWithState&gt; entry = ascendingIterator.next(); ObserverWithState observer = entry.getValue(); while ((observer.mState.compareTo(mState) &lt; 0 &amp;&amp; !mNewEventOccurred &amp;&amp; mObserverMap.contains(entry.getKey()))) &#123; pushParentState(observer.mState); observer.dispatchEvent(lifecycleOwner, upEvent(observer.mState)); popParentState(); &#125; &#125;&#125;private void backwardPass(LifecycleOwner lifecycleOwner) &#123; Iterator&lt;Entry&lt;LifecycleObserver, ObserverWithState&gt;&gt; descendingIterator = mObserverMap.descendingIterator(); while (descendingIterator.hasNext() &amp;&amp; !mNewEventOccurred) &#123; Entry&lt;LifecycleObserver, ObserverWithState&gt; entry = descendingIterator.next(); ObserverWithState observer = entry.getValue(); while ((observer.mState.compareTo(mState) &gt; 0 &amp;&amp; !mNewEventOccurred &amp;&amp; mObserverMap.contains(entry.getKey()))) &#123; Event event = downEvent(observer.mState); pushParentState(getStateAfter(event)); observer.dispatchEvent(lifecycleOwner, event); popParentState(); &#125; &#125;&#125; è¿Ÿåˆ°çš„ä¸¤ä¸ªæ–¹æ³•ç»ˆäºŽæ¥äº†ï¼Œè¿™é‡Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¯ä»¥å¤æ‚çš„ã€‚åªæ˜¯é€šè¿‡å¾ªçŽ¯æ‰¾åˆ°æ‰€æœ‰çš„è§‚å¯Ÿè€…ï¼Œå¹¶è¿›è¡Œäº‹ä»¶çš„åˆ†å‘observer.dispatchEvent(lifecycleOwner, event) 123456void dispatchEvent(LifecycleOwner owner, Event event) &#123; State newState = getStateAfter(event); mState = min(mState, newState); mLifecycleObserver.onStateChanged(owner, event); mState = newState;&#125; å“ˆå“ˆï¼Œ åˆæ˜¯ä¸€ä¸ªæ–¹æ³•è¿›å…¥äº†æˆ‘ä»¬çš„è§†çº¿ onStateChanged(owner, event)ï¼Œå†æ¬¡ç‚¹å‡»åŽ»åŽï¼Œå‘çŽ°æ˜¯ä¸€ä¸ªæŽ¥å£ã€‚æŸ¥è¯¢å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šå®žçŽ°ç±»ï¼Œå›°æƒ‘å—ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ ä½†æˆ‘ä»¬åªéœ€è¦å…³æ³¨ ReflectiveGenericLifecycleObserver , æƒ³çŸ¥é“ä¸ºä»€ä¹ˆå—ï¼Ÿ æˆ‘ä¹Ÿæ˜¯çœ‹äº†æºç æ‰æ€»ç»“å‡ºæ¥çš„ã€‚ ReflectiveGenericLifecycleObserver1234567891011121314151617/** * An internal implementation of &#123;@link LifecycleObserver&#125; that relies on reflection. */class ReflectiveGenericLifecycleObserver implements LifecycleEventObserver &#123; private final Object mWrapped; private final CallbackInfo mInfo; ReflectiveGenericLifecycleObserver(Object wrapped) &#123; mWrapped = wrapped; mInfo = ClassesInfoCache.sInstance.getInfo(mWrapped.getClass()); &#125; @Override public void onStateChanged(LifecycleOwner source, Event event) &#123; mInfo.invokeCallbacks(source, event, mWrapped); &#125;&#125; å“Žï¼ŒmInfo.invokeCallbacks(source,event,mWrapped); è¿™åˆæ˜¯ä»€ä¹ˆï¼Œæ‹ä¸‹æ¥è¿˜ä»Žæ²¡è§è¿‡ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡è§è¿‡è¿™ä¸ªç±»çš„åˆå§‹åŒ–å’ŒåŠ è½½è¿‡ç¨‹ï¼Œå¯¹ä¸å¯¹ðŸ˜¨ðŸ˜¨ðŸ˜¨ æ—¢ç„¶æ˜¯ç±»å˜›ï¼Œé‚£è‚¯å®šæ˜¯è¦åˆ›å»ºçš„ï¼Œé‚£å°±çœ‹ä¸‹æž„é€ å™¨å‘—ã€‚ wrapped è¿™ä¸œè¥¿ï¼Œç»è¿‡äº†ç¼“å­˜ï¼ŒEmmm ï¼Œæˆ‘ä¹Ÿæ˜¯ç‚¹è¿›åŽ» ClassesInfoCache ä¹‹åŽï¼Œéƒ½äº†å®ƒçš„æ³¨é‡Šæ‰æ˜Žç™½çš„ã€‚ é‚£ wrapped åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé€šè¿‡ ClassesInfoCache å’Œæˆ‘ä»¬è¿½è¸ª ReflectiveGenericLifecycleObserver å¯ä»¥çœ‹å‡ºï¼Œ ClassesInfoCache ç¼“å­˜äº† LifecycleObserver çš„ç±»å¯¹è±¡ï¼ŒReflectiveGenericLifecycleObserver ä¹Ÿæ˜¯å‘ä¸‹ä¼ é€’ä¸€ä¸ª LifecycleObserverã€‚ç”±æ­¤æˆ‘ä»¬å¯ä»¥åˆ¤æ–­å‡ºï¼Œå…¶å®žè¿™ä¸ª LifecycleObserver å°±æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„è§‚å¯Ÿè€…ã€‚ è€Œç³»ç»Ÿå¸®æˆ‘åšçš„äº‹å„¿ï¼Œå°±æ˜¯ä½¿ç”¨åå°„æŠ€æœ¯ï¼Œé€šè¿‡æˆ‘ä»¬è‡ªå·±æ ‡æ³¨çš„æ³¨è§£ï¼Œå¹¶æ ¹æ®å½“å‰ç”Ÿå‘½å‘¨æœŸçš„çŠ¶æ€ï¼Œåå°„æ‰§è¡Œæˆ‘ä»¬çš„æ–¹æ³• mInfo.invokeCallback(source event, mWrapped); reflect invoke method1234567891011121314151617181920void invokeCallback(LifecycleOwner source, Lifecycle.Event event, Object target) &#123; //noinspection TryWithIdenticalCatches try &#123; switch (mCallType) &#123; case CALL_TYPE_NO_ARG: mMethod.invoke(target); break; case CALL_TYPE_PROVIDER: mMethod.invoke(target, source); break; case CALL_TYPE_PROVIDER_WITH_EVENT: mMethod.invoke(target, source, event); break; &#125; &#125; catch (InvocationTargetException e) &#123; throw new RuntimeException("Failed to call observer method", e.getCause()); &#125; catch (IllegalAccessException e) &#123; throw new RuntimeException(e); &#125;&#125; è¿˜è®°å¾—æ–‡ç« å¼€å¤´å¯¹ Lifecycle æ³¨è§£çš„ç¿»è¯‘å—ï¼Ÿ è¿™é‡Œçš„åˆ¤æ–­å°±æ˜¯ä¾æ®å…¶æ³¨è§£æ ‡æ³¨ï¼Œå¹¶å›žè°ƒå¯¹åº”çš„å‚æ•°æ–¹æ³• è‡³æ­¤ï¼Œä¼¼ä¹Žæˆ‘ä»¬å·²ç»ä¸èƒ½å†è¿½ä¸‹åŽ»äº†ï¼Œä»£ç æ‰§è¡Œåˆ°è¿™é‡Œå·²ç»ç»“æŸäº†ã€‚ ä½†æ˜¯ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ æˆ‘ä»¬è¿˜æœ‰ä¸€å¤§å—æ²¡æœ‰åˆ†æžï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ addObserver()å‰é¢æˆ‘ä»¬è¯´äº†ä¸€å¤§å †ï¼Œéƒ½æ˜¯å¯¹ Lifecycle å¦‚ä½•å¤„ç†ï¼Œå¹¶ç›‘å¬æˆ‘ä»¬çš„ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ Lifecycleæ˜¯å¦‚ä½•å¤„ç†ç›‘å¬çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å‰é¢ä¸€ç›´éƒ½æ²¡æœ‰è¯´è¿‡ï¼Œè§‚å¯Ÿè€…é‚£é‡Œæ¥çš„ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ å¥½ï¼Œæˆ‘ä»¬ç»§ç»­è§‚å¯Ÿ LifecycleRegister ä¸­çš„ addObserver(LifecycleObserver) è¿™ä¸ªä¹Ÿæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰è§‚å¯Ÿè€…åŽï¼Œéœ€è¦è°ƒç”¨çš„æ–¹æ³• 123456789101112131415161718192021222324252627282930313233@Overridepublic void addObserver(@NonNull LifecycleObserver observer) &#123; State initialState = mState == DESTROYED ? DESTROYED : INITIALIZED; ObserverWithState statefulObserver = new ObserverWithState(observer, initialState); ObserverWithState previous = mObserverMap.putIfAbsent(observer, statefulObserver); if (previous != null) &#123; return; &#125; LifecycleOwner lifecycleOwner = mLifecycleOwner.get(); if (lifecycleOwner == null) &#123; // it is null we should be destroyed. Fallback quickly return; &#125; boolean isReentrance = mAddingObserverCounter != 0 || mHandlingEvent; State targetState = calculateTargetState(observer); mAddingObserverCounter++; while ((statefulObserver.mState.compareTo(targetState) &lt; 0 &amp;&amp; mObserverMap.contains(observer))) &#123; pushParentState(statefulObserver.mState); statefulObserver.dispatchEvent(lifecycleOwner, upEvent(statefulObserver.mState)); popParentState(); // mState / subling may have been changed recalculate targetState = calculateTargetState(observer); &#125; if (!isReentrance) &#123; // we do sync only on the top level. sync(); &#125; mAddingObserverCounter--;&#125; å“ˆå“ˆï¼Œçœ‹èµ·æ¥ä»£ç å¹¶ä¸æ˜¯å¾ˆå¤šä¸«ï¼ï¼ï¼ï¼ å“¼ï¼Œå¤©çœŸçš„ä½ ï¼ä½†å®ƒå°±æ˜¯è¿™ä¹ˆå¤š æˆ‘ä»¬è¿™é‡Œè¦é€è¡Œæ¸…ç‚¹ State initialState = mState == DESTROYED ? DESTROYED : INITIALIZED; å—¯ï¼Œä¸€ä¸Šæ¥å°±åˆå§‹åŒ–äº†ä¸€ä¸ª INITIALIZED çŠ¶æ€çš„çŠ¶æ€ï¼Œå“ˆå“ˆå“ˆï¼Œå¥½æ‹—å£ã€‚ éšåŽåˆ›å»ºäº†ä¸€ä¸ª ObserverWithState ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„è§‚å¯Ÿè€…ï¼Œä»Žåå­—ä¸Šæˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯æˆ‘ä»¬ä¼ å…¥çš„è§‚å¯Ÿè€…å’Œæˆ‘ä»¬åˆšåˆšåˆ›å»ºå¥½çš„çŠ¶æ€ã€‚è¿™æ˜¯ä¸ªè£…é¥°å™¨æ¨¡å¼ï¼Œç›®çš„æ˜¯ç»™åŽŸå¯¹è±¡ï¼Œå¢žåŠ ä¸€ä¸ªæ–°å±žæ€§ï¼Œä½†åˆä¸æ”¹å˜åŽŸæ•°æ®ç»“æž„çš„æ–¹æ¡ˆã€‚ ç´§æŽ¥ç€åˆæŠŠè¿™ä¸ªè§‚å¯Ÿè€…å’Œå¸¦æœ‰çŠ¶æ€çš„è§‚å¯Ÿè€…ï¼Œæ”¾è¿›äº†äº‹å…ˆå·²ç»åˆ›å»ºå¥½çš„ Map ä¸­ï¼Œä¹Ÿå°±æ˜¯ mObserverMap ç„¶åŽè¿”å›žäº†ä¸ªä¸œè¥¿ï¼Œ é˜…è¯»åŽå‘çŽ°ï¼Œåˆå’Œ Lifecycle çš„æ³¨é‡Šå¯¹ä¸Šäº†ã€‚ ä¹‹åŽï¼Œè®¡ç®—å‡ºå½“å‰ Activity æˆ– Fragment çš„çŠ¶æ€ï¼Œå¹¶åˆ¤æ–­ï¼Œå¦‚æžœå½“å‰è§‚å¯Ÿè€…çš„çŠ¶æ€è½åŽäºŽ Activity æˆ– Fragment çš„çŠ¶æ€ï¼Œåˆ™ç«‹å³æ‰§è¡ŒdispatchEvent() æ–¹æ³•ï¼Œæ‰§è¡Œå›žè°ƒã€‚ æ€»ç»“è®¤çœŸé˜…è¯»æºç åŽï¼Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹å‡ºï¼Œå…¶å®ž Lifecycle çš„æŠ€æœ¯å¾ˆç®€å•ï¼Œåªæœ‰åå°„ï¼Œè§‚å¯Ÿè€…ï¼Œè£…é¥°å™¨ï¼Œå®ƒå°†è¿™ä¸‰ä¸ªä¸œè¥¿åº”ç”¨çš„å¾ˆç¥žã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œåˆ†æžæºç æˆ‘ä»¬ä»Žä¸¤æ–¹é¢å…¥æ‰‹ addObserver() è¿™ä¸ªæ–¹æ³•æ˜¯å¯¹ç”¨æˆ·æœ€ç›´æŽ¥çš„å†…å®¹ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Observer åŽï¼Œéƒ½ä¼šé€šè¿‡ add çš„æ–¹å¼ï¼Œå°†æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„è§‚å¯Ÿè€…ä¼ å…¥ï¼Œé‚£ä¹ˆä»Žè¿™ä¸ªçªç ´å£æˆ‘ä»¬è¿›å…¥æºç åˆ†æžè§‚å¯Ÿåˆ° ç»™è¦æ·»åŠ çš„Observer ä¸€ä¸ªåˆå§‹çš„çŠ¶æ€ï¼ˆè£…é¥°å™¨æ¨¡å¼ï¼ŒåŒ…è£…æ•°æ®ï¼‰ å°†æ•°æ®å­˜å‚¨å†æœ¬åœ°ç¼“å­˜ä¸­ ï¼ˆmObserverMapï¼‰ ç«‹å³è¿›è¡ŒçŠ¶æ€åˆ¤æ–­ï¼Œå†³å®šæ˜¯å¦å¤„ç†ç”Ÿå‘½å‘¨æœŸå˜åŒ– ReportFragment ä½œç”¨æ˜¯ï¼Œé™„ç€å† Activity ä¸Šï¼Œç”¨æ¥æ„ŸçŸ¥ Activity çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–ï¼Œä¹Ÿèµ·åˆ°å°†ä¸šåŠ¡ä»Ž Activity ä¸­åˆ†ç¦»å‡ºæ¥ã€‚é€šè¿‡ç”Ÿå‘½æ„ŸçŸ¥ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–ï¼Œæ‰§è¡Œ dispatch() æ–¹æ³•ï¼Œå°†ç”Ÿå‘½å‘¨æœŸäº‹ä»¶åˆ†å‘ç»™å®ƒæ‰€æœ‰çš„è§‚å¯Ÿè€…åŽ»å¤„ç†æ¶ˆæ¯ handleLifecycleEvent åå°„ è¿™é‡Œçš„ä¸œè¥¿æ¯”è¾ƒæŠ½è±¡ï¼Œæ²¡æœ‰ä»»ä½•å†…å®¹æ˜¯èƒ½çœ‹å‡ºæ¥å’Œæˆ‘ä»¬æœ‰ä»€ä¹ˆå…³ç³»çš„ï¼Œ åªè¦ä½ ç†Ÿæ‚‰åå°„ï¼Œé‚£ä¹ˆä½ å°±èƒ½æ˜Žç™½å®ƒå†åšä»€ä¹ˆã€‚ sync() è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥å¿«é€ŸåŒæ­¥è§‚å¯Ÿè€…çŠ¶æ€ä¸Ž Activity å’Œ Fragment ï¼Œç›®çš„ä¹Ÿæ˜¯èƒ½å¤Ÿè®©è§‚å¯Ÿè€…æ‰§è¡Œåˆ°å®ƒæ‰€æœ‰è§‚å¯Ÿçš„æ•°æ®ã€‚ä¸¤ä¸ªæ–¹æ³• forwardPass() å’Œ backwardPass() æ˜¯å…¶å®žçŽ°çš„åŽŸç†ã€‚]]></content>
      <tags>
        <tag>Android,Jetpack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RecyclerView]]></title>
    <url>%2F2020%2F07%2F09%2FRecyclerView%2F</url>
    <content type="text"><![CDATA[RechclerView æ€»ç»“ Recycler Viewï¼š è´Ÿè´£å°† Datas å±•ç¤ºåœ¨è‡ªå·±èº«ä¸Šï¼Œå…¶æœ¬èº«æ˜¯ä¸€ä¸ª ViewGroupï¼Œåªè®¤è¯† Viewï¼Œå› æ­¤éœ€è¦ä¸€ä¸ª Adapter æ¥å°† Datas çš„å†…å®¹è½¬æ¢ä¸º View Adapterï¼š è´Ÿè´£ç¿»è¯‘ï¼Œå°† Datas å†…å®¹ï¼Œè½¬æ¢ä¸º Viewï¼Œæ–¹ä¾¿ RecyclerView å±•ç¤º ViewHolderï¼š RecyclerView åªä¼šä¸Ž ViewHolder è¿›è¡Œäº¤äº’ï¼Œå› æ­¤ ViewHolder å……å½“ä¸­é—´ä»¶ï¼Œæ¥å°† Datas çš„å†…å®¹ä¼ é€’ç»™ RecyclerView LayoutManagerï¼šè´Ÿè´£å¸ƒå±€ï¼ŒRecyclerView å°†å…¶å­ View çš„å¸ƒå±€ç®¡ç†ï¼Œäº¤ç»™å®ƒæ¥å®Œæˆ Recyclerï¼šè´Ÿè´£ç®¡ç† View çš„ç”Ÿå‘½å‘¨æœŸï¼ŒLayoutManager åªç®¡è´Ÿè´£ View çš„å¸ƒå±€ä»»åŠ¡ï¼Œå¯¹å…¶å›žæ”¶äº¤ç»™äº† Recycler æ¥å¤„ç†ï¼Œé¿å…é€ æˆä¸å¿…è¦çš„é”™è¯¯ ItemAnimatorï¼š è´Ÿè´£åŠ¨ç”»ï¼Œå½“ RecyclerView ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼ˆå¢žã€åˆ ç­‰ï¼‰éƒ½ä¼šé€šè¿‡å®ƒæ¥å®Œæˆå¹³æ»‘çš„è¿‡æ¸¡ RecyclerView çš„ç»˜åˆ¶RecyclerView æ— ç–‘ä¹Ÿæ˜¯ä¸€ä¸ª View ï¼ŒView çš„ç»˜åˆ¶åŒæ ·é€ƒç¦»ä¸äº†ä¸‰å¤§æ­¥éª¤ onMeasure() onLayout() onDraw() onMeasureLayoutManager è´Ÿè´£ RecyclerView çš„ç»˜åˆ¶ï¼Œå…¶æœ‰ä¸€ä¸ª mAutoMeasure å±žæ€§ï¼Œç”¨æ¥æŽ§åˆ¶æ˜¯å¦å¼€å¯è‡ªåŠ¨æµ‹é‡ï¼Œå¼€å¯æƒ…å†µä¸‹ï¼Œå¸ƒå±€äº¤ç”± RecyclerView ä½¿ç”¨ä¸€å¥—é»˜è®¤çš„æµ‹é‡æœºåˆ¶ï¼›å¦åˆ™ï¼Œè‡ªå®šä¹‰çš„ LayoutManager éœ€è¦é‡å†™ onMeasure æ¥å¤„ç†è‡ªèº«çš„æµ‹é‡å·¥ä½œã€‚ è‡ªåŠ¨æµ‹é‡åŽŸç†ï¼š å½“ RecyclerView çš„å®½é«˜éƒ½ä¸º EXACTLY æ—¶ï¼Œ å¯ä»¥ç›´æŽ¥è®¾ç½®å¯¹åº”çš„å®½é«˜ï¼Œç„¶åŽè¿”å›žï¼Œç»“æŸæµ‹é‡ å¦‚æžœå®½é«˜éƒ½ä¸æ—¶ EXACTLY åˆ™ä¼šåœ¨ onMeasure ä¸­å¼€å§‹å¸ƒå±€çš„å¤„ç†ã€‚ RecyclerView.State è¿™ä¸ªç±»å°è£…äº†å½“å‰ RecyclerView çš„ä¿¡æ¯ã€‚State ä¸­çš„ä¸€ä¸ªå˜é‡ mLayoutStep è®°å½•äº† RecyclerView å½“å‰çš„å¸ƒå±€çŠ¶æ€ STEP_START STEP_LAYOUT STEP_ANIMATIONS å¯¹åº”çš„ï¼Œ RecyclerView çš„å¸ƒå±€è¿‡ç¨‹ä¹Ÿåˆ†ä¸ºä¸‰æ­¥ï¼ŒSTEP_START è¡¨ç¤ºå¼€å§‹å¸ƒå±€ï¼Œå¯¹åº”éœ€è¦è°ƒç”¨ dispatchLayoutStep1() æ¥æ‰§è¡Œç¬¬ä¸€æ­¥å¸ƒå±€ï¼Œç»“æŸåŽï¼Œ mLayoutStep å˜ä¸º STEP_LAYOUT ï¼Œè¡¨ç¤ºæŽ¥ä¸‹æ¥éœ€è¦è°ƒç”¨ dispatchLayoutStep2() è¿›è¡Œå¸ƒå±€ï¼Œç»“æŸåŽ mLayoutStep å˜ä¸º STEP_ANIMATIONS, ç»§ç»­æ‰§è¡Œç¬¬ä¸‰æ­¥ dispatchLayoutStep3() dispatchLayoutStep1: è´Ÿè´£è®°å½•çŠ¶æ€ dispatchLayoutStep2ï¼šè´Ÿè´£å¸ƒå±€ dispatchLayoutStep3ï¼šä¸Ž step1 æ¯”è¾ƒï¼Œæ ¹æ®å˜åŒ–æ¥è§¦å‘åŠ¨ç”» onLayout 1234567891011121314151617181920212223242526protected void onLayout(boolean changed, int l int t, int r, int b) &#123; TraceCompat.beginSection(TRACE_ON_LAYOUT_TAG); dispatchLayout(); TraceCompat.endSection(); mFirstLayoutComplete = true;&#125;void dispatchLayout() &#123; mState.mIsMeasuring = false; if(mState.mLayoutStep == State.STEP_START) &#123; dispatchLayoutStep1(); mLayout.setExactMeasureSpecsFrom(this); dispatchLayoutStep2(); &#125; else if(mAdapterHelper.hasUpdates() || mLayout.getWidth() != getWidth() || mLayout.getHeight() != getHeight()) &#123; // first 2 steps are done in onMeasure but looks like we have to run again due to changed size mLayout.setExactMeasureSpecsFrom(this); dispatchLayoutStep2(); &#125; else &#123; // always make sure we sync them (to ensure mode is exact) mLayout.setExactMeasureSpecsFrom(this); &#125; dispatchLayoutStep3();&#125; é€šè¿‡ dispatchLayout å¯ä»¥éªŒè¯RecyclerView çš„ layoutä¸‰æ­¥èµ°åŽŸåˆ™ï¼Œå¦‚æžœåœ¨ onMeasure ä¸­å·²ç»å®Œæˆäº† step1 å’Œ step2 ï¼Œåˆ™åªä¼šæ‰§è¡Œ step3ï¼Œå¦åˆ™ï¼Œä¼šåœ¨ onLayout ä¸­ä¾æ¬¡è§¦å‘ä¸‰æ­¥èµ°ã€‚ dispatchLayoutStep1 1234567891011private void dispatchLayoutStep1()&#123; if(mState.mRunSimpleAnimations) &#123; int count = mChildHelper.getChildCount(); for(int i = 0; i &lt; count; i++) &#123; final ViewHolder holder = getChildViewHolderInt(mChildHelper.getChildAt(i)); final ItemHolderInfo animationInfo = mItemAnimator.recordPreLayoutInformation(mState, holder, ItemAnimator.buildAdapterChangeFlagsForAnimations(holder), holder.getUnmodifiedPayloads()); mViewInfoStore.addToPreLayout(holder, animationInfo); &#125; &#125; mState.mLayoutStep = State.STEP_LAYOUT&#125; step çš„ç¬¬ä¸€æ­¥ç›®çš„å°±æ˜¯è®°å½• View çš„çŠ¶æ€ï¼Œå…ˆéåŽ†å½“å‰æ‰€æœ‰ Viewï¼Œä¸€æ¬¡è¿›è¡Œå¤„ç†ï¼ŒmItemAnimator ä¼šæ ¹æ®æ¯ä¸ª View çš„ä¿¡æ¯ï¼Œå°è£…ä¸€ä¸ª ItemHolderInfo, è¿™ä¸ª ItemHolderInfo ä¸­ä¸»è¦åŒ…å«çš„å°±æ˜¯ View çš„ä½ç½®çŠ¶æ€ç­‰ã€‚ç„¶åŽå°† ItemHodlerInfo å­˜å…¥ mViewInfoStore ä¸­ã€‚åœ¨è¿›å…¥ç¬¬äºŒæ­¥åŽï¼Œ View çš„ä¿¡æ¯å°±å°†è¢«æ”¹å˜ dispatchLayoutStep2 12345private void dispatchLayoutStep2()&#123; mLayout.onLayoutChildren(mRecycler, mState); mState.mLayoutStep = State.STATE_ANIMATIONS;&#125; layout çš„ç¬¬äºŒæ­¥å°±æ˜¯çœŸæ­£çš„å¸ƒå±€ Viewã€‚RecyclerView çš„çœŸæ­£å¸ƒå±€æ˜¯ç”± LayoutManger æ¥è´Ÿè´£çš„ï¼Œå…¶ä¸»è¦å·¥ä½œä¹Ÿåœ¨ LayoutManager ä¸­ã€‚ 1234567891011121314151617181920212223242526272829303132public void onLayoutChildren(RecyclerView.Recycler recycler, RecyclerView.State state) &#123; if(!mAnchorInfo.mValid || mPendingScrollPosition != NO_POSITION || mPendingSavedState != null) &#123; updateAnchorInfoForLayout(recycler, state, mAnchorInfo); &#125; if(mAnchorInfo.mLayoutFromEnd) &#123; firstLayoutDirection = mShouldReverseLayout ? LayoutState.ITEM_DIRECTIONTAIL : LayoutState.ITEM_DIRECTION_HEAD; &#125; else &#123; firstLayoutDirection = mShouldReverseLayout ? LayoutState.ITEM_DIRECTION_HEAD : LayoutState.ITEM_DIRECTION_TAIL; &#125; onAnchorReady(recycler, state, mAnchorInfo, firstLayoutDirection); if(mAnchorInfo.mLayoutFromEnd) &#123; &#125; else &#123; // fill towards end updateLayouStateToFillEnd(mAnchorInfo); fill(recycler, mLayoutState, state, false); // fill towards start updateLayoutStateToFillStart(mAnchorInfo); fill(recycler, mLayoutState, state, false); &#125;&#125; æµç¨‹å¾ˆè´Ÿè´£ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ æ‰¾åˆ° anchorç‚¹ æ ¹æ® anchor ä¸€ç›´å‘å‰å¸ƒå±€ï¼Œç›´åˆ°å¡«å……æ»¡ anchor ç‚¹å‰é¢çš„æ‰€æœ‰åŒºåŸŸ æ ¹æ® anchor ä¸€ç›´å‘åŽå¸ƒå±€ï¼Œç›´åˆ°å¡«å……æ»¡ anchor ç‚¹åŽé¢çš„æ‰€æœ‰åŒºåŸŸ anchor ç‚¹çš„å¯»æ‰¾æ˜¯ç”± updateAnchorInfoForLayout å‡½æ•°è´Ÿè´£ã€‚å‘ä¸‹è¿½è¸ªä¼šçœ‹åˆ° updateAnchorFromChildren æ–¹æ³•ï¼Œå…¶å†…å®¹ä¸ºï¼Œå…ˆå¯»æ‰¾è¢« focus çš„ childï¼Œ æ‰¾åˆ°ä»¥æ­¤ child ä½œä¸º anchor ï¼Œå¦åˆ™æ ¹æ®å¸ƒå±€æ–¹å‘å¯»æ‰¾æœ€åˆé€‚çš„ child æ¥ä½œä¸º anchorï¼Œå¦‚æžœæ‰¾åˆ°åˆ™å°† child çš„ä¿¡æ¯å¤åˆ¶ç»™ anchorInfo ã€‚ anchorInfo ä¸»è¦è®°å½•çš„ä¿¡æ¯å°±æ˜¯ View çš„ç‰©ç†ä½ç½®ä¸Ž Adapter ä¸­çš„ä½ç½®ã€‚æ‰¾åˆ°åŽè¿”å›ž trueï¼Œå¦åˆ™è¿”å›ž falseï¼Œäº¤ç»™ä¸Šä¸€æ­¥å‡½æ•°åšå¤„ç†ã€‚ ç»§ç»­å½“æ‰¾åˆ° anchor åŽï¼Œä¼šæ ¹æ® anchor æ¥å¸ƒå±€ï¼Œé€šè¿‡ fill æ–¹æ³•æ¥å®Œæˆ 1234567891011121314int fill(RecyclerView.Recycler recycler, LayoutState layoutState, RecyclerView.state state, boolean stopOnFocusable) &#123; final int start = layoutState.mAvailable; if(layoutState.mScrollingOffset != LayoutState.SCROLLING_OFFSET_NaN) &#123; recycleByLayoutState(recycler, layoutState); &#125; int remainingSpace = layoutState.mAvailable + layoutState.mExtra; LayoutChunkResult layoutChunkResult = mLayoutChunkResult; while((layoutState.mInfinite || remainingSpace &gt; 0) &amp;&amp; layoutState.hasMore(state)) &#123; layoutChunk(recycler, state, layoutState, layoutChunkResult); &#125; return start-layoutState.mAvailable;&#125; recycleByLayoutState è¿™ä¸ªå‡½æ•°ï¼Œä¼šæ ¹æ®å½“å‰ä¿¡æ¯å¯¹ä¸éœ€è¦çš„ View è¿›è¡Œå›žæ”¶: 1234567private void recycleByLayoutState(RecyclerView.Recycler recycler, LayoutState layoutState) &#123; if(layoutState.mLayoutDirection == LayoutState.LAYOUT_START) &#123; &#125; else &#123; recycleViewsFromStart(recycler, layoutState.mScrollingOffset); &#125;&#125; ç»§ç»­çœ‹ recycleViewsFromStart 12345678910111213141516private void recycleViewsFromStart(RecyclerView.Recycler recycler, int dt)&#123; final int limit = dt; final int childCount = getChildCount(); if(mShouldReverseLayout) &#123; &#125; else &#123; for(int i = 0; i &lt; childCount; i++)&#123; View child = getChildAt(i); if(mOrientationHelper.getDecoratedEnd(child) &gt; limit || mOrientationHelper.getTransformedEndWithDecoration(child) &gt; limit) &#123; recycleChildren(recycler, 0, i); return; &#125; &#125; &#125;&#125; è¯¥å‡½æ•°çš„ä½œç”¨æ—¶éåŽ†æ‰€æœ‰çš„å­ View ,æ‰¾å‡ºé€ƒç¦»è¾¹ç•Œçš„ View è¿›è¡Œå›žæ”¶ï¼Œå›žæ”¶å‡½æ•°åœ¨ recycleChildren é‡Œï¼Œè€Œè¿™å‡½æ•°åˆè°ƒç”¨äº† removeAndRecycleViewAt 12345public void removeAndRecycleViewAt(int index, Recycler recycler) &#123; final View view = getChildAt(index); removeViewAt(index); recycler.recycleView(view);&#125; è¯¥å‡½æ•°å…ˆè°ƒç”¨ removeViewAt ï¼Œå°† View ä»Ž RecyclerView ä¸­ç§»é™¤ï¼Œç´§æŽ¥ç€æ˜¯ recycler æ‰§è¡Œäº† View çš„å›žæ”¶é€»è¾‘ã€‚åœ¨ fill å‡½æ•°çš„ä¸€å¼€å§‹ä¼šåŽ»å›žæ”¶é€ƒç¦»å‡ºå±å¹•çš„ viewã€‚ 1234while((layoutState.mInfinite || remainningSpace &gt; 0) &amp;&amp; layoutState.hasMore(state)) &#123; layoutChunk(recycler, state, layoutState, layoutChunkResult);&#125; åªè¦åˆå‰©ä½™ç©ºé—´ï¼Œå°±ä¼šæ‰§è¡Œ layoutChunk æ–¹æ³• 12345678910111213141516void layoutChunk(RecyclerView.Recycler recycler, RecyclerView.State stat, LayoutState layoutState, LayoutCHunkResult result)&#123; View view = layoutState.next(recycler); LayoutParams params = (LayoutParams) view.getLayoutParams(); if(layoutState.mScrapList == null) &#123; if(mShouldReverseLayout == (layoutState.mLayoutDirection == LayoutState.LAYOUT_START)) &#123; addView(view); &#125; else &#123; addView(view, 0); &#125; &#125; else &#123; &#125; layoutDecoratedWithMargins(view, left, top, right, bottom);&#125; åœ¨ layoutState çš„ next æ–¹æ³•è¿”å›žäº†ä¸€ä¸ª viewï¼Œ å‡­ç©ºå˜å‡ºä¸€ä¸ª Viewï¼Œ å¾ˆç¥žå¥‡ 1234View next(RecyclerView.Recycler recycler ) &#123; final View view = recycler.getViewForPosition(mCurrentPosition); return view;&#125; å¯è§ view çš„èŽ·å–é€»è¾‘ä¹Ÿæ˜¯ç”± recycler æ¥è´Ÿè´£ï¼Œ æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ¸…æ¥š recycler å¯ä»¥æ ¹æ®ä½ç½®è¿”å›žä¸€ä¸ª View å³å¯ã€‚ æˆ‘ä»¬åœ¨çœ‹ layoutChunk å¯¹åˆšåˆšç”Ÿæˆçš„ View çš„å¤„ç† 12345if(mShouldReverseLayout == (layoutState.mLayoutDirectoin == LayoutState.LAYOUT_STATE)) &#123; addView(view);&#125; else &#123; addView(view, 0);&#125; æ˜Žæ˜¾çš„è°ƒç”¨äº† addView æ–¹æ³•ï¼Œè™½ç„¶è¿™ä¸ªæ–¹æ³•æ˜¯ LayoutManager çš„ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æœ€ç»ˆä¼šå¤šæ¬¡è¾—è½¬è°ƒç”¨åˆ° Recycler View çš„ addView æ–¹æ³•ï¼Œå°† view æ·»åŠ åˆ° RecyclerView ä¸­ã€‚ dispatchLayoutStep2 æ•´ä¸ªå¸ƒå±€è¿‡ç¨‹ï¼Œå®Œæˆäº†å¯¹ å­ View çš„æµ‹é‡ä¸Žå¸ƒå±€ dispatchLayoutStep3æœ€åŽä¸€æ­¥ 1234567891011private void dispatchLayoutStep3()&#123; mState.mLayoutStep = State.STEP_START; if(mState.mRunSimpleAnimations) &#123; for(int i = mChildHelper.getChildCount() - 1; i &gt;= 0; i--) &#123; final ItemHolderInfo animationInfo = mItemAnimator.recordPostLayoutInformation(mState, holder); mViewInfoStore.addToPostLayout(holder, animationInfo); &#125; mViewInfoStore.process(mViewInfoProcessCallback); &#125;&#125; è¿™é‡Œæ˜¯ä¸Žç¬¬ä¸€æ­¥å‘¼åº”çš„ï¼Œæ­¤æ—¶å­ View éƒ½å·²å¸ƒå±€å®Œæˆï¼Œæ‰€ä»¥å­ View çš„ä¿¡æ¯éƒ½å‘ç”Ÿäº†å˜åŒ–ã€‚ç¬¬ä¸€æ­¥å‡ºçŽ°çš„ mViewInfoStore å’Œ mItemAnimator å†æ¬¡ç™»åœºï¼Œè¿™æ¬¡ mItemAnimator è°ƒç”¨çš„æ˜¯ recordPostLayoutInformation æ–¹æ³•ï¼Œè€Œ mViewInfoStore è°ƒç”¨çš„æ˜¯ addToPostLayout æ–¹æ³•ï¼Œ 12345678void addToPostLayout(ViewHolder holder, ItemHolderInfo info) &#123; InfoRecord record = mLayoutHolderMap.get(holder); if(record == null ) &#123; record = InfoRecord.obtain(); mLayoutHolderMap.put(holder, record); &#125; record.postInfo = info;record.flags |= FLAT_POST;&#125; æœ€åŽ mViewInfoStore è°ƒç”¨äº† process æ–¹æ³•ï¼Œæ ¹æ® mViewInfoStore ä¸­çš„ View ä¿¡æ¯ï¼Œæ¥æ‰§è¡ŒåŠ¨ç”»é€»è¾‘ã€‚ ç¼“å­˜é€»è¾‘ RecyclerView çš„ç¼“å­˜æ—¶åˆ†ä¸ºå¤šçº§çš„ï¼Œä½†å…¶å®žçœŸä¸ªé€»è¾‘å¾ˆå¥½ç†è§£ï¼Œ 12345678910111213141516171819202122232425262728293031323334353637383940414243View getViewForPosition(int position, boolean dryRun) &#123; boolean fromScrap = false; ViewHolder holder = null; if(mState.isPreLayout()) &#123; holder = getChangedScrapViewForPosition(position); fromScrap = holder != null &#125; if(hoder == null) &#123; hodler = getScrapViewForPosition(position, INVALID_TYPE, dryRun); &#125; if(holder == null )&#123; final int offsetPosition = mAdapterHelper.findPositionOffset(position); final int type = mAdapter.getItemViewType(offsetPosition); if(mAdapter.hasStableIds())&#123; holder = getScrapViewForId(mAdapter.getItemId(offsetPosition), type, dryRun); &#125; if(holder == null &amp;&amp; mViewCacheExtension != null) &#123; final View view = mViewCacheExtension.getViewForPositionAndType(this, position, type); &#125; if(holder == null) &#123; // fallback to recycler holder = getRecyclerViewPool().getRecyclerView(type); if(holder != null)&#123; holder.resetInternal(); if(FORCE_INVALIDATE_DISPLAY_LIST)&#123; invalidateDisplayListInt(holder); &#125; &#125; &#125; if(holder == null )&#123; holder = mAdapter.createViewHolder(RecyclerView.this, type); &#125; &#125; // ç”Ÿæˆ LayoutParams çš„ä»£ç  return holder.itemView;&#125; èŽ·å– View çš„é€»è¾‘å¯ä»¥æ•´ç†ä¸º æœç´¢ mChangedScrapï¼Œ å¦‚æžœæ‰¾åˆ°åˆ™è¿”å›žç›¸åº”çš„ holder æœç´¢ mAttachedScrapä¸Ž mCachedViewsï¼Œ å¦‚æžœæ‰¾åˆ°ä¸” holder æœ‰æ•ˆåˆ™è¿”å›žç›¸åº”çš„ holder å¦‚æžœè®¾ç½®äº† mViewCacheExtension, å¯¹å…¶è°ƒç”¨ getViewForPositionAndType æ–¹æ³•è¿›è¡ŒèŽ·å–ï¼Œè‹¥è¿”å›žç»“æžœåˆ™ç”Ÿæˆå¯¹åº”çš„ holder æœç´¢ mRecyclerPool, å¦‚æžœæ‰¾åˆ°åˆ™è¿”å›ž Holder å¦‚æžœä¸Šè¿°è¿‡ç¨‹éƒ½æ²¡æœ‰æ‰¾åˆ°å¯¹é¥®çš„ holder, åˆ™æ‰§è¡Œ Adapter.createViewHolder(); åˆ›å»ºæ–°çš„ ViewHolder å®žä¾‹ å¯¹äºŽ View çš„å›žæ”¶ 12345678910111213141516171819202122void recycleViewHolderInternal(ViewHolder holder ) &#123; if(holder.isRecyclable()) &#123; if(!holder.hasAnyOfTheFlags(VieHolder.FLAG_INVALID | ViewHolder.FLAG_REMOVED) | ViewHolder.FLAG_UPDATE) &#123; int cachedViewSize = mCachedViews.size(); if(cachedViewSize &gt;= mViewCacheMax &amp;&amp; cachedViewSize &gt; 0) &#123; recycleCachedViewAt(0); cachedViewSize--; &#125; if(cachedViewSize &lt; mViewCacheMax) &#123; mCachedViews.add(holder); cached = true; &#125; &#125; if(!cached) &#123; addViewHolderToRecycledViewPool(holder); recycled = true; &#125; &#125;&#125; å›žæ”¶æ²¡æœ‰åˆ›å»ºå¤æ‚ï¼Œåªæ¶‰åŠåˆ°ä¸¤æ¬¡ç¼“å­˜ï¼Œ mCachedViews å’Œ mRecyclerPool , mCachedViews ç›¸å½“äºŽä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æž„ï¼Œå½“æœ‰ä¿¡çš„ View éœ€è¦ç¼“å­˜æ—¶ï¼Œéƒ½ä¼šå°†æ–°çš„ View å­˜å…¥åˆ° mCachedViewsï¼Œ è€Œ mCachedView åˆ™ä¼šç§»é™¤å¤´éƒ¨å…ƒç´ ï¼Œå¹¶å°†å¤´éƒ¨å…ƒç´ å­˜å‚¨åœ¨ mRecyclerPool ä¸­ï¼Œ å³ mCachedViews ç›¸å½“äºŽä¸€çº§ç¼“å­˜ï¼Œ mRecyclerPool ç›¸å½“äºŽäºŒçº§ç¼“å­˜ï¼Œã€‚å¹¶ä¸” mRecyclerPool æ—¶å¯ä»¥å¤šä¸ª RecyclerView å…±äº«çš„ã€‚ ä¸Ž AdapterView æ¯”è¾ƒ index AdapterView RecyclerView 1 Simple click listener OnItemTouchListener 2 Simple Divider ItemDecoration 3 ListView and GridView LinearLayoutManagerGridLayoutManager.. 4 RecyclerBin Recycler 5 Header and Footer Partial refresh ç‚¹å‡»äº‹ä»¶ ListView åŽŸç”Ÿæä¾›äº†Item ç‚¹å‡»ã€é•¿å®‰çš„äº‹ä»¶ï¼Œè€Œ RecyclerView åˆ™éœ€è¦ä½¿ç”¨ onTouchListener ç›¸å¯¹æ¯”è¾ƒå¤æ‚ åˆ†å‰²çº¿ ListView å¯ä»¥å¾ˆè½»æ¾è®¾æ–½ Divider å±žæ€§æ¥æ˜¾ç¤º item ä¹‹é—´çš„åˆ†å‰²çº¿ï¼Œ RecyclerView éœ€è¦è‡ªå·±å®žçŽ° ItemDecoration ï¼Œä¸¤è€…æ¯”è¾ƒï¼Œå‰è€…ä½¿ç”¨æ›´ç®€å•ï¼ŒåŽè€…å®šåˆ¶æ€§æ›´å¼º å¸ƒå±€ç±»åž‹ AdapterView æä¾›äº† ListView å’Œ GridView ä¸¤ç§ï¼Œ RecyclerView æä¾›äº† LinearLayoutManger å’Œ GirdLayoutManagerã€‚ç›¸æ¯”è¾ƒ RecyclerView æ›´æ¢å¸ƒå±€æ–¹å¼æ›´è½»æ¾ï¼ŒAdapterView åˆ™éœ€è¦æ›´æ¢ä¸€ä¸ª Viewã€‚ ç¼“å­˜æ–¹å¼ ListView ä½¿ç”¨äº† RecyclerBin ç±»è´Ÿè´£è§†å›¾çš„ç¼“å­˜ï¼ŒRecyclerView ä½¿ç”¨ Recycler è¿›è¡Œç¼“å­˜ï¼ŒåŽŸç†åŸºæœ¬ä¸€è‡´ ä¸åŒç‚¹ å±€éƒ¨åˆ·æ–° ListView ä¸­æƒ³å±€éƒ¨åˆ·æ–°æŸä¸ª item éœ€è¦è‡ªå·±æ¥ç¼–å†™åˆ·æ–°é€»è¾‘ï¼Œ è€Œ RecyclerView ä¸­å¯ä»¥é€šè¿‡ notifyItemChanged(position) æ¥å®Œæˆï¼Œç”šè‡³å¯ä»¥é€šè¿‡ notifyItemChanged(position, payload) ä¼ å…¥ä¸€ä¸ª payload ä¿¡æ¯æ¥åˆ·æ–°å•ä¸ª item ä¸­çš„ç‰¹å®šå†…å®¹ã€‚ åŠ¨ç”» RecyclerView å†…éƒ¨é€šè¿‡ ItemAnimation ç±»å®Œæˆäº†åŠ¨ç”»æ“ä½œï¼Œè€Œ ListView åšåŠ¨ç”»æ¯”è¾ƒå›°éš¾ åµŒå¥—å¸ƒå±€ RecyclerView å®žçŽ°äº† NestedScrollingChild æŽ¥å£ï¼Œå¯ä»¥å’Œä¸€åˆ‡åµŒå¥—ç»„ä»¶å¾ˆå¥½çš„å·¥ä½œ ListView åŽŸç”Ÿç‰¹ç‚¹ å¤´éƒ¨ä¸Žå°¾éƒ¨æ”¯æŒ ListView åŽŸç”Ÿæ”¯æŒå¤´éƒ¨å’Œå°¾éƒ¨çš„æ·»åŠ ï¼Œè™½ç„¶ RecyclerView å¯ä»¥é€šè¿‡å®šä¹‰ä¸åŒçš„ Type æ¥åæ”¯æŒï¼Œä½†å®žé™…åº”ç”¨ä¸­ï¼Œå°è£…ä¸å¥½ä¼šé€ æˆé—®é¢˜ã€‚å› ä¸º Adapter ä¸­çš„æ•°æ®ä½ç½®ä¸Žç‰©ç†æ•°æ®ä½ç½®å‘ç”Ÿäº†åç§»ã€ å¤šé€‰ æ”¯æŒå¤šé€‰å’Œå•é€‰çš„ ListView æ›´æ–¹ä¾¿ å¤šæ•°æ®æºæ”¯æŒ ListView æä¾›äº† Cursor Adapterï¼Œ ArrayAdapter å¯ä»¥å¾ˆæ–¹ä¾¿ä»Žæ•°æ®åº“æˆ–è€…æ•°ç»„ä¸­èŽ·å–æ•°æ®ã€‚ æ€»ç»“ RecyclerView çš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯çµæ´»ï¼Œæ­£æ˜¯å› ä¸ºçµæ´»ï¼Œä¹Ÿç‰ºç‰²äº†å¾ˆå¤šä¾¿åˆ©æ€§ï¼Œè€Œ AdapterView æ¯”è¾ƒåˆ»æ¿ï¼ŒåŽŸç”Ÿæ–¹æ³•ç»™ä¸Žå¼€å‘å¾ˆå¤šä¾¿åˆ©ã€‚]]></content>
  </entry>
  <entry>
    <title><![CDATA[Android Q æ–‡ä»¶æƒé™é€‚é…]]></title>
    <url>%2F2020%2F03%2F11%2FAndroid-Q-%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E9%80%82%E9%85%8D%2F</url>
    <content type="text"><![CDATA[éšç€ Android Q çš„å‘å¸ƒï¼Œéšä¹‹è€Œæ¥çš„é€‚é…å·¥ä½œä¹Ÿåœ¨æš—æ½®æ¶ŒåŠ¨ï¼Œè¿™é‡Œè¯´ä¸€ä¸‹ Android Q æ–‡ä»¶å­˜å‚¨ï¼›Android Q åœ¨å¤–éƒ¨å­˜å‚¨è®¾å¤‡ä¸­ä¸ºæ¯ä¸ªåº”ç”¨æä¾›äº†ä¸€ä¸ªâ€œæ²™ç›’â€ï¼Œä»»ä½•å…¶ä»–åº”ç”¨éƒ½æ— æ³•ç›´æŽ¥è®¿é—®æ‚¨çš„æ²™ç›’æ–‡ä»¶ã€‚ç”±äºŽæ–‡ä»¶æ˜¯æ‚¨åº”ç”¨çš„ç§æœ‰æ–‡ä»¶ï¼Œå› æ­¤æ‚¨ä¸åœ¨éœ€è¦ä»»ä½•æƒé™å³å¯åœ¨å¤–éƒ¨å­˜å‚¨è®¾å¤‡ä¸­è®¿é—®å’Œä¿å­˜è‡ªå·±çš„è®¾å¤‡ã€‚è¿™æ¬¡æ›´æ–°æœ‰æ•ˆçš„ä¿è¯äº†ç”¨æˆ·æ–‡ä»¶çš„éšç§æ€§ï¼Œä¹Ÿèµšå°‘äº†å¯¹åº”åº”ç”¨æ‰€éœ€è¦çš„æƒé™æ•°é‡ã€‚ â€œæ²™ç›’â€å°±æ˜¯åº”ç”¨çš„ä¸“å±žæ–‡ä»¶ï¼Œå¹¶ä¸”è®¿é—®è¿™ä¸ªæ–‡ä»¶å¤¹æ— éœ€ä»»ä½•æƒé™ã€‚Google æŽ¨èåº”ç”¨çš„æ²™ç›’å†…å­˜å‚¨æ–‡ä»¶åœ°å€ä¸ºContext.getExternalFilesDir() ä¸‹çš„æ–‡ä»¶å¤¹ã€‚éœ€è¦ä¼ å…¥ä»¥ä¸‹å‚æ•° 1234567Environment.DIRECTORY_MUSICEnvironment.DIRECTORY_PODCASTSEnvironment.DIRECTORY_RINGTONESEnvironment.DIRECTORY_ALARMSEnvironment.DIRECTORY_NOTIFICATIONSEnvironment.DIRECTORY_PICUTRESEnvironment.DIRECTORY_MOVIES å¯æ ¹æ®å…·ä½“éœ€è¦ï¼Œä¼ å…¥ä¸é€šçš„å‚æ•°ã€‚ 1234567891011121314151617181920212223/** * èŽ·å–ä¸€ä¸ªæ–‡ä»¶é€šè¿‡æ–‡ä»¶å¤¹ç±»åž‹ * * @param fileName * @param boxType * @param defaultPath * @return * @throws FileNotFoundException */default File getFile(String fileName, String boxType, String defaultPath) throws FileNotFoundException &#123; File file; if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.Q) &#123; file = getCurrentContext().getExternalFilesDir(boxType + File.separator + fileName); &#125; else &#123; file = new File(defaultPath + fileName); &#125; if (file == null || !file.exists()) &#123; throw new FileNotFoundException(); &#125; return file;&#125; ä»¥ä¸Šä»£ç æœªç»æµ‹è¯•ï¼Œå¿˜è§è°… æŽ¥ä¸‹æ¥è¯´ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ç³»ç»Ÿå…¬å…±æ–‡ä»¶ï¼Œæ¯”å¦‚ç›¸å†Œï¼Œç›¸æœºï¼Œä¸‹è½½ç›®å½•ç­‰ï¼Œè¿™é‡Œä»¥è®¿é—®ç›¸å†Œä¸ºä¾‹ï¼š è®¿é—®æ²™ç›’å¤–(å…¶ä»–åº”ç”¨)çš„æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œä¾ç„¶éœ€è¦ç”³è¯·æ–‡ä»¶æƒé™ï¼ŒManifest.permission.READ_EXTERNAL_STORAGE å’Œ Manifest.permission.WRITE_EXTERNAL_STORAGE æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹èŽ·å–ç›¸å†Œèµ„æºçš„ä»£ç ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859final Uri contentUri = MediaStore.Files.getContentUri("external"); final String sortOrder = MediaStore.Files.FileColumns.DATE_MODIFIED + " DESC"; final String selection = "(" + MediaStore.Files.FileColumns.MEDIA_TYPE + "=?" + " OR " + MediaStore.Files.FileColumns.MEDIA_TYPE + "=?)" + " AND " + MediaStore.MediaColumns.SIZE + "&gt;0"; final String[] selectionAllArgs = &#123;String.valueOf(MediaStore.Files.FileColumns.MEDIA_TYPE_IMAGE)&#125;; ContentResolver contentResolver = mContext.getContentResolver(); String[] projections; projections = new String[]&#123;MediaStore.Files.FileColumns._ID, MediaStore.MediaColumns.DATA, MediaStore.MediaColumns.DISPLAY_NAME, MediaStore.MediaColumns.DATE_MODIFIED, MediaStore.MediaColumns.MIME_TYPE, MediaStore.MediaColumns.WIDTH, MediaStore .MediaColumns.HEIGHT, MediaStore.MediaColumns.SIZE&#125;; Cursor cursor = contentResolver.query(contentUri, projections, selection, selectionAllArgs, sortOrder); if (cursor != null &amp;&amp; cursor.moveToFirst()) &#123; int pathIndex = cursor.getColumnIndex(MediaStore.MediaColumns.DATA); int mimeTypeIndex = cursor.getColumnIndex(MediaStore.MediaColumns.MIME_TYPE); int sizeIndex = cursor.getColumnIndex(MediaStore.MediaColumns.SIZE); int widthIndex = cursor.getColumnIndex(MediaStore.MediaColumns.WIDTH); int heightIndex = cursor.getColumnIndex(MediaStore.MediaColumns.HEIGHT); do &#123; long size = cursor.getLong(sizeIndex); if (size &lt; 1) &#123; continue; &#125; String type = cursor.getString(mimeTypeIndex); String path = cursor.getString(pathIndex); if (TextUtils.isEmpty(path) || TextUtils.isEmpty(type)) &#123; continue; &#125; int width = cursor.getInt(widthIndex); int height = cursor.getInt(heightIndex); if (width &lt; 1 || height &lt; 1) &#123; continue; &#125; File file = new File(path); if (!file.exists() || !file.isFile()) &#123; continue; &#125; File parentFile = file.getParentFile(); if (parentFile != null) &#123; images.add(path); &#125; &#125; while (cursor.moveToNext()); cursor.close(); &#125; é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨å›¾ç‰‡åŠ è½½å·¥å…·å°†å›¾ç‰‡æ˜¾ç¤ºå‡ºæ¥ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨AndroidManifest.xml ä¸­çš„ &lt;application&gt; æ ‡ç­¾ä¸­åŠ å…¥ android:requestLegacyExternalStorage=&quot;true&quot;]]></content>
  </entry>
  <entry>
    <title><![CDATA[ASpectJ åˆè¯†]]></title>
    <url>%2F2020%2F03%2F06%2FASpectJ-%E5%88%9D%E8%AF%86%2F</url>
    <content type="text"><![CDATA[é¦–å…ˆæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ AOP AOP(é¢å‘åˆ‡é¢ç¼–ç¨‹) è¢«è®¤ä¸ºæ˜¯ OOPï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰ çš„ä¸€ä¸ªå¼ºå¤§è¡¥å……ï¼Œæœ‰äº† AOP ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåˆ†æ•£åœ¨åº”ç”¨å„å¤„çš„è¡Œä¸ºæ”¾åœ¨å¯é‡ç”¨çš„æ¨¡å—ä¸­ï¼Œæœ‰æ•ˆå‡å°‘å†—ä½™ä»£ç ï¼Œå¹¶è®©æˆ‘ä»¬çš„ç±»åªå…³æ³¨è‡ªèº«çš„ä¸»è¦åŠŸèƒ½ é¢å‘åˆ‡é¢ç¼–ç¨‹ AOPï¼ˆaspect oriented programmingï¼‰ï¼Œæ˜¯ä¸€ç§å°†æ¨ªåˆ‡å…³æ³¨ç‚¹ä¸Žä¸šåŠ¡é€»è¾‘åˆ†ç¦»çš„ç¼–ç¨‹æ–¹å¼ã€‚æ¯ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹éƒ½é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå„¿ä¸æ˜¯åˆ†æ•£åœ¨å¾ˆå¤šå¤„ä»£ç ä¸­ã€‚è¿™æ ·æˆ‘ä»¬çš„æœåŠ¡æ¨¡å—æ›´åŠ ç®€æ´ï¼Œå› ä¸ºä»–ä»¬åªåŒ…å«äº†ä¸»è¦å…³æ³¨ç‚¹çš„ä»£ç ï¼Œè€Œæ¬¡è¦çš„åŠŸèƒ½æˆ–è€…è¯´æ˜¯è¾…åŠ©çš„åŠŸèƒ½è¢«è½¬ç§»åˆ°åˆ‡é¢ä¸­ã€‚ AOP æœ¯è¯­ key åˆ«å æè¿° Advice é€šçŸ¥ åˆ‡é¢çš„å…·ä½“è¡Œä¸ºï¼Œè¦æ‰§è¡Œçš„ä»£ç  PointCut åˆ‡ç‚¹ é€šçŸ¥è¢«åº”ç”¨çš„å…·ä½“ä½ç½® Join Point è¿žæŽ¥ç‚¹ ç¨‹åºè¿è¡Œæ—¶ï¼Œèƒ½å¤Ÿåº”ç”¨é€šçŸ¥çš„æ‰€æœ‰ç‚¹ Aspect åˆ‡é¢ ä»€ä¹ˆæ—¶å€™åœ¨ä»€ä¹ˆåœ°æ–¹åšä»€ä¹ˆäº‹æƒ…ï¼Œæ˜¯åˆ‡ç‚¹å’Œé€šçŸ¥çš„ç»“åˆ Target ç›®æ ‡å¯¹è±¡ è¢«åˆ‡å…¥åŠŸèƒ½çš„ç›®æ ‡å¯¹è±¡ Introduction å¼•å…¥ å°†æ–°çš„æ–¹æ³•æˆ–å±žæ€§å¼•å…¥åˆ°çŽ°æœ‰çš„ç±»ä¸­ Weaving ç»‡å…¥ å°†åˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡å¹¶åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ AOP åº•å±‚é€šè¿‡ä½¿ç”¨åŠ¨æ€ä»£ç†å®žçŽ°ï¼ŒåŒ…å«ä¸¤ç§æ–¹å¼ï¼š ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†å®žçŽ° ä½¿ç”¨ cglib å®žçŽ° é€šçŸ¥ç±»åž‹ å‰ç½®é€šçŸ¥(Befor)ï¼šåœ¨æ–¹æ³•ä¹‹å‰æ‰§è¡Œ åŽç½®é€šçŸ¥(After)ï¼šåœ¨æ–¹æ³•ä¹‹åŽæ‰§è¡Œ å¼‚å¸¸é€šçŸ¥(AfterThrowing)ï¼šæ–¹æ³•å‡ºçŽ°å¼‚å¸¸æ‰§è¡Œ æœ€ç»ˆé€šçŸ¥(AfterReturning)ï¼šåœ¨åŽç½®ä¹‹åŽæ‰§è¡Œ çŽ¯ç»•é€šçŸ¥(Around)ï¼šåœ¨æ–¹æ³•ä¹‹å‰å’Œä¹‹åŽæ‰§è¡Œ AspectJAspectJ å®žé™…æ˜¯å¯¹ AOP ç¼–ç¨‹æ€æƒ³çš„ä¸€ä¸ªå®žè·µï¼Œç›®å‰ç”¨çš„æ¯”è¾ƒç«ï¼Œå®ƒæ˜¯ä¸€ç§é›†åˆå’Œ Java å®Œå…¨ä¸€æ ·çš„è¯­è¨€ï¼Œè€Œä¸”å®Œå…¨å…¼å®¹ Javaã€‚ å…ˆå†™åˆ°è¿™é‡Œï¼]]></content>
  </entry>
  <entry>
    <title><![CDATA[OKHttp é‡å®šå‘æ‹¦æˆªå™¨]]></title>
    <url>%2F2020%2F02%2F20%2FOKHttp-%E9%87%8D%E5%AE%9A%E5%90%91%E6%8B%A6%E6%88%AA%E5%99%A8%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨ OKHttp è¿›è¡Œé‡å®šå‘æ‹¦æˆªå¤„ç†okhttpé‡å®šå‘å­˜åœ¨ä¸¤ä¸ªç¼ºé™·ï¼š okhttpå¤„ç†301,302é‡å®šå‘æ—¶ï¼Œä¼šæŠŠè¯·æ±‚æ–¹å¼è®¾ç½®ä¸ºGETè¿™æ ·ä¼šä¸¢å¤±åŽŸæ¥Postè¯·æ±‚ä¸­çš„å‚æ•°ã€‚ okhttpé»˜è®¤ä¸æ”¯æŒè·¨åè®®çš„é‡å®šå‘ï¼Œæ¯”å¦‚httpé‡å®šå‘åˆ°https ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜å†™äº†è¿™ä¸ªæ‹¦æˆªå™¨ 1234567891011121314151617181920class RedirectInterceptor implements Interceptor &#123; @Override public Response intercept(Chain chain) throws IOException &#123; Request request = chain.request(); HttpUrl beforeUrl = request.url(); Response response = chain.proceed(request); HttpUrl afterUrl = response.request().url(); //1.æ ¹æ®urlåˆ¤æ–­æ˜¯å¦æ˜¯é‡å®šå‘ if(!beforeUrl.equals(afterUrl)) &#123; //å¤„ç†ä¸¤ç§æƒ…å†µ 1ã€è·¨åè®® 2ã€åŽŸå…ˆä¸æ˜¯GETè¯·æ±‚ã€‚ if (!beforeUrl.scheme().equals(afterUrl.scheme())||!request.method().equals("GET")) &#123; //é‡æ–°è¯·æ±‚ Request newRequest = request.newBuilder().url(response.request().url()).build(); response = chain.proceed(newRequest); &#125; &#125; return response; &#125;&#125;]]></content>
  </entry>
  <entry>
    <title><![CDATA[Android å¸¸ç”¨å·¥å…·å’Œæ’ä»¶]]></title>
    <url>%2F2020%2F02%2F20%2FAndroid-%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E5%92%8C%E6%8F%92%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[Android å¼€å‘å¿…å¤‡æ’ä»¶å’Œå·¥å…·Android Studio æ’ä»¶ æ’ä»¶å æ³¨é‡Š Alibaba Java Coding Guidelines é˜¿é‡Œçš„ä»£ç è§„èŒƒæ£€æŸ¥æ’ä»¶ï¼Œç”¨æ¥æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦ç¬¦åˆé©¼å³°å‘½åã€if else, switch els default ç­‰è¯­æ³•ç³–çš„å¥å£®æ€§ï¼›ä»¥åŠå•æ–¹æ³•è¡Œæ•°ä¸è¶…è¿‡ 80 è¡Œï¼Œæé†’â€å•ä¸€èŒè´£åŽŸåˆ™â€œç­‰ï¼› Android Parcelable code generator åºåˆ—åŒ– Po ç±»æ—¶ï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆåºåˆ—åŒ–ä»£ç  CodeGlance ä»£ç é¢„è§ˆå›¾ï¼Œåœ¨ç¼–è¾‘çª—å£å³ä¾§æœ‰ä¸€ä¸ªå½“å‰ä»£ç çš„ç¼©ç•¥å›¾ï¼Œå¯ä»¥å½“åšæ»šåŠ¨æ¡ä½¿ç”¨ï¼Œå¯ä»¥å¿«é€Ÿå®šä½ä»£ç  DataBase Navigator æ”¯æŒ Oracleã€MySQLã€SQLiteã€PostgreSQL ä»¥åŠä»»ä½•ç¬¦åˆ JDBC çš„æ•°æ®åº“ï¼›å¢žå¼ºæˆ‘ä»¬å¯¹æ•°æ®åº“æ•°æ®çš„è¯»å–ï¼Œå®šä½é—®é¢˜ FindBugs-IDEA å¯ä»¥åˆ†æžçŽ°å­˜ä»£ç ä¸­å®¹æ˜“å¼•èµ·å¼‚å¸¸çš„éƒ¨åˆ†ï¼Œå¹¶æä¾›ä¿®æ”¹å»ºè®® GsonFormater å°† xml å’Œ json è½¬æ¢ä½ pojo ç±»ï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆæ•°æ®æº Markdown è¯­è¨€å·¥å…·ï¼Œé€šè¿‡è¯­æ³•ç³–ï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆ HTML çš„é¢„è§ˆçª—ï¼Œå†™å‡º GitHub é£Žæ ¼çš„æŠ€æœ¯æ–‡æ¡£ Markdown Navigator Markdown é¢„è§ˆå·¥å…·ï¼Œå¯ä»¥è§‚å¯Ÿå®žæ—¶æ¸²æŸ“çš„ HTML æ–‡æ¡£ Android Resource Tools 1. å¯ä»¥ä¸º layout.xml ä¸­ å¸¦ id çš„ View ç”Ÿæˆå˜é‡åŠ findViewById ä»£ç 2. ä½¿ç”¨ Google å¯¹ strings.xml è¿›è¡Œç¿»è¯‘ï¼ˆéœ€è¦é…ç½®é•œåƒï¼‰ 3. é¢œè‰²æ¸²æŸ“å™¨æ”¯æŒ RGB å’Œ ARGBï¼Œæ–¹ä¾¿é…ç½®é€æ˜Žåº¦ Codota æ¨¡ç‰ˆä»£ç æŸ¥æ‰¾å™¨ï¼Œå¯ä»¥è¾“å…¥å…³é”®è¯ï¼Œæœç´¢å‡ºç›¸å…³çš„ä¸šåŠ¡ä»£ç ï¼Œæ¯”å¦‚ï¼Œæœç´¢ FileOutputSrteam åˆ™ä¼šæœ‰ ä»¥åŠåœ¨ç¼–è¯‘æ—¶ï¼Œä¼šç»™äºˆç›¸å…³çš„ä»£ç å—æç¤º GoodFormatter ä¿è¯å¤§å®¶ä»£ç æ ¼å¼åŒ–é£Žæ ¼ä¸€è‡´ï¼Œé¿å…å› ä¸åŒï¼Œå¯¼è‡´ git åˆå¹¶æ˜¯å‡ºçŽ°å¤§é‡ä¿®æ”¹ï¼› ButterknifePlugin å¿«é€Ÿç”Ÿæˆ butternkife çš„æ³¨å…¥ä»£ç ï¼Œå‰æéœ€è¦å¼•å…¥ butterknife JsonViewer å¯ä»¥æ›¿æ¢ postman çš„æ’ä»¶ï¼Œç”¨æ¥è°ƒè¯•æŽ¥å£ Git Commit Template Git æäº¤è®°å½•æ¨¡ç‰ˆå·¥å…· â€” â€” codata 123456789101112public void zipFile(File srcFile, File zipFile) throws IOException &#123; try (FileInputStream fis = new FileInputStream(srcFile); ZipOutputStream zos = new ZipOutputStream(new FileOutputStream(zipFile))) &#123; zos.putNextEntry(new ZipEntry(srcFile.getName())); int len; byte[] buffer = new byte[1024]; while ((len = fis.read(buffer)) &gt; 0) &#123; zos.write(buffer, 0, len); &#125; zos.closeEntry(); &#125;&#125; AndroidResourceTools JsonViewer å¼€å‘å·¥å…·é™¤å¿…è¦ AS ä¹‹å¤–ï¼Œéœ€è¦ä»¥ä¸‹å·¥å…·, Mac ç”¨æˆ·å¯ä»¥é€šè¿‡ XClient ä¸‹è½½ç ´è§£ç‰ˆè½¯ä»¶ å·¥å…· æ³¨é‡Š Sublime Text 3 æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œé™¤æ­£å¸¸çš„ç¼–è¾‘åŠŸèƒ½å¤–ï¼Œä¸°å¯Œçš„æ’ä»¶åº“è®©å®ƒæ¯” editplusã€plus++ç­‰æ–‡æœ¬ç¼–è¾‘æ›´å¼ºå¤§ï¼›PrettyJson æ’ä»¶å¯ä»¥å¿«é€Ÿå°†å­—ç¬¦ä¸²æ ¼å¼åŒ–ä¸º JSON æ ¼å¼ï¼Œæ— éœ€å†åŽ»åœ¨çº¿æ‰¾ json æ ¼å¼åŒ–ï¼›ä¹Ÿå¯ä»¥æ ¡éªŒ json çš„åˆæ³•æ€§ï¼›æ”¯æŒåˆ—ç¼–è¾‘ï¼Œå¿«é€Ÿä¿®æ”¹ Markdown å¯ä»¥ç”¨æ¥å†™ Markdown æ–‡ä»¶ï¼Œä½†ä¸æ”¯æŒæ¸²æŸ“Sublime Text 3 ä¸‹è½½åœ°å€ Postman æŽ¥å£è°ƒè¯•å·¥å…·ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸Šé¢æŽ¨èçš„ JsonViewerPostman ä¸‹è½½åœ°å€ Fiddlerã€Charles æŠ“åŒ…è°ƒè¯•å·¥å…·ï¼Œå¯æŠ“åŒ…ï¼Œä¿®æ”¹å‚æ•°è°ƒè¯•æŽ¥å£ï¼Œä»»é€‰Fiddler ä¸‹è½½åœ°å€Charles ä¸‹è½½åœ°å€ Markdown Windows å¯ä½¿ç”¨ Typora, Mac å¯ä»¥ä½¿ç”¨ MWeb Proï¼Œç”ŸæˆæŠ€æœ¯ç±»æ–‡æ¡£ä½¿ç”¨ï¼Œé©¬å…‹é£žè±¡åŒå¹³å°éƒ½å¯ä»¥ï¼ˆChrome æ’ä»¶ï¼Œéœ€è¦å‹å¥½è®¿é—®ï¼‰Typora ä¸‹è½½åœ°å€MWeb Pro ä¸‹è½½åœ°å€ Vysor Android è®¾å¤‡åŒå±å·¥å…·ï¼Œå¯å°†è®¾å¤‡åŒæ­¥åˆ°ç”µè„‘ä¸Šï¼Œæ–¹ä¾¿æˆªå›¾ï¼Œåˆ†äº«å±å¹•ç­‰ï¼Œéœ€è¦å‹å¥½è®¿é—®Vysor ä¸‹è½½åœ°å€ XMind è„‘å›¾å·¥å…·ï¼Œç”¨æ¥å†™ç»“æž„XMind ä¸‹è½½åœ°å€ Beyond Compare æ–‡ä»¶æ¯”è¾ƒå™¨ï¼Œæ¯”è¾ƒä¸¤ç»„æ–‡ä»¶çš„å·®å¼‚BeyondCompare ä¸‹è½½åœ°å€ Dash æºç æŸ¥çœ‹å™¨ï¼Œ ä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨çº¿çš„ Android ç¤¾åŒº PxCook äº‘åä½œè®¾è®¡å·¥å…·ï¼Œå¯ç”Ÿæˆç›¸åº”çš„å‰ç«¯ä»£ç ï¼Œè‡ªåŠ¨æµ‹é‡å°ºå¯¸ç­‰ï¼Œæ”¯æŒ Photoshopã€Sketchã€Adobe XDã€‚PxCook ä¸‹è½½åœ°å€ â€” â€”]]></content>
  </entry>
  <entry>
    <title><![CDATA[æ¸…é¦™æœ¨å…»æ®–ï¼ˆå››ï¼‰]]></title>
    <url>%2F2019%2F10%2F17%2F%E6%B8%85%E9%A6%99%E6%9C%A8%E5%85%BB%E6%AE%96%EF%BC%88%E5%9B%9B%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ä¸¢äº†Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· T_T]]></content>
  </entry>
  <entry>
    <title><![CDATA[Linux ä¸‹é…ç½® Android Studio ä¸­æ–‡è¾“å…¥]]></title>
    <url>%2F2019%2F08%2F23%2FLinux-%E4%B8%8B%E9%85%8D%E7%BD%AE-Android-Studio-%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%2F</url>
    <content type="text"><![CDATA[æˆ‘çš„ç”µè„‘æ˜¯æ·±åº¦ Ubuntuï¼Œ æ•ˆæžœå’Œ Windows å¾ˆåƒï¼Œä¸ªäººä¸å–œæ¬¢ Windows çš„åŽŸå› å¾ˆç®€å•ï¼Œç›—ç‰ˆå¤ªå¤šã€‚ è™½ç„¶ Ubuntu ä¸‹å¾ˆå¤šè½¯ä»¶éƒ½ä¼šå—åˆ°é™åˆ¶ï¼Œä½†æˆ‘æ˜¯ä¸€ä¸ªè½¯ä»¶å·¥ç¨‹å¸ˆï¼Œå¸¸ç”¨çš„å¼€å‘å·¥å…·å¯ä»¥ä½¿ç”¨ï¼Œå°±å¯ä»¥äº†ã€‚ æœ€è¿‘ä¸€ç›´å›°æ‰°æˆ‘çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œ æ¯å½“æˆ‘ç»™ Android Studio å‡çº§æ—¶ï¼Œå°±ä¼šé‡åˆ°æ— æ³•è¾“å…¥ä¸­æ–‡çš„æƒ…å†µï¼Œæ¯æ¬¡ä¸Šç½‘æŸ¥è¯¢ï¼Œæ€»æ˜¯ç£•ç£•ç»Šç»Šï¼Œä»Šå„¿å°†æ–¹æ³•è®°å½•ä¸‹æ¥ï¼Œä»¥å¤‡ä»¥åŽéœ€è¦æ˜¯å¥½æ‰¾ã€‚ é¦–å…ˆï¼Œæ‰“å¼€ Android Studio çš„æ–‡ä»¶ç›®å½• /android-stdio/bin/ ï¼Œä½¿ç”¨ Vi å‘½ä»¤æ‰“å¼€æ–‡ä»¶ studio.shï¼Œ åœ¨æ–‡ä»¶çš„å¼€å¤´ï¼Œè¾“å…¥ä¸‹é¢è¿™ä¸€ä¸² 123export XMODIFIERS=@im=fcitxexport QT_IM_MODULE=fcitxexport GTK_IM_MODULE=&quot;fcitx&quot; ç„¶åŽ :wq ä¿å­˜é€€å‡ºã€‚ æŽ¥ç€é‡å¯ Android Studio å°±å¯ä»¥äº†ã€‚]]></content>
  </entry>
  <entry>
    <title><![CDATA[Android èŽ·å– View çš„å®½é«˜]]></title>
    <url>%2F2019%2F08%2F21%2FAndroid-%E8%8E%B7%E5%8F%96-View-%E7%9A%84%E5%AE%BD%E9%AB%98%2F</url>
    <content type="text"><![CDATA[å®žé™…å¼€å‘ä¸­ï¼ŒèŽ·å–ä¸€ä¸ª View çš„å®½é«˜æœ‰å¾ˆå¤šä¸­æ–¹æ³•ï¼Œæœ€ç›´æŽ¥çš„å°±æ˜¯ï¼š 1234567// è¿”å›ž View çš„å®½é«˜ï¼Œå•ä½æ˜¯åƒç´ int height = view.getHeight();int width = view.getWidth();// è¿”å›ž View çš„åŽŸå§‹æµ‹é‡é«˜åº¦int height = view.getMeasuredHeight();int width = view.getMeasuredWidth(); æœ‰æ—¶éœ€è¦åœ¨ onCreate æ–¹æ³•ä¸­èŽ·å–æŸä¸ª View ç»„ä»¶çš„å®½åº¦å’Œé«˜åº¦ä¿¡æ¯ï¼Œè€Œç›´æŽ¥è°ƒç”¨ View ç»„ä»¶çš„ getWidth(), getHeight(), getMeasuredWidth(), getMeasuredHeight(), getTop(), getLeft() ç­‰æ–¹æ³•æ˜¯æ— æ³•èŽ·å–åˆ°çœŸå®žå€¼ï¼Œåªä¼šå¾—åˆ° 0 ï¼Œè¿™æ˜¯å› ä¸º View ç»„ä»¶å¸ƒå±€è¦åœ¨ onResume åŽå›žè°ƒ ã€‚ å› æ­¤ï¼Œå½“æˆ‘ä»¬éœ€è¦ View çš„å®½é«˜æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ getViewTreeObserver().addOnGlobalLayoutListener() æ¥èŽ·å– View çš„å®½åº¦æˆ–è€…é«˜åº¦ã€‚è¿™æ˜¯èŽ·å¾—ä¸€ä¸ª View çš„å®½åº¦å’Œé«˜åº¦çš„æ–¹æ³•ä¹‹ä¸€ã€‚ onGlobalLayoutListener() æ˜¯ ViewTreeObserver çš„å†…éƒ¨ç±»ï¼Œå½“ä¸€ä¸ªè§†å›¾æ ‘çš„å¸ƒå±€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå¯ä»¥è¢« ViewTreeObserver ç›‘å¬åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³¨å†Œç›‘å¬è§†å›¾çš„è§‚å¯Ÿè€…(observer)ï¼Œ åœ¨è§†å›¾æ ‘çš„å…¨å±€äº‹ä»¶æ”¹å˜æ—¶å¾—åˆ°é€šçŸ¥ã€‚ ViewTreeObserver ä¸èƒ½ç›´æŽ¥å®žä¾‹åŒ–ï¼Œè€Œæ˜¯é€šè¿‡ getViewTreeObserver() èŽ·å¾—ã€‚ å…¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ OnGlobalLayoutListener æ¥èŽ·å–ä¸€ä¸ªè§†å›¾çš„çœŸå®žé«˜åº¦ã€‚ 1234567891011121314private int height;private int width;private int positionX;private int positionY;imageView.getViewTreeObserver().addOnGlobalLayoutListener(new OnGlobalLayoutListener()&#123; @Override public void onGlobalLayout()&#123; positionX = imageView.getX(); positionY = imageView.getY(); height = imageView.getHeight(); widht = imageView.getWidth(); imageView.getViewTreeObserver().removeOnGlobalLayoutListener(this); &#125;&#125;); OnGlobalLayoutListener å¯èƒ½ä¼šè¢«å¤šæ¬¡è§¦å‘ï¼Œå› æ­¤åœ¨å¾—åˆ°äº†é«˜åº¦ä¹‹åŽï¼Œè¦å°† OnGlobalLayoutListener æ³¨é”€æŽ‰ 1imageView.getViewTreeObserver().removeOnGlobalLayoutListener(this); ViewTreeObserver123public final class ViewTreeObserver extends Objectjava.lang.Objectandroid.view.ViewTreeObserver æ˜¯ä¸€ä¸ªæ³¨å†Œç›‘å¬è§†å›¾çš„è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ï¼Œåœ¨è§†å›¾æ ‘å…¨å±€äº‹ä»¶æ”¹å˜æ—¶å¾—åˆ°é€šçŸ¥ã€‚è¿™ä¸ªå…¨å±€äº‹ä»¶ä¸ä»…åŒ…æ‹¬æ•´ä¸ªæ ‘çš„å¸ƒå±€ï¼Œä»Žç»˜ç”»è¿‡ç¨‹å¼€å§‹ï¼Œè§¦æ‘¸æ¨¡å¼çš„æ”¹å˜ç­‰ã€‚ViewTreeObserver ä¸èƒ½å¤Ÿè¢«åº”ç”¨ç¨‹åºå®žä¾‹åŒ–ï¼Œå› ä¸ºå®ƒæ˜¯ç”±è§†å›¾æä¾› getViewTreeObserver() åŸºæœ¬å¸¸ç”¨çš„æ–¹æ³• 1234567891011121314151617181920212223242526272829303132// å½“åœ¨ä¸€ä¸ªè§†å›¾ä¹¦ä¸­çš„ç„¦ç‚¹çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€è¦è°ƒç”¨çš„å›žè°ƒå‡½æ•°æŽ¥å£interface ViewTreeObserver.OnGlobalFocusChangeListener;// å½“åœ¨ä¸€ä¸ªè§†å›¾æ ‘ä¸­å…¨å±€å¸ƒå±€å‘ç”Ÿæ”¹å˜æ—¶æˆ–è€…è§†å›¾æ ‘ä¸­çš„æŸä¸ªè§†å›¾çš„å¯è§†åŒ–çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶interface ViewTreeObserver.OnGlobalLayoutListener;// å½“ä¸€ä¸ªè§†å›¾æ ‘å°†è¦ç»˜åˆ¶æ—¶interface ViewTreeObserver.OnPreDrawListener;// å½“ä¸€ä¸ªè§†å›¾æ ‘ä¸­çš„ç»„ä»¶å‘ç”Ÿæ»šåŠ¨æ—¶interface ViewTreeObserver.OnScrollChangedListener;// å½“ä¸€ä¸ªè§†å›¾æ ‘ä¸­çš„è§¦æ‘¸æ¨¡å¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç”¨äºŽç›‘å¬ touch å’Œéž touch çš„è½¬æ¢interface ViewTreeObserver.OnTouchModeChangeListener;// ç›‘å¬å¸ƒå±€çš„å˜åŒ–interface ViewTreeObserver.OnGlobalLayoutLitener;// å½“å‰ ViewTreeObserver æ˜¯å¦å¯ç”¨ï¼Œä¸å¯ç”¨æ—¶ï¼Œä»»ä½•æ–¹æ³•è°ƒç”¨éƒ½ä¼šæŠ¥é”™getViewTreeObserver().isAlive();addOnWindowAttachListenervoid removeOnGlobalFocusChangeListener();void removeOnScrollChangedListener();void removeOnTouchModeChangeListener();// å½“æ•´ä¸ªå¸ƒå±€å‘ç”Ÿæ”¹å˜æ—¶é€šçŸ¥ç›¸åº”çš„æ³¨å†Œç›‘å¬å™¨ã€‚å¦‚æžœä½ å¼ºåˆ¶å¯¹è§†å›¾å¸ƒå±€æˆ–è€…åœ¨ä¸€ä¸ªæ²¡æœ‰é™„åŠ åˆ°ä¸€ä¸ªçª—å£çš„è§†å›¾çš„å±‚æ¬¡ç»“æž„æˆ–è€…åœ¨GONEçŠ¶æ€ä¸‹ï¼Œå®ƒå¯ä»¥è¢«æ‰‹åŠ¨çš„è°ƒç”¨ void dispatchOnGlobalLayout()// å½“ä¸€ä¸ªè§†å›¾æ ‘å°†è¦ç»˜åˆ¶æ—¶é€šçŸ¥ç›¸åº”çš„æ³¨å†Œç›‘å¬å™¨ï¼Œå¦‚æžœè¿”å›ž trueï¼Œ åˆ™è¿™ä¸ªç»˜åˆ¶å°†è¢«å–æ¶ˆå¹¶é‡æ–°è®¡åˆ’ã€‚å¦‚æžœå¼ºåˆ¶å¯¹è§†å›¾å¸ƒå±€æˆ–è€…åœ¨ä¸€ä¸ªæ²¡æœ‰é™„åŠ åˆ°ä¸€ä¸ªçª—å£çš„è§†å›¾çš„å±‚æ¬¡ç»“æž„æˆ–è€…ä¸€ä¸ªåœ¨ gone çŠ¶æ€ä¸‹ï¼Œå°†è¢«æ‰‹åŠ¨è°ƒç”¨void dispatchOnPreDraw();]]></content>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java Reference]]></title>
    <url>%2F2019%2F08%2F09%2FJava%20%E5%90%84%E5%BC%95%E7%94%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[Reference å¼•ç”¨ç»§æ‰¿è‡ª Objectï¼Œ æœ‰ SoftReference, WeakReference, PhantomReference ä¸‰ä¸ªç›´æŽ¥å­ç±»ã€‚ ä¸‰ä¸ªå­ç±»çš„æž„é€ æ–¹æ³•ä¸­æ¶‰åŠåˆ° ReferenceQueue å’Œ Referentï¼š Referentï¼š è¢«å¼•ç”¨å¯¹è±¡ ReferenceQueueï¼šå½“å¼•ç”¨ï¼ˆè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰çš„ Referent è¢«å›žæ”¶åŽï¼Œè¯¥å¼•ç”¨ï¼ˆè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰ä¼šè¢« enqueue åˆ°è¿™ä¸ª ReferenceQueue ä¸­ã€‚ 123456789101112131415161718192021public class ReferenceTest&#123; public static void main(String[] args) &#123; &#125; static class Person &#123; private String name; private String getName()&#123; return name; &#125; private void setName(String name) &#123; this.name = name; &#125; @Override protected void finalize() throws Throwable &#123; super.finalize(); System.out.println("in Person finalize"); &#125; &#125;&#125; StrongReference å¼ºå¼•ç”¨Java ä¸­ä½¿ç”¨çš„æœ€å¤šï¼Œæ™®é€šçš„å¼•ç”¨ Object obj = new Object(); Person p = new Person(); éƒ½å±žäºŽå¼ºå¼•ç”¨ å¼ºå¼•ç”¨æœ¬èº«å­˜å‚¨åœ¨æ ˆä¸­ï¼Œnew å‡ºæ¥çš„å¯¹è±¡å­˜å‚¨åœ¨å †ä¸­ã€‚æ ˆä¸­ä¿å­˜çš„å¼•ç”¨æŒ‡å‘å †ä¸­å¯¹è±¡çš„åœ°å€ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå½“å¼•ç”¨ä¸åœ¨æŒ‡å‘å †ä¸­å¯¹è±¡çš„åœ°å€æ—¶ï¼ˆperson = nullï¼‰ GC collector å°±å¼€å§‹è€ƒè™‘å¯¹æ­¤å†…å­˜ï¼ˆå †ä¸­çš„å¯¹è±¡ï¼‰è¿›è¡Œå›žæ”¶ã€‚ 1Person p = new Person(); person å°±æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œå¼ºå¼•ç”¨ä¸ä¼šè¢« GCï¼Œå³ä½¿å†…å­˜ä¸å¤ŸæŠ›å‡º OOM æ—¶ä¹Ÿä¸ä¼šè¢«å›žæ”¶ã€‚ SoftReference è½¯å¼•ç”¨è½¯å¼•ç”¨æ™®é€šä½¿ç”¨å½¢å¼ï¼š 12Person p = new Person();SoftReference&lt;Person&gt; sr = new SoftReference&lt;Person&gt;(person); å¼ºå¼•ç”¨ person ä½œä¸ºå‚æ•°ï¼Œåˆ›å»ºäº†ä¸€ä¸ªè½¯å¼•ç”¨å¯¹è±¡ sr, ä¸‹é¢æ˜¯ä¾‹å­ï¼š 12345678910111213141516171819202122private static void testSofeReference()&#123; // åˆ›å»ºå¼ºå¼•ç”¨å¯¹è±¡ Person person = new Person(); System.out.println("person å¯¹è±¡ä¸º" + person); // åˆ›å»ºè½¯å¼•ç”¨å¯¹è±¡ SoftReference&lt;Person&gt; sr = new SoftReference&lt;Person&gt;(person); person = null; // ä¹‹å‰ new å‡ºçš„ Person å¯¹è±¡ä¸ä¼šç«‹å³è¢«å›žæ”¶ï¼Œé™¤éž JVM éœ€è¦å†…å­˜(OOM ä¹‹å‰) if(sr.get() == null) &#123; System.out.println("person å¯¹è±¡è¿›å…¥ GC æµç¨‹"); &#125; else &#123; System.out.println("person å¯¹è±¡å°šæœªè¢«å›žæ”¶" + sr.get()); &#125; System.gc(); if(sr.get() == null)&#123; System.out.println("person å¯¹è±¡è¿›å…¥ GC æµç¨‹"); &#125; else &#123; System.out.println("person å¯¹è±¡å°šæœªè¢«å›žæ”¶" + sr.get()); &#125;&#125; æ‰§è¡Œä¸Šé¢çš„ä¾‹å­ï¼š 123person å¯¹è±¡ä¸º com.example.ReferenceTest$Person@522d9d8cperson å¯¹è±¡å°šæœªè¢«å›žæ”¶ com.example.ReferenceTest$Person@522d9d8cperson å¯¹è±¡å°šæœªè¢«å›žæ”¶ com.example.ReferenceTest$Person@522d9d8c å½“æ‰§è¡Œ person = null åŽï¼Œå †å†…å­˜çš„ Person å¯¹è±¡ä¸å†æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘å®ƒï¼Œä½†æ­¤æ—¶è¿˜å­˜åœ¨ sr å¼•ç”¨çš„å¯¹è±¡æŒ‡å‘ Person å¯¹è±¡ã€‚æ­¤æ—¶è°ƒç”¨ sr.get() æ–¹æ³•ï¼Œè¿”å›ž Person å¯¹è±¡ï¼Œå³ä¹‹å‰å †ä¸­çš„å¼ºå¼•ç”¨å¯¹è±¡äº†ã€‚æˆ‘ä»¬å¯ä»¥åˆç†çŒœæµ‹GC collector å¾ˆæœ‰å¯èƒ½å°šæœªè¿›è¡Œåžƒåœ¾å›žæ”¶ï¼Œæ‰€ä»¥æ­¤æ—¶ sr.get() æ–¹æ³•è¿”å›žä¸ä¸ºç©ºã€‚ æˆ‘ä»¬ç»§ç»­æ‰§è¡Œ System.gc() å¼ºåˆ¶è¿›è¡Œåžƒåœ¾å›žæ”¶ï¼Œæ‰“å°ç»“æžœå¯ä»¥çœ‹åˆ°ï¼Œ sr.get() è¿”å›žä¾ç„¶ä¸ä¸ºç©ºï¼Œè¯´æ˜Ž Person å¯¹è±¡ä¾æ—§æ²¡æœ‰è¢«å›žæ”¶ã€‚ è½¯å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡è¦è¿›è¡Œå›žæ”¶ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼ˆå†…å­˜ä¸­çš„ Person å¯¹è±¡ï¼‰ JVM éœ€è¦å†…å­˜æ—¶ï¼Œå³åœ¨æŠ›å‡º OOM ä¹‹å‰ æ€»ç»“ï¼š SoftReference å˜ç›¸å»¶é•¿äº†å…¶åªæ˜¯å¯¹è±¡å æ®å †å†…å­˜çš„æ—¶é—´ï¼Œç›´åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸è¶³æ—¶åžƒåœ¾å›žæ”¶æ‰å›žæ”¶æ­¤å †å†…å­˜ç©ºé—´ã€‚ è½¯å¼•ç”¨è¿˜å¯ä»¥å’Œä¸€ä¸ª ReferenceQueue ä¸€èµ·ä½¿ç”¨ï¼Œ å½“ SoftReference çš„ Referent è¢«å›žæ”¶ä»¥åŽï¼Œè¿™ä¸ª SoftReference ä¼šè¢«è‡ªåŠ¨ enqueue åˆ°è¿™ä¸ª ReferenctQueue ä¸­ã€‚ 1234567891011121314151617181920212223242526private static void testSoftReferenceWithQueue()&#123; Person person = new Person(); System.out.println("person å¯¹è±¡ä¸ºï¼š" + person); ReferenceQueue&lt;Person&gt; queue = new ReferenceQueue&lt;&gt;(); SoftReference&lt;Person&gt; sr = new SoftReference&lt;&gt;(person, queue); person = null; // ä¹‹å‰ new å‡ºçš„ Person å¯¹è±¡ä¸ä¼šç«‹å³è¢«å›žæ”¶ï¼Œé™¤éž JVM éœ€è¦å†…å­˜ ï¼ˆOOM å‰ï¼‰ if(sr.get() == null) &#123; System.out.println("person å¯¹è±¡è¿›å…¥ GC æµç¨‹"); &#125; else &#123; System.out.println("person å¯¹è±¡å°šæœªè¢«å›žæ”¶" + sr.get()); &#125; System.out.println("åŠ å…¥ ReferenceQueue çš„å¯¹è±¡ä¸ºï¼š" + queue.poll()); System.gc(); if(sr.get() == null) &#123; System.out.println("person å¯¹è±¡è¿›å…¥ GC æµç¨‹"); &#125; else &#123; System.out.println("person å¯¹è±¡å°šæœªè¢«å›žæ”¶" + sr.get()); &#125; System.out.println("åŠ å…¥ ReferenceQueue çš„å¯¹è±¡ä¸ºï¼š " + queue.poll());&#125; æ‰§è¡Œä¸Šè¿°ä¾‹å­ï¼Œç»“æžœå¦‚ä¸‹ï¼š 12345person å¯¹è±¡ä¸º com.example.ReferenceTest$Person@522d9d8cperson å¯¹è±¡å°šæœªè¢«å›žæ”¶ com.example.ReferenceTest$Person@522d9d8cåŠ å…¥ ReferenceQueue çš„å¯¹è±¡ä¸º nullperson å¯¹è±¡å°šæœªè¢«å›žæ”¶ com.example.ReferenceTest$Person@522d9d8cåŠ å…¥ ReferenceQueue çš„å¯¹è±¡ä¸º null æ³¨æ„ï¼š å½“ SoftReference æˆ– WeakReference çš„ get() æ–¹æ³•è¿”å›ž null æ—¶ï¼Œä»…è¡¨æ˜Žå…¶æŒ‡ç¤ºçš„å¯¹è±¡å·²ç»è¿›å…¥åžƒåœ¾å›žæ”¶æµç¨‹ï¼Œæ­¤æ—¶å¯¹è±¡ä¸ä¸€å®šå·²ç»è¢«åžƒåœ¾å›žæ”¶ã€‚ è€Œåªæœ‰ç¡®è®¤è¢«åžƒåœ¾å›žæ”¶åŽï¼Œå¦‚æžœæœ‰ ReferenceQueue ï¼Œå…¶å¼•ç”¨æ‰ä¼šè¢«æ”¾ç½®äºŽ ReferenceQueue ä¸­ã€‚ WeakReference å¼±å¼•ç”¨å¼±å¼•ç”¨çš„ä¸€èˆ¬ä½¿ç”¨å½¢å¼ï¼š 1234567891011121314151617181920private static void testWeakReference()&#123; Person person = new Person(); System.out.println("person å¯¹è±¡ä¸ºï¼š " + person); WeakReference&lt;Person&gt; wr = new WeakReference&lt;&gt;(person); person = null; // è¢« GC åŽï¼Œä¹‹å‰ new å‡ºçš„ Person å¯¹è±¡ä¼šç«‹å³è¢«å›žæ”¶ï¼Œè¿›å…¥ GC æµç¨‹ã€‚ if (wr.get() == null) &#123; System.out.println("person å¯¹è±¡è¿›å…¥ GC æµç¨‹"); &#125; else &#123; System.out.println("person å¯¹è±¡å°šæœªè¢«å›žæ”¶" + wr.get()); &#125; System.gc(); if (wr.get() == null) &#123; System.out.println("person å¯¹è±¡è¿›å…¥ GC æµç¨‹"); &#125; else &#123; System.out.println("person å¯¹è±¡å°šæœªè¢«å›žæ”¶" + wr.get()); &#125;&#125; æ‰§è¡Œç»“æžœä¸ºï¼š 1234person å¯¹è±¡ä¸º com.example.ReferenceTest$Person@522d9d8cperson å¯¹è±¡å°šæœªè¢«å›žæ”¶ com.example.ReferenceTest$Person@522d9d8cperson å¯¹è±¡è¿›å…¥ GC æµç¨‹in Person finalize å½“æ‰§è¡Œ person = null åŽï¼Œå †å†…å­˜çš„ Person å¯¹è±¡ä¸å†æœ‰ä»»ä½•å¼•ç”¨æŒ‡å‘å®ƒï¼Œä½†æ­¤æ—¶è¿˜å­˜åœ¨ wr å¼•ç”¨çš„å¯¹è±¡æŒ‡å‘ Person å¯¹è±¡ã€‚ æ­¤æ—¶è°ƒç”¨ wr.get() æ–¹æ³•ï¼Œè¿”å›ž Person å¯¹è±¡ï¼Œå³ä¹‹å‰å †ä¸­çš„å¼ºå¼•ç”¨å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥åˆç†çŒœæµ‹ GC collector å¾ˆæœ‰å¯èƒ½å°šæœªè¿›è¡Œåžƒåœ¾å›žæ”¶ï¼Œæ‰€ä»¥æ­¤æ—¶ wr.get() æ–¹æ³•è¿”å›žä¸ä¸ºç©ºã€‚ ç»§ç»­æ‰§è¡Œ System.gc() å¼ºåˆ¶æ‰§è¡Œåžƒåœ¾å›žæ”¶ï¼Œæ‰“å°ç»“æžœå¯ä»¥çœ‹åˆ°ï¼Œwr.get() è¿”å›žä¸ºç©º â€œperson å¯¹è±¡è¿›å…¥ GC æµç¨‹â€ ï¼Œä¸”æ‰§è¡Œäº†é™æ€å†…éƒ¨ç±»ä¸­çš„ finalize æ–¹æ³•ã€‚è¯´æ˜Ž Person å¯¹è±¡è¢«å›žæ”¶ï¼Œè¿›å…¥åžƒåœ¾å›žæ”¶æµç¨‹ã€‚ å¼±å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡è¦è¿›è¡Œå›žæ”¶ï¼Œåªéœ€è¦æ»¡è¶³æ¡ä»¶ï¼š â€‹ æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘å¼±å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼ˆå†…å­˜ä¸­çš„ Person å¯¹è±¡ï¼‰ æ€»ç»“ï¼š â€‹ WeakReference ä¸æ”¹å˜åŽŸæœ‰çš„å¼ºå¼•ç”¨ç‹¬äº«çš„åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼Œä¸€æ—¦å…¶æŒ‡ç¤ºå¯¹è±¡æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨å¯¹è±¡æ—¶ï¼Œæ­¤å¯¹è±¡å³è¿›å…¥æ­£å¸¸çš„åžƒåœ¾å›žæ”¶æµç¨‹ã€‚ å…¶ä¸»è¦ä½¿ç”¨åœºæ™¯è§äºŽï¼š â€‹ å½“å‰å·²æœ‰å¼ºå¼•ç”¨æŒ‡å‘å¼ºå¼•ç”¨å¯¹è±¡ï¼Œæ­¤æ—¶ç”±äºŽä¸šåŠ¡éœ€è¦ï¼Œéœ€è¦å¢žåŠ å¯¹æ­¤å¯¹è±¡çš„å¼•ç”¨ï¼ŒåŒæ—¶åˆä¸å¸Œæœ›æ”¹å˜æ­¤å¼•ç”¨çš„åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼Œæ­¤æ—¶ WeakReference æ­£å¥½ç¬¦åˆéœ€æ±‚ï¼Œå¸¸è§äºŽä¸€äº›ä¸Žç”Ÿå‘½å‘¨æœŸçš„åœºæ™¯ä¸­ï¼Œæ¯”å¦‚ Activity ä¸­çš„ Handler çš„ä½¿ç”¨ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜æ³„éœ²éœ€è¦ç”¨åˆ°å¼±å¼•ç”¨ã€‚ ä¸Ž SoftReference ä¸€æ ·ï¼Œå¯ä»¥åŒ ReferenceQueue ä¸€èµ·ä½¿ç”¨ã€‚å½“ WeakReference çš„ Referent è¢«å›žæ”¶ä»¥åŽï¼Œè¿™ä¸ª WeakReference ä¼šè¢«è‡ªåŠ¨ enqueue åˆ°è¿™ä¸ª ReferenceQueue ä¸­ã€‚ 1234567891011121314151617181920212223242526272829303132333435private static void testWeakReferenceWithQueue () &#123; Person person = new Person(); System.out.println("person å¯¹è±¡ä¸º " + person); ReferenceQueue&lt;Person&gt; queue = new ReferenceQueue&lt;&gt;(); WeakReference&lt;Person&gt; wr = new WeakReference&lt;&gt;(person, queue); System.out.println("wr å¯¹è±¡ä¸º " + wr); if (wr.get() == null) &#123; System.out.println("person å¯¹è±¡è¿›å…¥ GC æµç¨‹"); &#125; else &#123; System.out.println("person å¯¹è±¡å°šæœªè¢«å›žæ”¶" + wr.get()); &#125; System.out.println("Whether or not this reference has been enqueued:" + wr.isEnqueued()); System.out.println("Queue item: " + queue.pull()); System.gc(); if (wr.get() == null) &#123;// ä»…æ˜¯è¡¨åæŒ‡ç¤ºçš„å¯¹è±¡å·²ç»è¿›å…¥åžƒåœ¾å›žæ”¶æµç¨‹ï¼Œæ­¤æ—¶å¯¹è±¡ä¸ä¸€å®šå·²ç»è¢«åžƒåœ¾å›žæ”¶ï¼Œåªæœ‰ç¡®è®¤è¢«åžƒåœ¾å›žæ”¶åŽï¼Œå¦‚æžœæœ‰ ReferenceQueue ï¼Œå…¶å¼•ç”¨æ‰ä¼šè¢«æ”¾ç½®äºŽ ReferenceQueue ä¸­ã€‚ System.out.println("person å¯¹è±¡è¿›å…¥ GC æµç¨‹"); &#125; else &#123; System.out.println("person å¯¹è±¡å°šæœªè¢«å›žæ”¶" + wr.get()); &#125; try &#123; // ç¡®ä¿åžƒåœ¾å›žæ”¶çº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œ Thread.sleep(1); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println("Whether or not this reference has been enqueued: " + wr.isEnqueued()); System.out.println("queue item: " + queue.poll());&#125; æ‰§è¡Œç»“æžœï¼š 123456789person å¯¹è±¡ä¸º com.example.ReferenceTEst$Person@522d9d8cwr å¯¹è±¡ä¸º java.lang.ref.WeakReference@603828d2person å¯¹è±¡å°šæœªè¢«å›žæ”¶ com.example.ReferenceTEst$Person@522d9d8cWhether or not this reference has been enqueued: falsequeue item: nullperson å¯¹è±¡è¿›å…¥å›žæ”¶æµç¨‹in Person finalizeWhether or not this reference has been enqueued: truequeue item: java.lang.ref.WeakReference@603828d2 ä»Žç¬¬äºŒè¡Œåˆ°æœ€åŽè¡Œå¯ä»¥çœ‹å‡ºï¼Œ person è¿›å…¥ GC æµç¨‹åŽï¼Œwr è¢«åŠ å…¥åˆ° queue ä¸­ã€‚ æ³¨æ„ï¼š â€‹ å½“ SoftReference æˆ–è€… WeakReference çš„ get() æ–¹æ³•è¿”å›ž null æ—¶ï¼Œä»…è¡¨ç¤ºå…¶æŒ‡ç¤ºå¯¹è±¡å·²ç»è¿›å…¥åžƒåœ¾å›žæ”¶æµç¨‹ï¼Œæ­¤æ—¶å¯¹è±¡ä¸ä¸€å®šå·²ç»è¢«åžƒåœ¾å›žæ”¶ã€‚ â€‹ è€Œåªæœ‰ç¡®è®¤è¢«åžƒåœ¾å›žæ”¶åŽï¼Œå¦‚æžœæœ‰ ReferenceQueueï¼Œ å…¶å¼•ç”¨æ‰ä¼šè¢«æ”¾ç½®äºŽ ReferenceQueue ä¸­ã€‚ PhantomReference è™šå¼•ç”¨è™šå¼•ç”¨æºç ï¼š 1234567891011121314package java.lang.ref;import java.lang.ref.Reference;import java.lang.ref.ReferenceQueue;public class PhantomReference&lt;T&gt; extends Reference&lt;T&gt; &#123; public T get()&#123; return null; &#125; public PhantomReference(T var1, ReferenceQueue&lt;? super T&gt; var2) &#123; super.(var1, var2); &#125;&#125; PhantomReference åªæœ‰ä¸€ä¸ªæž„é€ å‡½æ•° PhantomReference(T referenct, ReferenceQueue&lt;? super T&gt; q) å› æ­¤ï¼ŒPhantomReference ä½¿ç”¨å¿…é¡»ç»“åˆ ReferenceQueueï¼› ä¸ç®¡æœ‰æ— å¼ºå¼•ç”¨æŒ‡å‘ PhantomReference çš„æŒ‡ç¤ºå¯¹è±¡ï¼Œ PhantomReference çš„ get() æ–¹æ³•è¿”å›žç»“æžœéƒ½æ˜¯ null ä¸¾ä¾‹ï¼š 1234567891011121314151617181920212223private static void testPhantomReference() &#123; Person person = new Person(); System.out.println("person å¯¹è±¡ä¸º" + person); ReferenceQueue&lt;Person&gt; queue = new ReferenceQueue&lt;&gt;(); PhantomReference&lt;Person&gt; pr = new PhantomReference&lt;&gt;(person, queue); System.out.println("pr å¯¹è±¡ä¸º" + pr); System.out.println("pr.get() = " + pr.get()); person = null; System.gc(); try&#123; // ç¡®ä¿åžƒåœ¾å›žæ”¶çº¿ç¨‹æ‰§è¡Œ Thread.sleep(1); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println("queue item: " + queue.poll());&#125; æ‰§è¡Œç»“æžœï¼š 12345person å¯¹è±¡ä¸º com.example.ReferenceTEst$Person@522d9d8cpr å¯¹è±¡ä¸º java.lang.ref.PhantomReference@60e35b53pr.get() = nullin Person finalizequeue ite: java.lang.ref.PhantomReference@60e35b53 æ€»ç»“ï¼š â€‹ ä¸Ž WeakReference ä¸€æ ·ï¼Œä¸æ”¹å˜åŽŸæœ‰çš„å¼ºå¼•ç”¨å¯¹è±¡çš„åžƒåœ¾å›žæ”¶æœºåˆ¶ã€‚å¦‚æžœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥è¢«åžƒåœ¾å›žæ”¶ã€‚è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åžƒåœ¾å›žæ”¶åŽçš„æ´»åŠ¨ï¼ˆç›‘å¬å¹¶æ‰åŽ»å¿…è¦çš„è¡ŒåŠ¨ï¼‰ ç”¨é€”ï¼š â€‹ å½“åžƒåœ¾å›žæ”¶å™¨å‡†å¤‡å›žæ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æžœå‘çŽ°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›žæ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸Žä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ â€‹ ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­åŒ»ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥è™šå¼•ç”¨æ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åžƒåœ¾å›žæ”¶ã€‚ â€‹ ç¨‹åºå¦‚æžœå‘çŽ°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›žæ”¶ä¹‹å‰æ‰åŽ»å¿…è¦çš„è¡ŒåŠ¨ã€‚]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android å†…å­˜ç®¡ç†]]></title>
    <url>%2F2019%2F08%2F04%2FAndroid%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[å†…å­˜ç®¡ç†çš„ç›®çš„å°±æ˜¯æˆ‘ä»¬åœ¨å¼€å‘ä¸­æ€Žä¹ˆæœ‰æ•ˆçš„é¿å…æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå‡ºçŽ°å†…å­˜æ³„éœ²é—®é¢˜ã€‚å†…å­˜æ³„éœ²ç®€çŸ­ç²—ä¿—çš„è®²ï¼Œå°±æ˜¯è¯¥è¢«é‡Šæ”¾çš„å¯¹è±¡æ²¡æœ‰é‡Šæ”¾ï¼Œä¸€ç›´è¢«æŸä¸ªæˆ–æŸäº›å®žä¾‹æ‰€æŒæœ‰å´ä¸è¢«ä½¿ç”¨ï¼Œå¯¼è‡´ GC ä¸èƒ½å›žæ”¶ã€‚ Java å†…å­˜åˆ†é…ç­–ç•¥Java ç¨‹åºè¿è¡Œæ—¶çš„å†…å­˜åˆ†é…ç­–ç•¥æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯é™æ€åˆ†é…ã€æ ˆå¼åˆ†é…å’Œå †å¼åˆ†é…ã€‚å¯¹åº”çš„ä¸‰ç§å­˜å‚¨ç­–ç•¥ä½¿ç”¨çš„å†…å­˜ç©ºé—´ä¸»è¦åˆ†åˆ«æ˜¯é™æ€å­˜å‚¨åŒºï¼ˆæ–¹æ³•åŒºï¼‰ã€æ ˆåŒºå’Œå †åŒºã€‚ é™æ€å­˜å‚¨åŒºï¼ˆæ–¹æ³•åŒºï¼‰ï¼šä¸»è¦å­˜æ”¾é™æ€æ•°æ®ï¼Œå…¨å±€ static æ•°æ®å’Œå¸¸é‡ã€‚è¿™å—å†…å­˜åœ¨ç¨‹åºç¼–è¯‘æ—¶å°±å·²ç»åˆ†é…å¥½ï¼Œå¹¶ä¸”åœ¨ç¨‹åºæ•´ä¸ªè¿è¡ŒæœŸé—´éƒ½å­˜åœ¨ã€‚ æ ˆåŒºï¼šå½“æ–¹æ³•è¢«æ‰§è¡Œæ—¶ï¼Œæ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ï¼ˆå…¶ä¸­åŒ…æ‹¬åŸºç¡€æ•°æ®ç±»åž‹ã€å¯¹è±¡å¼•ç”¨ï¼‰éƒ½åœ¨æ ˆä¸Šåˆ›å»ºï¼Œå¹¶åœ¨æ–¹æ³•æ‰§è¡Œç»“æŸæ—¶è¿™äº›å±€éƒ¨å˜é‡æ‰€æŒæœ‰çš„å†…å­˜å°†ä¼šè‡ªåŠ¨è¢«é‡Šæ”¾ã€‚å› æ­¤æ ˆå†…å­˜åˆ†é…è¿ç®—å†…ç½®äºŽå¤„ç†å™¨çš„æŒ‡ä»¤é›†ä¸­ï¼Œæ•ˆçŽ‡å¾ˆé«˜ï¼Œä½†æ˜¯åˆ†é…çš„å†…å­˜å®¹é‡æœ‰é™ã€‚ å †åŒºï¼šåˆç§°åŠ¨æ€å†…å­˜åˆ†é…ï¼Œé€šå¸¸å°±æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ç›´æŽ¥ new å‡ºæ¥çš„å†…å­˜ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡çš„å®žä¾‹ã€‚è¿™éƒ¨åˆ†å†…å­˜åœ¨ä¸ä½¿ç”¨æ—¶ï¼Œå°†ä¼šç”± Java åžƒåœ¾å›žæ”¶å™¨è´Ÿè´£å›žæ”¶ã€‚ å †ä¸Žæ ˆçš„åŒºåˆ«ï¼šåœ¨æ–¹æ³•ä½“å†…å®šä¹‰çš„ï¼ˆå±€éƒ¨å˜é‡ï¼‰ä¸€äº›åŸºæœ¬ç±»åž‹çš„å˜é‡å’Œå¯¹è±¡çš„å¼•ç”¨éƒ½æ˜¯åœ¨æ–¹æ³•çš„æ ˆå†…å­˜ä¸­åˆ†é…çš„ã€‚å½“åœ¨ä¸€æ®µæ–¹æ³•å—ä¸­å®šä¹‰ä¸€ä¸ªå˜é‡æ—¶ï¼ŒJava å°±ä¼šåœ¨æ ˆä¸­ä¸ºè¯¥å˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼Œå½“è¶…è¿‡è¯¥å˜é‡çš„ä½œç”¨åŸŸåŽï¼Œè¯¥å˜é‡ä¹Ÿå°±æ— æ•ˆäº†ï¼Œåˆ†é…ç»™å®ƒçš„å†…å­˜ç©ºé—´ä¹Ÿå°†è¢«é‡Šæ”¾æŽ‰ï¼Œè¯¥å†…å­˜ç©ºé—´å¯ä»¥è¢«é‡æ–°ä½¿ç”¨ã€‚ å †å†…å­˜ç”¨æ¥å­˜æ”¾æ‰€æœ‰ç”± new åˆ›å»ºçš„å¯¹è±¡ï¼ˆåŒ…æ‹¬è¯¥å¯¹è±¡å…¶ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼‰å’Œæ•°ç»„ã€‚åœ¨å †ä¸­åˆ†é…çš„å†…å­˜ï¼Œå°†ç”± Java åžƒåœ¾å›žæ”¶å™¨æ¥è‡ªåŠ¨ç®¡ç†ã€‚åœ¨å †ä¸­äº§ç”Ÿäº†ä¸€ä¸ªæ•°ç»„æˆ–è€…å¯¹è±¡åŽï¼Œè¿˜å¯ä»¥åœ¨æ ˆä¸­å®šä¹‰ä¸€ä¸ªç‰¹æ®Šå˜é‡ï¼Œè¿™ä¸ªå˜é‡çš„å–å€¼ç­‰äºŽæ•°ç»„æˆ–è€…å¯¹è±¡åœ¨å†…å­˜ä¸­çš„é¦–åœ°å€ï¼Œè¿™ä¸ªç‰¹æ®Šçš„å˜é‡å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„å¼•ç”¨å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå¼•ç”¨å˜é‡æ¥è®¿é—®å †ä¸­çš„å¯¹è±¡æˆ–è€…æ•°ç»„ã€‚ ä¸¾ä¾‹ï¼š 123456789101112public class Sample &#123; int s1 = 0; Sample sample1 = new Sample(); public void method () &#123; int s2 = 1; Sample sample2 = new Sample(); &#125;&#125;Sample sample3 = new Sample(); Sample ç±»çš„å±€éƒ¨å˜é‡ s2 å’Œå¼•ç”¨å˜é‡ sample2 éƒ½æ˜¯å­˜åœ¨äºŽæ ˆä¸­ï¼Œä½† smaple2 æŒ‡å‘çš„å¯¹è±¡æ˜¯å­˜åœ¨äºŽå †ä¸­ã€‚ sample3 æŒ‡å‘çš„å¯¹è±¡å­˜æ”¾åœ¨å †ä¸­ï¼ŒåŒ…æ‹¬è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰æˆå‘˜å˜é‡ s1 å’Œ sample1ï¼Œ è€Œå®ƒè‡ªå·±å­˜åœ¨ä¸Žæ ˆä¸­ã€‚ ç»“è®ºï¼š å±€éƒ¨å˜é‡çš„è„šæœ¬æ•°æ®ç±»åž‹å’Œå¼•ç”¨å­˜å‚¨åœ¨æ ˆä¸­ï¼Œå¼•ç”¨çš„å¯¹è±¡å®žä½“å­˜å‚¨äºŽå †ä¸­ã€‚â€”â€” å› ä¸ºä»–ä»¬å±žäºŽæ–¹æ³•ä¸­çš„å˜é‡ï¼Œç”Ÿå‘½å‘¨æœŸéšæ–¹æ³•è€Œç»“æŸ æˆå‘˜å˜é‡å…¨éƒ¨å­˜å‚¨äºŽå †ä¸­ï¼ˆåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œå¼•ç”¨å’Œå¼•ç”¨çš„å¯¹è±¡å®žä½“ï¼‰ã€‚â€”â€” å› ä¸ºä»–ä»¬å±žäºŽç±»ï¼Œç±»å¯¹è±¡ç»ˆç©¶æ˜¯è¦è¢« new å‡ºæ¥ä½¿ç”¨çš„ã€‚ Java æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜Java çš„å†…å­˜ç®¡ç†å°±æ˜¯å¯¹è±¡çš„åˆ†é…å’Œé‡Šæ”¾çš„é—®é¢˜ã€‚åœ¨ Java ä¸­ï¼Œcoder éœ€è¦é€šè¿‡å…³é”®å­— new ä¸ºæ¯ä¸€ä¸ªå¯¹è±¡ç”³è¯·æ–°çš„å­˜å‚¨ç©ºé—´ï¼ˆåŸºæœ¬ç±»åž‹é™¤å¤–ï¼‰ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨ å †ï¼ˆHeapï¼‰ä¸­åˆ†é…ç©ºé—´ã€‚å¦å¤–å¯¹è±¡çš„é‡Šæ”¾æ˜¯ç”± GC å†³å®šå’Œæ‰§è¡Œçš„ï¼Œåœ¨ Java ä¸­ï¼Œå†…å­˜åˆ†é…æ˜¯ç”± coder å®Œæˆçš„ï¼Œè€Œå†…å­˜é‡Šæ”¾æ˜¯ç”± GC å®Œæˆçš„ã€‚è¿™ç§æ”¶æ”¯ä¸¤æ¡çº¿çš„æ–¹æ³•ç®€åŒ–äº† coder çš„å·¥ä½œã€‚åŒæ—¶ä¹ŸåŠ é‡äº† JVM çš„å·¥ä½œã€‚ä¹Ÿæ˜¯ Java ç¨‹åºè¿è¡Œé€Ÿåº¦æ…¢çš„åŽŸå› ä¹‹ä¸€ã€‚å› ä¸º GC ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾å¯¹è±¡ï¼Œ GC å¿…é¡»ç›‘æŽ§æ¯ä¸€ä¸ªå¯¹è±¡çš„è¿è¡ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬å¯¹è±¡çš„ç”³è¯·ã€å¼•ç”¨ã€è¢«å¼•ç”¨ã€èµ‹å€¼ç­‰ï¼ŒGC éƒ½éœ€è¦ç›‘æŽ§ã€‚ ç›‘æŽ§å¯¹è±¡çŠ¶æ€æ˜¯ä¸ºäº†æ›´å‡†ç¡®ã€åŠæ—¶åœ°é‡Šæ”¾å¯¹è±¡ï¼Œè€Œé‡Šæ”¾å¯¹è±¡çš„æ ¹æœ¬åŽŸåˆ™å°±æ˜¯è¯¥å¯¹è±¡ä¸åœ¨è¢«å¼•ç”¨ã€‚ Java ä½¿ç”¨æœ‰å‘å›¾çš„æ–¹å¼è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œå¯ä»¥æ¶ˆé™¤å¼•ç”¨å¾ªçŽ¯çš„é—®é¢˜ï¼Œä¾‹å¦‚æœ‰ä¸‰ä¸ªå¯¹è±¡ï¼Œç›¸äº’å¼•ç”¨ï¼Œåªè¦ä»–ä»¬å’Œæ ¹è¿›ç¨‹ä¸å¯è¾¾ï¼Œé‚£ä¹ˆ GC å°±å¯ä»¥å›žæ”¶ä»–ã€‚è¿™ç§ç®¡ç†æ–¹å¼çš„æœ‰ç‚¹æ˜¯ç®¡ç†å†…å­˜çš„ç²¾åº¦é«˜ï¼Œä½†æ˜¯æ•ˆçŽ‡ä½Žã€‚ ä»€ä¹ˆæ˜¯ Java ä¸­çš„å†…å­˜æ³„éœ²åœ¨ Java ä¸­ï¼Œå†…å­˜æ³„éœ²å°±æ˜¯å­˜åœ¨ä¸€äº›è¢«åˆ†é…çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡æœ‰ä¸¤ä¸ªç‰¹ç‚¹ã€‚ è¿™äº›å¯¹è±¡æ˜¯å¯è¾¾çš„ï¼Œå³åœ¨æœ‰å‘å›¾ä¸­ï¼Œå­˜åœ¨é€šè·¯ä¸Žå…¶ç›¸è¿ž è¿™äº›å¯¹è±¡æ˜¯æ— ç”¨çš„ï¼Œå³ç¨‹åºä»¥åŽä¸ä¼šåœ¨ä½¿ç”¨è¿™äº›å¯¹è±¡ã€‚ å¦‚æžœæ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œè¿™äº›å¯¹è±¡å°±å¯ä»¥åˆ¤å®šä¸º Java ä¸­çš„å†…å­˜æ³„éœ²ï¼Œè¿™äº›å¯¹è±¡ä¸ä¼šè¢« GC å›žæ”¶ï¼Œä½†å´æ˜¯å ç”¨ç€å†…å­˜ã€‚ å¯¹äºŽç¨‹åºçŒ¿æ¥è¯´ï¼Œ GC åŸºæœ¬æ˜¯é€æ˜Žçš„ï¼Œä¸å¯è§çš„ã€‚è™½ç„¶æˆ‘ä»¬åªæœ‰å‡ ä¸ªå‡½æ•°å¯ä»¥æ–¹ä½ GCï¼Œ ä¾‹å¦‚è¿è¡Œ GC çš„å‡½æ•° System.gc()ï¼Œä½†æ˜¯æ ¹æ® Java è¯­è¨€è§„èŒƒå®šä¹‰ï¼Œè¯¥å‡½æ•°ä¸ä¿è¯ JVM çš„åžƒåœ¾å›žæ”¶å™¨ä¸€å®šä¼šæ‰§è¡Œã€‚å› ä¸ºï¼Œä¸åŒçš„ JVM å®žçŽ°ç€å¯èƒ½ä½¿ç”¨ä¸åŒçš„ç®—æ³•ç®¡ç† GCã€‚ é€šå¸¸ GC çš„çº¿ç¨‹ä¼˜å…ˆçº§æ¯”è¾ƒä½Žã€‚ JVM è°ƒç”¨ GC çš„ç­–ç•¥ä¹Ÿæœ‰å¾ˆå¤šç§ï¼Œæœ‰çš„æ˜¯å†…å­˜ä½¿ç”¨è¾¾åˆ°ä¸€å®šæˆéƒ½æ—¶ï¼Œ GC æ‰å¼€å§‹å·¥ä½œï¼›ä¹Ÿæœ‰å®šæ—¶æ‰§è¡Œï¼Œæœ‰çš„æ˜¯å¹³ç¼“æ‰§è¡Œ GCï¼Œ æœ‰çš„æ˜¯ä¸­æ–­å¼æ‰§è¡Œ GCã€‚ é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒè¿™äº›ã€‚é™¤éžåœ¨ä¸€äº›ç‰¹å®šçš„åœºåˆï¼Œ GC çš„æ‰§è¡Œå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œä¾‹å¦‚å¯¹äºŽåŸºäºŽ Web çš„å®žæ—¶ç³»ç»Ÿï¼Œå¦‚ç½‘ç»œæ¸¸æˆç­‰ï¼Œç”¨æˆ·ä¸å¸Œæœ› GC çªç„¶ç»ˆç«¯åº”ç”¨ç¨‹åºæ‰§è¡Œè€Œè¿›è¡Œåžƒåœ¾å›žæ”¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦è°ƒæ•´ GC çš„å‚æ•°ï¼Œè®© GC èƒ½å¤Ÿé€šè¿‡å¹³ç¼“çš„æ–¹å¼é‡Šæ”¾å†…å­˜ï¼Œä¾‹å¦‚å°†åžƒåœ¾å›žæ”¶åˆ†è§£ä¸ºä¸€ç³»åˆ—çš„å°æ­¥éª¤æ‰§è¡Œï¼Œ Sun æä¾›äº† HotSpot JVM æ”¯æŒè¿™ä¸€ç‰¹æ€§ã€‚ åŒæ ·ç»™å‡ºä¸€ä¸ª Java å†…å­˜æ³„éœ²çš„å…¸åž‹ä¾‹å­ 123456Vector v = new Vector(10);for (int i = 1; i &lt; 100; i++) &#123; Object o = new Object(); v.add(o); o = null;&#125; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¾ªçŽ¯ç”³è¯· Object å¯¹è±¡ï¼Œå¹¶å°†æ‰€ç”³è¯·çš„å¯¹è±¡æ”¾å…¥ä¸€ä¸ª Vector ä¸­ï¼Œå¦‚æžœæˆ‘ä»¬ä»…ä»…é‡Šæ”¾å¼•ç”¨æœ¬èº«ï¼Œé‚£ä¹ˆ Vector ä»ç„¶åº”ç”¨è¯¥å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªå¯¹è±¡å¯¹ GC æ¥è¯´æ˜¯ä¸å¯å›žæ”¶çš„ã€‚å› æ­¤ï¼Œå¦‚æžœå¯¹è±¡åŠ å…¥åˆ° Vector åŽï¼Œè¿˜å¿…é¡»ä»Ž Vector ä¸­åˆ é™¤ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°† Vector å¯¹è±¡è®¾ç½®ä¸º nullã€‚ è¯¦ç»†çš„ Java ä¸­çš„å†…å­˜æ³„éœ²Java å†…å­˜å›žæ”¶æœºåˆ¶ä¸è®ºé‚£ç§è¯­è¨€çš„å†…å­˜åˆ†é…æ–¹å¼ï¼Œéƒ½éœ€è¦è¿”å›žæ‰€åˆ†é…çš„çœŸå®žåœ°å€ï¼Œä¹Ÿå°±æ˜¯è¿”å›žä¸€ä¸ªæŒ‡é’ˆåˆ°å†…å­˜å—çš„é¦–åœ°å€ã€‚Java ä¸­å¯¹è±¡æ˜¯é‡‡ç”¨ new æˆ–è€…åå°„çš„æ–¹æ³•åˆ›å»ºçš„ï¼Œè¿™äº›å¯¹è±¡çš„åˆ›å»ºéƒ½æ˜¯åœ¨å †ï¼ˆHeapï¼‰ä¸­åˆ†é…çš„ã€‚æ‰€æœ‰å¯¹è±¡çš„å›žæ”¶éƒ½æ˜¯ç”± Java è™šæ‹Ÿæœºé€šè¿‡åžƒåœ¾å›žæ”¶æœºåˆ¶å®Œæˆã€‚ GC ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾å¯¹è±¡ï¼Œä¼šç›‘æŽ§æ¯ä¸ªå¯¹è±¡çš„è¿è¡ŒçŠ¶æ€ï¼Œå¯¹ä»–ä»¬çš„ç”³è¯·ã€å¼•ç”¨ã€è¢«å¼•ç”¨ã€èµ‹å€¼ç­‰çŠ¶å†µè¿›è¡Œç›‘æŽ§ï¼Œ Java ä¼šä½¿ç”¨æœ‰å‘å›¾çš„æ–¹å¼è¿›è¡Œç®¡ç†å†…å­˜ï¼Œå®žæ—¶ç›‘æŽ§å¯¹è±¡æ˜¯å¦å¯ä»¥åˆ°è¾¾ï¼Œå¦‚æžœä¸å¯ä»¥åˆ°è¾¾ï¼Œåˆ™å°†å…¶å›žæ”¶ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ¶ˆé™¤å¼•ç”¨çš„å¾ªçŽ¯é—®é¢˜ã€‚åœ¨ Java è¯­è¨€ä¸­ï¼Œåˆ¤æ–­ä¸€ä¸ªå†…å­˜ç©ºé—´æ˜¯å¦ç¬¦åˆåžƒåœ¾å›žæ”¶æ ‡å‡†æœ‰ä¸¤ä¸ªï¼š 1. ç»™å¯¹è±¡èµ‹äºˆäº†ç©ºå€¼ null 2. ç»™å¯¹è±¡èµ‹äºˆäº†æ–°å€¼ï¼Œè¿™æ ·é‡æ–°åˆ†é…äº†å†…å­˜ç©ºé—´ã€‚ Java å†…å­˜æ³„æ¼å¼•èµ·çš„åŽŸå› å†…å­˜æ³„éœ²æ˜¯æŒ‡æ— ç”¨å¯¹è±¡ï¼ˆä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼‰æŒç»­å æœ‰å†…å­˜æ´»æ— ç”¨å¯¹è±¡çš„å†…å­˜å¾—ä¸åˆ°åŠæ—¶é‡Šæ”¾ï¼Œä»Žè€Œé€ æˆå†…å­˜ç©ºé—´çš„æµªè´¹ç§°ä¸ºå†…å­˜æ³„æ¼ã€‚å†…å­˜æ³„æ¼æœ‰æ—¶ä¸ä¸¥é‡ï¼Œä¸æ˜“å¯Ÿè§‰ï¼Œè¿™æ ·å¼€å‘è€…å°±ä¸çŸ¥é“å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œä½†æœ‰æ—¶ä¹Ÿå¾ˆä¸¥é‡ï¼Œä¼šæç¤º Out of memoryã€‚ Java å†…å­˜æ³„æ¼çš„æ ¹æœ¬åŽŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„å¼•ç”¨å°±å¾ˆå¯èƒ½å‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œå°½ç®¡çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡å·²ç»ä¸å†éœ€è¦ï¼Œä½†æ˜¯å› ä¸ºé•¿ç”Ÿå‘½å‘¨æœŸæŒæœ‰å®ƒçš„å¼•ç”¨è€Œå¯¼è‡´ä¸èƒ½è¢«é‡Šæ”¾å›žæ”¶ï¼Œè¿™å°±æ˜¯ Java ä¸­å†…å­˜æ³„æ¼çš„å‘ç”Ÿåœºæ™¯ï¼Œä¸»è¦æœ‰ä¸€ä¸‹å‡ å¤§ç±»ï¼š é™æ€é›†åˆç±»å¼•èµ·çš„å†…å­˜æ³„æ¼ï¼š åƒ HashMapã€Vector ç­‰çš„ä½¿ç”¨æœ€å®¹æ˜“å‡ºçŽ°å†…å­˜æ³„æ¼ï¼Œè¿™äº›é™æ€å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå’Œåº”ç”¨ç¨‹åºä¸€è‡´ï¼Œä»–ä»¬æ‰€å¼•ç”¨çš„æ‰€æœ‰çš„å¯¹è±¡ Object ä¹Ÿä¸èƒ½è¢«é‡Šæ”¾ï¼Œå› ä¸ºä»–ä»¬ä¹Ÿå°†ä¸€ç›´è¢« Vector ç­‰å¼•ç”¨ç€ã€‚ ä¾‹å¦‚ï¼š 123456Static Vector v = new Vercor(10);for (int i = 1; i &lt; 100; i++) &#123; Object o = new Object(); v.add(o); o = null;&#125; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¾ªçŽ¯ç”³è¯· Object å¯¹è±¡ï¼Œå¹¶å°†æ‰€ç”³è¯·çš„å¯¹è±¡æ”¾å…¥ä¸€ä¸ª Vector ä¸­ï¼Œå¦‚æžœä»…ä»…é‡Šæ”¾å¼•ç”¨æœ¬èº«ï¼ˆo = nullï¼‰ï¼Œé‚£ä¹ˆ Vector ä»ç„¶å¼•ç”¨è¯¥å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªå¯¹è±¡å¯¹ GC æ¥è¯´æ˜¯ä¸å¯ä¼šè¯´çš„ã€‚å› æ­¤å¯¹è±¡åŠ å…¥åˆ° Vector åŽï¼Œ è¿˜å¿…é¡»ä»Ž Vector ä¸­åˆ é™¤ï¼Œæœ€ç®€å•çš„æ˜¯å°† Vector è®¾ç½®ä¸º nullã€‚ å½“é›†åˆé‡Œé¢çš„å¯¹è±¡å±žæ€§è¢«ä¿®æ”¹åŽï¼Œå†è°ƒç”¨ remove() æ–¹æ³•æ—¶ï¼Œä¸èµ·ä½œç”¨ ä¾‹å¦‚ï¼š 12345678910111213141516171819202122public static void main(String[] args) &#123; Set&lt;Person&gt; set = new HashSet&lt;Person&gt;(); Person p1 = new Person("å”åƒ§", "pwd1", 25); Person p2 = new Person("å­™æ‚Ÿç©º", "pwd2", 24); Person p3 = new Person("çŒªå…«æˆ’", "pwd3", 26); set.add(p1); set.add(p2); set.add(p3); System.out.println("æ€»å…±æœ‰ï¼š" + set.size() + " ä¸ªå…ƒç´ ");// ç»“æžœï¼š æ€»å…±æœ‰ 3 ä¸ªå…ƒç´  p3.setAge(2); // ä¿®æ”¹ p3 çš„å¹´é¾„ï¼Œæ­¤æ—¶ p3 å…ƒç´ å¯¹åº”çš„ hashcode å€¼å‘ç”Ÿæ”¹å˜ set.remove(p3); // remove æŽ‰ï¼Œé€ æˆå†…å­˜æ³„éœ² set.add(p3); // é‡æ–°æ·»åŠ ï¼ŒæˆåŠŸ System.out.println("æ€»å…±æœ‰ï¼š" + set.size() + " ä¸ªå…ƒç´ "); // ç»“æžœï¼šæ€»å…±æœ‰ 4 ä¸ªå…ƒç´  for (Person person : set) &#123; System.out.println(person); &#125;&#125; ç›‘å¬å™¨ åœ¨ Java å˜æˆä¸­ï¼Œæˆ‘ä»¬éœ€è¦å’Œç›‘å¬å™¨æ‰“äº¤é“ï¼Œé€šå¸¸ä¸€ä¸ªåº”ç”¨å½“ä¸­ä¼šæœ‰å¤šä¸ªç›‘å¬å™¨ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ä¸€ä¸ªæŽ§ä»¶çš„ä¾‹å¦‚addXXXXListener() ç­‰æ–¹æ³•æ¥å¢žåŠ ç›‘å¬å™¨ï¼Œä½†å¾€å¾€åœ¨é‡Šæ”¾å¯¹è±¡çš„æ—¶å€™ï¼Œå´æ²¡æœ‰è®°ä½åŽ»åˆ é™¤è¿™äº›ç›‘å¬å™¨ï¼Œä»Žè€Œå¢žåŠ äº†å†…å­˜æ³„æ¼çš„æœºä¼šã€‚ å„ç§è¿žæŽ¥ æ¯”å¦‚æ•°æ®åº“è¿žæŽ¥ï¼ˆdataSourse.getConnection()ï¼‰ã€ ç½‘ç»œè¿žæŽ¥(socket) å’Œ io è¿žæŽ¥ï¼Œé™¤éžå…¶æ˜¾ç¤ºçš„è°ƒç”¨äº†å…¶ close() æ–¹æ³•å°†å…¶è¿žæŽ¥å…³é—­ï¼Œå¦åˆ™æ˜¯ä¸ä¼šè‡ªåŠ¨è¢« GC å›žæ”¶çš„ã€‚å¯¹äºŽ Resultset å’Œ Statement å¯¹è±¡å¯ä»¥ä¸è¿›è¡Œæ˜¾ç¤ºå›žæ”¶ï¼Œä½† Connection ä¸€å®šè¦æ˜¾ç¤ºå›žæ”¶ï¼Œå› ä¸º Connection åœ¨ä»»ä½•æ—¶å€™éƒ½æ— æ³•è‡ªåŠ¨å›žæ”¶ï¼Œè€Œ Connection ä¸€æ—¦å›žæ”¶ï¼Œ Resultset å’Œ Statement å¯¹è±¡å°±ä¼šç«‹å³2ä¸º NULLã€‚ ä½†æ˜¯å¦‚æžœä½¿ç”¨è¿žæŽ¥æ± ï¼Œæƒ…å†µå°±ä¸ä¸€æ ·äº†ï¼Œé™¤äº†è¦æ˜¾ç¤ºåœ°å…³é—­é“¾æŽ¥ï¼Œè¿˜å¿…é¡»æ˜¾ç¤ºåœ°å…³é—­ Resultset å’Œ Statement å¯¹è±¡ï¼ˆå…³é—­å…¶ä¸­ä¸€ä¸ªï¼Œ å¦å¤–ä¸€ä¸ªä¹Ÿä¼šå…³é—­ï¼‰ï¼Œå¦åˆ™å°±ä¼šé€ æˆå¤§é‡çš„ Statement å¯¹è±¡æ— æ³•é‡Šæ”¾ï¼Œä»Žè€Œå¼•èµ·å†…å­˜æ³„æ¼ã€‚è¿™ç§æƒ…å†µä¸‹ä¸€èˆ¬éƒ½ä¼šåœ¨ try é‡Œé¢åŽ»è¿žæŽ¥ï¼Œåœ¨ finally é‡Œé¢é‡Šæ”¾è¿žæŽ¥ã€‚ å†…éƒ¨ç±»å’Œå¤–éƒ¨æ¨¡å—çš„å¼•ç”¨ å†…éƒ¨ç±»çš„å¼•ç”¨æ˜¯æ¯”è¾ƒå®¹æ˜“é—å¿˜çš„ä¸€ç§ï¼Œè€Œä¸”ä¸€æ—¦æ²¡é‡Šæ”¾å¯èƒ½å¯¼è‡´ä¸€ç³»åˆ—çš„åŽç»­ç±»å¯¹è±¡æ²¡æœ‰é‡Šæ”¾ã€‚æ­¤å¤– coder è¿˜è¦å°å¿ƒå¤–éƒ¨æ¨¡å—ä¸ç»æ„çš„å¼•ç”¨ï¼Œä¾‹å¦‚ coder A è´Ÿè´£ A æ¨¡å—ï¼Œè°ƒç”¨äº† B æ¨¡å—çš„ä¸€ä¸ªæ–¹æ³•ï¼š public void registerMsg(Object b); è¿™ç§è°ƒç”¨å°±è¦å°å¿ƒï¼Œä¼ å…¥äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¾ˆå¯èƒ½æ¨¡å— B å°±ä¿æŒäº†å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™æ—¶å€™å°±éœ€è¦æ³¨æ„æ¨¡å— B æ˜¯å¦æä¾›å“åº”çš„æ“ä½œåŽ»é™¤å¼•ç”¨ã€‚ å•ä¾‹æ¨¡å¼ ä¸æ­£ç¡®çš„ä½¿ç”¨å•ä¾‹æ¨¡å¼æ˜¯å¼•èµ·å†…å­˜æ³„æ¼çš„ä¸€ä¸ªå¸¸è§é—®é¢˜ï¼Œå•åˆ©å¯¹è±¡åœ¨åˆå§‹åŒ–åŽï¼Œå°†åœ¨ JVM çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å­˜åœ¨ï¼ˆä»¥é™æ€å˜é‡çš„æ–¹å¼ï¼‰ï¼Œå¦‚æžœå•ä¾‹å¯¹è±¡æŒæœ‰å¤–éƒ¨çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†ä¸èƒ½è¢« JVM æ­£å¸¸å›žæ”¶ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚ 12345678910111213141516171819202122class A &#123; public A () &#123; B.getInstance().setA(this); &#125; ...&#125;// B é‡‡ç”¨å•ä¾‹æ¨¡å¼class B &#123; private A a; private static B instance = new B(); private b ()&#123;&#125; public static B getInstance()&#123; return instacne; &#125; public void setA (A a) &#123; this.a = a; &#125; // .........&#125; æ˜¾ç„¶ B é‡‡ç”¨ singleton æ¨¡å¼ï¼Œ å®ƒæŒæœ‰ä¸€ä¸ª A å¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œè¿™ä¸ªç±»çš„å¯¹è±¡å°†ä¸èƒ½è¢«å›žæ”¶ã€‚æƒ³è±¡ä¸‹å¦‚æžœ A æ˜¯ä¸ªæ¯”è¾ƒå¤æ‚çš„å¯¹è±¡æˆ–è€…é›†åˆç±»åž‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ Android ä¸­å¸¸è§çš„å†…å­˜æ³„æ¼æ±‡æ€»é›†åˆç±»æ³„æ¼é›†åˆç±»å¦‚æžœä»…ä»…æœ‰æ·»åŠ å…ƒç´ çš„æ–¹æ³•ï¼Œè€Œæ²¡æœ‰ç›¸åº”çš„åˆ é™¤æœºåˆ¶ï¼Œå¯¼è‡´å†…å­˜è¢«å ç”¨ã€‚å¦‚æžœè¿™ä¸ªé›†åˆç±»æ˜¯å…¨å±€æ€§çš„å˜é‡ï¼ˆæ¯”å¦‚ç±»ä¸­çš„é™æ€å±žæ€§ï¼Œå…¨å±€æ€§çš„ map ç­‰å³æœ‰é™æ€å¼•ç”¨æˆ– final ä¸€ç›´æŒ‡å‘å®ƒï¼‰ï¼Œé‚£ä¹ˆæ²¡æœ‰ç›¸åº”çš„åˆ é™¤æœºåˆ¶ï¼Œå¾ˆå¯èƒ½å¯¼è‡´é›†åˆæ‰€å ç”¨çš„å†…å­˜åªå¢žä¸å‡ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­å°±æ˜¯å…¶ä¸­ä¸€ç§æƒ…å†µï¼Œå½“ç„¶å®žé™…ä¸Šæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­è‚¯å®šä¸ä¼šè¿™æ ·è°¢ä»£ç ï¼Œä½†ç¨ä¸æ³¨æ„è¿˜æ˜¯å¾ˆå®¹æ˜“å‡ºçŽ°è¿™ç§æƒ…å†µã€‚ å•ä¾‹é€ æˆçš„å†…å­˜æ³„éœ²ç”±äºŽå•åˆ©çš„é™æ€ç‰¹æ€§ä½¿å¾—å…¶ç”Ÿå‘½å‘¨æœŸè·Ÿåº”ç”¨ä¸€æ ·é•¿ï¼Œæ‰€ä»¥å¦‚æžœä½¿ç”¨ä¸æ°å½“çš„è¯ï¼Œå¾ˆå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ã€‚ 12345678910111213public class AppManager &#123; private static AppManager instance; private Context context; private AppManager(Context context) &#123; this.connect = connect; &#125; public static AppManager getInstance(Context context) &#123; if (instance == null) &#123; instance = new AppManager(context); &#125; return instance; &#125;&#125; è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„å•ä¾‹æ¨¡å¼ï¼Œå½“åˆ›å»ºè¿™ä¸ªå•ä¾‹çš„æ—¶å€™ï¼Œç”±äºŽéœ€è¦ä¼ å…¥ä¸€ä¸ª Contextï¼Œ æ‰€ä»¥è¿™ä¸ª Context çš„ç”Ÿå‘½å‘¨æœŸçš„é•¿çŸ­è‡³å…³é‡è¦ï¼š å¦‚æžœæ­¤æ—¶ä¼ å…¥çš„æ˜¯ Application çš„ Contextï¼Œ å› ä¸º Application çš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯è¿™ä¸ªåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥è¿™å°†æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ å¦‚æžœæ­¤æ—¶ä¼ å…¥çš„æ˜¯ Activity çš„ Contextï¼Œå½“è¿™ä¸ª Context æ‰€å¯¹åº”çš„ Activity é€€å‡ºæ—¶ï¼Œç”±äºŽè¯¥ Context çš„åº”ç”¨è¢«å•ä¾‹å¯¹è±¡æ‰€æŒæœ‰ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸç­‰äºŽæ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥å½“å‰ Activity é€€å‡ºæ—¶ï¼Œå®ƒçš„å†…å­˜å¹¶ä¸ä¼šè¢«é‡Šæ”¾ï¼Œå°±ä¼šé€ æˆæ³„æ¼ã€‚ æ­£ç¡®çš„æ–¹å¼åº”ä¿®æ”¹ä¸ºï¼š 1234567891011121314public class AppManager &#123; private static AppManager instance; private Context context; private AppManager (Context context) &#123; this.context = context.getApplicationContext();// ä½¿ç”¨ Application çš„ context &#125; public static AppManager getInstance(Context context) &#123; if (instance == null) &#123; instance = new AppManager(context); &#125; return instance; &#125;&#125; æˆ–è€…è¿™æ ·å†™ï¼Œè¿ž Context éƒ½ä¸ç”¨ä¼ è¿›æ¥ï¼š 12345678910111213141516171819202122232425262728293031åœ¨ä½ çš„ Application ä¸­æ·»åŠ ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œ getContext() è¿”å›ž Application çš„ context...context = getApplicationContext();.../** * èŽ·å–å…¨å±€çš„ Context * @return è¿”å›žå…¨å±€çš„ context å¯¹è±¡ */ public static Context getContext()&#123; reutnr context;&#125;public class AppManager &#123; private static AppManager instance; private Context context; private AppManager () &#123; this.context = MyApplication.getContext();// ä½¿ç”¨ Application çš„ context &#125; public staitc AppManager getInstance() &#123; if (instance == null) &#123; instance = new AppManager(); &#125; return instance; &#125;&#125; åŒ¿åå†…éƒ¨ç±»/éžé™æ€å†…éƒ¨ç±»å’Œå¼‚æ­¥çº¿ç¨‹éžé™æ€å†…éƒ¨ç±»åˆ›å»ºé™æ€å®žä¾‹é€ æˆçš„å†…å­˜æ³„æ¼ æœ‰çš„æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šåœ¨å¯åŠ¨é¢‘ç¹çš„ Activity ä¸­ï¼Œä¸ºäº†é¿å…é‡å¤åˆ›å»ºç›¸åŒèµ„æºï¼Œå¯èƒ½ä¼šå‡ºçŽ°è¿™ç§å†™æ³• 1234567891011121314151617public class MainActivity extends AppCompatActivity &#123; private staitc TestResource mResource = null; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); if(mResource == null) &#123; mResource = new TestResource(); &#125; //.... &#125; class TestResource &#123; //.... &#125;&#125; è¿™æ ·å°±åœ¨ Activity å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªéžé™æ€å†…éƒ¨ç±»çš„å•ä¾‹ï¼Œæ¯æ¬¡å¯åŠ¨ Activity éƒ½ä¼šä½¿ç”¨è¯¥å•åˆ©çš„æ•°æ®ï¼Œè¿™æ ·è™½ç„¶é¿å…äº†èµ„æºçš„é‡å¤åˆ›å»ºï¼Œä¸è¿‡è¿™ç§å†™æ³•å´é€ æˆäº†å†…å­˜å†™æ³„æ¼ï¼Œå› ä¸ºéžé™æ€å†…éƒ¨ç±»é»˜è®¤ä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œè€Œè¯¥éžé™æ€å†…éƒ¨ç±»åˆåˆ›å»ºäº†ä¸€ä¸ªé™æ€å®žä¾‹ï¼Œè¯¥å®žä¾‹çš„ç”Ÿå‘½å‘¨æœŸå’Œåº”ç”¨ä¸€æ ·é•¿ï¼Œè¿™å°±å¯¼è‡´äº†è¯¥é™æ€å®žä¾‹ä¸€ç›´ä¼šæŒæœ‰è¯¥ Activity çš„å¼•ç”¨ï¼Œå¯¼è‡´ Activity çš„å†…å­˜èµ„æºä¸èƒ½æ­£å¸¸å›žæ”¶ã€‚æ­£ç¡®çš„åšæ³•ï¼š å°†è¯¥å†…éƒ¨ç±»è®¾ä¸ºé™æ€å†…éƒ¨ç±»æˆ–è€…å°†è¯¥å†…éƒ¨ç±»æŠ½å–å‡ºæ¥å°è£…æˆå•ä¾‹ï¼Œå¦‚æžœéœ€è¦ä½¿ç”¨ Contextï¼Œ æŒ‰ç…§ä¸Šä¸€ä¸ªæ–¹æ³•æŽ¨èä½¿ç”¨ Application ä¸­çš„ Contextã€‚ å½“ç„¶ Application çš„ Context ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½éšä¾¿ä¹±ç”¨ï¼Œå¯¹äºŽæœ‰äº›åœ°æ–¹åˆ™æ˜¯å¿…é¡»ä½¿ç”¨ Activity çš„ Context ï¼Œå¯¹äºŽ Applicationï¼ŒServiceï¼Œ Activity ä¸‰è€…çš„ Context çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š å…¶ä¸­ï¼šNO1 è¡¨ç¤º Application å’Œ Service å¯ä»¥å¯åŠ¨ä¸€ä¸ª Activityï¼Œä¸è¿‡éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ task ä»»åŠ¡é˜Ÿåˆ—ã€‚è€Œå¯¹äºŽ Dialog è€Œè¨€ï¼Œåªæœ‰åœ¨ Activity ä¸­æ‰èƒ½åˆ›å»ºã€‚ åŒ¿åå†…éƒ¨ç±»Android å¼€å‘ç»å¸¸ä¼šç»§æ‰¿å®žçŽ° Activity/Fragment/Viewï¼Œ æ­¤æ—¶å¦‚æžœä½ ä½¿ç”¨äº†åŒ¿åç±»ï¼Œå¹¶è¢«å¼‚æ­¥çº¿ç¨‹æŒæœ‰ï¼Œå¦‚æžœæ²¡æœ‰ä»»ä½•æŽªæ–½è¿™æ ·ä¸€å®šä¼šå¯¼è‡´æ³„æ¼ 1234567891011public class MainActivity extends Activity &#123; ... Runnable ref1 = new MyRunnable(); Runnable ref2 = new Runnable ()&#123; @Override public void run() &#123; .... &#125; &#125;; ...&#125; ref1 å’Œ ref2 çš„åŒºåˆ«æ˜¯ï¼Œ ref2 ä½¿ç”¨äº†åŒ¿åå†…éƒ¨ç±»ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿è¡Œæ—¶ï¼Œè¿™ä¸¤ä¸ªå¼•ç”¨çš„å†…å­˜ï¼š å¯ä»¥çœ‹åˆ° ref1 æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚ ä½† ref2 è¿™ä¸ªåŒ¿åç±»çš„å®žçŽ°å¯¹è±¡é‡Œé¢å¤šäº†ä¸€ä¸ªå¼•ç”¨ï¼š this$0 è¿™ä¸ªå¼•ç”¨æŒ‡å‘ MainActivity.thisï¼Œ ä¹Ÿå°±æ˜¯è¯´å½“å‰çš„ MainActivity å®žä¾‹ä¼šè¢« ref2 æŒæœ‰ï¼Œå¦‚æžœå°†è¿™ä¸ªå¼•ç”¨å†ä¼ å…¥ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹ï¼Œæ­¤çº¿ç¨‹å’Œæ­¤ Activity ç”Ÿå‘½å‘¨æœŸä¸ä¸€è‡´çš„æ—¶å€™ï¼Œå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚ Handler é€ æˆçš„å†…å­˜æ³„æ¼Handler çš„ä½¿ç”¨é€ æˆçš„å†…å­˜æ³„æ¼é—®é¢˜åº”è¯¥è¯´æ˜¯æœ€å¸¸è§çš„ï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸ºäº†é¿å… ANR è€Œä¸åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œè€—æ—¶æ“ä½œï¼Œåœ¨å¤„ç†ç½‘ç»œä»»åŠ¡æˆ–è€…å°è£…ä¸€äº›è¯·æ±‚å›žè°ƒç­‰ api éƒ½å€ŸåŠ© Handler æ¥å¤„ç†ï¼Œä½† Handler ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå¯¹äºŽ Handler çš„ä½¿ç”¨ä»£ç ç¼–å†™ä¸è§„èŒƒå°±æœ‰å¯èƒ½é€ æˆå†…å­˜æ³„æ¼ã€‚å¦å¤–ï¼Œæˆ‘ä»¬çŸ¥é“ Handlerã€Message å’Œ MessageQueue éƒ½æ˜¯ç›¸äº’å…³è”åœ¨ä¸€èµ·çš„ï¼Œä¸‡ä¸€ Handler å‘é€çš„ Message å°šæœªè¢«å¤„ç†ï¼Œåˆ™è¯¥ Message åŠå‘é€å®ƒçš„ Handler å¯¹è±¡å°†è¢«çº¿ç¨‹ MessageQueue ä¸€ç›´æŒæœ‰ã€‚ ç”±äºŽ Handler å±žäºŽ TLSï¼ˆThread Local Storageï¼‰å˜é‡ï¼Œç”Ÿå‘½å‘¨æœŸå’Œ Activity æ˜¯ä¸ä¸€è‡´çš„ã€‚å› æ­¤è¿™ç§å®žçŽ°æ–¹å¼ä¸€èˆ¬å¾ˆéš¾ä¿è¯è·Ÿ View æˆ–è€… Activity çš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ— æ³•æ­£ç¡®é‡Šæ”¾ã€‚ 1234567891011121314151617181920212223public class MainActivity extends Activity &#123; private final Handler mLeakyHandler = new Handerl()&#123; @Override public void handleMessage(Message msg) &#123; ... &#125; &#125;; @Override protected void onCreate(Bundler savedInstanceState) &#123; super.onCreate(savedInstanceState); // post a message and delay its execution for 10 minutes. mLeakHandler.postDelayed(new Runnable()&#123; @Override public void run()&#123; ... &#125; &#125;, 1000 * 6 * 10); // go back to the previous Activity finish(); &#125;&#125; åœ¨è¯¥ä¾‹ä¸­ï¼Œç”Ÿå‘½äº†ä¸€ä¸ªå»¶æ—¶ 10 åˆ†é’Ÿæ‰§è¡Œçš„æ¶ˆæ¯ Messageï¼Œ mLeakyHandler å°†å…¶ push è¿›äº†æ¶ˆæ¯é˜Ÿåˆ— MessageQueue ä¸­ã€‚å½“ Activity è¢« finish() æŽ‰ï¼Œå»¶æ—¶ä»»åŠ¡çš„ Message è¿˜ä¼šç»§ç»­å­˜åœ¨äºŽä¸»çº¿ç¨‹ä¸­ï¼Œå®ƒæŒæœ‰è¯¥ Activity çš„ Handler å¼•ç”¨ï¼Œæ­¤æ—¶ finish() æŽ‰çš„ Activity å°±ä¸ä¼šè¢«å›žæ”¶ï¼Œä»Žè€Œé€ æˆå†…å­˜æ³„æ¼ï¼ˆå›  Handler ä¸ºéžé™æ€å†…éƒ¨ç±»ï¼Œä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œåœ¨è¿™é‡Œå°±æ˜¯ MainActivityï¼‰. ä¿®å¤æ–¹æ³•ï¼šåœ¨ Activity ä¸­é¿å…ä½¿ç”¨éžé™æ€å†…éƒ¨ç±»ï¼Œæ¯”å¦‚ä¸Šé¢æˆ‘ä»¬å°† Handler ç”Ÿå‘½ä¸ºé™æ€çš„ï¼Œåˆ™å…¶å­˜æ´»æœŸå’Œ Activityçš„ ç”Ÿå‘½å‘¨æœŸæ— å…³äº†ï¼ŒåŒæ—¶é€šè¿‡å¼±å¼•ç”¨çš„æ–¹å¼å¼•å…¥ Activityï¼Œé¿å…ç›´æŽ¥å°† Activity ä½œä¸º Context ä¼ å…¥ï¼Œ å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class SampleActivity extends Activity &#123; /** * Instence of static inner classes do not bold an implicit reference to their outer class */ private static class MyHandler extends Handler &#123; private final WeakReference&lt;SampleActivity&gt; mActivity; public MyHandler (SampleActivity activity) &#123; mActivity = new WeakReference&lt;SampleActivity&gt;(activity); &#125; @Override public void handleMessage (Message msg) &#123; SampleActivity activity = mActivity.get(); if(activity != null) &#123; //.... &#125; &#125; &#125; private final MyHandler mHandler = new MyHandler(this); /** * Instance of anonymous classes do not hold an implicit * reference to their outer class when they are "static" */ private static final Runnable sRunnable = new Runnable () &#123; @Override public void run()&#123; ... &#125; &#125;; @Override protected void onCreate(Bundler savedInstanceState) &#123; super.onCreate(savedInstanceState); // Post a message and delay its execution for 10 mintues. mHandler.postDelay(sRunnable, 1000 * 60 * 10); // go back to the previous Activity finish(); &#125; &#125; ç»¼è¿°ï¼Œ å³æŽ¨èä½¿ç”¨é™æ€å†…éƒ¨ç±» + WeakReference è¿™ç§æ–¹å¼ã€‚æ¯æ¬¡ä½¿ç”¨å‰æ³¨æ„åˆ¤ç©ºã€‚ å‰é¢æåˆ°çš„ WeakReferenceï¼Œæ‰€ä»¥è¿™é‡Œç®€å•è¯´ä¸‹ Java ä¸­å¯¹è±¡çš„å‡ ç§å¼•ç”¨ç±»åž‹ã€‚ Java å¯¹å¼•ç”¨åˆ†ä¸º StrongReferenceï¼Œ SoftReferenceï¼Œ WeakReferenceå’Œ PhantomReference å››ç§ã€‚ çº§åˆ« å›žæ”¶æ—¶æœº ç”¨é€” ç”Ÿå­˜æ—¶é—´ å¼º(StrongReference) ä»Žæ¥ä¸ä¼š å¯¹è±¡çš„ä¸€èˆ¬çŠ¶æ€ JVM åœæ­¢è¿è¡Œæ—¶ç»ˆæ­¢ è½¯(SoftReference) åœ¨å†…å­˜ä¸è¶³æ—¶ è”åˆ ReferenceQueue æž„é€ æœ‰æ•ˆæœŸçŸ­/å å†…å­˜å¤§/ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡çš„äºŒçº§é«˜é€Ÿç¼“å†²å™¨(å†…å­˜ä¸è¶³æ‰æ¸…ç©º) å†…å­˜ä¸è¶³æ—¶ç»ˆæ­¢ å¼±ï¼ˆWeakReferenceï¼‰ åœ¨åžƒåœ¾å›žæ”¶æ—¶ è”åˆ ReferenceQueue æž„é€ æœ‰æ•ˆæœŸçŸ­/å å†…å­˜å¤§/ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡çš„ä¸€çº§é«˜é€Ÿç¼“å†²å™¨(ç³»ç»Ÿå‘ç”Ÿ gc åˆ™æ¸…ç©º) gc è¿è¡ŒåŽç»ˆæ­¢ è™šï¼ˆPhantomReferenceï¼‰ åœ¨åžƒåœ¾å›žæ”¶æ—¶ è”åˆ ReferenceQueue æ¥è·Ÿè¸ªå¯¹è±¡è¢«åžƒåœ¾å›žæ”¶å™¨å›žæ”¶çš„æ´»åŠ¨ gc è¿è¡ŒåŽç»ˆæ­¢ åœ¨ Android åº”ç”¨å¼€å‘ä¸­ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜æº¢å‡ºï¼Œåœ¨å¤„ç†ä¸€äº›å ç”¨å†…å­˜å¤§è€Œä¸”ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡æ—¶å€™ï¼Œå¯ä»¥å°½é‡åº”ç”¨è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨æŠ€æœ¯ã€‚ è½¯/å¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æžœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åžƒåœ¾å›žæ”¶å™¨å›žæ”¶ï¼ŒJava è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸Žä¹‹å…³è”å¾—çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚åˆ©ç”¨è¿™ä¸ªé˜Ÿåˆ—å¯ä»¥å¾—çŸ¥è¢«å›žæ”¶çš„è½¯/å¼±å¼•ç”¨çš„å¯¹è±¡åˆ—è¡¨ï¼Œä»Žè€Œä¸ºç¼“å†²å™¨æ¸…æ¥šå·²å¤±æ•ˆçš„è½¯/å¼±å¼•ç”¨ã€‚ å‡è®¾æˆ‘ä»¬çš„åº”ç”¨ä¼šç”¨åˆ°å¤§é‡çš„é»˜è®¤å›¾ç‰‡ï¼Œæ¯”å¦‚åº”ç”¨ä¸­æœ‰é»˜è®¤çš„å¤´åƒï¼Œé»˜è®¤æ¸¸æˆå›¾æ ‡ç­‰ç­‰ï¼Œè¿™äº›å›¾ç‰‡å¾ˆå¤šåœ°æ–¹ä¼šç”¨åˆ°ã€‚å¦‚æžœæ¯æ¬¡åŽ»è¯»å–å›¾ç‰‡ï¼Œç”±äºŽè¯»å–æ–‡ä»¶éœ€è¦ç¡¬ä»¶æ“ä½œï¼Œé€Ÿåº¦å¾ˆæ…¢ï¼Œä¼šå¯¼è‡´æ€§èƒ½è¾ƒä½Žã€‚æ‰€ä»¥æˆ‘ä»¬è€ƒè™‘å°†å›¾ç‰‡ç¼“å­˜èµ·æ¥ï¼Œéœ€è¦çš„æ—¶å€™ç›´æŽ¥ä»Žå†…å­˜ä¸­è¯»å–ã€‚ä½†æ˜¯ç”±äºŽå›¾ç‰‡å ç”¨ç©ºé—´æ¯”è¾ƒå¤§ï¼Œç¼“å­˜å¾ˆå¤šå›¾ç‰‡éœ€è¦å¾ˆå¤šçš„å†…å­˜ï¼Œå°±å¯èƒ½æ¯”è¾ƒå®¹æ˜“å‘ç”Ÿ OutOfMemery å¼‚å¸¸ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨è½¯/å¼±å¼•ç”¨æŠ€æœ¯æ¥é¿å…è¿™ä¸ªé—®é¢˜å‘ç”Ÿã€‚ä»¥ä¸‹æ˜¯é«˜é€Ÿç¼“å†²å™¨çš„é›å½¢ï¼š é¦–å…ˆå®šä¹‰ä¸€ä¸ª HashMapï¼Œä¿å­˜è½¯å¼•ç”¨å¯¹è±¡ï¼š 1private Map&lt;String, SoftReference&lt;Bitmap&gt;&gt; imageCache = new HashMap&lt;String, SoftReference&lt;Bitmap&gt;&gt;(); å†å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œä¿å­˜ bitmap çš„è½¯å¼•ç”¨åˆ° HashMapã€‚ 123456789101112131415161718192021222324public class CacheBySoftRef &#123; // å…ˆå®šä¹‰ä¸€ä¸ª HashMapï¼Œä¿å­˜è½¯å¼•ç”¨å¯¹è±¡ private Map&lt;String, SoftReference&lt;Bitmap&gt;&gt; imageCache = new HashMap&lt;String, SoftReference&lt;Bitmap&gt;&gt;(); // å†å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œä¿å­˜ bitmap çš„è½¯å¼•ç”¨åˆ° HashMapã€‚ public void addBitmapToCache(String path) &#123; // å¼ºå¼•ç”¨çš„ Bitmap å¯¹è±¡ Bitmap bitmap = BitmapFactory.decodeFile(path); // è½¯å¼•ç”¨çš„ bitmap å¯¹è±¡ SoftReference&lt;Bitmap&gt; softBitmap = new SoftReference&lt;Bitmap&gt;(bitmap); imageCache.put(path, softBitmap); &#125; // èŽ·å–çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ SoftReference çš„ get() æ–¹æ³•å¾—åˆ° bitmap å¯¹è±¡ public Bitmap getBitmapByPath(String path) &#123; // ä»Žç¼“å­˜ä¸­å–è½¯å¼•ç”¨çš„ bitmap å¯¹è±¡ SoftReference&lt;Bitmap&gt; softBitmap = imageCache.get(path); // åˆ¤æ–­æ˜¯å¦å­˜åœ¨è½¯å¼•ç”¨ if (softBitmap == null) return; // é€šè¿‡è½¯å¼•ç”¨å–å‡º bitmap å¯¹è±¡ï¼Œå¦‚æžœç”±äºŽå†…å­˜ä¸è¶³ Bitmap è¢«å›žæ”¶ï¼Œå°†å–åˆ°ç©ºï¼Œå¦‚æžœæœªè¢«å›žæ”¶ï¼Œåˆ™å¯é‡å¤ä½¿ç”¨ï¼Œæé«˜é€Ÿåº¦ Bitmap bitmap = softBitmap.get(); return bitmap; &#125;&#125; ä½¿ç”¨è½¯å¼•ç”¨ä»¥åŽï¼Œåœ¨ OutOfMemory å¼‚å¸¸å‘ç”Ÿä¹‹å‰ï¼Œè¿™äº›ç¼“å­˜çš„å›¾ç‰‡èµ„æºçš„å†…å­˜ç©ºé—´å¯ä»¥è¢«é‡Šæ”¾æŽ‰ï¼Œä»Žè€Œé¿å…å†…å­˜è¾¾åˆ°ä¸Šçº¿ï¼Œé¿å… Crash å‘ç”Ÿã€‚ å¦‚æžœåªæ˜¯æƒ³é¿å… OutOfMemory å¼‚å¸¸çš„å‘ç”Ÿï¼Œåˆ™å¯ä»¥ä½¿ç”¨è½¯å¼•ç”¨ã€‚å¦‚æžœå¯¹äºŽåº”ç”¨çš„æ€§èƒ½æ›´åœ¨æ„ï¼Œæƒ³å°½å¿«å›žæ”¶ä¸€äº›å ç”¨å†…å­˜æ¯”è¾ƒå¤§çš„å¯¹è±¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¼±å¼•ç”¨ã€‚ å¦å¤–å¯ä»¥æ ¹æ®å¯¹è±¡æ˜¯å¦ç»å¸¸ä½¿ç”¨æ¥åˆ¤æ–­é€‰æ‹©è½¯å¼•ç”¨è¿˜æ˜¯å¼±å¼•ç”¨ã€‚å¦‚æžœå¯¹è±¡å¯èƒ½ä¼šç»å¸¸ä½¿ç”¨ï¼Œå°±å°½å¯èƒ½çš„ä½¿ç”¨è½¯å¼•ç”¨ã€‚å¦‚æžœå¯¹è±¡ä¸è¢«ä½¿ç”¨çš„å¯èƒ½æ€§æ›´å¤§ï¼Œå°±ç”¨å¼±å¼•ç”¨ã€‚ å‰é¢æ‰€è¯´ï¼Œåˆ›å»ºä¸€ä¸ªé™æ€çš„ Handler å†…éƒ¨ç±»ï¼Œç„¶åŽå¯¹ Handler æŒæœ‰çš„å¯¹è±¡ä½¿ç”¨å¼±å¼•ç”¨ï¼Œè¿™æ ·åœ¨å›žæ”¶æ—¶ä¹Ÿå¯ä»¥å›žæ”¶ Handler æŒæœ‰çš„å¯¹è±¡ï¼Œä½†æ˜¯è¿™æ ·åšè™½ç„¶é¿å…äº† Activity çš„æ³„æ¼ï¼Œä¸è¿‡ Looper çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œè¿˜æ˜¯å¯èƒ½ä¼šæœ‰å¾…å¤„ç†çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ Activity çš„ onDestory() æ—¶ï¼Œæˆ–è€… Stop æ—¶åº”è¯¥ç§»é™¤æ¶ˆæ¯é˜Ÿåˆ— MessageQueue ä¸­çš„æ¶ˆæ¯ã€‚ ç§»é™¤æ¶ˆæ¯é˜Ÿåˆ—ä¸­ Message çš„æ–¹æ³•ï¼š 12345public final void removeCallbacks(Runnable r);public final void removeCallbacks(Runnable r, Objject token);public final void removeCallbacksAndMessages(Object token);public final void removeMessages(int what);public final void removeMessages(int what, Object object); å°½é‡é¿å…ä½¿ç”¨ static æˆå‘˜å˜é‡å¦‚æžœæˆå‘˜å˜é‡è¢«å£°æ˜Žä¸º static, é‚£æˆ‘ä»¬éƒ½çŸ¥é“å…¶ç”Ÿå‘½å‘¨æœŸå°†ä¸Žæ•´ä¸ª APP è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸä¸€æ ·ã€‚ è¿™ä¼šå¯¼è‡´ä¸€äº›åˆ—é—®é¢˜ï¼Œå¦‚æžœä½ çš„ APP è¿›ç¨‹è®¾è®¡ä¸Šæ˜¯å¸¸é©»å†…å­˜çš„ï¼Œé‚£å³ä½¿ APP åˆ‡åˆ°åŽå°ï¼Œè¿™éƒ¨åˆ†å†…å­˜ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾ã€‚æŒ‰ç…§çŽ°åœ¨æ‰‹æœº APP å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå å†…å­˜è¾ƒå¤§çš„åŽå°é›†æˆå°†ä¼˜å…ˆå›žæ”¶ï¼Œå› ä¸ºå¦‚æžœæ­¤ APP åšè¿‡è¿›ç¨‹äº’ç›¸ä¿æ´»ï¼Œé‚£ä¼šé€ æˆ APP åœ¨åŽå°é¢‘ç¹é‡å¯ã€‚å½“æ‰‹æœºå®‰è£…äº†ä½ å‚ä¸Žå¼€å‘çš„ APP ä»¥åŽä¸€å¤œæ—¶é—´æ‰‹æœºè¢«æ¶ˆè€—ç©ºäº†ç”µé‡ã€æµé‡ï¼Œä½ çš„ APP ä¸å¾—ä¸è¢«ç”¨æˆ·å¸è½½æˆ–è€…é™é»˜ã€‚ ä¿®å¤æ–¹æ³•æ˜¯ï¼š ä¸è¦åœ¨ç±»åˆå§‹åŒ–æ—¶åˆå§‹åŒ–é™æ€æˆå‘˜ã€‚å¯ä»¥è€ƒè™‘ lazy åˆå§‹åŒ–ã€‚æž¶æž„è®¾è®¡ä¸Šè¦æ­»å¥½æ˜¯å¦çœŸçš„æœ‰å¿…è¦è¿™æ ·åšï¼Œå°½é‡é¿å…ã€‚å¦‚æžœæž¶æž„éœ€è¦è¿™ä¹ˆè®¾è®¡ï¼Œé‚£ä¹ˆæ­¤å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä½ æœ‰è´£ä»»ç®¡ç†èµ·æ¥ã€‚ é¿å… Override finalize() finalize æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶é—´ä¸ç¡®å®šï¼Œä¸èƒ½ä¾èµ–å®ƒæ¥é‡Šæ”¾ç´§ç¼ºçš„èµ„æºï¼Œæ—¶é—´ä¸ç¡®å®šçš„åŽŸå› æ˜¯ï¼šè™šæ‹Ÿæœºè°ƒç”¨ GC çš„æ—¶é—´ä¸ç¡®å®š finalize daemon çº¿ç¨‹è¢«è°ƒåº¦åˆ°çš„æ—¶é—´ä¸ç¡®å®šã€‚ finalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼ŒåŠæ—¶å¯¹è±¡è¢«å¤æ´»ï¼Œå¦‚æžœå·²ç»æ‰§è¡Œè¿‡ finalize æ–¹æ³•ï¼Œå†æ¬¡è¢« GC æ—¶ï¼Œä¹Ÿä¸ä¼šå†æ‰§è¡Œï¼ŒåŽŸå› æ˜¯ï¼š å«æœ‰ finalize æ–¹æ³•çš„ Object æ˜¯åœ¨ new çš„æ—¶å€™ï¼Œç”±è™šæ‹Ÿæœºç”Ÿæˆäº†ä¸€ä¸ª finalize reference åœ¨æ¥å¼•ç”¨åˆ°è¯¥ Objectçš„ï¼Œè€Œåœ¨finalize æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼Œè¯¥ Object æ‰€å¯¹åº”çš„ finalize Reference ä¼šè¢«é‡Šæ”¾æŽ‰ã€‚å³ä½¿åœ¨è¿™ä¸ªæ—¶å€™æŠŠè¯¥Object å¤æ´»ï¼ˆå³ç”¨å¼ºå¼•ç”¨å¼•ç”¨ä½è¯¥ Objectï¼‰ï¼Œå†ç¬¬äºŒæ¬¡è¢« GC çš„æ—¶å€™ï¼Œç”±äºŽæ²¡æœ‰äº† finalize Reference ä¸Žä¹‹å¯¹åº”ï¼Œæ‰€ä»¥ finalize æ–¹æ³•ä¸ä¼šå†æ‰§è¡Œã€‚ å«æœ‰ finalize æ–¹æ³•çš„ Object éœ€è¦è‡³å°‘ç»è¿‡ä¸¤è½® GC æ‰æœ‰å¯èƒ½è¢«é‡Šæ”¾ã€‚ èµ„æºæœªå…³é—­é€ æˆçš„å†…å­˜æ³„æ¼å¯¹äºŽä½¿ç”¨äº† BroadcastRevicer, ContentObserver, Fileï¼Œ æ¸¸æ ‡ Cursorï¼Œ Streamï¼Œ Bitmap ç­‰èµ„æºçš„ä½¿ç”¨ï¼Œåº”è¯¥åœ¨ Activity é”€æ¯æ—¶åŠæ—¶å…³é—­æˆ–è€…æ³¨é”€ï¼Œå¦åˆ™è¿™äº›èµ„æºå°†ä¸ä¼šè¢«å›žæ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚ ä¸€äº›ä¸è‰¯ä»£ç é€ æˆçš„å†…å­˜åŽ‹åŠ›æœ‰äº›ä»£ç å¹¶ä¸é€ æˆå†…å­˜æ³„æ¼ï¼Œä½†æ˜¯ä»–ä»¬ï¼Œ æˆ–æ˜¯å¯¹æ²¡ä½¿ç”¨çš„å†…å­˜æ²¡è¿›è¡Œæœ‰æ•ˆåŠæ—¶çš„é‡Šæ”¾ï¼Œæˆ–æ˜¯æ²¡æœ‰æœ‰æ•ˆçš„åˆ©ç”¨å·²æœ‰çš„å¯¹è±¡è€Œæ˜¯é¢‘ç¹çš„ç”³è¯·æ–°å†…å­˜ã€‚ æ¯”å¦‚: Bitmap æ²¡æœ‰è°ƒç”¨ recycle(), å¯¹äºŽ Bitmap å¯¹è±¡åœ¨ä¸ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆè°ƒç”¨ recycle(), é‡Šæ”¾å†…å­˜ï¼Œç„¶åŽè®¾ç½®ä¸º nullã€‚ å› ä¸ºåŠ è½½ bitmap å¯¹è±¡çš„å†…å­˜ç©ºé—´ï¼Œä¸€éƒ¨åˆ†æ˜¯ Java çš„ï¼Œ ä¸€éƒ¨åˆ†æ˜¯ C çš„ï¼ˆå› ä¸º Bitmap åˆ†é…çš„åº•å±‚æ˜¯é€šè¿‡ JNI è°ƒç”¨çš„ï¼‰ã€‚è€Œè¿™ä¸ª recycle() å°±æ˜¯é’ˆå¯¹ C éƒ¨åˆ†çš„å†…å­˜é‡Šæ”¾ã€‚æž„é€  Adapter æ—¶ï¼Œæ²¡æœ‰ä½¿ç”¨ç¼“å­˜çš„ convertViewï¼Œ æ¯æ¬¡éƒ½åœ¨åˆ›å»ºæ–°çš„ converViewã€‚ è¿™é‡ŒæŽ¨èä½¿ç”¨ ViewHolderã€‚ æ€»ç»“å¯¹ Activity ç­‰ç»„ä»¶çš„å¼•ç”¨åº”è¯¥æŽ§åˆ¶åœ¨ Activity çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼›å¦‚æžœä¸èƒ½å°±è€ƒè™‘ä½¿ç”¨ getApplicationContext æˆ–è€… getApplication ,ä»¥é¿å… Activity è¢«å¤–éƒ¨é•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡å¼•ç”¨è€Œæ³„æ¼ã€‚ å°½é‡ä¸è¦åœ¨é™æ€å˜é‡æˆ–è€…é™æ€å†…éƒ¨ç±»ä¸­ä½¿ç”¨éžé™æ€å¤–éƒ¨æˆå‘˜å˜é‡ï¼ˆåŒ…æ‹¬ contextï¼‰ï¼Œå³ä½¿è¦ä½¿ç”¨ï¼Œä¹Ÿè¦è€ƒè™‘é€‚æ—¶æŠŠå¤–éƒ¨æˆå‘˜å˜é‡ç½®ç©ºï¼›ä¹Ÿå¯ä»¥åœ¨å†…éƒ¨ç±»ä¸­ä½¿ç”¨å¼±å¼•ç”¨æ¥å¼•ç”¨å¤–éƒ¨ç±»çš„å˜é‡ã€‚ å¯¹ç”Ÿå‘½å‘¨æœŸæ¯” Activity é•¿çš„å†…éƒ¨ç±»å¯¹è±¡ï¼Œå¹¶ä¸”å†…éƒ¨ç±»ä¸­ä½¿ç”¨äº†å¤–éƒ¨ç±»çš„æˆå‘˜å˜é‡ï¼Œå¯ä»¥è¿™æ ·é¿å…å†…å­˜æ³„æ¼ï¼š 12å°†å†…éƒ¨ç±»æ”¹ä¸ºé™æ€å†…éƒ¨ç±»é™æ€å†…éƒ¨ç±»ä¸­ä½¿ç”¨å¼±å¼•ç”¨æ¥å¼•ç”¨å¤–éƒ¨æˆå‘˜çš„æˆå‘˜å˜é‡ Handler çš„æŒæœ‰çš„å¼•ç”¨å¯¹è±¡æœ€å¥½ä½¿ç”¨å¼±å¼•ç”¨ï¼Œèµ„æºé‡Šæ”¾æ—¶ï¼Œä¹Ÿå¯ä»¥æ¸…ç©º Handler ä¸­çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚åœ¨ Activity onStop æˆ–è€… onDestory çš„æ—¶å€™ï¼Œå–æ¶ˆæŽ‰è¯¥ Handler å¯¹è±¡çš„ Message å’Œ Runnableã€‚ åœ¨ Java çš„å®žçŽ°è¿‡ç¨‹ä¸­ï¼Œä¹Ÿè¦è€ƒè™‘å…¶å¯¹è±¡é‡Šæ”¾ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨ä¸ä½¿ç”¨æŸå¯¹è±¡æ˜¯ï¼Œæ˜¾å¼åœ°å°†æ­¤å¯¹è±¡èµ‹å€¼ä¸º null, æ¯”å¦‚ä½¿ç”¨å®Œ Bitmap åŽï¼Œå…ˆè°ƒç”¨ recycle()ï¼Œ å†èµ‹ nullï¼Œ æ¸…ç©ºå¯¹å›¾ç‰‡ç­‰èµ„æºæœ‰ç›´æŽ¥å¼•ç”¨æˆ–ç®€æ´å¼•ç”¨çš„æ•°ç»„ï¼ˆä½¿ç”¨ array.clear(); array=nullï¼‰ç­‰ï¼Œæœ€å¥½éµå¾ªè°åˆ›å»ºè°é‡Šæ”¾çš„åŽŸåˆ™ã€‚ æ­£ç¡®å…³é—­èµ„æºï¼Œå¯¹äºŽä½¿ç”¨äº† BroadcastReceivedï¼Œ ContentObserver, File, Cursor, Stream, Bitmap ç­‰èµ„æºçš„ä½¿ç”¨ï¼Œåº”è¯¥åœ¨ Activity é”€æ¯æ—¶åŠæ—¶å…³é—­æˆ–è€…æ³¨é”€ã€‚ ä¿æŒå¯¹å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„æ•æ„Ÿï¼Œç‰¹åˆ«æ³¨æ„å•ä¾‹ï¼Œé™æ€å¯¹è±¡ï¼Œå…¨å±€æ€§é›†åˆç­‰çš„ç”Ÿå‘½å‘¨æœŸã€‚]]></content>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Handler çº¿ç¨‹é€šä¿¡åŸºç¡€æµç¨‹]]></title>
    <url>%2F2019%2F08%2F01%2FHandler%20%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1%E5%9F%BA%E7%A1%80%E6%B5%81%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[Android ä¸­çº¿ç¨‹é€šä¿¡é çš„å°±æ˜¯ Handlerã€Looperã€Messageã€MessageQueue è¿™å››ä¸ªã€‚ Looperåœ¨ Looper ä¸­ï¼Œç»´æŒä¸€ä¸ª Thread å¯¹è±¡ä»¥åŠ MessageQueueï¼Œ é€šè¿‡ Looper çš„æž„é€ å‡½æ•°å¯ä»¥çœ‹å‡º 1234private Looper(boolean quitAllowed) &#123; mQueue = new MessageQueue(quitAllowed);// ä¼ å…¥çš„å‚æ•°ä»£è¡¨è¿™ä¸ª Queue æ˜¯å¦èƒ½å¤Ÿè¢«é€€å‡º mThread = Thread.currentThread();&#125; Looper åœ¨æž„é€ å‡½æ•°é‡Œåšäº†ä¸¤ä»¶äº‹å„¿ï¼š å°†çº¿ç¨‹å¯¹è±¡æŒ‡å‘äº†åˆ›å»ºçš„ Looper çš„çº¿ç¨‹ åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ MessageQueue åˆ†æžå®Œæž„é€ å‡½æ•°åŽï¼Œçœ‹ä¸‹é¢ä¸¤ä¸ªæ–¹æ³• looper.loop() looper.prepare() looper.loop()åœ¨å½“å‰çº¿ç¨‹ä¸­å¯åŠ¨ä¸€ä¸ª Message loop æœºåˆ¶ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public static void loop()&#123; final Looper me = myLooper();// èŽ·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„ Looper if(me == null) &#123; throw new RuntimeException("No Looper; Looper.prepare() wasn`t called on this thread"); &#125; final MessageQueue queue = me.mQueue();// èŽ·å–ä¸Ž Looper ç»‘å®šçš„ MessageQueue // make sure the identity of this thread is that of the local process, // And keep track of what that identity token actuall is. Binder.clearCallingIdentity(); fianl long ident = Binder.clearCallingIdentity(); // è¿›å…¥æ­»å¾ªçŽ¯ï¼Œä¸æ–­èŽ·å–å¯¹è±¡ï¼Œåˆ†å‘å¯¹è±¡åˆ° Handler ä¸­åŽ»æ¶ˆè´¹ for(;;) &#123; Message msg = queue.next();// ä¸æ–­èŽ·å–ä¸‹ä¸€ä¸ª message å¯¹è±¡ï¼Œè¿™é‡Œå¯èƒ½ä¼šé€ æˆé˜»å¡žã€‚ if(msg == null) &#123; // No message idicates that the message queue is quittig. return; &#125; // This must be in a local variable, in case a UI event sets the logger Printer logging = me.mLogging; if(logging != null) &#123; logging.println("&gt;&gt;&gt; Dispatching to " + msg.target + " " + msg.callback _ ": " + msg.what); &#125; // åœ¨è¿™é‡Œå¼€å§‹åˆ†å‘ Message msg.target.dispatchMessage(msg); if(logging != null) &#123; logging.println("&lt;&lt;&lt;&lt;&lt; Finished to " + msg.target + " " + msg.callback); &#125; // Make sure that during the course of dispatching the identity of the thread wasn`t corrupted. final long newIdent = Binder.clearCallingIdentity(); if(ident != null) &#123; Log.wtf(TAG, "Thread identity changed from 0x" + Long.toHexString(ident) + " to 0x" + Long.toHexString(newIdent) + " while dispatching to " + msg.target.getClass().getName() + " " + msg.callback + " what=" + msg.what); &#125; // å½“åˆ†å‘å®Œ Message åŽï¼Œå½“ç„¶è¦æ ‡è®°å°†è¯¥ Message ä¸º â€œæ­£åœ¨ä½¿ç”¨â€ msg.recycleUnchecked(); &#125;&#125; ä»Žä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œæœ€é‡è¦çš„æ–¹æ³•æ˜¯ï¼š queue.next() msg.target.dispatchMessage(msg) msg.recycleUnchecked() å…¶å®ž Looper ä¸­æœ€é‡è¦çš„éƒ¨åˆ†éƒ½æ˜¯ç”± Messageã€MessageQueue ç»„æˆçš„ï¼Œè¿™æ®µä»£ç è®¾è®¡åˆ°çš„å››ä¸ªå¯¹è±¡ï¼Œä»–ä»¬å½¼æ­¤çš„å…³ç³»å¦‚ä¸‹: MessageQueueï¼š è£…é£Ÿç‰©çš„å®¹å™¨ Message ï¼šè¢«è£…çš„é£Ÿç‰© Handler ï¼ˆmsg.target å®žé™…ä¸Šå°±æ˜¯ Handlerï¼‰ï¼šé£Ÿç‰©çš„æ¶ˆè´¹è€… Looperï¼šè´Ÿè´£åˆ†å‘é£Ÿç‰©çš„äºº looper.prepare() åœ¨å½“å‰çº¿ç¨‹å…³è”ä¸€ä¸ª Lopper å¯¹è±¡12345678private static void prepare(boolean quitAllowed) &#123; if(sThreadLocal.get() != null) &#123; throw new RuntimeException("Only one Lopper may be created per thread"); &#125; // åœ¨å½“å‰çº¿ç¨‹ç»‘å®šä¸€ä¸ª looper mThreadLocal.set(new Looper(quiteAllowed));&#125; åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåšäº†ä¸¤ä»¶äº‹å„¿ï¼š åˆ¤æ–­å½“å‰çº¿ç¨‹æœ‰æ²¡æœ‰ Looperï¼Œå¦‚æžœæœ‰åˆ™æŠ›å‡ºå¼‚å¸¸ï¼ˆåœ¨è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ï¼ŒAndroid è§„å®šä¸€ä¸ªçº¿ç¨‹åªèƒ½æ‹¥æœ‰ä¸€ä¸ªä¸Žè‡ªå·±å…³è”çš„ Looperã€‚ å¦‚æžœæœ‰çš„è¯ï¼Œé‚£ä¹ˆå°±è®¾ç½®ä¸€ä¸ªæ–°çš„ Looper åˆ°å½“å‰çº¿ç¨‹ã€‚ Handler çš„ä½¿ç”¨1234567Handler handler = new Handler ()&#123; // @Override public void handleMessage(Message msg) &#123; // handle your message &#125;&#125; æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ Handler çš„æž„é€ ï¼š 12345678910111213141516// ç©ºå‚æž„é€ ä¸Žä¹‹å¯¹åº”public Handler(Callback callbacck, boolean async) &#123; // å¤§å§¨æ³„æ¼æé†’log ... // èŽ·å–ä¸Žåˆ›å»º Handler çº¿ç¨‹çš„ Looper mLooper = Looper.myLooper(); if(mLooper == null) &#123; throw new RunntimeException("Can`t create handler inside thread that has not called Looper.prepare()"); &#125; // èŽ·å– Looper ç»‘å®šçš„ MessageQueue // å› ä¸ºä¸€ä¸ª Looper åªæœ‰ä¸€ä¸ª MessageQueueï¼Œ ä¹Ÿå°±æ˜¯ä¸Žå½“å‰çº¿ç¨‹ç»‘å®šçš„ MessageQueue mQueue = mLooper.mQueue; mCallback = callback; mAsynchronous = async;&#125; Looper.loop() æ­»å¾ªçŽ¯ä¸­çš„ msg.target æ˜¯ä»€ä¹ˆæ—¶å€™è¢«èµ‹å€¼çš„ï¼Ÿ handler.handleMessage(msg) åœ¨ä»€ä¹ˆæ—¶å€™è¢«å›žè°ƒçš„ï¼Ÿ A1: Looper.loop() æ­»å¾ªçŽ¯ä¸­çš„ msg.target æ˜¯ä»€ä¹ˆèµ‹å€¼çš„å‘¢ï¼Ÿè¦åˆ†æžè¿™ä¸ªé—®é¢˜ï¼Œè‡ªç„¶çš„å°±æƒ³åˆ°ä»Žå‘é€æ¶ˆæ¯å¼€å§‹ï¼Œæ— è®ºæ˜¯ handler.sendMessage(msg) è¿˜æ˜¯ handler.sendEmptyMessage(what)ï¼Œ æœ€åŽéƒ½å¯ä»¥è¿½æº¯åˆ°ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼š 1234567891011121314public boolean sendMessageAtTime(Message msg, long uptimeMillis) &#123; // å¼•ç”¨ Handler ä¸­çš„ MessageQueue // è¿™ä¸ª MessageQueue å°±æ˜¯åˆ›å»º Looper æ—¶è¢«åˆ›å»ºçš„ MessageQueue MessageQueue queue = mQueue; if(queue == null) &#123; RuntimeException e = new RuntimeException( this + " sendMessageAtTime() called withe no mQueue"); Log.w("Looper", e.getMessage(), e); return false; &#125; // å°†æ–°æ¥çš„ Message åŠ å…¥åˆ° MessageQueue ä¸­ return enqueueMessage(queue, msg, uptimeMillis);&#125; æŽ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ enququeMessage(queue, msg, uptimeMillis): 1234567private boolean enququeMessage(MessageQueue, queue, Message msg, long uptimeMillis) &#123; msg.target = this; if(mAsynchronous) &#123; msg.setAsynchronous(true); &#125; return queue.enqueueMessage(msg, uptimeMillis);&#125; A2: handler.handleMessage(msg) åœ¨ä»€ä¹ˆæ—¶å€™è¢«å›žè°ƒï¼Ÿé€šè¿‡ä¸Šé¢çš„åˆ†æžï¼Œæˆ‘ä»¬å¾ˆæ˜Žç¡®çŸ¥é“ï¼Œ Message ä¸­çš„ target æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™èµ‹å€¼çš„ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æžä¸‹åœ¨ Looper.loop() ä¸­å‡ºçŽ°è¿‡çš„ dispatchMessage(msg) æ–¹æ³• 123456789101112public void diapatchMessage(Message msg) &#123; if(msg.callback != null) &#123; handleCallback(msg); &#125; else &#123; if(mCallback != null) &#123; if(mCallback.handleMessage(msg)) &#123; return; &#125; &#125; handleMessage(msg); // å¼€å§‹å›žè°ƒ &#125;&#125; é€šè¿‡ä¸Šé¢çš„åˆ†æžï¼Œå¯ä»¥æ¸…æ¥šçš„çŸ¥é“ Handler, Looper, Message, MessageQueue è¿™å››è€…çš„å…³ç³»ä»¥åŠå¦‚ä½•åˆä½œäº†ã€‚ æ€»ç»“å½“æˆ‘ä»¬è°ƒç”¨ handler.sendMessage(msg)ï¼› æ–¹æ³•å‘é€ä¸€ä¸ª Message æ—¶ï¼Œ å®žé™…ä¸Šè¿™ä¸ª Message æ˜¯å‘é€åˆ°ä¸Žå½“å‰çº¿ç¨‹ç»‘å®šçš„ä¸€ä¸ª MessageQueue ä¸­ï¼Œç„¶åŽä¸Žå½“å‰çº¿ç¨‹ç»‘å®šçš„ Looper å°†ä¼šä¸æ–­çš„ä»Ž MessageQueue ä¸­å–å‡ºæ–°çš„ Messageï¼Œ è°ƒç”¨ msg.target.dispatchMessage(msg) æ–¹æ³•å°†æ¶ˆæ¯å‘é€åˆ°ä¸Ž Message ç»‘å®šçš„ handler.handleMessage() æ–¹æ³•ä¸­ã€‚ ä¸€ä¸ª Thread å¯¹åº”å¤šä¸ª Handlerï¼Œ ä¸€ä¸ª Thread å¯¹åº”ä¸€ä¸ª Looper å’Œ MessageQueueï¼Œ Handler ä¸Ž Thread å…±äº« Looper å’Œ MessageQueueã€‚ Message åªæ˜¯æ¶ˆæ¯çš„è½½ä½“ï¼Œå°†ä¼šè¢«å‘é€åˆ°ä¸Žçº¿ç¨‹ç»‘å®šçš„å”¯ä¸€çš„ MessageQueue ä¸­ï¼Œå¹¶ä¸”è¢«ä¸Žçº¿ç¨‹ç»‘å®šçš„å”¯ä¸€çš„ Looper åˆ†å‘ï¼Œè¢«å…¶è‡ªèº«ç»‘å®šçš„ Handler æ¶ˆè´¹ã€‚]]></content>
      <tags>
        <tag>Handler</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¸…é¦™æœ¨å…»æ®–ï¼ˆä¸‰ï¼‰]]></title>
    <url>%2F2019%2F06%2F23%2F%E6%B8%85%E9%A6%99%E6%9C%A8%E5%85%BB%E6%AE%96%EF%BC%88%E4%B8%89%EF%BC%89%2F</url>
    <content type="text"><![CDATA[è·ç¦»ä¸Šä¸€æ¬¡æ›´æ–°å·²ç»è¿‡åŽ»ä¸€ä¸ªåŠæœˆäº†ï¼Œè¯·ä¸è¦æ‹…å¿ƒï¼Œä»–è¿˜åœ¨ï¼ä½œä¸ºç»¿æ¤å°ç™½ï¼ŒçœŸçœŸåˆ‡åˆ‡çš„ä½“éªŒå…»æ®–çš„å¿«ä¹ã€ä¸ŽæƒŠå¿ƒåŠ¨é­„çš„æ—¶å€™ï¼Œæ˜¯ä¸ä¼šæƒ³èµ·æ¥è¦è®°å½•åšå®¢çš„ã€‚ è¿™æ¬¡å†™è¿™ç¯‡æ–‡ç« çš„ç›®çš„ï¼Œä¾ç„¶è¿˜æ˜¯è¦è®°å½•ä¸€ä¸‹å®ƒçš„æˆé•¿ï¼Œé­é‡ï¼Œä»¥åŠä¸€äº›å…»æ®–è¿‡ç¨‹ä¸­çš„ç»éªŒã€‚å¥½å•¦ï¼Œå¤©ä¹Ÿä¸æ—©äº†ï¼Œå’±ä¹Ÿå¾—å¼„ç‚¹å¹²è´§äº†ã€‚ ç»¿æ¤å°ç™½ï¼Œåœ¨ä¸Šæ‰‹æ¸…é¦™æœ¨åŽï¼ŒæŸ¥è¯¢åˆ°çš„ä¸€äº›å…»æ®–çš„ç†è®ºçŸ¥è¯†ï¼Œåœ¨è¿™ä¸€ä¸ªåŠæœˆçš„æ—¶é—´é‡Œå¾—åˆ°äº†å¾ˆä¸¥å³»çš„æŒ‘æˆ˜ã€‚ç»§ä¸Šæ¬¡ä¸ºå®ƒæ›¿æ¢äº†æ–°å®¶ä¹‹åŽï¼Œå®ƒå°±ä¸åœ¨æ˜¯ä»Žå‰çš„é‚£ä¸ªå¯çˆ±çš„å­©å­äº†ï¼Œæ·˜æ°”çš„ç‹ ï¼›çŽ°åœ¨é€ çš„ï¼ˆä¸œåŒ—è¯ï¼Œæœ¬äººä¸œåŒ—æ»´ï¼Œæ„æ€æ˜¯å°†è‡ªå·±çš„èº«ä½“ï¼Œå¤–è¡¨ï¼Œæˆ–å…¶ä»–å¼„å¾—ç ´è´¥ä¸å ªï¼‰è¿˜èƒ½å¯çœ‹å‡ºç‚¹æ¨¡æ ·æ¥ã€‚ è¿™æ®µæ—¶é—´ï¼Œå®ƒç»åŽ†çš„æŽ‰å¶ã€æž¯é»„ã€æ—±æ¶ã€‚å“ˆå“ˆï¼Œä½ ä»¬æœ‰æ²¡æœ‰æ„Ÿè§‰åˆ°ä»–å¾ˆå¯æ€œã€‚ä½†ä¸è®ºæ€Žæ ·ï¼Œä»–çŽ°åœ¨æ­£åœ¨èŒå£®çš„æˆé•¿ä¸­ï¼Œå·²ç»é€ƒç¦»äº†æ³•æµ·ã€‚ çŽ°åœ¨çš„å®ƒï¼Œè™½ç„¶å·²ç»æ²¡æœ‰äº†æŒ¡ä½çš„æžç¹å¶èŒ‚ï¼Œä½†ä¹Ÿæ²¡æœ‰åƒæˆ‘è¿™æ²¡ç¨‹åºå‘˜ä¸€æ ·ï¼Œå¯¸è‰ä¸ç”Ÿã€‚é‚£æˆ‘ä»¬å°±æŽ¥ä¸‹æ¥å°±è¿˜æ˜¯è¯´è¯´å®ƒçš„å…»æ®–æ³¨æ„äº‹é¡¹å§ï¼š æŽ‰å¶ æŽ‰å¶æ˜¯æ­£å¸¸çŽ°è±¡ï¼Œåœ¨ç»¿æ¤æ›´æ–°æ–°çš„çŽ¯å¢ƒï¼Œç§»æ¤åˆ°æ–°çš„ç›†ä¸­æ—¶ï¼Œéƒ½ä¼šå› éœ€è¦å¯¹æ–°çŽ¯å¢ƒçš„é€‚åº”å„¿æŽ‰å¶ï¼Œè¿‡å‡ å¤©ä¹‹åŽå°±å¥½äº†ï¼Œæ›´æ¢æ–°ç›†åŽï¼Œå°†æ°´æµ‡é€ï¼Œé™æ­¢å‡ å¤©ï¼ˆè¶…è¿‡æ­£å¸¸æµ‡æ°´å‘¨æœŸï¼‰ï¼Œä½†ä¹Ÿè¦è€ƒè™‘çªç„¶çš„è“„æ°´èƒ½åŠ›ä»¥åŠåœŸå£¤çš„æ½®æ¹¿ç¨‹åº¦ã€‚ é»„å¶ é»„å¶ä¸€èˆ¬æ˜¯å‘ç”Ÿåœ¨æ°´åˆ†è¿‡å¤§ï¼Œå¯¼è‡´æ ¹éƒ¨è…çƒ‚æ—¶ä¼šå‘ç”Ÿï¼Œå› æ­¤æˆ‘åœ¨æµ‡æ°´æ—¶ï¼Œè¦å…³æ³¨ä¸€ä¸‹çªç„¶ä¸­æ°´åˆ†çš„å«é‡ï¼Œé€‚é‡ä¸”æœ‰è§„å¾‹çš„æµ‡æ°´ï¼Œå¯¹ç»¿æ¤çš„å‘è‚²æ˜¯æœ‰å¥½å¤„çš„ã€‚ åœŸå£¤ èµ·åˆæˆ‘çš„æµ‡æ°´é¢‘çŽ‡æ˜¯ 3-5 å¤©æµ‡ä¸€æ¬¡ï¼Œä½†æˆ‘å‘çŽ°ä»–ç»å¸¸æ²¡æœ‰ç²¾ç¥žï¼Œè”«è”«çš„ï¼Œæ¯æ¬¡æµ‡æ°´æ—¶ï¼Œè§‚å¯ŸåœŸå£¤éƒ½å·²ç»è¦å¹²é€äº†ï¼Œç„¶åŽæˆ‘å°±æ”¹ä¸º 2-3 å¤©æµ‡æ°´ä¸€æ¬¡ï¼Œæ…¢æ…¢çš„ä»–æ¯”ä»¥å‰æ›´åŠ æ²¹ç»¿ï¼Œç²¾ç¥žé¢è²Œæ›´åŠ æŒºæ‹”ã€‚ç”±æ­¤å‘¢ï¼Œæ€»ç»“ä¸‹æ¥åœŸå£¤è“„æ°´èƒ½åŠ›å¯¹æ¤ç‰©çš„ç”Ÿé•¿æˆæ­£æ¯”å…³ç³»ï¼Œæ‰€ä»¥é€‰æ‹©å¥½çš„åœŸå£¤ï¼Œæ›´æœ‰åŠ©äºŽå®ƒçš„ç”Ÿé•¿ã€‚ç›®å‰å®ƒçš„åœŸå£¤è¿˜æ˜¯è‡ªä»Žä»–æ¥åˆ°æˆ‘è¿™é‡Œå•†å®¶é€çš„ï¼ŒåœŸå£¤å¾ˆç¨€æ¾ï¼Œæ‚è´¨æ¯”è¾ƒå¤šï¼Œè“„æ°´èƒ½åŠ›ä¹Ÿä¸€èˆ¬ï¼Œç­‰åˆ°ä»–åœ¨æ‰“ä¸€ç‚¹ï¼Œä¸ºä»–æ¢ä¸€ä¸ªæ–°å®¶çš„æ—¶å€™ï¼Œä¼šè€ƒè™‘ç»™ä»–æ¢ä¸€ä¸ªåœŸå£¤ã€‚æ¯•ç«Ÿå¤§è‡ªç„¶çš„åŠ›é‡æ˜¯å¾ˆåºžå¤§çš„ï¼Œä¹Ÿè®¸é‚£æ—¶ä»–ä¼šæˆé•¿ä¸ºå‚å¤©å¤§æ ‘å§ã€‚ æ€»ç»“ æ€»ä¹‹ï¼Œè€è¯è®²â€æœ‰å¿—è€…äº‹ç«Ÿæˆâ€œï¼Œåªè¦ç”¨äº†çœŸå¿ƒï¼Œå°±ä¸€å®šä¼šæœ‰æ”¶èŽ·ï¼›ä¸è®ºæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œæˆ‘ä»¬éƒ½è¦å°†ä»–çœ‹åšæ˜¯æˆ‘ä»¬æˆåŠŸè·¯ä¸Šçš„ç»éªŒï¼Œä¸éª„ä¸é¦ã€‚ ä¹ æƒ¯æ˜¯å…»æˆçš„ï¼Œå°±åƒå®ƒä¸€æ ·ï¼Œè™½ç„¶å®ƒåœ¨é‚£é‡Œï¼Œä¹Ÿä¸ä¼šåŒæˆ‘è®²è¯ï¼Œä¹Ÿä¸ä¼šåŒæˆ‘äº’åŠ¨ï¼Œå°±é‚£æ ·é™é™çš„çœ‹ç€æˆ‘ï¼Œè€Œå“ªä¸€å¤©çœ‹ä¸è§å®ƒçš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿä¼šå¾ˆæƒ³å®ƒï¼Œæœ‰æ—¶ä¹Ÿä¸åè‡ªå·±çš„ç›®å…‰ï¼Œå¤šçœ‹å‡ çœ¼ï¼Œåªå¸Œæœ›å®ƒèƒ½å¤Ÿæ‹™é•¿æˆé•¿ã€‚]]></content>
      <tags>
        <tag>ç»¿æ¤</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¸…é¦™æœ¨å…»æ®–ï¼ˆäºŒï¼‰]]></title>
    <url>%2F2019%2F05%2F08%2F%E6%B8%85%E9%A6%99%E6%9C%A8%E5%85%BB%E6%AE%96%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[å¿ƒå¿ƒåˆ‡åˆ‡,æ¯å¤©éƒ½ä¼šå…³æ³¨å®ƒçš„å˜åŒ–,å¯æƒœå¿ƒæ€¥åƒä¸å¾—çƒ­è±†è…;ç»è¿‡äº†å‡ å¤©, å‘çŽ°å®ƒæœ‰ä¸€äº›æž¯å¶å’Œå¹²æž,ä½ æ˜¯åœ¨å‘æˆ‘å®£æˆ˜å—?????ä¸Šç½‘æŸ¥è¯¢äº†ä¸€ä¸‹å‘çŽ°å…¶å®žæ˜¯æ¤ç‰©åœ¨æ›´æ¢äº†çŽ¯å¢ƒä¹‹åŽ,éœ€è¦ä¸€æ®µæ—¶é—´çš„é€‚åº”,æž¯å¶å¹²æžå±žäºŽæ­£å¸¸çŽ°è±¡, å“ˆå“ˆå“ˆ,è¿˜å¥½ä½ ä¸æ˜¯å«Œå¼ƒæˆ‘çš„å°å±‹. è®°å¾—é«˜ä¸­é‚£ä¼š,æ¯å¤©éƒ½åœ¨ä¹¦æœ¬çš„æµ·æ´‹é‡Œé£˜è¡,ç”Ÿç‰©å­¦è‡ªåœ¨å…¶ä¸­,å˜´è¾¹ä¹Ÿæ€»æ˜¯åœ¨èƒŒè¯µç€æ¤ç‰©çš„â€å…‰åˆä½œç”¨â€,â€å‘¼å¸ä½œç”¨â€,è¿™äº›çŸ¥è¯†æ—©å·²æ·±æ·±é“­è®°åœ¨å¿ƒä¸­,åˆ»å°åœ¨è„‘æµ·,æŒ¥ä¹‹ä¸åŽ». æ¤ç‰©ç™½å¤©è¿›è¡Œå…‰åˆä½œç”¨,å¸æ”¶äºŒæ°§åŒ–ç¢³,é‡Šæ”¾æ°§æ°”;å¤œæ™šå‘¼å¸ä½œç”¨å¸æ”¶æ°§æ°”,é‡Šæ”¾äºŒæ°§åŒ–ç¢³.è¿™äº›çŸ¥è¯†è®©æˆ‘è®¤è¯†äº†ä¸–ç•Œ,ç„¶è€Œå¹¶æ²¡æœ‰è®©æˆ‘è®¤è¯†ä»–.èµ·åˆè¿˜æ˜¯å‚»ä¹Žä¹Žçš„æ¯å¤©å‡ºé—¨ä¸Šç­æ—¶,æŠŠèŠ±æ”¾åœ¨çª—å°ä¸Š,æ‰“å¼€çª—å­,è®©ä»–æ²æµ´é˜³å…‰,æŽ¥å—æ´—ç¤¼;å¯æœ€è¿‘åœ¨æµè§ˆä¸€äº›ç½‘ç«™æ—¶,æ³¨æ„åˆ°ä¸€å¥è¯è®©æˆ‘å›°æƒ‘ä¸å·²â€”-â€œç»™äºˆæ¤ç‰©å……è¶³çš„å…‰ç…§,å¯ä»¥æ”¾åœ¨é˜³å°ä¸Š,ä½†è¦é¿å…å¤ªé˜³å…‰ç›´å°„â€. æˆ‘æ‡µäº†,æˆ‘çœŸçš„æ‡µäº†, æ—¢ç„¶éƒ½é€‰æ‹©æ”¾åœ¨çª—å°ä¸Š,éš¾é“çª—å°ä¸Šçš„é˜³å…³å°±ä¸æ˜¯å¤ªé˜³ç›´å°„äº†å˜›????? æˆ‘å¾ˆå›°æƒ‘, çˆ±ç¢ç£¨çš„æˆ‘åœ¨æƒ³, çª—å°ä¸Šæœ‰çŽ»ç’ƒ,Uhâ€¦ éš¾é“æ˜¯éš”ç€ä¸€å±‚çŽ»ç’ƒå°±ä¸ç®—ç›´å°„äº†å—,, å“Ž, è¿™ä¸ªé—®é¢˜,åˆ°çŽ°åœ¨æˆ‘ä¹Ÿæ²¡æœ‰æƒ³æ¸…æ¥š.åœ¨ç»è¿‡ä¸æ–­çš„æŸ¥è¯¢æˆ‘å‘çŽ°å…¶å®žæ¤ç‰©è¿›è¡Œå…‰åˆä½œç”¨å¹¶ä¸æ˜¯ä¹‹å¯ä»¥æœ‰å¤ªé˜³å…‰æ‰å¯ä»¥. æ¤ç‰©è¿›è¡Œå…‰åˆä½œç”¨,å¶ç»¿ä½“æ˜¯ä¸»è¦åŠŸè‡£,é«˜ç­‰æ¤ç‰©çš„å…‰åˆè‰²ç´ ä¸»è¦æœ‰å¶ç»¿ç´ å’Œç±»èƒ¡èåœç´ ,åœ¨é¢œè‰²ä¸Šå¶ç»¿ç´ (å¶ç»¿ç´ a å’Œå¶ç»¿è‰² b) ä¸»è¦å‘ˆç»¿è‰², ç±»èƒ¡èåœç´ (èƒ¡èåœç´ å’Œå¶é»„ç´ ) å‘ˆé»„è‰².å¶ç»¿ç´ å¸æ”¶å…‰çš„èƒ½åŠ›æžå¼º,è€Œå¯¹æ¤ç‰©å…‰åˆä½œç”¨èµ·åˆ°ä½œç”¨çš„æ˜¯æ³¢é•¿åœ¨ 640 ~ 670 nm çš„çº¢å…‰éƒ¨åˆ†å’Œæ³¢é•¿åœ¨ 430 ~ 450 çš„è“ç´«å…‰éƒ¨åˆ†;å› ä¸ºå¤ªé˜³å…‰ä¸æ˜¯å•ä¸€çš„å…‰,åˆ°è¾¾åœ°è¡¨åŽæ³¢é•¿åœ¨ 300nm ~ 2600 nm, åªæœ‰æ³¢é•¿åœ¨ 390 ~ 770 nmä¸ºå¯è§å…‰(ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„çº¢æ©™é»„ç»¿é’è“ç´«,åŠå…¶æ··åˆè‰²),è‡ªç„¶å¤ªé˜³å…‰æ˜¯å¯ä»¥æ»¡è¶³æ¤ç‰©è¿›è¡Œå…‰åˆä½œç”¨çš„,åŒæ—¶,æˆ‘ä»¬æ—¥å¸¸çš„ç…§æ˜Žç¯ä¾‹å¦‚:ç™½ç‚½ç¯,è§å…‰ç¯,LED ç¯,ä»–ä»¬ä¹Ÿå¯æ»¡è¶³æ¤ç‰©è¿›è¡Œå…‰åˆä½œç”¨,ä½†ä»–ä»¬çš„æ³¢é•¿ä¸èƒ½æ»¡è¶³æ¤ç‰©å…‰åˆä½œç”¨çš„æ‰€æœ‰æ³¢é•¿é€‰æ‹©, åªèƒ½æ˜¯å•ä¸€, æ¯”å¦‚åªæ»¡è¶³çº¢å…‰æˆ–è“ç´«å…‰.ä½¿ç”¨ç…§æ˜Žç¯è¿›è¡Œå…‰ç…§,åªä¼šå¯¼è‡´æ¤ç‰©ç¼ºå°‘ä¸€äº›å…ƒç´ ;æ·˜å®ä¸Šä¹Ÿæœ‰ä¸“é—¨ä¹°æ¤ç‰©å…‰åˆä½œç”¨éœ€è¦çš„çº¢å…‰å’Œè“å…‰çš„ç¯,ä½†æ€Žæ ·éƒ½ä¸å¦‚æ¤ç‰©åœ¨å¤–é¢æ™’å‡ å°æ—¶,å¤§è‡ªç„¶å°±æ˜¯è¿™ä¹ˆç¥žå¥‡. æ˜¨å¤©ä¸ºæˆ‘çš„å°å¿ƒå¿µç§»æ¤äº†æ–°å±…,å› ä¸ºåˆšåˆšæ”¶åˆ°ä»–æ—¶,ä»–çš„å®¶æœ‰ç‚¹ç ´è´¥,ç´¢æ€§å°±ä¸ºä»–æ¢ä¸ªè±ªå®….å…ˆç”¨å°é“²é“²æ¾ä»–çš„æ ¹åŸº(ä¸è¦è´´ç€ä»–,ä¸ç„¶ä¼šä¼¤å®³åˆ°å“¦),è¦ä¸è¦ç”¨åŠ›åŽ»æ‹”,ä¼¤åˆ°æ ¹éƒ¨,å°±å†ä¹Ÿæ•‘ä¸æ´»äº†.æ…¢æ…¢çš„,è¦ç»†å¿ƒ,å¾…æ•´ä½“éƒ½å¾ˆæ¾åŠ¨,èƒ½å¤Ÿè¿žæ ¹å¸¦åœŸçš„,ä¸€èµ·ä»Žç›†ä¸­å¸¦å‡º,åœ¨æ–°å®¶å…ˆç»™ä»–æŒ–å¥½å®¹èº«ä¹‹æ‰€,ç”¨æ‰‹æ‹–ä½ä»–,ç»†å¿ƒçš„æ”¾åœ¨æ–°å®¶å¤„,å¹¶åŸ‹å¥½,ç„¶åŽå°‘é‡çš„ç»™äºˆä¸€äº›æ°´åˆ†, è®©ä»–çš„å®¶æ ¹åŸºæ›´å¤¯å®ž,ä¸è¦è¿‡åº¦æµ‡æ°´,ä½†ä¹Ÿè¦æµ‡å¤´,ä¿æŒåœŸå£¤æ¾å¼›,è¿™æ ·æ°§æ°”æ‰èƒ½è¿›å…¥åˆ°åœŸå£¤,è®©æ ¹éƒ¨èƒ½å¤Ÿå……åˆ†çš„è¿›è¡Œå‘¼å¸ä½œç”¨.ä¸€ç›´æ–°å®¶åŽ,å°å¿ƒå¿µå±žäºŽè„†å¼±çš„æ—¶å€™,è¿™æ—¶ä¸è¦è®©ä»–åœ¨é˜³å…‰ä¸‹æš´æ™’,ä¸åˆ©äºŽæ ¹éƒ¨åœ¨æ–°å®¶è½æ ¹. æ–°å®¶å·²ç»å®‰æŽ’å¦¥å½“,ä¹‹åŽå°±æ˜¯ç”¨å¿ƒåŽ»è§‚å¯Ÿä»–çš„å˜åŒ–,ä¿æŒé€šé£Ž,å’Œå…‰ç…§,ä»–æ‰ä¼šèŒå£®æˆé•¿.]]></content>
      <tags>
        <tag>ç»¿æ¤</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¸…é¦™æœ¨å…»æ®–ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2019%2F05%2F04%2F%E6%B8%85%E9%A6%99%E6%9C%A8%E5%85%BB%E6%AE%96%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[æ¿€åŠ¨çš„å¿ƒï¼Œé¢¤æŠ–çš„æ‰‹ï¼Œäº¬ä¸œä¸Šé¢åŠ¨åŠ¨æ‰‹ã€‚å“ˆå“ˆï¼Œå¾ˆä¹…å°±æœ‰æƒ³å…»ä¸€ä¸ªç»¿æ¤çš„æƒ³æ³•ï¼Œç»è¿‡äº†åŠå¹´çš„æŒ£æ‰Žï¼Œç»ˆäºŽåœ¨ 3 å¤©å‰åŠ¨èµ·äº†æ‰‹ï¼Œå…¥æ‰‹ä¸€æ ªæ¸…é¦™æœ¨ï¼Œæ®è€æ¿è¯´ï¼Œæ¸…é¦™æœ¨å¯ä»¥æ•£å‘å‡ºé¦™å‘³ï¼Œå……æ»¡æ•´ä¸ªæˆ¿é—´ï¼Œé¦™æ°”å››æº¢ï¼ˆè¿˜æœªé‰´å®šï¼Œåˆšæ”¶åˆ°ï¼Œæ­£æ€€ç€æ¿€åŠ¨çš„å¿ƒåœ¨å†™ï¼‰ã€‚ å…¶å®žå¯¹è¿™æžæœ‰ä¸€ç‚¹å°å¤±æœ›ï¼Œå°±æ˜¯ä¸ªå¤´å¤ªå°ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œå’±ä¿©ç†¬å‘—ï¼Œæ—©æ™šä½ ä¼šé•¿å¤§çš„ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘æ˜¯ä¸€åªç¨‹åºç‹—ï¼Œè¿™ç§å¼ é£žç»£èŠ±çš„äº‹å„¿ï¼Œç€å®žè®©æˆ‘å¤´ç–¼äº†ä¸€ç•ªï¼›å¹³æ—¥é‡Œååœ¨ç”µè„‘å‰ï¼Œå™¼é‡Œå•ªå•¦çš„æ•²ç€é”®ç›˜ï¼Œä¹¦å†™ç€ä¸€è¡Œè¡Œ ABCï¼ˆçªç„¶æƒ³èµ·ä¸€é¦–æ­Œã€Šéƒ½é€‰ Cã€‹ï¼‰ï¼Œå¾œå¾‰åœ¨ç¼–ç çš„ä¸–ç•Œé‡Œã€‚å¿½ç„¶ä¹‹é—´ï¼Œç”Ÿæ´»ä¸­å¤šäº†ä¸€æ ªç»¿æ¤ï¼Œè®©é‚£ä»½éšè—åœ¨æˆ‘èº«ä½“æŸå¤„å¤šå¹´çš„å°çˆ±å¿ƒåˆå¦‚é›¨åŽæ˜¥ç¬‹ä¸€èˆ¬ï¼ŒèŒå‘äº†èµ·æ¥ã€‚å¯æ˜¯å•Šï¼Œåœ¨ç¼–ç çš„ä¸–ç•Œé‡Œï¼Œæˆ‘å¯ä»¥è£…è£…æ ·å­ï¼Œä½†åœ¨ ta çš„ä¸–ç•Œé‡Œï¼Œæˆ‘åªèƒ½è£…å­™å­ã€‚ è‡ªæ­¤ä¹‹åŽï¼Œæˆ‘å°†è¸ä¸Šç»¿æ¤çš„å…»æŠ¤ä¹‹é“ï¼Œåƒé‡Œä¹‹è¡Œå§‹äºŽè¶³ä¸‹ï¼Œå°±è¯·ä½ æŠŠæˆ‘å¸¦å…¥åˆ°ä½ çš„ä¸–ç•Œé‡Œï¼Œæ·±å…¥çš„äº†è§£å¹¶çˆ±ä¸Šä½ å§ã€‚ OKï¼Œè¯´æ­£äº‹å„¿ï¼Œå…ˆæ¥ä»‹ç»ä¸€ä¸‹æ¸…é¦™æœ¨ï¼š æ¸…é¦™æœ¨éžå¸¸æ”¶åˆ°èŠ±å‹çš„å–œçˆ±ï¼Œæ˜¯ä¸€ç§éžå¸¸ç†æƒ³çš„ç›†æ ½æ¤ç‰©ï¼Œç›†æ™¯æ¸…é¦™æœ¨æ‘†æ”¾åœ¨å®¤å†…ï¼Œèƒ½è¥é€ å‡ºä¸€ç§é‡Žå¤–å±±æ°´æ ‘æœ¨ç§»å…¥å®¶å†…çš„æ„Ÿè§‰ï¼Œè‡ªç„¶æ¸…æ–°ã€‚åŽŸæœ¬ç”Ÿé•¿æˆ‘å›½çš„äº‘è„‘ä¸­éƒ¨ã€åŒ—éƒ¨åŠå››å·å—éƒ¨ç­‰é«˜æµ·æ‹”çš„å¹²çƒ­æ²³è°·åœ°å¸¦ï¼Œå…·æœ‰è€é˜´æ€§ï¼Œå–œå¥½æš–ï¼Œç”Ÿé•¿ç¼“æ…¢ï¼Œå¯¿å‘½é•¿ç­‰ç‰¹ç‚¹ï¼ˆè¿™ä¹Ÿä¼šæˆ‘é€‰æ‹©æ · ta çš„åŽŸå› ï¼‰ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªå…»èŠ±çš„ APPï¼Œå…»èŠ±å¤§å…¨ï¼Œæˆ‘å°±æ˜¯åœ¨è¿™ä¸Šå­¦ä¹ å…»èŠ±çš„æŠ€æœ¯åŠæ³¨æ„äº‹é¡¹çš„ã€‚ è™½ç„¶æˆ‘å¹¶æ²¡æœ‰ç»ç†è¿‡ ta çš„å‡ºç”Ÿï¼Œä½†åŽé¢çš„è·¯æˆ‘æƒ³å’Œä½ ä¸€èµ·ã€‚ä¸ºä½ æ•´ç†å‘åž‹ï¼ˆä¿®å‰ªæžå¶ï¼‰ã€ä¸ºä½ å®‰å®¶ä¹ä¸šï¼ˆä¸Šç›†å®šåž‹ï¼‰ï¼Œå‘µæŠ¤ä½ ï¼ˆåœŸå£¤å’Œæ°´åˆ†ï¼‰ï¼Œä¸€è·¯å‰è¡Œï¼ˆå…‰ç…§å’Œæ¸©åº¦ï¼‰ã€‚ è™½ç„¶ APP ä¸Šä»‹ç»äº†æ¸…é¦™æœ¨ä¸€äº›å–œå¥½ï¼Œä¹Ÿæä¾›äº†ä¸€äº›å…»æ®–æ–¹æ³•ï¼Œä½†èº«åœ¨é—¨å¤–æ±‰çš„æˆ‘è¿˜æ˜¯å¯¹ç»¿æ¤ç•Œçš„æœ¯è¯­æ„Ÿåˆ°å¤´ç–¼ï¼Œä¸‹é¢æ¥ä»‹ç»ä¸€ä¸‹ æœ¯è¯­ å«ä¹‰ è§å¹²è§æ¹¿ è§å¹²ï¼šåœŸå£¤å¹²æ¶¸ï¼Œè¡¨é¢çœ‹ä¸åˆ°æ½®æ¹¿ã€‚ è§æ¹¿ï¼šæµ‡æ°´æ—¶ï¼Œçœ‹åœŸå£¤å…¨éƒ¨æµ¸æ¹¿ã€‚ æµ‡æ°´è¦æµ‡é€ æµ‡æ°´æ—¶ï¼Œè§åˆ°æ°´ä»Žåº•éƒ¨å­”æµå‡º è¿™ä¸ªè¡¨æ ¼æ˜¯æˆ‘åœ¨çœ‹æ¸…é¦™æœ¨å…»æ®–äº‹é¡¹æ—¶é‡åˆ°çš„é—®é¢˜ï¼Œä»¥åŽä¼šç»§ç»­æ›´æ–°ã€‚è™½ç„¶è¿™ä¸ªæœ¯è¯­åˆšåˆ°çœ‹çš„æ—¶å€™ï¼Œä¸€è„¸æ‡µã€‚æˆ‘ä¹Ÿè¯·æ•™äº†æˆ‘çš„åŒäº‹å…³äºŽå…»æŠ¤çš„é—®é¢˜ï¼Œä»–ä¹Ÿç»†å¿ƒçš„è§£é‡Šäº†ï¼Œè€Œä¸”è¿˜ç‰¹åˆ«ç…§é¡¾æˆ‘è¿™ä¸ªå°ç™½ï¼Œç”¨å¾ˆç”ŸåŠ¨çš„æ¯”å–»è®©æˆ‘ç†è§£é€äº†è¿™äº›å±žäºŽã€‚ é‚£ä¹ˆè¿™é‡Œæˆ‘åœ¨è¯¦ç»†çš„è¯´ä¸€ä¸‹æˆ‘çš„ç†è§£ï¼š è§å¹²è§æ¹¿ï¼šè¦è§£é‡Šçš„å’Œä¸Šé¢çš„å«ä¹‰ä¸€æ ·ï¼Œé‚£ä¹ˆæˆ‘è¿˜è¦è¡¥å……çš„éƒ¨åˆ†å°±æ˜¯ï¼ŒåœŸå£¤æ˜¯è‡ªä¸Šè€Œä¸‹å¹²çš„ï¼Œ å› æ­¤è¡¨é¢ä¸Šè™½ç„¶å¹²äº†ï¼Œä½†æ˜¯åœŸå£¤å†…éƒ¨å…¶å®žè¿˜æ²¡æœ‰å¹²ï¼Œå°¤å…¶æ˜¯åœŸå£¤åº•éƒ¨ï¼ˆæ¤ç‰©çš„æ ¹éƒ¨ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘åœŸå£¤ä¸­æ’å…¥ä¸€æ ¹æœ¨æ£ï¼ˆè¦æ’åˆ°åº•å„¿å“¦ðŸ˜ï¼‰ï¼Œä¸“é—¨ç”¨æ¥æ£€æµ‹åœŸå£¤æ¹¿åº¦ï¼Œæ‹”å‡ºæ—¶è®°ä½æœ¨æ£è£¸éœ²åœ¨åœŸå£¤å¤–é¢çš„ä½ç½®ï¼Œæ‹”å‡ºåŽç”¨æ½®æ¹¿çš„éƒ¨ä½åŽ»è®¡ç®—ä½ç½®ã€‚ä¿æŒæ ¹éƒ¨çš„æ¹¿æ¶¦ï¼Œå¯ä»¥ä¿ƒè¿›æ¤ç‰©æ ¹ç³»çš„å‘å±•ï¼Œå› æ­¤ä¸éœ€è¦ç»å¸¸ç»™æ¤ç‰©æµ‡æ°´ã€‚è§æ¹¿ä¹Ÿå°±æ˜¯æµ‡æ°´æ—¶ï¼Œä¿è¯åœŸå£¤æ¹¿æ¶¦å³å¯ã€‚ æµ‡æ°´è¦æµ‡é€ï¼šå½“æˆ‘çœ‹åˆ°æ—¶æˆ‘ä¹Ÿå’Œçº³é—·ä»€ä¹ˆæ„æ€ï¼Œè€Œä¸”å’Œä¸Šé¢çš„è§æ¹¿ä¼¼ä¹Žåˆå†²çªï¼Œåˆ°åº•æ˜¯è§åˆ°åœŸå£¤æ¹¿äº†å°±å¯ä»¥ï¼Œè¿˜æ˜¯è¦æµ‡é€ï¼Ÿé‚£ä»€ä¹ˆåˆæ˜¯æµ‡é€å‘¢ï¼Ÿç»è¿‡æˆ‘çš„è°ƒç ”å’Œå’¨è¯¢ï¼Œç»ˆäºŽå¼„æ˜Žç™½ï¼Œè¿™äº›æƒ…å†µæ˜¯å’ŒåœŸå£¤çš„æˆåˆ†æœ‰å…³ç³»ï¼Œå› ä¸ºåœŸå£¤çš„é€æ°”æ€§ã€ä¿æ°´æ€§éƒ½å¯¹æ¤ç‰©å‘è‚²æœ‰å¾ˆå¤§å½±å“ï¼Œä¸€æ—¦æœ‰é—®é¢˜ï¼Œå¾ˆå¯èƒ½å¯¼è‡´å¶å­å‘é»„ï¼Œè„±è½ï¼Œç”šè‡³æ­»äº¡ã€‚Emmm æˆ‘ä»¬è¯´æµ‡é€çš„äº‹å„¿ï¼ŒèŠ±ç›†åº•éƒ¨æ˜¯æœ‰ä¸€ä¸ªå°å£çš„ï¼ˆä¸å…»èŠ±æ ¹éƒ¨ä¸æ‡‚äº‹å¹²å˜›çš„ï¼Œå°æ—¶å€™å¸®å¦ˆå¦ˆæµ‡èŠ±ï¼Œæ°´ä»Žé‚£æ¼å‡ºæ¥ï¼Œè¿˜ä»¥ä¸ºæµªè´¹äº†å‘¢ï¼‰ã€‚å› ä¸ºåœŸå£¤æˆåˆ†ä¸åŒï¼Œå¸æ°´ã€è“„æ°´èƒ½åŠ›ä¹Ÿä¸åŒï¼Œå…·ä½“åœŸå£¤æˆåˆ†å…ˆä¸ä»‹ç»ï¼Œç®€å•è¯´ä¸‹åŽŸç†â€”å¯ä»¥å…ˆæµ‡ä¸€éå¿«æ°´ï¼Œå°±æ˜¯å°†æ°´åˆ†å‡åŒ€çš„æ´’åœ¨åœŸå£¤çš„è¡¨é¢ï¼Œä¸è¦ç•™å¹²ï¼Œéƒ½æµ¸æ¹¿ï¼Œè§ç›†åœ°æœ‰æ°´åˆ†æµå‡ºå³å¯ï¼Œç­‰åˆ° 10 åˆ†é’Ÿä¹‹åŽï¼Œåœ¨è¿›è¡Œä¸€æ¬¡æµ‡æ°´ï¼ŒåŒæ ·æ˜¯å‡åŒ€çš„æµ‡ï¼Œå¹¶åº•éƒ¨æœ‰æ°´æµå‡ºå³å¯ã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯æµ‡é€äº†ã€‚ å°ç™½åœ¨è¿™çŒ®ä¸‘äº†ï¼ŒåŽç»­ä¼šæŒç»­æ›´æ–°]]></content>
      <tags>
        <tag>ç»¿æ¤</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[OkHttp Intercept]]></title>
    <url>%2F2019%2F04%2F30%2FOkHttp-Intercept%2F</url>
    <content type="text"><![CDATA[OKHttp åœ¨å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°,è¿™é‡Œä»‹ç»ä¸€ä¸‹ OKHttp çš„æ‹¦æˆªå™¨(interceptor)çš„å‡ ä¸ªä½¿ç”¨ä¾‹å­ è¦æ˜¯ç”¨æ‹¦æˆªå™¨å¾ˆç®€å•,æˆ‘ä»¬åªéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª interceptor ç±», å¹¶å®žçŽ° Interceptor æŽ¥å£, åŒæ—¶é‡å†™ intercept æ–¹æ³•. è¿™é‡Œä»‹ç»ä¸¤ç§ Interceptor çš„å®žä¾‹ Log æ—¥å¿— (LogInterceptor)Log åœ¨å¼€å‘è°ƒè¯•ä¸­çš„é‡è¦æ€§, ä¸è¨€è€Œå–», ä¸€ä¸ªå¥½çš„æ—¥å¿—æ•°æ®,èƒ½å¤Ÿä¸ºå¼€å‘æ—¶æä¾›å¾ˆå¤šå¸®åŠ©,å¯ä»¥é€šè¿‡ Log æ¥èŽ·å–å½“å‰ç¨‹åºçš„æ‰§è¡ŒçŠ¶æ€, é¡ºåºç­‰ç­‰. è¿™é‡Œä»‹ç»çš„ Log æ—¥å¿—æ‹¦æˆªå™¨,ä¸»è¦æ˜¯è´Ÿè´£åœ¨ç½‘ç»œè¯·æ±‚æ—¶,æˆªèŽ·è¯·æ±‚ä¸­çš„ä¿¡æ¯,å¹¶å°†è¯·æ±‚ä¿¡æ¯ä»¥ Log çš„æ–¹å¼è¾“å‡ºåˆ°æŽ§åˆ¶å°ä¸Š,å¯å±•çŽ°å½“å‰è¯·æ±‚åœ°å€,è¯·æ±‚å‚æ•°,ä»¥åŠè¯·æ±‚ç»“æžœç­‰. è¯ä¸å¤šè¯´, ä¸Šä»£ç . 1234567891011121314151617181920212223242526272829303132333435363738394041/*** è‡ªå®šä¹‰ log æ‹¦æˆªå™¨,è¾“å…¥è¯·æ±‚åœ°å€,è¯·æ±‚å‚,è¯·æ±‚ç»“æžœ*/public class LogInterceptor implements Interceptor &#123; @Override public Response intercept(Chain chain) throws IOException &#123; // æ‹¦æˆªè¯·æ±‚ä¿¡æ¯,èŽ·å–è¯·æ±‚åœ°å€åŠè¯·æ±‚å‚æ•° Request request = chain.request(); long t1 = System.nanoTime(); // èŽ·å–è¯·æ±‚æ–¹å¼ String method = request.method(); if ("POST".equals(method)) &#123; StringBuilder sb = new StringBuilder(); if (request.body() instanceof FormBody) &#123; FormBody body = (FormBody) request.body(); for (int i = 0; i &lt; body.size(); i++) &#123; sb.append(body.encodedName(i) + "=" + body.encodedValue(i) + ","); &#125; sb.delete(sb.length() - 1, sb.length()); LogUtils.d(TAG, String.format("Sending request %s on %s %n%s %nRequestParams:&#123;%s&#125;", request.url(), chain.connection(), request.headers(), sb.toString())); &#125; &#125; else &#123; LogUtils.d(TAG, String.format("Sending request %s on %s %n%s", request.url(), chain.connection(), request.headers())); &#125; // èŽ·å–å“åº”ä¿¡æ¯ Response response = chain.proceed(request); long t2 = System.nanoTime(); LogUtils.d(TAG, String.format("Received response for %s in %.1fms%n%s", response.request().url(), (t2 - t1) / 1e6d, response.headers())); MediaType contentType = response.body().contentType(); String content = response.body().string(); LogUtils.d(TAG, content); ResponseBody wrappedBody = ResponseBody.create(contentType, content); return response.newBuilder().body(wrappedBody).build(); &#125; &#125; åŠ å‚åŠ å‚çš„æ„ä¹‰åœ¨äºŽ,åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­, éœ€è¦ä¼ é€’ä¸€äº›åŸºæœ¬å‚æ•°,è¿™äº›å‚æ•°æ˜¯åŸºæœ¬ä¿æŒä¸å˜çš„, è€Œè¿™äº›å‚æ•°åˆæ˜¯åŽå°éœ€è¦æ ¡éªŒçš„ä¾é ,æˆ‘ä»¬ä¿—ç§°ä»–ä»¬ä¸ºå…¬å‚, å¦‚æžœåœ¨è¯·æ±‚è¿‡ç¨‹ä¸­åœ¨æ¯ä¸€ä¸ªæŽ¥å£é‡Œé¢éƒ½åŽ»æ·»åŠ è¿™äº›å‚æ•°,æ˜¾å¾—éžå¸¸ç¹ç,è€Œä¸”éº»çƒ¦,åŽç»­äººå‘˜æŽ¥æ‰‹,åˆä¼šä¸çŸ¥æ‰€æŽª,ç»´æŠ¤èµ·æ¥ç›¸å½“ä¸æ–¹ä¾¿. å› æ­¤,åœ¨è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯é€šè¿‡è¯·æ±‚æ‹¦æˆªå™¨,é€šè¿‡æ‹¦æˆªå™¨åŽ»æ·»åŠ è¿™äº›å‚æ•°. å…¬å‚æ‹¦æˆªå™¨åœ¨è¯·æ±‚ä¸­,å¢žåŠ ä¸€äº›å…¬å…±çš„å‚æ•°. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198public class CommonParamsInterceptor implements Interceptor &#123; private Map&lt;String, String&gt; queryParamsMap = new HashMap&lt;&gt;(); private Map&lt;String, String&gt; paramsMap = new HashMap&lt;&gt;(); private Map&lt;String, String&gt; headerParamsMap = new HashMap&lt;&gt;(); private List&lt;String&gt; headerLinesList = new ArrayList&lt;&gt;(); @Override public Response intercept(Chain chain) throws IOException &#123; Request request = chain.request(); Request.Builder requestBuilder = request.newBuilder(); // process header params inject Headers.Builder headerBuilder = request.headers().newBuilder(); if (headerParamsMap.size() &gt; 0) &#123; Iterator iterator = headerParamsMap.entrySet().iterator(); while (iterator.hasNext()) &#123; Map.Entry entry = (Map.Entry) iterator.next(); headerBuilder.add((String) entry.getKey(), (String) entry.getValue()); &#125; &#125; if (headerLinesList.size() &gt; 0) &#123; for (String line : headerLinesList) &#123; headerBuilder.add(line); &#125; requestBuilder.headers(headerBuilder.build()); &#125; // process header params end // process queryParams inject whatever it's GET or POST if (queryParamsMap.size() &gt; 0 &amp;&amp; "GET".equals(request.method())) &#123;// if (queryParamsMap.size() &gt; 0) &#123; request = injectParamsIntoUrl(request, requestBuilder, queryParamsMap); &#125; // process post body inject if (paramsMap != null &amp;&amp; paramsMap.size() &gt; 0 &amp;&amp; "POST".equals(request.method())) &#123; if (request.body() instanceof FormBody) &#123; FormBody.Builder newFormBodyBuilder = new FormBody.Builder(); if (paramsMap.size() &gt; 0) &#123; Iterator iterator = paramsMap.entrySet().iterator(); while (iterator.hasNext()) &#123; Map.Entry entry = (Map.Entry) iterator.next(); newFormBodyBuilder.add((String) entry.getKey(), (String) entry.getValue()); &#125; &#125; FormBody oldFormBody = (FormBody) request.body(); int paramSize = oldFormBody.size(); if (paramSize &gt; 0) &#123; for (int i = 0; i &lt; paramSize; i++) &#123; newFormBodyBuilder.add(oldFormBody.name(i), oldFormBody.value(i)); &#125; &#125; requestBuilder.post(newFormBodyBuilder.build()); request = requestBuilder.build(); &#125; else if (request.body() instanceof MultipartBody) &#123; MultipartBody.Builder multipartBuilder = new MultipartBody.Builder().setType(MultipartBody.FORM); Iterator iterator = paramsMap.entrySet().iterator(); while (iterator.hasNext()) &#123; Map.Entry entry = (Map.Entry) iterator.next(); multipartBuilder.addFormDataPart((String) entry.getKey(), (String) entry.getValue()); &#125; List&lt;MultipartBody.Part&gt; oldParts = ((MultipartBody) request.body()).parts(); if (oldParts != null &amp;&amp; oldParts.size() &gt; 0) &#123; for (MultipartBody.Part part : oldParts) &#123; multipartBuilder.addPart(part); &#125; &#125; requestBuilder.post(multipartBuilder.build()); request = requestBuilder.build(); &#125; &#125; return chain.proceed(request); &#125; private boolean canInjectIntoBody(Request request) &#123; if (request == null) &#123; return false; &#125; if (!TextUtils.equals(request.method(), "POST")) &#123; return false; &#125; RequestBody body = request.body(); if (body == null) &#123; return false; &#125; MediaType mediaType = body.contentType(); if (mediaType == null) &#123; return false; &#125; if (!TextUtils.equals(mediaType.subtype(), "x-www-form-urlencoded")) &#123; return false; &#125; return true; &#125; // func to inject params into url private Request injectParamsIntoUrl(Request request, Request.Builder requestBuilder, Map&lt;String, String&gt; paramsMap) &#123; HttpUrl.Builder httpUrlBuilder = request.url().newBuilder(); if (paramsMap.size() &gt; 0) &#123; Iterator iterator = paramsMap.entrySet().iterator(); while (iterator.hasNext()) &#123; Map.Entry entry = (Map.Entry) iterator.next(); httpUrlBuilder.addEncodedQueryParameter((String) entry.getKey(), (String) entry.getValue()); &#125; requestBuilder.url(httpUrlBuilder.build()); return requestBuilder.build(); &#125; return request; &#125; private static String bodyToString(final RequestBody request) &#123; try &#123; final RequestBody copy = request; final Buffer buffer = new Buffer(); if (copy != null) copy.writeTo(buffer); else return ""; return buffer.readUtf8(); &#125; catch (final IOException e) &#123; return "did not work"; &#125; &#125; public static class Builder &#123; CommonParamsInterceptor interceptor; public Builder() &#123; interceptor = new CommonParamsInterceptor(); &#125; public Builder addParam(String key, String value) &#123; interceptor.paramsMap.put(key, value); return this; &#125; public Builder addParamsMap(Map&lt;String, String&gt; paramsMap) &#123; interceptor.paramsMap.putAll(paramsMap); return this; &#125; public Builder addHeaderParam(String key, String value) &#123; interceptor.headerParamsMap.put(key, value); return this; &#125; public Builder addHeaderParamsMap(Map&lt;String, String&gt; headerParamsMap) &#123; interceptor.headerParamsMap.putAll(headerParamsMap); return this; &#125; public Builder addHeaderLine(String headerLine) &#123; int index = headerLine.indexOf(":"); if (index == -1) &#123; throw new IllegalArgumentException("Unexpected header: " + headerLine); &#125; interceptor.headerLinesList.add(headerLine); return this; &#125; public Builder addHeaderLinesList(List&lt;String&gt; headerLinesList) &#123; for (String headerLine : headerLinesList) &#123; int index = headerLine.indexOf(":"); if (index == -1) &#123; throw new IllegalArgumentException("Unexpected header: " + headerLine); &#125; interceptor.headerLinesList.add(headerLine); &#125; return this; &#125; public Builder addQueryParam(String key, String value) &#123; interceptor.queryParamsMap.put(key, value); return this; &#125; public Builder addQueryParamsMap(Map&lt;String, String&gt; queryParamsMap) &#123; interceptor.queryParamsMap.putAll(queryParamsMap); return this; &#125; public CommonParamsInterceptor build() &#123; return interceptor; &#125; &#125;&#125; åŠ ç­¾æ‹¦æˆªå™¨äº’è”ç½‘æ˜¯ä¸€ä¸ªå¼€æ”¾çš„çŽ¯å¢ƒ,å±é™©æ— å¤„ä¸åœ¨,åŠ å¯†é€šä¿¡æ˜¯å®‰å…¨çš„åŸºç¡€. åŠ å¯†çš„æ–¹å¼åˆæœ‰å¾ˆå¤š,æ¯”å¦‚å¯¹ç§°åŠ å¯†/éžå¯¹ç§°åŠ å¯†/Hash(ä¸¥æ ¼çš„è¯´ä¸æ˜¯åŠ å¯†),è¿™é‡Œå…ˆä¸å¯¹åŠ å¯†è¿›è¡Œä»‹ç»,æˆ‘ä»¬èŠèŠåŠ ç­¾; åŠ ç­¾,å…¶å®žå°±æ˜¯ç»™æŠ¥æ–‡åšä¸€ä¸ªæ‘˜è¦,ç›¸åŒçš„ç­¾åç®—æ³•å¾—åˆ°çš„æ‘˜è¦æ˜¯ç›¸åŒçš„,æ¯”å¦‚MD5, SH1, SH256ç­‰, ç®€å•çš„åŠ ç­¾å¹¶ä¸èƒ½é˜²æ­¢ç¯¡æ”¹,å› ä¸ºæ”»å‡»è€…å¯ä»¥ç¯¡æ”¹åŽ,è‡ªå·±ç”Ÿæˆæ–°çš„ç­¾å.æœåŠ¡ç«¯éªŒç­¾è¿˜æ˜¯å¯ä»¥é€šè¿‡çš„,å› æ­¤åŠ ç­¾æ—¶ä¸€å®šè¦åŒ…å«ä¸€äº›ç§æœ‰çš„ä¸œè¥¿,æ¯”å¦‚ç§é’¥. è¿™é‡Œä»‹ç»ä¸€ç§åŠ ç­¾æ–¹å¼, åŠ å¯†è§„åˆ™ æ ¹æ®è¯·æ±‚å‚æ•° key è¿›è¡ŒæŽ’åº æŒ‰æŽ’å¥½çš„é¡ºåºç»„è£…æˆ key=value&amp;key=value å½¢å¼çš„å­—ç¬¦ä¸² å°†ä¸Šè¿°å­—ç¬¦ä¸²æ‹¼æŽ¥ ,æœ€ç»ˆå½¢æˆ key=value&amp;key=valueçš„å­—ç¬¦ä¸² å°†å­—ç¬¦ä¸² md5, ç”Ÿæˆ auth. ä¸€ä¸ªç®€å•çš„åŠ ç­¾é€»è¾‘å°±æ˜¯è¿™æ ·,ä¸‹é¢ä»£ç å°±æ˜¯å¯¹è¿™ç§è§„åˆ™çš„å®žçŽ°,çœ‹ä»£ç â†“â†“â†“â†“ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243public class AuthorizeInterceptor implements Interceptor &#123; private static final String TAG = "AuthorizeInterceptor"; /** * ç”Ÿæˆ auth çš„ç§é’¥ */ private String authKey; /** * å½“å‰è®¾å¤‡ mid,ç”¨æ¥ç”Ÿæˆ auth * æ•°æ®ç”± Builder ç±»ä¼ å…¥ */ private String mid = ""; private AuthorizeInterceptor() &#123; &#125; @Override public Response intercept(Chain chain) throws IOException &#123; Request request = chain.request(); Request.Builder requestBuilder = request.newBuilder(); String url = request.url().toString(); LogUtils.d(TAG, url); if ("POST".equals(request.method())) &#123; request = injectionParamIntoBody(request, requestBuilder); &#125; else if ("GET".equals(request.method())) &#123; request = injectionAuthIntoUrl(request, requestBuilder); &#125; return chain.proceed(request); &#125; /** * GET è¯·æ±‚æ–¹å¼, ç”ŸæˆæŽˆæƒå’Œæ·»åŠ æ—¶é—´æˆ³ * * @param request * @param requestBuilder * @return */ private Request injectionAuthIntoUrl(Request request, Request.Builder requestBuilder) &#123; //èŽ·å–åˆ°è¯·æ±‚åœ°å€api HttpUrl newHttpUrl = request.url(); TreeMap&lt;String, String&gt; authMap = new TreeMap&lt;&gt;(); //é€šè¿‡è¯·æ±‚åœ°å€(æœ€åˆå§‹çš„è¯·æ±‚åœ°å€)èŽ·å–åˆ°å‚æ•°åˆ—è¡¨ Set&lt;String&gt; parameterNames = newHttpUrl.queryParameterNames(); for (String key : parameterNames) &#123; //å¾ªçŽ¯å‚æ•°åˆ—è¡¨,èŽ·å–å‚æ•°value, String paramValue = newHttpUrl.queryParameter(key); if (!TextUtils.isEmpty(paramValue)) &#123; authMap.put(key, paramValue); &#125; &#125; HttpUrl.Builder newBuilder = request.url().newBuilder() .addEncodedQueryParameter("auth", assembleAuth(authMap, false)); requestBuilder.url(newBuilder.build()); return requestBuilder.build(); &#125; /** * å°†å‚æ•°æ³¨å…¥åˆ° POST è¯·æ±‚çš„ body ä¸­ * * @param request * @param requestBuilder * @return */ private Request injectionParamIntoBody(Request request, Request.Builder requestBuilder) &#123; if (request.body() instanceof FormBody) &#123; // å¤„ç†æ­£å¸¸è¡¨å•è¯·æ±‚æ–¹å¼ FormBody oldFormBody = (FormBody) request.body(); return assembleFormBody(request, oldFormBody, requestBuilder); &#125; else if (request.body() instanceof MultipartBody) &#123; return assembleMultipartBody(request, requestBuilder); &#125; else &#123; return request; &#125; &#125; /** * æž„å»ºæµåª’ä½“å‚æ•°çš„ body * * @param request * @param builder * @return */ private Request assembleMultipartBody(Request request, Request.Builder builder) &#123; // å¤„ç†æµçš„è¯·æ±‚æ–¹å¼ MultipartBody body = (MultipartBody) request.body(); TreeMap&lt;String, String&gt; authMap = new TreeMap&lt;&gt;(); // èŽ·å–å‚æ•° key åŠ value æ•°æ®, å°†æ•°æ®å†™å…¥åˆ° TreeMap ä¸­è¿›è¡ŒæŽ’åº if (body != null &amp;&amp; body.parts().size() &gt; 0) &#123; for (MultipartBody.Part part : body.parts()) &#123; // åªå¤„ç† contentType ä¸ºç©º,æˆ–ä¸º text çš„æƒ…å†µ, image ä¸Šä¼ å›¾ç‰‡çš„å­—æ®µ,ä¸è¿›è¡Œå¤„ç† if (part.body().contentType() == null || !"image".equals(part.body().contentType().type()) || "text".equals(part.body().contentType().type())) &#123; Headers headers = part.headers(); // ä»Ž header ä¸­èŽ·å– Key, form-data; name= çš„å­—æ®µè¿‡æ»¤èŽ·å–key // ç­›é€‰æŽ‰ basic, èŽ·å–åˆ°å½“å‰ header,å¯¹åº”çš„ RequestBody, é€šè¿‡ buffer çš„æ–¹å¼,èŽ·å–åˆ° value // å°† key å’Œ value å¡«å……åˆ° TreeMap ä¸­ for (int i = 0; i &lt; headers.names().size(); i++) &#123; String headerName = headers.value(i); if (headerName.contains("form-data; name=")) &#123; String key = headerName.replace("form-data; name=", "").replace("\"", ""); String value = body2String(part.body()); if (!TextUtils.isEmpty(value)) &#123; authMap.put(key, body2String(part.body())); &#125; &#125; &#125; &#125; &#125; &#125; MultipartBody.Builder multipartBuilder = new MultipartBody.Builder().setType(MultipartBody.FORM); multipartBuilder.addFormDataPart("auth", assembleAuth(authMap, false)); List&lt;MultipartBody.Part&gt; oldParts = ((MultipartBody) request.body()).parts(); if (oldParts != null &amp;&amp; oldParts.size() &gt; 0) &#123; for (MultipartBody.Part part : oldParts) &#123; multipartBuilder.addPart(part); &#125; &#125; builder.post(multipartBuilder.build()); return builder.build(); &#125; /** * æž„å»º Auth æ•°æ® * &lt;p&gt; * TreeMap æ•°æ®,æŒ‰ç…§å­—æ¯é¡ºåºè‡ªåŠ¨æŽ’åºåŽ,éåŽ†æ•°æ®,æ‹¼æŽ¥æˆ key=value&amp;key=value çš„å½¢å¼, * Map æ‹¼æŽ¥å®ŒæˆåŽ,åœ¨å…¶åŽéœ€è¦å†æ¬¡æ‹¼æŽ¥ä¸Š * &lt;p&gt; * æœ€åŽå°†æ•°æ® MD5 è½¬åŒ–ä¸º 32 ä½å°å†™å¹¶è¿”å›ž * * @param treeMap æž„å»º Auth çš„å…·ä½“æ•°æ® * @param isNeedDecode æ˜¯å¦éœ€è¦è§£ç  * @return è¿”å›ž auth æ•°æ® */ private String assembleAuth(TreeMap&lt;String, String&gt; treeMap, boolean isNeedDecode) &#123; StringBuilder stringBuilder = new StringBuilder(); if (treeMap.size() &gt; 0) &#123; for (Map.Entry&lt;String, String&gt; stringStringEntry : treeMap.entrySet()) &#123; try &#123; stringBuilder.append(stringStringEntry.getKey()) .append("=") .append(isNeedDecode ? URLDecoder.decode(stringStringEntry.getValue(), "UTF-8") : stringStringEntry.getValue()) .append("&amp;"); &#125; catch (UnsupportedEncodingException e) &#123; e.printStackTrace(); &#125; &#125; &#125; treeMap.clear(); stringBuilder .append(authKey); Log.d(TAG, stringBuilder.toString()); return MD5.MD5(stringBuilder.toString()); &#125; /** * body è½¬ string èŽ·å–å®žé™…å‚æ•°å€¼ * * @param body Part body * @return part ä¸­å†™å¦‚çš„å‚æ•°æ•°æ® */ private String body2String(RequestBody body) &#123; if (body != null) &#123; Buffer buffer = new Buffer(); try &#123; body.writeTo(buffer); Charset charset = Charset.forName("UTF-8"); MediaType contentType = body.contentType(); if (contentType != null) &#123; charset = contentType.charset(charset); &#125; assert charset != null; return buffer.readString(charset); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; return ""; &#125; /** * ç»„è£… Form è¡¨å•è¯·æ±‚æ•°æ® * * @param request * @param oldFormBody * @param requestBuilder * @return */ private Request assembleFormBody(Request request, FormBody oldFormBody, Request.Builder requestBuilder) &#123; TreeMap&lt;String, String&gt; authMap = new TreeMap&lt;&gt;(); // éåŽ†è¯·æ±‚å‚æ•°,éžç©ºå‚æ•°,æ·»åŠ åˆ°é›†åˆä¸­ for (int i = 0; i &lt; oldFormBody.size(); i++) &#123; if (!TextUtils.isEmpty(oldFormBody.encodedValue(i))) &#123; authMap.put(oldFormBody.encodedName(i), oldFormBody.encodedValue(i)); &#125; &#125; if (authMap.size() != 0) &#123; // ç”Ÿæˆ auth æ•°æ® FormBody.Builder newFormBody = new FormBody.Builder(); for (int i = 0; i &lt; oldFormBody.size(); i++) &#123; newFormBody.addEncoded(oldFormBody.encodedName(i), oldFormBody.encodedValue(i)); &#125; newFormBody.add("auth", assembleAuth(authMap, true)); requestBuilder.method(request.method(), newFormBody.build()); return requestBuilder.build(); &#125; return request; &#125; /** * Builder æž„é€ å‡½æ•°,ç”¨æ¥è®¾ç½® Authorize çš„ç›¸å…³å‚æ•°,åŠåˆ›å»ºå·¥ä½œ */ public static class Builder &#123; AuthorizeInterceptor authorizeInterceptor; public Builder() &#123; authorizeInterceptor = new AuthorizeInterceptor(); &#125; public Builder setMid(String mid) &#123; authorizeInterceptor.mid = mid; return this; &#125; public Builder setAuthKey(String key) &#123; authorizeInterceptor.authKey = key; return this; &#125; public AuthorizeInterceptor build() &#123; return authorizeInterceptor; &#125; &#125;&#125; è¯¥åŠ ç­¾æ–¹å¼,è®²è¯·æ±‚å‚æ•°æ‹¼æŽ¥ä¸º key=value çš„æ–¹å¼, éš¾ç‚¹åœ¨äºŽå¦‚ä½•ä»Ž OkHttp ä¸­èŽ·å–è¿™äº›å‚æ•°,åœ¨ GET è¯·æ±‚å’Œ POST çš„å¤„ç†æ–¹å¼åˆä¸åŒ,ä»£ç ä¸­ POST è¯·æ±‚æ–¹å¼,åˆä¼šæ ¹æ®è¯·æ±‚ä¼ é€’çš„ contentType è€Œåˆæœ‰æ‰€ä¸åŒ,è¿™é‡Œä»‹ç»äº†Formè¡¨å•æäº¤å’Œ Multipart ä¸Šä¼ æ–‡ä»¶çš„å‚æ•°èŽ·å–æ–¹å¼,å…¶ä»–çš„è¯·ä¸¾ä¸€åä¸‰.]]></content>
      <tags>
        <tag>OkHttp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šä¸ª ssh å…¬é’¥æäº¤ä»£ç åˆ°ä¸åŒå¹³å°]]></title>
    <url>%2F2019%2F04%2F17%2F%E5%A4%9A%E4%B8%AA-ssh-%E5%85%AC%E9%92%A5%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E5%88%B0%E4%B8%8D%E5%90%8C%E5%B9%B3%E5%8F%B0%2F</url>
    <content type="text"><![CDATA[ä½œä¸ºä¸€ä¸ªæŠ€æœ¯å¼€å‘äººå‘˜ï¼Œå…ä¸äº†åœ¨ github ä»¥åŠ gitlab ä»¥åŠå…¶ä»– git å¹³å°ä¸Šè¿›è¡Œä»£ç ç®¡ç†ï¼›å·¥ä½œä¸­æ‚¨å¯èƒ½ä½¿ç”¨ svn ï¼ˆè¿™ä¸åœ¨æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´ï¼‰,ä¹Ÿæœ‰å¯èƒ½ä½¿ç”¨ git, ç”Ÿæ´»ä¸­ï¼Œæ‚¨å¯èƒ½ä¼šå°†ä¸€äº›å†…å®¹åˆ†äº«åˆ°ä½ çš„ github ä¸Šï¼Œ ä¾›å¤§å®¶å‚é˜…ã€‚ git åˆ›å»ºç‰ˆæœ¬åº“å¾ˆå®¹æ˜“ï¼Œ clone ä»£ç ä¹Ÿä»…ä»…æ˜¯ç®€å•çš„ä¸€å¥ git clone https://github.com/xxxx.gitï¼Œå¼‚æˆ–æ˜¯ git clone git@github.com:xxxxx.gitï¼›å½“ç„¶ï¼Œä½¿ç”¨ https çš„æ–¹å¼ç®€å•æ˜“æ“ä½œï¼ˆæœ¬äººè®¤ä¸ºæ˜¯ä¸€ä¸ªå‚»ç“œç›¸æœºï¼‰ï¼Œä½†æ˜¯é€šè¿‡ä½¿ç”¨ https çš„æ–¹å¼ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦è¾“å…¥è´¦å·å’Œå¯†ç çš„æƒ…å†µï¼Œè¿™å¤§å¤§çš„åŠ å¤§äº†å®‰å…¨é—®é¢˜ï¼Œè™½ç„¶æŸ dear çš„å›¾å½¢åŒ–å·¥å…·ï¼Œä¼šå¸®åŠ©æˆ‘ä»¬ remeber è´¦å·å’Œå¯†ç ï¼Œé¿å…äº†é‡å¤è¾“å…¥ï¼Œä½†è¿™ä¸åœ¨æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´ï¼ˆä¸ªäººå¾ˆé„™è§†ä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢çš„ï¼‰ï¼ŒæŽ¥ä¸‹æ¥è¦è¯´çš„å°±æ˜¯ä½¿ç”¨ SSH çš„æ–¹å¼æ¥å¤„ç† git çš„ç‰ˆæœ¬ç®¡ç†ã€‚ ç”Ÿæˆ SSH å¯†é’¥ä½¿ç”¨ SSH åˆ›å»ºä¸€å¥—å…¬å¯†é’¥ï¼Œå°†å…¬é’¥æ·»åŠ åˆ°ä½ è¦ä½¿ç”¨çš„ Git å¹³å°è´¦æˆ·ä¸‹ 1ssh-keygen -t rsa -C &quot;your email addr&quot; -f ~/.ssh/github æ³¨æ„ï¼š -f åŽé¢çš„å‚æ•°æ˜¯ç”¨æ¥è‡ªå®šä¹‰ SSH KEY çš„å­˜æ”¾è·¯å¾„ï¼Œå¦‚æžœä¸éœ€è¦ä¹Ÿå¯ä»¥è‡ª -f å¼€å§‹çœç•¥ å‘½ä»¤è¾“å…¥å®ŒæˆåŽï¼Œè¿žå‡»3ä¸‹å›žè½¦å°±å¯ä»¥ï¼Œä¸éœ€è¦å¤„ç†æ“ä½œï¼ˆé™¤éžä½ å¾ˆæƒ³å¤„ç†ï¼‰ æ·»åŠ ç”Ÿæˆçš„ SSH å…¬é’¥æ·»åŠ  ssh å…¬é’¥åˆ° github ** æ‰“å¼€ https://github.com/settings/profile ï¼Œé€‰æ‹© SSH and GPG keys ç‚¹å‡» New SSH key title å¯ä»¥éšä¾¿å†™ï¼Œå»ºè®®è§åçŸ¥æ„ï¼Œèƒ½çŸ¥é“æ˜¯å“ªå°è®¾å¤‡ key é€šè¿‡åˆšåˆšé€šè¿‡ SSH å‘½ä»¤ç”Ÿæˆçš„ .pub æ–‡ä»¶ä¸­å¤åˆ¶å³å¯ã€‚æ–‡ä»¶è·¯å¾„ .ssh/id_rsa.pub å¼‚æˆ–æ˜¯å­˜åœ¨æ‚¨ -f ä¹‹åŽæŒ‡å®šçš„ç›®å½•ã€‚ ç‚¹å‡» add SSH key é…ç½®å¤šä¸ª sshé…ç½®å¤šä¸ª ssh æ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š å¦‚æžœä½ æœªæŒ‡å®šå…¬é’¥çš„å­˜å‚¨è·¯å¾„ï¼Œé‚£ä¹ˆä½ éœ€è¦ä¸€ä¸ªä¸€ä¸ªçš„æ‰‹åŠ¨åŽ»åˆ›å»ºï¼Œå¹¶é…ç½® ssh å…¬é’¥åˆ°å¯¹åº”å¹³å°ï¼Œå¦åˆ™ï¼ŒåŽç»­çš„ ssh åˆ›å»ºè¿‡ç¨‹ï¼Œ ä¼šè¦†ç›–æŽ‰ä¹‹å‰åˆ›å»ºçš„ã€‚ ssh-keygen ä¼šåŒæ—¶åˆ›å»º id_rsa å’Œ id_rsa.pub ä¸¤ä¸ªæ–‡ä»¶ï¼Œ .pub æ˜¯å…¬é’¥ï¼Œ ä¸å¸¦åŽç¼€çš„æ˜¯ä½ çš„ç§é’¥ã€‚ åŒæ—¶é…ç½®å¤šä¸ª ssh æ—¶ï¼Œéœ€è¦æ‚¨ä¿ç•™ç§é’¥åœ¨ .ssh ç›®å½•ä¸‹ï¼Œä¸ºä¿è¯å¤šå¹³å°éƒ½å¯ä»¥ä½¿ç”¨ï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹ id_rsa æ–‡ä»¶çš„åç§°ï¼Œ.pub å°±éšä¾¿äº†ï¼Œé…ç½®å®Œï¼Œå°±æ²¡ç”¨äº†ã€‚ å°†å¯†é’¥æ·»åŠ åˆ° ssh-agent ä¸­ 1ssh-add ~.ssh/id_rsa 123456# æŸ¥çœ‹ agent ä¸­çš„å¯†é’¥ssh-add -l# æŸ¥çœ‹ agent ä¸­çš„å…¬é’¥ssh-add -L# åˆ é™¤ agent ä¸­çš„å¯†é’¥ssh-add -d .ssh/id_xxx.pub ä¿®æ”¹é…ç½®æ–‡ä»¶è¯´äº†åŠå¤©ï¼Œç»ˆäºŽåˆ°é‡ç‚¹äº† åœ¨ ~/.ssh ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª config æ–‡ä»¶ å¯¹ï¼Œæ²¡æœ‰é”™ï¼Œå°±æ˜¯ä¸€ä¸ªè¿žåŽç¼€éƒ½æ²¡æœ‰çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ç”¨æ¥å­˜å‚¨æ‚¨çš„æ‰€æœ‰å¹³å°ä¿¡æ¯ï¼Œä»¥åŠå¹³å°å¯¹åº”ä½¿ç”¨çš„ ssh å¯†é’¥ã€‚ touch config æ·»åŠ ä»¥ä¸‹é…ç½®ä¿¡æ¯ 12345678910111213# githubHost github.com # ä¹Ÿå¯ä»¥æ˜¯æ•°å­— ip åœ°å€ï¼ŒåŠ ä¸åŠ  http/https éƒ½æ— æ‰€è°“HostName github.com # åŒä¸ŠPreferredAuthentications publickey # è¿™é‡Œä¸è¦ä¿®æ”¹IdentityFile ~/.ssh/id_rsa_github # è¿™é‡Œçš„æ–‡ä»¶åä¿®æ”¹ä¸ºè¯¥å¹³å°å¯¹åº”çš„å¯†é’¥# gitlabHost å…¬å¸ gitlab åœ°å€HostName å…¬å¸ gitlab åœ°å€PreferredAuthentications publickeyIdentityFile ~/.ssh/id_rsa_gitlab... æµ‹è¯•å‘½ä»¤ä¸ºï¼š 1ssh -T git@github.com ç»“æžœ 1Hi boywithsmalleyes! You&apos;ve successfully authenticated, but GitHub does not provide shell access. åªéœ€è¦æ›¿æ¢åŽé¢çš„ gitä»“åº“åœ°å€, å…¶ä»–ç‰ˆæœ¬åº“éƒ½å¯ä»¥è¿›è¡Œæµ‹è¯•ã€‚ ç»“è¯­è¯´äº†åŠå¤©ï¼Œ è¿˜æ˜¯è¦è®°ä½ä¸€ç‚¹ï¼Œæ—¢ç„¶è¦ä½¿ç”¨ ssh çš„æ–¹å¼è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œé‚£ä¹ˆåœ¨ clone ä»£ç æ—¶ï¼Œä¹Ÿè¦ä½¿ç”¨ ssh æ–¹å¼ï¼Œ ä¸ç„¶æˆ‘è¯´äº†è¿™ä¹ˆåŠå¤©ï¼Œéƒ½æ˜¯ç™½æ‰¯ã€‚ æ–‡ç« å†…å®¹æœ‰ç‘•ç–µï¼Œè¯·ç»™äºˆæŒ‡æ­£æ‰¹è¯„]]></content>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯æ•°å­—çš„æ–¹æ³•]]></title>
    <url>%2F2019%2F04%2F16%2FJava-%E5%88%A4%E6%96%AD%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%98%AF%E5%90%A6%E6%98%AF%E6%95%B0%E5%AD%97%E7%9A%84%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨ Javaè‡ªå¸¦çš„å‡½æ•° 12345678public static boolean isNumeric (String str) &#123; for (int i = str.length(); --i &gt;=0) &#123; if (!Character.isDigit(str.charAt(i))) &#123; return false; &#125; &#125; return true;&#125; ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ æ–¹æ³•ä¸€: 1234public static boolean isNumeric(String str) &#123; Pattern pattern = Pattern.compile(&quot;^[-\\+]?[\\d]*$&quot;); return pattern.matcher(str).matches();&#125; æ–¹æ³•äºŒ: 123456public static boolean isNumeric(String str) &#123; if (str != null &amp;&amp; !&quot;&quot;.equals(str.trim())) &#123; return s.matches(&quot;^[0-9]*$&quot;); &#125; return false;&#125; æ–¹æ³•ä¸‰: 1234 public static boolean isNumeric (String str) &#123; Pattern pattern = Pattern.compile(&quot;[0-9]*&quot;); return pattern.matcher(str).matcher();&#125; ä½¿ç”¨ ASCII ç  123456789public static boolean isNumeric (String str) &#123; for (int i = str.length(); --i&gt;=0;) &#123; int chr = str.charAt(i); if (chr &lt; 48 || chr &gt; 57) &#123; return false; &#125; &#125; return true;&#125; åˆ¤æ–­æ˜¯ä¸æ˜¯æµ®ç‚¹åž‹æ•°æ® 1234public static boolean isDouble(String str) &#123; Pattern pattern = Pattern.compile(&quot;^[-\\+]?[.\\d]*$&quot;); return pattern.matcher(str).matches();&#125;]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android ä¸­è®¾ç½®å…¨å±çš„æ–¹æ³•]]></title>
    <url>%2F2019%2F04%2F16%2FAndroid-%E4%B8%AD%E8%AE%BE%E7%BD%AE%E5%85%A8%E5%B1%8F%E7%9A%84%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[åœ¨å¼€å‘ä¸­,æˆ‘ä»¬ç»å¸¸éœ€è¦æŠŠæˆ‘ä»¬çš„åº”ç”¨è®¾ç½®ä¸ºå…¨å±,è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼: ä¸€æ˜¯åœ¨ä»£ç ä¸­è®¾ç½®; äºŒæ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® ä¸€. åœ¨ä»£ç ä¸­è®¾ç½®1234567891011public class BaseActivity extends Activity &#123; @Override public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(saveInstanceState); // æ— title requestWindowFeature(Window.FEATURE_NO_TITLE); // å…¨å± getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN); setContentView(R.layout.activity_main); &#125; &#125; å¼ºè°ƒä¸€ç‚¹: è®¾ç½®å…¨å±çš„ä¸¤æ®µä»£ç ,å¿…é¡»åœ¨ setContentView() ä¹‹å‰è°ƒç”¨,ä¸ç„¶ä¼šæŠ¥é”™ äºŒ. åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹1234567891011121314151617&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; package=&quot;com.android.test&quot; android:versionCode=&quot;1&quot; ndroid:versionName=&quot;1.0&quot;&gt; &lt;application android:icon=&quot;@drawable/icon&quot; android:lable=&quot;@string/app_name&gt; &lt;activity android:name=&quot;.BaseActivity&quot; android:theme=&quot;@android:style/Theme.NotitleBar.Fullscreen&quot; android:lable=&quot;@string/app_name&quot;&gt; &lt;intent-filter&gt; &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt; &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;/&gt; &lt;/intent-filter&gt; &lt;/application&gt;&lt;/manifest&gt; ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•,ä¼šåœ¨åº”ç”¨è¿è¡ŒåŽ,çœ‹åˆ°ä¸€ä¸ªçŸ­æš‚çš„çŠ¶æ€æ¥, ç„¶åŽæ‰å…¨å±, è€Œç¬¬äºŒç§æ–¹æ³•æ˜¯ä¸ä¼šæœ‰è¿™ç§æƒ…å†µçš„,å¤§å®¶æ ¹æ®éœ€è¦è‡ªè¡Œé€‰æ‹©.]]></content>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android èŽ·å– IP åœ°å€]]></title>
    <url>%2F2019%2F04%2F16%2FAndroid-%E8%8E%B7%E5%8F%96-IP-%E5%9C%B0%E5%9D%80%2F</url>
    <content type="text"><![CDATA[å¼€å‘ä¸­ç»å¸¸ä¼šéœ€è¦åˆ¤æ–­å½“å‰æ˜¯å¦è¿žæŽ¥ç½‘ç»œ, WiFi æˆ– ç§»åŠ¨æ•°æ®è¿žæŽ¥åˆ¤æ–­çš„éœ€æ±‚, ç¬¬ä¸€ç§æ–¹æ³•: 123WifiManager wifiManager = (WifiManager) getSystemService(WIFI_SERVICE); WifiInfo wifiInfo = wifiManager.getConnectionInfo(); int ipAddress = wifiInfo.getIpAddress(); é€šè¿‡è¿™ç§æ–¹å¼èŽ·å–åˆ°çš„ IP åœ°å€ä¸ºä¸€ä¸²æ•°å­—,æˆ‘ä»¬å¹¶ä¸èƒ½çœ‹æ‡‚,å› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œè½¬æ¢: 1String ip = (ipAddress &amp; 0xff) + &quot;.&quot; + (ipAddress&gt;&gt;8 &amp; 0xff) + &quot;.&quot; + (ipAddress&gt;&gt;16 &amp; 0xff) + &quot;.&quot; + (ipAddress &gt;&gt; 24 &amp; 0xff); è¿™æ ·è½¬æ¢ä¹‹åŽ,æˆ‘ä»¬èŽ·å–åˆ°çš„ IP åœ°å€å°±æ˜¯æˆ‘ä»¬å¹³æ—¶è®¤è¯†çš„, æ¯”å¦‚: 192.168.1.108 è¿™ç§æ–¹æ³•åœ¨é£žè¡Œæ¨¡å¼ä¸‹èŽ·å–åˆ°çš„ IP åœ°å€ä¸º 0.0.0.0 ç¬¬äºŒç§æ–¹æ³•: 12345678910111213141516 public String getLocalIpAddress() &#123; try &#123; for (Enumeration&lt;NetworkInterface&gt; en = NetworkInterface.getNetworkInterfaces(); en.hasMoreElements();) &#123; NetworkInterface intf = en.nextElement(); for (Enumeration&lt;InetAddress&gt; enumIpAddr = intf.getInetAddresses(); enumIpAddr.hasMoreElements();) &#123; InetAddress inetAddress = enumIpAddr.nextElement(); if (!inetAddress.isLoopbackAddress()) &#123; return inetAddress.getHostAddress().toString(); &#125; &#125; &#125; &#125; catch (SocketException ex) &#123; Log.e(LOG_TAG, ex.toString()); &#125; return null; &#125; ç¬¬äºŒç§æ–¹å¼æ˜¯æ¯”è¾ƒé€šç”¨çš„,åœ¨WiFiå’Œ3G/4G çŠ¶æ€ä¸‹,éƒ½å¯ä»¥èŽ·å–åˆ°æ­£ç¡®çš„åœ°å€.æ¯”å¦‚: fe80::8e3a:e3ff:fe45:a018 è¿™ç§æ–¹æ³•åœ¨æ‰‹æœºå¤„äºŽé£žè¡ŒçŠ¶æ€ä¸‹æ—¶, èŽ·å–åˆ°çš„ IP åœ°å€ä¸º null]]></content>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[äº‹ä»¶åˆ†å‘]]></title>
    <url>%2F2019%2F04%2F16%2F%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%2F</url>
    <content type="text"><![CDATA[äº‹ä»¶åˆ†å‘çš„ä¸‰ä¸ªæ–¹æ³• dispatchTouchEvent(MotionEvent event) åˆ¤æ–­å½“å‰ View æ˜¯å¦è¦æ¶ˆè´¹æ­¤äº‹ä»¶ï¼Œæ¶ˆè´¹ï¼Œåˆ™ä¸å†å‘ä¸‹ä¼ é€’ï¼Œåä¹‹ä¼ é€’ï¼Œä»¥æ­¤æ¥åˆ†å‘äº‹ä»¶ï¼› onInterceptTouchEvent(MotionEvent event) é€šè¿‡ dispatchTouchEvent è°ƒç”¨ï¼Œ è¿”å›žå€¼ç”¨æ¥åˆ¤æ–­å½“å‰ View æ˜¯å¦è¦æ¶ˆè´¹äº‹ä»¶ï¼› onTouchEvent(MotionEvent event) å½“ View å†³å®šæ¶ˆè´¹äº‹ä»¶ï¼Œåˆ™å°†è¿›è¡Œè¯¥æ–¹æ³•çš„è°ƒç”¨ï¼Œä¾æ®å…·ä½“çš„äº‹ä»¶ï¼ŒåŠå…·ä½“ä¸šåŠ¡ï¼Œå®žçŽ°ä¸åŒçš„äº‹ä»¶ã€‚ å…³äºŽäº‹ä»¶åˆ†å‘çš„ä¸€äº›ç»“è®ºï¼š åŒä¸€ä¸ªäº‹ä»¶åºåˆ—æ˜¯æŒ‡ä»Žæ‰‹æŒ‡æŽ¥è§¦å±å¹•çš„é‚£ä¸€åˆ»èµ·ï¼Œåˆ°æ‰‹æŒ‡ç¦»å¼€å±å¹•çš„é‚£ä¸€åˆ»ç»“æŸï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ‰€äº§ç”Ÿçš„ä¸€ç³»åˆ—äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶ç³»åˆ—ä»¥ down äº‹ä»¶å¼€å§‹ï¼Œ ä¸­é—´å«æœ‰è‹¥å¹²ä¸ª move äº‹ä»¶ï¼Œ æœ€ç»ˆä»¥ up äº‹ä»¶ç»“æŸï¼› æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªäº‹ä»¶åºåˆ—åªèƒ½è¢«ä¸€ä¸ª View æ‹¦æˆªä¸”æ¶ˆè€—ã€‚è¿™ä¸€å¥—å“¦çš„åŽŸå› å¯ä»¥å‚è€ƒ 3ï¼Œ å› ä¸ºä¸€æ—¦ä¸€ä¸ªå…ƒç´ æ‹¦æˆªäº†æŸä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªäº‹ä»¶åºåˆ—å†…çš„æ‰€æœ‰äº‹ä»¶éƒ½ä¼šç›´æŽ¥äº¤ç»™å®ƒå¤„ç†ï¼Œå› æ­¤åŒä¸€ä¸ªäº‹ä»¶åºåˆ—ä¸­çš„äº‹ä»¶ä¸èƒ½åˆ†åˆ«ç”±ä¸¤ä¸ª View åŒæ—¶å¤„ç†ï¼Œä½†æ˜¯é€šè¿‡ç‰¹æ®Šæ‰‹æ®µå¯ä»¥åšåˆ°ï¼Œæ¯”å¦‚ä¸€ä¸ª View å°†æœ¬è¯¥è‡ªå·±å¤„ç†çš„äº‹ä»¶ï¼Œé€šè¿‡ onTouchEventå¼ºè¡Œä¼ é€’ç»™å…¶ä»– View å¤„ç†ï¼› æŸä¸ª View ä¸€æ—¦å†³å®šæ‹¦æˆªï¼Œé‚£ä¹ˆè¿™ä¸€ä¸ªäº‹ä»¶åºåˆ—éƒ½åªèƒ½ç”±å®ƒæ¥å¤„ç†ï¼ˆå¦‚æžœèƒ½ä¼ é€’åˆ°ä»–çš„è¯ï¼‰ï¼Œå¹¶ä¸”å®ƒçš„ onInterceptTouchEvent ä¸ä¼šå†è¢«è°ƒç”¨ã€‚ æŸä¸ª View ä¸€æ—¦å¼€å§‹å¤„ç†äº‹ä»¶ï¼Œå¦‚æžœå®ƒä¸æ¶ˆè€— ACTION_DOWN äº‹ä»¶ï¼ˆonTouchEvent è¿”å›ž falseï¼‰ï¼Œ é‚£ä¹ˆåŒä¸€äº‹ä»¶åºåˆ—ä¸­çš„å…¶ä»–äº‹ä»¶éƒ½ä¸ä¼šå†äº¤ç»™å®ƒæ¥å¤„ç†ï¼Œå¹¶ä¸”äº‹ä»¶å°†ä¼šé‡æ–°äº¤ç”±å®ƒçš„çˆ¶å…ƒç´ åŽ»å¤„ç†ï¼Œå³çˆ¶å…ƒç´ çš„ onTouchEvent ä¼šè¢«è°ƒç”¨ï¼Œæ„æ€å°±æ˜¯äº‹ä»¶ä¸€æ—¦äº¤ç”±ä¸€ä¸ª View å¤„ç†ï¼Œé‚£ä¹ˆå®ƒå°±å¿…é¡»æ¶ˆè€—æŽ‰ï¼Œå¦åˆ™åŒä¸€äº‹ä»¶åºåˆ—ä¸­çš„å‰©ä¸‹çš„äº‹ä»¶å°±ä¸åœ¨äº¤ç»™ä»–æ¥å¤„ç†äº†ã€‚ å¦‚æžœ View ä¸æ¶ˆè€—é™¤ ACTION_DOWN ä»¥å¤–çš„å…¶ä»–äº‹ä»¶ï¼Œ é‚£ä¹ˆè¿™ä¸ªç‚¹å‡»äº‹ä»¶ä¼šæ¶ˆå¤±ï¼Œæ­¤æ—¶çˆ¶å…ƒç´ çš„ onTouchEvent å¹¶ä¸ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”å½“å‰ View å¯ä»¥æŒç»­å—åˆ°åŽç»­çš„äº‹ä»¶ï¼Œæœ€ç»ˆè¿™äº›æ¶ˆå¤±çš„ç‚¹å‡»äº‹ä»¶ä¼šä¼ é€’ç»™ Activity å¤„ç†ã€‚ ViewGroup é»˜è®¤ä¸æ‹¦æˆªä»»ä½•äº‹ä»¶ï¼ŒAndroid æºç ä¸­ ViewGroup çš„ onInterceptTouchEvent æ–¹æ³•é»˜è®¤è¿”å›ž falseã€‚ View æ²¡æœ‰ onInterceptTouchEvent æ–¹æ³•ï¼Œä¸€æ—¦æœ‰ç‚¹å‡»äº‹ä»¶ä¼ é€’ç»™ä»–ï¼Œé‚£ä¹ˆä»–çš„ onTouchEvent æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚ View çš„ onTouchEvent æ–¹æ³•é»˜è®¤ä¼šæ¶ˆè€—æŽ‰äº‹ä»¶ï¼ˆè¿”å›ž trueï¼‰ï¼Œé™¤éžä»–æ˜¯ä¸å¯ç‚¹å‡»çš„ï¼ˆclickable å’Œ longClickable åŒæ—¶ä¸º falseï¼‰ã€‚View çš„ longClickable å±žæ€§é»˜è®¤éƒ½æ˜¯ falseï¼Œclickable å±žæ€§è¦åˆ†æƒ…å†µï¼Œæ¯”å¦‚ Button çš„ clickable å±žæ€§é»˜è®¤æ˜¯ trueï¼Œè€Œ TextView çš„ clickable é»˜è®¤æœª falseã€‚ View çš„ enable å±žæ€§ä¸å½±å“ onTouchEvent çš„é»˜è®¤è¿”å›žå€¼ï¼Œå“ªæ€•ä¸€ä¸ª View æ˜¯ disable çŠ¶æ€ï¼Œåªè¦ä»–çš„ clickable æˆ–è€… longClickable æœ‰ä¸€ä¸ªä¸º trueï¼Œ é‚£ä¹ˆä»–çš„ onTouchEvent å°±è¿”å›žtrueã€‚ onClick ä¼šå‘ç”Ÿçš„å‰ææ˜¯ View æ˜¯å¯ç‚¹å‡»çš„ï¼Œå¹¶ä¸”å®ƒæ”¶åˆ°äº† down å’Œ up äº‹ä»¶ã€‚ äº‹ä»¶ä¼ é€’è¿‡ç¨‹æ˜¯æœ‰å¤–å‘å†…çš„ï¼Œå³äº‹ä»¶æ€»æ˜¯å…ˆä¼ é€’ç»™çˆ¶å…ƒç´ ï¼Œç„¶åŽåœ¨ç”±çˆ¶å…ƒç´ åˆ†å‘ç»™å­ Viewï¼Œé€šè¿‡ requestDisallowInterceptTouchEvent æ–¹æ³•å¯ä»¥åœ¨å­å…ƒç´ ä¸­å¹²é¢„çˆ¶å…ƒç´ çš„äº‹ä»¶åˆ†å‘è¿‡ç¨‹ï¼Œä½†æ˜¯ ACTION_DOWN äº‹ä»¶é™¤å¤–ï¼ˆè§£å†³æ»‘åŠ¨å†²çªï¼Œå†…éƒ¨æ‹¦æˆªæ³•ï¼‰ã€‚ äº‹ä»¶çš„ä¼ é€’è¿‡ç¨‹ï¼šActivity -&gt; Window(PhoneWindow) -&gt; View -&gt; dispatchTouchEvent -&gt; onInterceptTouchEvent -&gt; onTouchEventã€‚ å½“ä¸€ä¸ª View éœ€è¦å¤„ç†äº‹ä»¶æ—¶ï¼Œå¦‚æžœå®ƒè®¾ç½®äº† onTouchListenerï¼Œé‚£ä¹ˆ onTouchListener ä¸­çš„ onTouch æ–¹æ³•ä¼šè¢«å›žè°ƒã€‚è¿™æ—¶äº‹ä»¶å¦‚ä½•å¤„ç†è¦çœ‹ onTouch çš„è¿”å›žå€¼ï¼Œè¿”å›ž falseï¼Œåˆ™å½“å‰ View çš„ onTouchEvent è¢«è°ƒç”¨ï¼Œtrueï¼Œ åˆ™ä¸è°ƒç”¨ã€‚View çš„ onTouchListener æ–¹æ³•ä¼˜å…ˆçº§é«˜äºŽ onTouchEventï¼›onClickListenerï¼ˆéœ€è¦å®Œæˆæœ‰ up æ“ä½œï¼‰ æ–¹æ³•åœ¨ onTouchEvent ä¸­è¢«è°ƒç”¨ï¼Œå› æ­¤ï¼ŒonClickListener å¤„äºŽäº‹ä»¶ä¼ é€’çš„å°¾ç«¯ã€‚]]></content>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android åœ¨ä¸€ä¸ªåº”ç”¨ä¸­å¯åŠ¨å¦å¤–ä¸€ä¸ªåº”ç”¨]]></title>
    <url>%2F2019%2F04%2F16%2FAndroid-%E5%9C%A8%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8%E4%B8%AD%E5%90%AF%E5%8A%A8%E5%8F%A6%E5%A4%96%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8%2F</url>
    <content type="text"><![CDATA[Android åœ¨ä¸€ä¸ªåº”ç”¨ä¸­å¯åŠ¨å¦å¤–ä¸€ä¸ªåº”ç”¨Android ä¸­,ä»Žå½“å‰ APP å¯åŠ¨å¦å¤–ä¸€ä¸ª APP çš„éœ€æ±‚,ä¸æ˜¯å¾ˆå¸¸è§, ä½†ç¡®å®žå­˜åœ¨ç€,æ¯”å¦‚è¯´åœ¨æŸå®è¿˜æ²¡æœ‰çŽ°åœ¨è¿™ä¹ˆå¼ºå¤§æ—¶,æ”¯ä»˜éœ€è¦å¯åŠ¨ä»–ä»¬çš„ APP. å†æ¯”å¦‚è¯´,æŸç±³çš„é’±åŒ…ç³»ç»Ÿ,éœ€è¦å’Œä»–ä»¬çš„é‡‘èž APP åœ¨æŸäº›ä¸šåŠ¡ä¸Šæ˜¯ç›¸äº’ä¾èµ–çš„,éœ€è¦ç›¸äº’å¯åŠ¨. ç»¼ä¸Šæ‰€è¿°, ä»Žä¸€ä¸ª APP åŽ»å¯åŠ¨å¦å¤–ä¸€ä¸ª APP çš„éœ€æ±‚è¿˜æ˜¯æœ‰å®ƒå­˜åœ¨çš„ä»·å€¼.å› æ­¤,ä¸€ä¸‹æ˜¯æˆ‘åœ¨å·¥ä½œå’Œå­¦ä¹ ä¸­æ€»ç»“çš„å¦‚ä½•é€šè¿‡ä¸€ä¸ª APP åŽ»å¯åŠ¨å¦å¤–ä¸€ä¸ª APP çš„æ–¹å¼. 1. é€šè¿‡ APP å¯åŠ¨å¦ä¸€ä¸ª APP1234String packageName = &quot;com.android.calendar&quot;;Intent intent = getPackageManager().getLaunchIntentForPackage(packageName);intent.putExtra(&quot;type&quot;, true);startActivity(intent); ä¸Šé¢çš„ä»£ç ,å°±å¯ä»¥å®Œæˆä»Žä¸€ä¸ª APP å¯åŠ¨å¦ä¸€ä¸ª APP çš„ä¸šåŠ¡éœ€æ±‚, è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯,æˆ‘ä»¬éœ€è¦æ£€æµ‹ä¸€ä¸‹è¦å¯åŠ¨çš„ APP æ˜¯å¦å·²ç»å®‰è£…,å¦‚æžœåº”ç”¨æœªå®‰è£…, åˆ™ä¼š NullPointException. é€šè¿‡è¿™ç§æ–¹å¼, Android è™šæ‹Ÿæœºä¼šè‡ªå·±åœ¨ç›®æ ‡ APP ä¸‹å¯»æ‰¾æ ‡ç­¾ä¸º android.intent.action.MAIN çš„ Activity å¯åŠ¨. è¿™é‡Œä»‹ç»ä¸¤ç§æ–¹å¼,æ£€æµ‹ç›®æ ‡åº”ç”¨æ˜¯å¦å·²ç»å®‰è£… æ–¹æ³•ä¸€: 1234Intent intent = getPackageName().getLaunchIntentForPackage(packageName);if (intent == null) &#123; // è¿™é‡Œåˆ¤æ–­ Intent ä¸ºç©º, è¯´æ˜Žåº”ç”¨ä¸å­˜åœ¨ &#125; æ–¹æ³•äºŒ: 1234PackageInfo packageInfo = getPackageManager(0.getPackageInfo(packageName, 0);if (packageInfo == null) &#123; // è¿™é‡Œå¦‚æžœ packageInfo ä¸º null, è¯´æ˜Žåº”ç”¨ä¸å­˜åœ¨&#125; 2. æ‰“å¼€å¦å¤–ä¸€ä¸ª APP æŒ‡å®šçš„ Activity1234Intent intent = new Intent();ComponentName componeneName = new ComponeneName(&quot;com.android.calendar&quot;, &quot;com.android.calendar.LaunchActivity&quot;);intent.setComponent(componeneName);startActivity(intent); å€¼å¾—æ³¨æ„: éœ€è¦å°†ç›®æ ‡ Activity çš„ android:export=â€trueâ€ å±žæ€§åœ¨æ‰€å±žåº”ç”¨çš„ AndroidMainfest é‡Œè®¾ç½®ä¸º true, æ„æ€æ˜¯å½“å‰ Activity å…è®¸è¢«å¤–éƒ¨åº”ç”¨è®¿é—®, å¦åˆ™ä¼šæŠ¥é”™ 123Caused by: java.lang.SecurityException: Permission Denial: starting Intent &#123; cmp=com.example.fm/.MainFragmentActivity (has extras) &#125; from ProcessRecord&#123;39282a97 11545:com.xing.toolbardemo1/u0a71&#125; (pid=11545, uid=10071) not exported from uid 10067 åœ¨ 5.0 ä»¥å‰çš„è®¾å¤‡ä¸Š,éœ€è¦åœ¨å½“å‰çš„ AndroidMainfest é‡Œä¹Ÿç”Ÿå‘½ç›®æ ‡Activity, å¦åˆ™ä¼šæŠ¥é”™; ä½†åœ¨ 5.0 ä»¥åŽçš„è®¾å¤‡ä¸Š,å°±ä¸ä¼šæŠ¥é”™å“¦ 12 Caused by: android.content.ActivityNotFoundException: Unable to find explicit activity class &#123;com.example.fm/com.example.fm.MainFragmentActivity&#125;; have you declared this activity in your AndroidManifest.xml?]]></content>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android Studio Dependencies Library Resolve]]></title>
    <url>%2F2019%2F04%2F16%2FAndroid-Studio-Dependencies-Library-Resolve%2F</url>
    <content type="text"><![CDATA[åœ¨ä½¿ç”¨ Android Studio å¼€å‘æ—¶,ä½¿ç”¨ Gradle è„šæœ¬æž„å»ºé¡¹ç›®, åŒ Maven ä¸€æ ·,æ‰€å¼•ç”¨çš„åŒ…ä¹‹é—´ä¹Ÿå­˜åœ¨ç€ç›¸äº’ä¾èµ–çš„å…³ç³», å½“ä½ ä½¿ç”¨æŸä¸ªåŒ…ä¹‹åŽ,å‘çŽ°æœ‰åŒ…ç‰ˆæœ¬å†²çª, é‚£ä¹ˆè§£å†³æ–¹æ¡ˆå°±æ¥äº†. å…ˆè¯´ç‚¹ä¸æ­£ç»çš„: ä½ å¯ä»¥æŠŠä½ è‡ªå·±å¼•å…¥çš„åŒ…åŽ»æŽ‰,ä½¿ç”¨ä¾èµ–åŒ… æ”¾å¼ƒæ²»ç–— å“ˆå“ˆ,è¨€å½’æ­£ä¼ : å½“æˆ‘ä»¬å¼•å…¥çš„åŒ…ä¹‹é—´å­˜åœ¨å†²çª(ä¸æ˜¯åŒä¸€ä¸ª)çš„å…³ç³»æ—¶, ä¹Ÿå°±æ˜¯è¯´,æˆ‘ä»¬éœ€è¦ä¿ç•™ä¸€ä¸ªé¡¹ç›®ä¾èµ–åŒ…ä½¿ç”¨,é‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ build.gradle ä¸­å°†æˆ‘ä»¬ä¸éœ€è¦çš„åŒ…åˆ é™¤æŽ‰. ä¸¾ä¸ªæ —å­:å½“æˆ‘ä½¿ç”¨ com.squareup.retrofit2:adapter-rxjava:2.1.0 æ—¶, å®ƒé»˜è®¤ä¾èµ–ä½¿ç”¨ RxJava 1.5.0 ç‰ˆæœ¬. å½“æˆ‘ä½¿ç”¨ io.reactivex.rxjava2:rxjava:2.0.6 æ—¶, å°±ä¼šå¼•èµ·åŒ…å†²çª. è§£å†³æ–¹æ¡ˆ:build.gradle 1234567891011...dependencies &#123; compile fileTree(include: [&apos;*.jar&apos;], dir: &apos;libs&apos;) compile (&apos;com.squareup.retrofit2:adapter-rxjava:2.1.0&apos;)&#123; exclude group: &apos;io.reactivex&apos; &#125; compile &apos;io.reactivex.rxjava2:rxjava:2.0.6&apos; compile &apos;io.reactivex.rxjava2:rxandroid:2.0.1&apos;&#125;]]></content>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[git command]]></title>
    <url>%2F2019%2F04%2F16%2Fgit-command%2F</url>
    <content type="text"><![CDATA[Git å‘½ä»¤ ä¿®æ”¹è®°å½• ä¿®æ”¹æ—¶é—´ å¤‡æ³¨ æ·»åŠ åˆ é™¤è¿œç¨‹åˆ†æ”¯ 2018å¹´07æœˆ26æ—¥13:59:22 åˆ é™¤è¿œç¨‹åˆ†æ”¯å‘½ä»¤ æ›´æ–°forkä»“åº“ 2018å¹´08æœˆ10æ—¥14:16:08 æ·»åŠ forkçš„ä»“åº“ï¼Œä»Žä¸»ä»“åº“æ›´æ–°ä»£ç çš„å‘½ä»¤ æ•´ç†çš„è¿˜ä¸å¤Ÿå®Œå–„ï¼Œä»¥åŽå·¥ä½œä¸­é‡åˆ°äº†ä¼šä¸æ–­è¡¥è¿›ï¼Œå¦‚æœ‰å¤§ç¥žï¼Œæœ‰å¯ä»¥ç•™è¨€ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥å®Œå–„ã€‚æ¬¢è¿Žå„ä½ç•™è¨€^_^ Git æ–‡ä»¶çš„ä¸‰ç§çŠ¶æ€ å·²æäº¤ï¼šè¡¨ç¤ºè¯¥æ–‡ä»¶å·²ç»è¢«å®‰å…¨åœ°ä¿å­˜åœ¨æœ¬åœ°ç‰ˆæœ¬åº“ä¸­ï¼Œæ‰§è¡Œè¿‡git commitã€‚ å·²ä¿®æ”¹ï¼šè¡¨ç¤ºä¿®æ”¹äº†æŸä¸ªæ–‡ä»¶ï¼Œä½†è¿˜æ²¡æœ‰æäº¤ä¿å­˜ å·²æš‚å­˜ï¼šè¡¨ç¤ºæŠŠå·²ä¿®æ”¹çš„æ–‡ä»¶æˆ¿å­å•Šä¸‹æ¬¡æäº¤æ—¶è¦ä¿å­˜çš„æ¸…å•ä¸­ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œäº† git add å‘½ä»¤ã€‚ è¿œç¨‹ä»“åº“ä¸Žæœ¬åœ°ä»£ç çš„é…ç½®å°†æœ¬åœ°å·²ç»æœ‰çš„é¡¹ç›®ä¸Šä¼ åˆ°è¿œç¨‹ç©ºä»“åº“ä¸­ 123456cd &lt;project path&gt;git initgit remote add origin &lt;è¿œç¨‹ä»“åº“åœ°å€&gt;git add .git commit -m &apos;æäº¤æ—¥å¿—&apos;git push -u origin master Git åŸºæœ¬é…ç½® é…ç½®ä¸ªäººçš„ç”¨æˆ·åç§°å’Œç”µå­é‚®ä»¶åœ°å€ï¼Œæ¯æ¬¡æäº¤æ—¶ï¼Œéƒ½ä¼šå¼•ç”¨è¿™ä¸¤æ¡ä¿¡æ¯ï¼Œä»¥ç”¨æ¥è¯´æ˜Žæ˜¯è°æäº¤çš„æ›´æ–°ã€‚ ä½¿ç”¨ --global é€‰é¡¹ï¼Œæ›´æ”¹çš„æœªç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„é…ç½®ï¼Œå¦‚æžœæƒ³åœ¨æŸä¸ªç‰¹å®šçš„é¡¹ç›®ä¸­ä½¿ç”¨å…¶ä»–çš„åç§°å’Œé‚®ä»¶ï¼Œåªéœ€è¦åŽ»æŽ‰ --global é€‰é¡¹é‡æ–°é…ç½®ï¼Œæ–°çš„é…ç½®ä½äºŽå½“å‰é¡¹ç›®çš„ .git/config æ–‡ä»¶ä¸­ã€‚ 12git config --global user.name &apos;&apos;yourname&apos;&apos;git config --global user.email yourname@gmail.com åŸºç¡€å‘½ä»¤ git init é€šè¿‡æ­¤å‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ª.gitçš„éšè—ç›®å½•ï¼Œè¿™æ˜¯gitçš„ç¬¬ä¸€æ­¥ã€‚ git status git statusæ˜¯æœ€ä¸ºå¸¸ç”¨çš„å‘½ä»¤ä¹‹ä¸€ï¼Œç”¨äºŽæ£€æŸ¥æœ¬åœ°é¡¹ç›®çš„çŠ¶æ€.ä»”ç»†é˜…è¯»çº¢è‰²/ç»¿è‰²éƒ¨åˆ†ï¼Œå¯ä»¥èŽ·å¾—ç›¸å…³æ–‡ä»¶çš„æ“ä½œä¿¡æ¯ï¼Œæ ¹æ®æç¤ºï¼Œåˆ¤æ–­æ˜¯æ‰§è¡Œgit commit è¿˜æ˜¯æ‰§è¡Œgit add æ“ä½œã€‚ git add å°†ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶æ·»åŠ åˆ° gitä»“åº“ä¸­ï¼Œåªæœ‰é€šè¿‡ git add æ·»åŠ çš„æ–‡ä»¶æ‰ä¼šè¢«ç‰ˆæœ¬æŽ§åˆ¶ç®¡ç†ã€‚ æ·»åŠ å•ä¸ªæ–‡ä»¶ git add HelloWorld2.java æ·»åŠ å¤šä¸ªæ–‡ä»¶ git add --a æ·»åŠ å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ git add . git rm â€“cached å°†æ–‡ä»¶ä»Žgitè¿½è¸ªåˆ—è¡¨ä¸­ç§»é™¤ï¼Œåªæ˜¯é€»è¾‘åˆ é™¤ï¼ˆä»Žç‰ˆæœ¬åº“ä¸­ç§»é™¤ï¼‰ï¼Œå¹¶ä¸ä¼šå°†æœ¬åœ°æ–‡ä»¶åˆ é™¤ git commit æ‰§è¡Œè¿‡ git add å‘½ä»¤åŽï¼Œéœ€è¦å°†æš‚å­˜çš„æ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“ä¸­ï¼Œæ­¤æ—¶æ˜¯çœŸæ­£çš„æäº¤ å¸¦ log çš„æäº¤ï¼š git commit -m &#39;first commit&#39; é€šè¿‡ç¼–è¾‘å™¨æäº¤: git commit å¸¦log çš„æäº¤æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†å½“ä½ çš„æäº¤ä¿¡æ¯æœ‰ä¸€å®šæ ¼å¼æˆ–è€…éœ€è¦æäº¤çš„æ–‡å­—å†…å®¹è¾ƒå¤šæ—¶ï¼Œä½¿ç”¨ç¼–è¾‘å™¨æ•ˆæžœä¼šæ›´å¥½. git log æŸ¥çœ‹åŽ†å²æäº¤è®°å½•ï¼Œ åŒ…æ‹¬æäº¤äººã€æ—¶é—´ã€ä¿¡æ¯ã€ä¿¡æ¯æŒ‡çº¹ç­‰. æŸ¥çœ‹æäº¤è®°å½•ï¼š git log å•è¡Œå±•ç¤ºè®°å½•ï¼š git log --pretty=oneline å±•ç¤ºå…¨éƒ¨ä¿¡æ¯ï¼š git log --pretty=fuller git clone &lt;è¿œç¨‹ä»“åº“åœ°å€&gt; æ‹‰å–è¿œç¨‹ä»“åº“ä»£ç ,æ­¤é¡¹ç›®å¹¶ä¸ä¸€å®šæ˜¯ä½ æ‰€åˆ›å»º ä¾‹å¦‚ï¼š git clone git@github.com:bboyfeiyu/AndroidEventBus.git æ‰§è¡Œå®ŒæˆåŽï¼Œä¼šåœ¨æœ¬åœ°å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªAndroidEventBusçš„ç›®å½•æ¥å­˜æ”¾ä»“åº“ä»£ç  git remote å°†æœ¬åœ°å·²ç»initè¿‡çš„å·¥ç¨‹é“¾æŽ¥åˆ°è¿œç¨‹çš„ç©ºä»“åº“ä¸­ï¼Œä»¥æ­¤æ¥å®Œæˆè¿œç¨‹ç‰ˆæœ¬åº“çš„åˆ›å»º é“¾æŽ¥è¿œç¨‹ç‰ˆæœ¬åº“ï¼š git remote add origin &lt;è¿œç¨‹åœ°å€&gt; git remote set-url &lt;ä»“åº“åœ°å€&gt; SSH å’Œ HTTPS æ–¹å¼åˆ‡æ¢ 1234# ssh to https$ git remote set-url origin https://github.com/USERNAME/repository.git# https to ssh$ git remote set-url origin git@github.com:USERNAME/repository.git å¯ä»¥ä½¿ç”¨ git remote -v æ¥æ£€æŸ¥å½“å‰ä»“åº“åœ°å€ 12&gt; origin git@github.com:username/repository.git (fetch)&gt; origin git@github.com:username/repository.git (push) SSH å’Œ HTTPS çš„åŒºåˆ«ï¼š ä½¿ç”¨ SSH æ–¹å¼éœ€è¦åœ¨æœ¬åœ°é…ç½®ä¸€ä¸ªå¯†é’¥ï¼Œå…·ä½“å¯å‚è§å¤šä¸ª SSH å…¬é’¥æäº¤ä»£ç åˆ°ä¸åŒå¹³å°ä¸­ä»‹ç»ï¼›è€Œä½¿ç”¨ HTTPS çš„æ–¹å¼æ“ä½œç®€å•ï¼Œå¼Šç«¯æ˜¯éœ€è¦ç»å¸¸è¾“å…¥å¯†ç ã€‚ git branch åˆ†æ”¯æ˜¯ç”¨æ¥ç®¡ç†ä»£ç ç‰ˆæœ¬ã€ç±»åž‹çš„æœ‰æ•ˆå·¥å…·ï¼Œå¯æ ¹æ®ä¸åŒçš„æœåŠ¡å¯¹è±¡ã€ä¸åŒçš„ä¸Šçº¿ç‰ˆæœ¬ç­‰ç­‰ï¼Œæ¥åšä»£ç åˆ†ç¦»ï¼Œç‰ˆæœ¬ç®¡ç†æ“ä½œ æŸ¥çœ‹åˆ†æ”¯ï¼š git branch æŸ¥çœ‹å¸¦æäº¤ä¿¡æ¯çš„åˆ†æ”¯ä¿¡æ¯ï¼š git branch -v åˆ›å»ºåˆ†æ”¯ï¼š git branch &lt;åˆ†æ”¯åç§°&gt; åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯ï¼š git branch -b &lt;åˆ†æ”¯åç§°&gt; åˆ‡æ¢åˆ†æ”¯ï¼š git checkout &lt;åˆ†æ”¯åç§°&gt; æŽ¨é€åˆ†æ”¯ï¼š git push origin &lt;åˆ†æ”¯åç§°&gt; åˆ é™¤åˆ†æ”¯ï¼š git branch -d &lt;åˆ†æ”¯åç§°&gt; åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š git push origin :&lt;åˆ†æ”¯åç§°&gt; åˆå¹¶åˆ†æ”¯ï¼š git merge &lt;åˆ†æ”¯åç§°&gt; git push æŽ¨é€æœ¬åœ°ä¿®æ”¹åˆ°è¿œç«¯æœåŠ¡å™¨ git push origin master æœ‰æ—¶å› ä¸¤ä¸ªç‹¬ç«‹çš„åŽ†å²ï¼Œä¼šå¯¼è‡´æŽ¨é€æ— æ³•è¾¾æˆï¼Œ é€šå¸¸åœ¨ git pull æ—¶ä¼šæç¤º fatal: refusing to merge unrelated histories // æ‹’ç»åˆå¹¶æ— å…³åŽ†å² è¿™æ—¶å¯æ˜¯ä½¿ç”¨ git pull origin master --allow-unrelated-histories æ¥è§£å†³ã€‚ git tag ä¼šåˆ—å‡ºæ‰€æœ‰çš„ tag æ ‡ç­¾ä¿¡æ¯ åœ¨å®Œæˆäº†æ‰€æœ‰åŠŸèƒ½ã€å¹¶ä¸”ç»è¿‡æµ‹è¯•ä¹‹åŽï¼Œå¯ä»¥å°æ¿ä¸Šçº¿çš„ç‰ˆæœ¬ï¼Œé€šå¸¸ä¼šæ‰“ä¸€ä¸ªæ ‡ç­¾ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½ å»ºè®®æ¯æ¬¡ä¸Šçº¿éƒ½è¦åšä¸€æ¬¡ï¼Œä¾¿äºŽåŽç»­çš„ç‰ˆæœ¬æ£€ç´¢ä¸Žç»´æŠ¤ï¼Œé€šå¸¸ä¸€ä¸ªæ ‡ç­¾å°±ä»£è¡¨äº†ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬ã€‚ æŸ¥çœ‹æœ¬åœ°/è¿œç¨‹ tag æ ‡ç­¾ï¼šgit tag æŸ¥çœ‹æ¨¡ç³Š tag æ ‡ç­¾ï¼š git tag -l &#39;v1.4.2.*&#39; æŸ¥çœ‹å¤‡æ³¨ tag æ ‡ç­¾ï¼š git tag -ln æŸ¥çœ‹æ ‡ç­¾ä¿¡æ¯ï¼š git show &lt;æ ‡ç­¾å&gt; åˆ›å»ºæœ¬åœ° tag æ ‡ç­¾ï¼š git tag -a &lt;æ ‡ç­¾å&gt; -m &quot;&lt;æ ‡ç­¾å¤‡æ³¨ä¿¡æ¯&gt;&quot; åˆ é™¤æœ¬åœ° tag æ ‡ç­¾ï¼š git tag -d &lt;æ ‡ç­¾å&gt; æŽ¨é€è¿œç¨‹ tag æ ‡ç­¾ï¼š git push origin &lt;æ ‡ç­¾å&gt; æŽ¨é€å…¨éƒ¨ tag æ ‡ç­¾ï¼š git push origin -tags åˆ é™¤è¿œç¨‹ tag æ ‡ç­¾ï¼š git push origin :refs/tags/&lt;æ ‡ç­¾å&gt; æŸ¥çœ‹è¿œç¨‹æœºçŠ¶æ€ git remote ç”¨æ¥ç®¡ç†ï¼Œ fork çš„é¡¹ç›®ï¼Œä¸Žä¸»é¡¹ç›®çš„æ›´æ–°æ“ä½œ 12345git remote -vgit remote add upstream git@github.com:XXX/XXX.gitgit fetch upstreamgit merge upstream/mastergit push ä½¿ç”¨ä¸­çš„ä¸€äº›æŠ€å·§å‘½ååˆ«åå¤æ‚å¹¶è¶…é•¿çš„å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡èµ·åˆ«åçš„æ–¹å¼æ–¹ä¾¿åœ¨ç»ˆç«¯ä¸­ä¹¦å 123git config --global alias.ci commitgit config --global alias.ck checkoutgit config --global alias.st status ç„¶åŽå°±å¯ä»¥å¾ˆæ„‰å¿«çš„ä½¿ç”¨gitå‘½ä»¤äº†ã€‚1git st]]></content>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¼€å‘ä¸€ä¸ªAndroid IoT App]]></title>
    <url>%2F2019%2F04%2F16%2F%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AAAndroid-IoT-App%2F</url>
    <content type="text"><![CDATA[æž„å»º Android IoT Appæœ¬æ–‡ç¿»è¯‘è‡ªBuilding IoT APP for Android Things in 3 step å‰è¨€è¿™ç¯‡æ–‡ç« ä¸»è¦æè¿°äº†ï¼Œå¦‚ä½•ä¸º Android Things æž„å»º Android IoT Appã€‚ ä¹Ÿè®¸ä½ æ—©å·²ç»çŸ¥é“äº†ï¼Œæœ€è¿‘ Google å‘å¸ƒäº†ä¸€ä¸ªæ–°çš„ IoT æ“ä½œç³»ç»Ÿâ€“ Android Thingsã€‚Android Things ç³»ç»Ÿï¼Œæ˜¯ç”± Android ç³»ç»Ÿè¡ç”Ÿå‡ºæ¥çš„ï¼Œæ›´æœ‰æ„æ€çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„ Android çŸ¥è¯†æ¥å¼€å‘ Android IoT åº”ç”¨ç¨‹åºã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œäº†è§£ Android Things and how it works æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ åè¯ç´¢å¼•Android IoT App ï¼š å®‰å“ç‰©è”ç½‘åº”ç”¨ Raspberry Pi 3 ï¼š æ ‘èŽ“æ´¾ 3 ç›®æ ‡è¿™ç¯‡æ–‡ç« çš„ç›®æ ‡æ˜¯ï¼š ä½¿ç”¨ Android Things æž„å»ºä¸€ä¸ªç®€å•çš„ RGB Led æŽ§åˆ¶å™¨ ä½¿ç”¨ Android API æž„å»º Android IoT UI å¼€å‘ æˆ‘ä»¬ä¼šä½¿ç”¨ Raspberry Pi 3 ä½œä¸º IoT å¼€å‘æ¿,ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„å¼€å‘æ¿åŽ»å¼€å‘ Android Thingsã€‚ æ­¤Android IoTåº”ç”¨å¯å¸®åŠ©æ‚¨ç†Ÿæ‚‰æ–°çš„Android Things APIã€‚ æ­¤å¤–ï¼Œè¿™ä¸ªç‰©è”ç½‘åº”ç”¨ç¨‹åºå¯¹äºŽå¼€å‘Android IoT åº”ç”¨ UI çš„æ¦‚è¿°å¾ˆæœ‰ç”¨ã€‚ æ­¥éª¤ä¸€é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ª IoT å·¥ç¨‹æœ‰ä¸¤éƒ¨åˆ†ï¼Œ ç”µæ°”/ç”µå­éƒ¨åˆ†å’Œè½¯ä»¶éƒ¨åˆ†ã€‚è®©äº‹æƒ…å˜å¾—ç®€å•ï¼Œä½¿æˆ‘ä»¬å¯ä»¥é›†ä¸­ç²¾åŠ›åœ¨Android IoT App, è¿™ä¸ª IoT åº”ç”¨æŽ§åˆ¶ç€ä¸€ä¸ªç®€å•çš„ RGB LED ï¼ˆå…±é˜³æžï¼‰ç¯ã€‚RGB Led ç¯ä½¿ç”¨220Î©ç”µé˜»é“¾æŽ¥åˆ° Raspberryï¼Œ æ¯ä¸ªé¢œè‰²ä¸€ä¸ªï¼ŒåŽŸç†å›¾å¦‚ä¸‹ï¼š å…±é˜³æž RGB LED ç¯éžå¸¸å¸¸è§ï¼Œå› æ­¤ Raspberry Pi 3 ä¸ºå¼•è„šé˜³æžä¾›ç”µã€‚æŽ§åˆ¶ LED é¢œè‰²çš„ RGB å¼•è„šè¿žæŽ¥åˆ° Raspberry å¼•è„šï¼š Pin 29 Pin 31 Pin 33 è¿™äº›å¼•è„šç´¢å¼•æ˜¯éžå¸¸é‡è¦çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šåœ¨ Android IoT App ä¸Šä½¿ç”¨å®ƒã€‚ ä¸Šç”µå‰ï¼Œè¯·ä»”ç»†æ£€æŸ¥ Raspberry é“¾æŽ¥æ˜¯å¦æœ‰å¼‚å¸¸ã€‚ çŽ°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ Android Studio åˆ›å»ºä¸€ä¸ª IoT åº”ç”¨ï¼Œç¬¬ä¸€æ­¥ï¼Œé…ç½® Android IoT å·¥ç¨‹ï¼Œ build.gradle : 123dependencies &#123; provided &apos;com.google.android.things:androidthings:0.1-devpreview&apos;&#125; Android Things ä½¿ç”¨ Activity ï¼Œå°±åƒæˆ‘ä»¬åœ¨ Android ä¸­ä½¿ç”¨ä¸€æ ·ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª RGBThingsActivity ç±»ï¼Œå¹¶åœ¨ onCreate æ–¹æ³•ä¸­å¤„ç† Pin é€šä¿¡ã€‚ æ­¥éª¤äºŒä½¿ç”¨ GPIO å¼•è„šä¸Ž RGB LED ä¼ é€’ä¿¡æ¯ã€‚ GPIO å¼•è„šä½¿ç”¨å¯ç¼–ç¨‹çš„æŽ¥å£åŽ»èŽ·å–è®¾å¤‡çš„çŠ¶æ€æˆ–è€…è®¾ç½®è¾“å‡ºå€¼ï¼ˆé«˜ç”µå¹³/ä½Žç”µå¹³ï¼‰ï¼Œä½¿ç”¨ Respberry GPIO éŸ³åŠå“¦å•Šï¼Œæˆ‘ä»¬å¼€å¯æˆ–å…³é—­ä¸‰ä¸ªé¢œè‰²çš„ç»„ä»¶ï¼ˆçº¢ç»¿è“ï¼‰ã€‚ Android Things SDK æä¾›äº†ä¸€ä¸ª PeripheralManagerService çš„æœåŠ¡ï¼ŒåŽ»æŠ½è±¡ GPIO é€šä¿¡æŽ¥å£ã€‚æ¯å½“æˆ‘ä»¬æƒ³è¯»å†™æ•°æ®æ—¶éƒ½å¿…é¡»ä½¿ç”¨å®ƒã€‚ä¸€å¼€å§‹ï¼Œ Android IoT App åˆå§‹åŒ–æœåŠ¡ï¼Œå¹¶è®¾ç½®å¼•è„šå€¼ï¼š 1234567891011121314try &#123; PeripheralManagerService manager = new PeripheralManagerService(); blueIO = manager.openGpio(&quot;BCM5&quot;); blueIO.setDirection(Gpio.DIRECTION_OUT_INITIALLY_LOW); greenIO = manager.openGpio(&quot;BCM6&quot;); greenIO.setDirection(Gpio.DIRECTION_OUT_INITIALLY_HIGH); redIO = manager.openGpio(&quot;BCM13&quot;); redIO.setDirection(Gpio.DIRECTION_OUT_INITIALLY_LOW); redIO.setValue(false); blueIO.setValue(false); greenIO.setValue(false);&#125; catch (IOException e) &#123; Log.w(TAG, &quot;Unable to access GPIO&quot;, e);&#125; è¿™æ®µä»£ç ä»‹ç»äº†ä¸€äº›æ–°çš„é‡è¦çš„æ–°æ–¹é¢ã€‚é¦–å…ˆ,æˆ‘ä»¬å¿…é¡»é€‰å¯¹å¼•è„šã€‚å¦‚æžœä½¿ç”¨çš„æ˜¯ Respberry ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ¯ä¸€ä¸ªå¼•è„šéƒ½æœ‰å¯¹åº”çš„åºå·ã€‚åŒæ ·çš„æ–¹å¼ï¼ŒAndroid Things ä½¿ç”¨ç›¸åŒçš„å¯»å€æ¨¡åž‹ï¼Œä¸ç®¡æ€Žæ ·ï¼Œå¼•è„šçš„å‘½åéƒ½æ˜¯ç”¨ä¸åŒçš„æ–¹å¼ã€‚é€šè¿‡ Respberry Pin reference ,ä¸‹å›¾ï¼š å¯ä»¥äº†è§£åˆ° Respberry Pi 3 çš„å¼•è„šåœ°å€ã€‚è¿™äº›åœ°å€åç§°åœ¨ä¸Šé¢çš„ä»£ç ä¸­ä½¿ç”¨ã€‚ ä¾‹å¦‚ï¼Œè¦ä½¿ç”¨å¼•è„šBCM5ï¼ˆæˆ–å¼•è„š29ï¼‰ï¼Œä»£ç ä¸ºï¼š 1blueIO = manager.openGpio(&quot;BCM5&quot;); å¼€å§‹ï¼Œ æˆ‘ä»¬è®¾ç½®æ‰€æœ‰çš„å¼•è„šä¸ºä½Žç”µå¹³çŠ¶æ€ï¼ˆä½Žç”µå¹³å³ä¸ºå…³é—­çŠ¶æ€ï¼‰ï¼Œæ­¤æ—¶ Led ç¯ä¸ºå…³é—­çŠ¶æ€ã€‚æ”¹å˜å¼•è„šçš„çŠ¶æ€å€¼ï¼Œç”±ä½Žç”µå¹³è°ƒæ•´åˆ°é«˜ç”µå¹³ï¼Œæˆ–è€…æœ‰é«˜ç”µå¹³è°ƒæ•´ä¸ºä½Žç”µå¹³ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¯çš„é¢œè‰²å˜åŒ–ã€‚ æ­¥éª¤ä¸‰Android Things å¦å¤–ä¸€ä¸ªæœ‰è¶£çš„åŠŸèƒ½æ˜¯ï¼Œä¸ºæˆ‘ä»¬æä¾›äº† UI Interfaceã€‚ æˆ‘ä»¬å¼€å‘ä¸€ä¸ª UI Interface ç»™ Android IoT App å’Œå¼€å‘ Android UI ä¸€æ ·ã€‚å°±åƒ Android app ä¸€æ ·ï¼Œ Android Things UI åŒæ ·æ˜¯ä½¿ç”¨ xml æ ¼å¼å¼€å‘ã€‚ ä¸‹é¢ä¾‹å­ï¼Œæˆ‘ä»¬åŽ»é…ç½®æŽ§åˆ¶ RGB Led æ˜¾ç¤ºçš„ 3 ä¸ªå¼€å…³ï¼š 12345678910111213141516171819202122232425&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:orientation=&quot;vertical&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot;&gt; &lt;Switch android:text=&quot;Red&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:id=&quot;@+id/switchRed&quot; android:layout_marginTop=&quot;20dp&quot;/&gt; &lt;Switch android:text=&quot;Green&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:id=&quot;@+id/switchGreen&quot; android:layout_marginTop=&quot;20dp&quot;/&gt; &lt;Switch android:text=&quot;Blue&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:id=&quot;@+id/switchBlue&quot; android:layout_marginTop=&quot;20dp&quot;/&gt; &lt;/LinearLayout&gt; åœ¨ onCreate æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è®¾ç½® layout å¸ƒå±€ï¼š 123456@Overridepublic void onCreate (Bundle savedInstanceState) &#123; super.onCreate(saveInstanceState); setContentView(R.layout.activity_main); ...&#125; å¤„ç†ç”¨æˆ·å¼€å…³ï¼š 1234567891011Switch switchRed = (Switch)findViewById(R.id.switchRed);switch.setOnCheckedChangedListener(new CompoundButton.OnCheckedChangedListener()&#123; @Override public void onCheckedChanged (CompoundButton buttonView, boolean isChecked)&#123; try &#123; redIO.setValue(!isChecked); &#125; catch (IOException e) &#123; Log.w(TAG,&quot;Red GPIO Error&quot;, e); &#125; &#125;&#125;); æˆ‘ä»¬å¿…é¡»ä¸ºå…¶ä»–å¼•è„šé‡å¤åŒä¸€æ®µä»£ç ã€‚æœ€ç»ˆç»“æžœå¦‚ä¸‹ï¼š å›  MarkDown æ¨¡å¼ä¸‹ï¼Œ ç®€ä¹¦ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ï¼Œè¯·ç‚¹å‡»ä¸€ä¸‹é“¾æŽ¥è§‚çœ‹ã€‚ æœ€ç»ˆç»“æžœå±•ç¤ºâ€“éœ€è¦ç¿»å¢™ youtube ä¸Šè§‚çœ‹ æœ€åŽï¼Œè¦ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ Manifest.xml æ–‡ä»¶ä¸­æ¡ä»¶ï¼š 1&lt;uses-library android:name=&quot;com.google.android.things&quot;/&gt; å¹¶ä¸”å£°æ˜Žæˆ‘çš„ Activity æ˜¯ä¸€ä¸ª IoT Activityï¼Œ å¯åŠ¨è„šæœ¬ä¸ºï¼š 1234&lt;intent-filter&gt; &lt;category android:name=&quot;android.intent.category.IOT_LAUNCHER&quot;/&gt; &lt;category android:name=&quot;android.intent.category.DEFAULTâ€/&gt;&lt;/intent-filter&gt; æ€»ç»“æ–‡ç« æœ€åŽï¼Œä½ å·²ç»çŸ¥é“äº†å¦‚ä½•æ›´å¥½çš„ä½¿ç”¨ Android Thingsã€‚ æœ‰è¶£çš„æ˜¯ï¼Œä½¿ç”¨ä¸€äº›æ–°çš„ API Android å¼€å‘äººå‘˜å¯ä»¥å‡†å¤‡ä¸‹ä¸€æ¬¡æŠ€æœ¯é©å‘½æˆä¸ºç‰©è”ç½‘ã€‚æ­¤å¤–ï¼Œå¼€å‘è¿‡ç¨‹ä¸Ž Android åº”ç”¨ç¨‹åºç›¸åŒã€‚ ä½¿ç”¨ç®€å•çš„å‡ è¡Œä»£ç ï¼Œä¸€ä¸ª Android å¼€å‘è€…å°±å¯ä»¥æž„å»º Android IoT App.]]></content>
      <tags>
        <tag>Android Things</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Jenkins + gradle + git æž„å»º Android CI æž„å»ºçŽ¯å¢ƒ]]></title>
    <url>%2F2019%2F04%2F16%2FJenkins-gradle-git-%E6%9E%84%E5%BB%BA-Android-CI-%E6%9E%84%E5%BB%BA%E7%8E%AF%E5%A2%83%2F</url>
    <content type="text"><![CDATA[å‰è¨€åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†æœ€æ–°çš„ä»£ç æ›´æ–°ï¼Œæä¾›ç»™æµ‹è¯•äººå‘˜è¿›è¡Œæµ‹è¯•ï¼Œä»¥åŠå‘å¸ƒã€‚ ç›®å‰ Android å·¥ä½œä¸­éƒ½åœ¨ä½¿ç”¨å¾ˆå¼ºå¤§çš„å¼€å‘ã€æž„å»ºä»¥åŠæ‰“åŒ…å·¥å…·ï¼Œä¾‹å¦‚ï¼š android-studioã€Gradleã€Gitç­‰ã€‚ ç„¶ï¼Œåœ¨ä¼ä¸šç»„ç»‡å¹¶ä¸æ˜¯å¾ˆå®Œå–„çš„å…¬å¸é‡Œï¼Œå¼€å‘æ‰“åŒ…å‘å¸ƒç­‰å·¥ä½œï¼Œæ—¶å¸¸ä¼šç”±å¼€å‘äººå‘˜è¿›è¡Œæ“ä½œï¼Œéš¾å…åœ¨ä¸€äº›åœ°æ–¹ç–å¿½æŽ‰ã€‚ å› æ­¤ï¼ŒCI æž„å»ºçš„å‡ºçŽ°ï¼Œä½¿å¾—è¿™äº›ç¹ççš„å·¥ä½œå˜å¾—è½»æ¾èµ·æ¥ã€‚ å¯¹äºŽå¼€å‘å·¥ç¨‹å¸ˆï¼Œåªè´Ÿè´£å‘ç‰ˆæœ¬åº“æäº¤ä»£ç ï¼Œä¸ç”¨å…³å¿ƒæ‰“åŒ…ï¼Œå‘å¸ƒä¹‹ç±»çš„æµç¨‹ã€‚ å¯¹äºŽäº§å“å’Œæµ‹è¯•ï¼Œåªéœ€è¦ä»Žå‘å¸ƒé¡µé¢ä¸‹è½½ APK å®‰è£…æ–‡ä»¶ï¼Œä¸éœ€è¦æ¯ä¸€æ¬¡éƒ½åŽ»å·¥ç¨‹å¸ˆå“ªé‡Œç´¢å–æœ€æ–°çš„å®‰è£…æ–‡ä»¶ã€‚ CI çš„åŸºæœ¬å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š æˆ‘ä»¬æ¯ä¸€æ¬¡æäº¤ä»£ç ï¼ˆé€šè¿‡git/svnä½œä¸ºç‰ˆæœ¬åº“ï¼‰åˆ°ä¸»å¹²ä¸Šï¼Œæ ¹æ® CI çš„å®šæ—¶ä»»åŠ¡ï¼Œæ£€æµ‹åˆ°ç‰ˆæœ¬æ›´æ–°ï¼Œé€šè¿‡ CI ï¼Œå°†è¿›è¡Œæ‰“åŒ…å‘å¸ƒç­‰æµç¨‹æ“ä½œã€‚ å‡†å¤‡å·¥ä½œæœ¬æ–‡ä½¿ç”¨ Linux Ubuntu ç³»ç»Ÿä¸ºå¤§å®¶ä»‹ç»çŽ¯å¢ƒçš„æ­å»º çŽ¯å¢ƒå·¥å…·1. PC æœº(mac/linux) 2. Java JDK 3. Android SDK 4. Gradle 5. Git 6. Tomcat 7. Jenkins çŽ¯å¢ƒæ­å»ºJava çŽ¯å¢ƒ å®‰è£…Java JDK, Android SDK, Gradle å¯ä»ŽAndroidDevToolså¤„ä¸‹è½½èŽ·å–ã€‚ git å®‰è£…git å¯é€šè¿‡ç»ˆç«¯è¿›è¡Œå®‰è£…123sudo add-apt-repository ppa:git-core/ppasudo apt-get updatesudo apt-get install git å®‰è£…å®Œæˆä¹‹åŽé€šè¿‡git --version æ£€æŸ¥æ˜¯å¦æˆåŠŸ å®‰è£…åŽ git å­˜å‚¨åœ¨ /usr/bin/gitä¸‹ Jenkinsé€šè¿‡ Jenkins å®˜æ–¹ç½‘ç«™ä¸‹è½½æœ€æ–°Jenkins.waråŒ… çŽ¯å¢ƒå˜é‡æ‰“å¼€ vi /etc/profile å°†ä¸‹åˆ—è¯­å¥æ·»åŠ åœ¨æ–‡ä»¶çš„æœ«å°¾åŽï¼Œ æ‰§è¡Œ esc-&gt;:wq å…¶ä¸­çŽ¯å¢ƒä½ç½®æ ¹æ®è‡ªå·±çš„æ‰€åœ¨ä½ç½®è¿›è¡Œç›¸åº”çš„æ›´æ”¹ å¯åŠ¨æ¿€åŠ¨çš„ä½ ï¼Œæ˜¯ä¸æ˜¯å·²ç»è¢«è¿™äº›ç¹ççš„ä¸œè¥¿æžçš„ä¸è€çƒ¦äº†å‘¢ï¼Œä¸‹é¢æˆ‘ä»¬å¼€å§‹å¯åŠ¨ Jenkins å°†ä¸‹è½½å¥½çš„ Jenkins.war åŒ…ï¼Œ æ”¾å…¥ Tomcat çš„ webapps ç›®å½•ä¸‹ï¼Œè¿›å…¥ bin ç›®å½•æ‰§è¡Œ ./startup.sh å¯åŠ¨ Tomcatã€‚ å¯åŠ¨åŽï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼š localhost:8080/jenkins æ’ä»¶å®‰è£…ç³»ç»Ÿç®¡ç†-&gt; æ’ä»¶ç®¡ç†-&gt;å¯é€‰æ’ä»¶ï¼š åœ¨æœç´¢æ¡†ä¸­æœç´¢ä»¥ä¸‹æ’ä»¶ï¼Œå¹¶è¿›è¡Œå®‰è£… git plugingitlab plugingrade pluginAndroid Lint PluginBuild Pipeline pluginbuild timeout pluginbuild name pluginchange assembly-version plugincredentials binding plugindescription setter pluginDynamic parameter pluginEmail Extension pluginFindBugs pluginJaCoco pluginUnit attachments pluginProject Description pluginTimestamperWorkspace cleanup plugin å®‰è£…å®ŒæˆåŽï¼Œé‡å¯ã€‚ ç³»ç»Ÿè®¾ç½®ç³»ç»Ÿç®¡ç†-&gt;ç³»ç»Ÿè®¾ç½®ï¼š é…ç½®Android çŽ¯å¢ƒï¼Œå°†åœ°å€æŒ‡å‘æœ¬æœºçš„ SDK ç›®å½• ç³»ç»Ÿç®¡ç†-&gt;å…¨å±€å·¥å…·é…ç½® é…ç½® Javaï¼Œ Git ï¼Œ Gradle ç›®å½•ç­‰ JDKï¼š Gitï¼š Gradleï¼š åˆ°æ­¤ï¼ŒçŽ¯å¢ƒé…ç½®ï¼Œå·²åŸºæœ¬å®Œæˆã€‚ ä¸‹é¢æˆ‘ä»¬å¼€å§‹è¿›è¡Œé¡¹ç›®å¤Ÿå°†æ“ä½œ é¡¹ç›®æž„å»ºåˆ›å»ºJobæ–°å»º-&gt;æž„å»ºä¸€ä¸ªè‡ªç”±é£Žæ ¼çš„è½¯ä»¶é¡¹ç›®: å‚æ•°åŒ–æž„å»ºé€šå¸¸æˆ‘ä»¬åœ¨ä½¿ç”¨ Android-studio è¿›è¡Œæ‰“åŒ…æ—¶ä»¥åŠç­¾åæ—¶ï¼Œéƒ½ä¼šç”¨åˆ°build.gradleå¹¶åœ¨å…¶ä¸­é…ç½®ç›¸å…³å±žæ€§ã€‚å†æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Jenkinsï¼Œé…ç½®æˆ‘ä»¬çš„é¡¹ç›®å‚æ•°ï¼Œä¾‹å¦‚å‘å¸ƒçš„ç‰ˆæœ¬å·ï¼Œæž„å»ºæ—¶é—´ï¼Œ ä¸Šä¼ è·¯å¾„ï¼Œå‘å¸ƒåœ°å€ï¼Œç­¾åæ‰“åŒ…ç­‰ç­‰ã€‚ åœ¨è¿™é‡Œæˆ‘ä»¬å…ˆçœ‹çœ‹ build.gradle ä¸­çš„æž„å»ºä¿¡æ¯: åœ¨é¡¹ç›®çš„ moudle ä¸‹ build.gradle æ–‡ä»¶1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768def getDate () &#123; def date = new Date() def formattedDate = date.format(&quot;yyyyMMddHHmm&quot;) return formattedDate&#125;def verName = APP_VERSIONdef verCode = 14android &#123; .... signingConfigs &#123; release &#123; keyAlias &apos;&apos; keyPassword &apos;&apos; storeFile file (&apos;&apos;) storePassword &apos;&apos; &#125; &#125; defaultConfig &#123; applicationId &quot;cn.zhuangbudong.example&quot; minSdkVersion 18 targetSdkVersion 25 multiDexEnabled true versionCode verCode versionName verName resValues(&quot;string&quot;, &apos;app_version&apos;, verName) &#125; buildTypes &#123; release &#123; signingConfig signingConfigs.release minifyEnabled false proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos; &#125; lintOptions &#123; abortOnError false &#125; dexOptions &#123; javaMaxHeapSize &apos;2g&apos; &#125;applicationVariants.all &#123; variant -&gt; variant.outputs.each &#123; output -&gt; def newName def timeNow def oldFile = output.outputFile def outDirectory = oldFile.parent if (&quot;true&quot;.equals(IS_JENKINS)) &#123; timeNow = JENKINS_TIME outDirectory = &quot;/media/nexd/work/android/package/release/&quot; newName = &apos;zhuangbudong_example_&apos; + verName + &quot;_&quot; + timeNow + &quot;_&quot; + variant.buildType.name + &quot;.apk&quot; &#125; else &#123; timeNow = getDate() if (variant.buildType.name.equals(&apos;debug&apos;)) &#123; newName = &apos;zhuangbudong_example_&apos; + verName + &quot;_debug.apk&quot; &#125; else &#123; newName = &apos;zhuangbudong_example_&apos; + verName + &quot;_&quot; + timeNow + &quot;_&quot; + variant.buildType.name + &quot;.apk&quot; &#125; &#125; output.outputFile = new File(outDirectory, newName) &#125;&#125; &#125;&#125; gradle.properties: 123APP_VERSION=2.0.2IS_JENKINS=falseJENKINS_TIME=&apos;&apos; åœ¨å·¥ç¨‹ä¸­æ·»åŠ ä»¥ä¸Šä»£ç ï¼Œå¹¶åœ¨Jenkinsä¸­ä¸ºè¿™äº›å‚æ•°èµ‹å€¼ã€‚ ä¸‹é¢ä»‹ç» Jenkins å‚æ•°é…ç½® å‹¾é€‰å‚æ•°åŒ–æž„å»ºè¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š æŒ‰ç…§ä¸‹å›¾ï¼Œæ·»åŠ ç›¸å…³ç±»åž‹çš„å‚æ•°ï¼Œæ­¤å¤„æ³¨æ„ï¼ŒJenkins é…ç½®çš„å‚æ•°åè¦å’Œåœ¨android-studioä¸­é…ç½®çš„å‚æ•°åä¿æŒä¸€è‡´ æºç ç®¡ç†æ­¤å¤„è´Ÿè´£ä»Žç‰ˆæœ¬åº“ä¸­æ‹‰åŽ»æœ€æ–°çš„ä»£ç  æ­¤å¤„å¦‚æžœéœ€è¦éªŒè¯ï¼Œç‚¹å‡» Addï¼Œ é€‰æ‹©ï¼š Username with password åœ¨å¯¹åº”çª—å£è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯ ç‚¹å‡»æ·»åŠ ã€‚ ä½¿ç”¨ gitlab è¿›è¡Œæºç åº“ç®¡ç†ã€‚ è§¦å‘å™¨è§¦å‘å™¨è´Ÿè´£æ‹‰å–ä»£ç ï¼Œç¼–è¯‘ï¼Œæ‰“åŒ…ï¼Œå‘å¸ƒç­‰æ“ä½œã€‚é€šè¿‡è§¦å‘å™¨ï¼Œæ‰§è¡ŒJenkinsã€‚ æž„å»ºçŽ¯å¢ƒæ­¤å¤„åªæ˜¯åœ¨Jenkinsåœ¨æ‰“åŒ…æ—¶ï¼Œé…ç½®ä»»åŠ¡åç§°å³å¯ã€‚å¦‚ä¸‹å›¾ï¼š æž„å»ºè¿™é‡Œæ˜¯æœ€é‡è¦æ»´ï¼Œé…ç½®ä»¥ä¸‹å‘½ä»¤ï¼Œæ‰èƒ½è¿›è¡Œæ‰“åŒ…ç­¾åç­‰ç­‰ã€‚ å¦‚ä¸‹é…ç½®ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸‹ï¼Œæž„å»ºæ–‡ä»¶ï¼Œæ ¹ç›®å½•ã€‚åœ¨ä½ çš„ç›®å½•ç»“æž„æ¯”è¾ƒå¤æ‚çš„æ—¶å€™ï¼Œå³ä½ çš„æ ¹ç›®å½•æ²¡æœ‰ build.gradle æ–‡ä»¶æ—¶ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸‹ build.gradle ç›®å½•çš„ä½ç½®ã€‚ åŒæ—¶ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼Œå‹¾é€‰ä¸Špass job parameters as gradle properties ï¼Œä¸ç„¶ä¹‹å‰é…ç½®çš„å‚æ•°æ— æ³•ä¼ é€’ç»™é¡¹ç›®ä¸­çš„ gradle.propertiesã€‚ æž„å»ºåŽæ“ä½œå½“é¡¹ç›®æž„å»ºå®ŒæˆåŽï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‚®ä»¶çš„æ–¹å¼å°†äº§ç”Ÿçš„Apkæ–‡ä»¶ï¼Œä»¥åŠæµ‹è¯•æŠ¥å‘Šï¼Œæž„å»ºæ—¥å¿—ç­‰ä¿¡æ¯ï¼Œå‘é€å‡ºæ¥ å¦‚ä¸‹å›¾ï¼š 12345678910111213&lt;hr/&gt;(æœ¬é‚®ä»¶æ˜¯ç¨‹åºè‡ªåŠ¨ä¸‹å‘çš„ï¼Œè¯·å‹¿å›žå¤ï¼)&lt;br/&gt;&lt;hr/&gt;é¡¹ç›®åç§°ï¼š$&#123;PROJECT_NAME&#125;&lt;br/&gt;&lt;hr/&gt;æž„å»ºç¼–å·ï¼š$&#123;BUILD_NUMBER&#125;&lt;br/&gt;&lt;hr/&gt;æž„å»ºçŠ¶æ€ï¼š$&#123;BUILD_STATUS&#125;&lt;br/&gt;&lt;hr/&gt;è§¦å‘åŽŸå› ï¼š$&#123;CAUSE&#125;&lt;br/&gt;&lt;hr/&gt;æµ‹è¯•æŠ¥å‘Šï¼š&lt;a href=&quot;$&#123;PROJECT_URL&#125;ws/$&#123;PROJECT_NAME&#125;app/build/reports/tests/release/index.html&quot;&gt;$&#123;PROJECT_URL&#125;ws/$&#123;PROJECT_NAME&#125;app/build/reports/tests/release/index.html&lt;/a&gt;&lt;br/&gt;&lt;hr/&gt;æž„å»ºæ—¥å¿—åœ°å€ï¼š&lt;a href=&quot;$&#123;BUILD_URL&#125;console&quot;&gt;$&#123;BUILD_URL&#125;console/&lt;/a&gt;&lt;br/&gt;&lt;hr/&gt;æž„å»ºåœ°å€ï¼š&lt;a href=&quot;$&#123;PROJECT_URL&#125;&quot;&gt;$&#123;PROJECT_URL&#125;&lt;/a&gt;&lt;br/&gt;&lt;hr/&gt;æž„å»ºæŠ¥å‘Šï¼š&lt;a href=&quot;$&#123;BUILD_URL&#125;testReport&quot;&gt;$&#123;BUILD_URL&#125;testReport&lt;/a&gt;&lt;br/&gt;&lt;hr/&gt;å˜æ›´é›†:$&#123;JELLY_SCRIPT,template=&quot;html&quot;&#125;&lt;br/&gt;&lt;hr/&gt; å¼€å§‹æž„å»ºå›žåˆ° Jenkins é¦–é¡µï¼Œç‚¹å‡»åˆ›å»ºçš„é¡¹ç›®ï¼Œç‚¹å‡» build with parameters: ç‚¹å‡»å¼€å§‹æž„å»ºï¼Œå¯åŠ¨ Jenkins æž„å»ºä»»åŠ¡ã€‚ æž„å»ºæˆåŠŸæ—¶ï¼Œæ˜¾ç¤ºä¸ºè“è‰²ï¼Œ å¤±è´¥ä¸ºçº¢è‰²ï¼Œå¦‚ä¸‹å›¾ï¼š æž„å»ºåŽç”Ÿæˆçš„ Apk æ–‡ä»¶ï¼Œå­˜åœ¨ build.gradle æ–‡ä»¶ä¸­é…ç½®çš„ç›®å½•ã€‚åŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨è’²å…¬è‹±æˆ–fir.im è¿›è¡Œå‘å¸ƒç®¡ç†ã€‚ è°¢è°¢~]]></content>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[adb command]]></title>
    <url>%2F2019%2F04%2F16%2Fadb-command%2F</url>
    <content type="text"><![CDATA[æŸ¥çœ‹PID 1adb shell ps æŸ¥çœ‹æ—¥å¿— 12345å…¨éƒ¨æ—¥å¿—adb logcatæŒ‰ç…§ PID ç­›é€‰æ—¥å¿—adb logcat | grep &lt;PID&gt; æŸ¥è¯¢é“¾æŽ¥è®¾å¤‡ 1adb devices é‡å¯æœºå™¨ 1adb reboot æ€æ­»è¿›ç¨‹æœåŠ¡ 1adb kill-server é‡å¯è¿›ç¨‹æœåŠ¡ 1adb start-server èŽ·å–æœºå™¨ Mac åœ°å€ 1adb shell cat /sys/class/net/wlan0/address å®‰è£… APK 12345678æ™®é€šå®‰è£…adb install &lt;file path&gt;ä¿ç•™æ•°æ®å’Œç¼“å­˜æ–‡ä»¶adb install -r &lt;file path&gt;å®‰è£…åˆ° SD å¡ä¸Šadb install -s &lt;file path&gt; å¸è½½ APK 12345æ™®é€šå¸è½½adb uninstall &lt;package name&gt;ä¿ç•™æ•°æ®å’Œç¼“å­˜æ–‡ä»¶adb uninstall -k &lt;package name&gt; å¯åŠ¨åº”ç”¨ 1adb shell am start -n &lt;package name&gt;/.&lt;activity_class_name&gt; æŸ¥çœ‹ CPU å ç”¨çŽ‡ 1234567adb shell topæŸ¥çœ‹å†…å­˜å ç”¨å‰ 6 çš„ appadb shell top -m 6åˆ·æ–°ä¸€æ¬¡å†…å­˜adb shell top -n 1 æ€æ­»è¿›ç¨‹ 1adb shell kill &lt;pid&gt; å°† System åˆ†åŒºé‡æ–°æŒ‚åœ¨ä¸ºå¯è¯»å†™åˆ†åŒº 1adb remount ä»Žæœ¬åœ°å¤åˆ¶æ–‡ä»¶åˆ°è®¾å¤‡ 1adb push &lt;local&gt; &lt;remote&gt; ä»Žè®¾å¤‡å¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ° 1adb pull &lt;remote&gt; &lt;local&gt; æŸ¥çœ‹ WiFi å¯†ç  1adb shell cat /data/misc/wifi/*.conf æŸ¥çœ‹ bug æŠ¥å‘Š 1adb bugreport è·‘ monkey 1adb shell monkey -v -p your.package.name 500 æˆªå›¾ 1adb shell screencap -p /sdcard/screenshot.png å½•å± 1adb shell screenrecord /sdcard/demo.mp4 æŸ¥çœ‹å®‰è£…åˆ—è¡¨ 1adb shell pm list packages å®‰è£…è¯ä¹¦ 1adb shell am start -n com.android.certinstaller/.CertInstallerMain -a android.intent.action.VIEW -t application/x-x509-ca-cert file:///sdcard/cacert.cer æŸ¥çœ‹å†…å­˜å ç”¨ 1adb shell dumpsys meminfo &lt;package&gt; -d æŸ¥è¯¢æ ˆä¿¡æ¯ 12345adb shell dumpsys activity// èŽ·å–è‡ªå·±åº”ç”¨adb shell dumpsys activity | grep &lt;package&gt;// èŽ·å–å¤„äºŽæ ˆé¡¶çš„ activityadb shell dumpsys activity | grep mFocusedActivity]]></content>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[schedule]]></title>
    <url>%2Fschedule%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[sitemap]]></title>
    <url>%2Fsitemap%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[tags]]></title>
    <url>%2Ftags%2Findex.html</url>
    <content type="text"></content>
  </entry>
</search>
