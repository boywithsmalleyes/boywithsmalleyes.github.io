<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>èŒ¶ç™½</title>
  <icon>https://www.gravatar.com/avatar/f27b936c2ac428d82177b6d3626c8e3a</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://xiaoman.ren/"/>
  <updated>2020-09-16T16:15:50.578Z</updated>
  <id>http://xiaoman.ren/</id>
  
  <author>
    <name>èŒ¶ç™½</name>
    <email>zhuangbudong@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Lifecycle æºç åˆ†æ</title>
    <link href="http://xiaoman.ren/2020/09/17/Lifecycle-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <id>http://xiaoman.ren/2020/09/17/Lifecycle-æºç åˆ†æ/</id>
    <published>2020-09-16T16:00:39.000Z</published>
    <updated>2020-09-16T16:15:50.578Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼€å§‹æ˜¯åºŸè¯ï¼ˆç¿»è¯‘è‡ªæºç ï¼‰"><a href="#å¼€å§‹æ˜¯åºŸè¯ï¼ˆç¿»è¯‘è‡ªæºç ï¼‰" class="headerlink" title="å¼€å§‹æ˜¯åºŸè¯ï¼ˆç¿»è¯‘è‡ªæºç ï¼‰"></a>å¼€å§‹æ˜¯åºŸè¯ï¼ˆç¿»è¯‘è‡ªæºç ï¼‰</h2><p>å®šä¹‰äº†ä¸€ä¸ª Android ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ã€‚ <code>Fragment</code>å’Œ<code>FragmentActivity</code>ç±»å®ç°<code>LifecycleOwner</code>æ¥å£ï¼Œ å¹¶å¯ä»¥é€šè¿‡ <code>getLifecycle()</code> æ–¹æ³•æ¥è®¿é—®ç”Ÿå‘½å‘¨æœŸã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°<code>LifecycleOwner</code>åœ¨è‡ªå·±çš„ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨æ­¤ç±»äº‹ä»¶ååˆ†å‘ LifecycleOwner çš„ç›¸å…³æ–¹æ³•çš„è¿”å›æ—¶ã€‚ </span></span><br><span class="line">Lifecycle.Event.ON_CREATE ï¼Œ Lifecycle.Event.ON_START ï¼Œ Lifecycle.Event.ON_RESUME</span><br><span class="line"><span class="comment">// åœ¨æ­¤ç±»äº‹ä»¶åœ¨ä¹‹å‰åˆ†æ´¾LifecycleOwnerè¢«ç§°ä¸ºçš„ç›¸å…³æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œ Lifecycle.Event.ON_STARTåä¼šè¢«åˆ†æ´¾onStartå›æŠ¥ï¼Œ Lifecycle.Event.ON_STOPä¹‹å‰å°†æ´¾å‡ºonStopè¢«è°ƒç”¨ã€‚ è¿™ç»™ä½ ä¸€å®šçš„ä¿è¯åœ¨å…¶å›½å®¶çš„ä¸»äººåœ¨ä¸åœ¨ã€‚</span></span><br><span class="line">Lifecycle.Event.ON_PAUSE ï¼Œ Lifecycle.Event.ON_STOP ï¼Œ Lifecycle.Event.ON_DESTROY</span><br></pre></td></tr></table></figure><a id="more"></a><p>å¦‚æœæ‚¨ä½¿ç”¨Java 8 è¯­è¨€ ï¼Œç„¶åä½¿ç”¨<code>DefaultLifecycleObserver</code> è§‚å¯Ÿäº‹ä»¶ã€‚ éœ€è¦å°†<code>&quot;androidx.lifecycle:common-java8:&lt;version&gt;&quot;</code> å¢åŠ åˆ°ä½ çš„ <code>build.gradle</code> æ–‡ä»¶ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestObserver</span> <span class="keyword">implements</span> <span class="title">DefaultLifecycleObserver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(LifecycleOwner owner)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// your code</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä½¿ç”¨çš„Java 7 è¯­è¨€ ï¼Œä½¿ç”¨çš„æ³¨è§£è§‚å¯Ÿç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚ ä¸€æ—¦Javaçš„8è¯­è¨€æˆä¸ºåœ¨Androidä¸Šçš„ä¸»æµï¼Œæ³¨é‡Šå°†è¢«å¼ƒç”¨ï¼Œæ‰€ä»¥<code>DefaultLifecycleObserver</code>å’Œæ³¨é‡Šä¹‹é—´ï¼Œåˆ™é¡»åå‘ <code>DefaultLifecycleObserver</code>ã€‚</p>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestObserver</span> <span class="keyword">implements</span> <span class="title">LifecycleObserver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@OnLifecycleEvent</span>(ON_STOP)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onStopped</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§‚æµ‹æ–¹æ³•å¯ä»¥æ¥æ”¶é›¶ä¸ªæˆ–ä¸€ä¸ªå‚æ•°ã€‚ å¦‚æœä½¿ç”¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹å¿…é¡»ä¸º<code>LifecycleOwner</code> ã€‚ å¸¦æ³¨é‡Šçš„æ–¹æ³•<code>Lifecycle.Event.ON_ANY</code> å¯ä»¥æ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®ƒå¿…é¡»æ˜¯ç±»å‹çš„<code>Lifecycle.Event</code>ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestObserver</span> <span class="keyword">implements</span> <span class="title">LifecycleObserver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@OnLifecycleEvent</span>(ON_CREATE)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onCreated</span><span class="params">(LifecycleOwner source)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="meta">@OnLifecycleEvent</span>(ON_ANY)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onAny</span><span class="params">(LifecycleOwner source, Event event)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æä¾›è¿™äº›é¢å¤–çš„å‚æ•°å¯ä»¥è®©æ‚¨æ–¹ä¾¿åœ°è§‚å¯Ÿåˆ°å¤šä¸ªä¾›åº”å•†å’Œäº‹ä»¶ï¼Œè€Œæ— éœ€æ‰‹åŠ¨è·Ÿè¸ªä»–ä»¬ã€‚</p><h2 id="é‚£æˆ‘èƒ½åšä»€ä¹ˆå‘¢"><a href="#é‚£æˆ‘èƒ½åšä»€ä¹ˆå‘¢" class="headerlink" title="é‚£æˆ‘èƒ½åšä»€ä¹ˆå‘¢"></a>é‚£æˆ‘èƒ½åšä»€ä¹ˆå‘¢</h2><p>è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±åº”è¯¥æƒ³åˆ°ä¸€äº›åœ¨å¼€å‘ä¸­å¸¸å¸¸ä¸è¢«æˆ‘ä»¬å¿½è§†ï¼Œä½†åˆä¸æ€ä¹ˆä½¿ç”¨çš„ä¸œè¥¿ <strong>å‹ç›Ÿç»Ÿè®¡</strong></p><p>åœ¨å‹ç›Ÿç»Ÿè®¡ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šåœ¨ <code>BaseActivity</code> ä¸­æ’å…¥å‹ç›Ÿå¯¹é¡µé¢æµè½¬çš„ç»Ÿè®¡, <code>onStart()</code> <code>onResume()</code> <code>onPause()</code> <code>onStop()</code> ç­‰ï¼Œç„¶è€Œè¿™é‡Œæœ‰ä¸€ç‚¹ä¸å¥½çš„æ˜¯ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡å’Œå…¬å…±ç»„ä»¶è€¦åˆåœ¨äº†ä¸€èµ·ã€‚</p><p>å¹²è´§~~~æ¥äº†</p><p>é‚£ä¹ˆè§£å†³ä¸Šè¿°é—®é¢˜çš„æ–¹æ¡ˆå°±æ¥äº†ï¼Œæˆ‘ä»¬é€šè¿‡å®ç° <code>LifecycleObserver</code> ï¼Œé€šè¿‡æ ‡è¯†å£°æ˜å‘¨æœŸæ–¹æ³•ä¹‹åï¼Œä»…éœ€ä¸€å¥ <code>addObserver(this)</code> ï¼Œå°±å¯ä»¥å°† <code>Activity</code> æˆ– <code>Fragment</code> çš„å£°æ˜å‘¨æœŸæ–¹æ³•ä¸æˆ‘ä»¬å®šä¹‰çš„ <code>Observer</code> æ–¹æ³•å…³è”èµ·æ¥ã€‚é€šè¿‡æ„ŸçŸ¥ <code>Activity</code> æˆ– <code>Fragment</code> çš„å£°æ˜å‘¨æœŸæ–¹æ³•ï¼Œå®ç°å‹ç›Ÿç»Ÿè®¡ï¼Œæ­¤æ—¶å°±å°†ä¸šåŠ¡æ•´ä½“ä¸ <code>BaseActivity</code> æŠ½ç¦»å¼€ï¼Œæ˜¯çš„å…¬å…±ç»„ä»¶å˜å¾—æ›´ç®€æ´ä¸€äº›ã€‚</p><p>å½“ç„¶ï¼Œè¿™åªæ˜¯ <code>Lifecycle</code> çš„ä¸€ç§ç®€å•åº”ç”¨ï¼Œå…¶ä»–çš„ä½¿ç”¨æ–¹æ³•è¿˜æ˜¯éœ€è¦æˆ‘ä»¬ä¸æ–­çš„å»æ¢ç´¢ã€‚</p><h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><h3 id="Lifecycle-UML"><a href="#Lifecycle-UML" class="headerlink" title="Lifecycle UML"></a><strong><code>Lifecycle UML</code></strong></h3><p><img src="https://github.com/xiaomanwong/static_file/blob/master/images/Lifecycle%20UML.png?raw=true" alt="Lifecycle UML"></p><p><strong>æƒ³ç†è§£ä¸€ä¸ªä¸œè¥¿ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯å»é˜…è¯»å®ƒ</strong>ï¼Œ è¿™æ˜¯å¼€å‘å¤šå¹´æ€»ç»“å‡ºçš„ä¸€å¥è¯ã€‚</p><p>é‚£ä¹ˆé€šè¿‡ä¸Šé¢çš„ UML ç±»å›¾å…³ç³»ï¼Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹å‡ºï¼Œ <code>Lifecycle</code> çš„å†…å®¹å¹¶ä¸æ˜¯å¾ˆå¤šã€‚ä½†å®ƒæ€ä¹ˆå°±ä¼šè¿™ä¹ˆå¼ºå¤§å‘¢ã€‚</p><h3 id="ComponentActivity-amp-ReportFragment"><a href="#ComponentActivity-amp-ReportFragment" class="headerlink" title="ComponentActivity &amp; ReportFragment"></a><strong><code>ComponentActivity</code> &amp; <code>ReportFragment</code></strong></h3><p>å°±ç®—æ²¡çœ‹è¿‡æºç ï¼ŒçŸ¥é“<code>Lifecycle</code> çš„äººï¼Œä¹Ÿåº”è¯¥å¬è¯´ä¸ªï¼Œè¿™æ˜¯è¦ç»™å£°æ˜å‘¨æœŸç›‘æ§ç±»ï¼Œé‚£ä¹ˆæ—¢ç„¶å’Œç”Ÿå‘½å‘¨æœŸæœ‰å…³ï¼Œé‚£è‡ªç„¶æ˜¯å’Œ <code>Activity</code> æœ‰å…³ï¼Œé€šè¿‡<code>AppCompatActivity</code> ç±»ï¼Œæˆ‘ä»¬å‘ä¸ŠæŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>ComponentActivity</code> è¿™ä¸ªç±»ï¼Œå®ç°äº† <code>LifecycleOwner</code> æ¥å£ï¼Œå¹¶è¿”å›äº†ä¸€ä¸ª <code>mLifecycleRegistry</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ComponentActivity ç±»åˆå§‹åŒ–æ˜¯ï¼Œåˆ›å»ºäº†ä¸€ä¸ª LifecycleRegistryï¼Œå¹¶å°†è‡ªå·±ä¼ å…¥è¿‡å»</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> LifecycleRegistry mLifecycleRegistry = <span class="keyword">new</span> LifecycleRegistry(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// LifecycleOwner æ¥å£ï¼Œæä¾›äº†ä¸€ä¸ª getLifecycle() æ–¹æ³•</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Lifecycle <span class="title">getLifecycle</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mLifecycleRegistry;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>ComponentActivity</code> çš„æ„é€ æ–¹æ³•é‡Œï¼Œé€‚é…äº†ä¸åŒçš„å¹³å°ç‰ˆæœ¬ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ComponentActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Lifecycle lifecycle = getLifecycle();</span><br><span class="line">    <span class="comment">//noinspection ConstantConditions</span></span><br><span class="line">    <span class="keyword">if</span> (lifecycle == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"getLifecycle() returned null in ComponentActivity's "</span></span><br><span class="line">                                        + <span class="string">"constructor. Please make sure you are lazily constructing your Lifecycle "</span></span><br><span class="line">                                        + <span class="string">"in the first call to getLifecycle() rather than relying on field "</span></span><br><span class="line">                                        + <span class="string">"initialization."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">19</span>) &#123;</span><br><span class="line">        getLifecycle().addObserver(<span class="keyword">new</span> LifecycleEventObserver() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStateChanged</span><span class="params">(@NonNull LifecycleOwner source,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       @NonNull Lifecycle.Event event)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (event == Lifecycle.Event.ON_STOP) &#123;</span><br><span class="line">                    Window window = getWindow();</span><br><span class="line">                    <span class="keyword">final</span> View decor = window != <span class="keyword">null</span> ? window.peekDecorView() : <span class="keyword">null</span>;</span><br><span class="line">                    <span class="keyword">if</span> (decor != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        decor.cancelPendingInputEvents();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    getLifecycle().addObserver(<span class="keyword">new</span> LifecycleEventObserver() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStateChanged</span><span class="params">(@NonNull LifecycleOwner source,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   @NonNull Lifecycle.Event event)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (event == Lifecycle.Event.ON_DESTROY) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!isChangingConfigurations()) &#123;</span><br><span class="line">                    getViewModelStore().clear();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">19</span> &lt;= SDK_INT &amp;&amp; SDK_INT &lt;= <span class="number">23</span>) &#123;</span><br><span class="line">        getLifecycle().addObserver(<span class="keyword">new</span> ImmLeaksCleaner(<span class="keyword">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ„é€ æ–¹æ³•ï¼Œæœ‰æ²¡æœ‰å‘ç°ä¸€ä¸ªå¾ˆé‡è¦çš„ä¿¡æ¯ï¼Œ <code>addObserver()</code>ï¼Œ ç”±æ­¤ï¼Œæˆ‘ä»¬ä¸éš¾çœ‹å‡º ï¼Œ<code>LifecycleRegister</code> çš„ä¸€ä¸ªé‡è¦çš„æ–¹æ³•å°±æ˜¯ <code>addObserver()</code> ã€‚ç¿»é˜…ç±»ç»“æ„äº†è§£åˆ° <code>LifecycleRegister</code> æ˜¯ <code>Lifecycle</code> æ´¾ç”Ÿçš„ä¸€ä¸ªå­ç±»ï¼Œæœ‰å…³æ‰€æœ‰å’Œå£°æ˜å‘¨æœŸæœ‰å…³çš„å†…å®¹ï¼Œéƒ½å’Œè¿™ä¸ªç±»æœ‰å…³ã€‚</p><p>æˆ‘ä»¬å…ˆä¸ç€æ€¥çœ‹ <code>LifecycleRegister</code>ï¼Œç»§ç»­çœ‹ <code>CompontentActivity</code> ç±»ï¼Œæ—¢ç„¶æ˜¯ä¸ª <code>Activity</code> é‚£ä¹ˆä¸€å®šä¼šæœ‰åˆ›å»ºè¿‡ç¨‹ï¼Œå›çœ‹ <code>onCreate()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ä¸€ä¸ªæœ‰è¶£çš„ä¸œè¥¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If your ComponentActivity is annotated with &#123;<span class="doctag">@link</span> ContentView&#125;, this will</span></span><br><span class="line"><span class="comment">     * call &#123;<span class="doctag">@link</span> #setContentView(int)&#125; for you.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    mSavedStateRegistryController.performRestore(savedInstanceState);</span><br><span class="line">    ReportFragment.injectIfNeededIn(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (mContentLayoutId != <span class="number">0</span>) &#123;</span><br><span class="line">        setContentView(mContentLayoutId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ReportFragment.injectIfNeededIn(this)</code> å’¦ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ ä½ æ˜¯è°ï¼Œä½ åœ¨è¿™å„¿åšä»€ä¹ˆã€‚</p><p>åˆ«æ…Œï¼Œè¿›å»çœ‹ã€‚</p><h4 id="ReportFragment"><a href="#ReportFragment" class="headerlink" title="ReportFragment"></a><code>ReportFragment</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">injectIfNeededIn</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ProcessLifecycleOwner should always correctly work and some activities may not extend</span></span><br><span class="line">    <span class="comment">// FragmentActivity from support lib, so we use framework fragments for activities</span></span><br><span class="line">    android.app.FragmentManager manager = activity.getFragmentManager();</span><br><span class="line">    <span class="keyword">if</span> (manager.findFragmentByTag(REPORT_FRAGMENT_TAG) == <span class="keyword">null</span>) &#123;</span><br><span class="line">        manager.beginTransaction().add(<span class="keyword">new</span> ReportFragment(), REPORT_FRAGMENT_TAG).commit();</span><br><span class="line">        <span class="comment">// Hopefully, we are the first to make a transaction.</span></span><br><span class="line">        manager.executePendingTransactions();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’¦ï¼Ÿï¼Ÿï¼Ÿï¼Ÿä¸ºä»€ä¹ˆè¦åœ¨æˆ‘çš„ <code>Activity</code> ä¸Šæ·»åŠ ä¸€ä¸ª <code>Fragment</code>ï¼Œ ç¿»éä»£ç ï¼Œæˆ‘ä»¬ä¹Ÿæœªè§åˆ°ä»»ä½•å¸ƒå±€ï¼Œä½ æ˜¯ä¸€ä¸ª<strong>ç©ºçš„</strong> ï¼ŒğŸ˜±ğŸ˜±ğŸ˜±ï¼Œ å¤ªå¯æ€•äº†ï¼</p><p>æŒ‰ç…§ <code>Fragment</code> çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬ç»§ç»­çœ‹</p><h5 id="dispatch"><a href="#dispatch" class="headerlink" title="dispatch()"></a><code>dispatch()</code></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onActivityCreated(savedInstanceState);</span><br><span class="line">    dispatchCreate(mProcessListener);</span><br><span class="line">    dispatch(Lifecycle.Event.ON_CREATE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onStart();</span><br><span class="line">    dispatchStart(mProcessListener);</span><br><span class="line">    dispatch(Lifecycle.Event.ON_START);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onResume();</span><br><span class="line">    dispatchResume(mProcessListener);</span><br><span class="line">    dispatch(Lifecycle.Event.ON_RESUME);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onPause();</span><br><span class="line">    dispatch(Lifecycle.Event.ON_PAUSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onStop();</span><br><span class="line">    dispatch(Lifecycle.Event.ON_STOP);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    dispatch(Lifecycle.Event.ON_DESTROY);</span><br><span class="line">    <span class="comment">// just want to be sure that we won't leak reference to an activity</span></span><br><span class="line">    mProcessListener = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰æ²¡æœ‰å‘ç°ï¼Œ åˆæœ‰ä¸€ä¸ªæ–¹æ³•è¢«é‡å¤çš„åˆ©ç”¨ï¼Œæ²¡é”™ï¼Œå°±æ˜¯<code>dispatch(Lifecycle.Event event)</code> è€Œä¸”ä¼ å…¥çš„å‚æ•°ï¼Œåˆå’Œ <code>Activity</code> çš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒ.</p><h5 id="handleLifecycleEvent"><a href="#handleLifecycleEvent" class="headerlink" title="handleLifecycleEvent()"></a><code>handleLifecycleEvent()</code></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dispatch</span><span class="params">(Lifecycle.Event event)</span> </span>&#123;</span><br><span class="line">    Activity activity = getActivity();</span><br><span class="line">    <span class="keyword">if</span> (activity <span class="keyword">instanceof</span> LifecycleRegistryOwner) &#123;</span><br><span class="line">        ((LifecycleRegistryOwner) activity).getLifecycle().handleLifecycleEvent(event);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (activity <span class="keyword">instanceof</span> LifecycleOwner) &#123;</span><br><span class="line">        Lifecycle lifecycle = ((LifecycleOwner) activity).getLifecycle();</span><br><span class="line">        <span class="keyword">if</span> (lifecycle <span class="keyword">instanceof</span> LifecycleRegistry) &#123;</span><br><span class="line">            ((LifecycleRegistry) lifecycle).handleLifecycleEvent(event);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶ç»è¿‡äº†ä¸¤ä¸ªåˆ¤æ–­ï¼Œä½†è¿™æ²¡å…³ç³»ï¼Œå› ä¸ºè¿™æ˜¯ç³»ç»Ÿå¸®åŠ©æˆ‘ä»¬åšçš„é€‚é…å·¥ä½œï¼Œæ— è®ºå¦‚ä½•ï¼Œä»–ä»¬é˜Ÿä¸­éƒ½è°ƒç”¨äº† <code>handleLifecycleEvent(event)</code> æ–¹æ³•ï¼Œåˆè’™è”½äº†ä¸ï¼Œè¿™é‡Œå•¥ä¹Ÿæ²¡å¹²ï¼Œå°±è·‘äº†ã€‚</p><p>ä½ è·‘ï¼Œé‚£æˆ‘å°±è¿½ï¼</p><h3 id="LifecycleRegister"><a href="#LifecycleRegister" class="headerlink" title="LifecycleRegister"></a><strong><code>LifecycleRegister</code></strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets the current state and notifies the observers.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Note that if the &#123;<span class="doctag">@code</span> currentState&#125; is the same state as the last call to this method,</span></span><br><span class="line"><span class="comment">     * calling this method has no effect.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> event The event that was received</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLifecycleEvent</span><span class="params">(@NonNull Lifecycle.Event event)</span> </span>&#123;</span><br><span class="line">    State next = getStateAfter(event);</span><br><span class="line">    moveToState(next);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">moveToState</span><span class="params">(State next)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mState == next) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mState = next;</span><br><span class="line">    <span class="keyword">if</span> (mHandlingEvent || mAddingObserverCounter != <span class="number">0</span>) &#123;</span><br><span class="line">        mNewEventOccurred = <span class="keyword">true</span>;</span><br><span class="line">        <span class="comment">// we will figure out what to do on upper level.</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mHandlingEvent = <span class="keyword">true</span>;</span><br><span class="line">    sync();</span><br><span class="line">    mHandlingEvent = <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬ç¿»è¯‘ä¸‹æ³¨é‡Š</p><blockquote><p>è®¾ç½®å½“å‰çŠ¶æ€ï¼Œå¹¶é€šçŸ¥è§‚å¯Ÿè€…</p><p>æ³¨æ„ï¼Œå¦‚æœå½“å‰çŠ¶æ€å’Œä¸Šä¸€æ¬¡æ–¹æ³•è°ƒç”¨æ—¶ç›¸åŒï¼Œé‚£ä¹ˆè¿™æ¬¡è°ƒç”¨åˆ™æ— æ•ˆ</p></blockquote><h4 id="getStateAfter"><a href="#getStateAfter" class="headerlink" title="getStateAfter()"></a><code>getStateAfter()</code></h4><p>ç°åœ¨æˆ‘ä»¬æ¥åˆ†ææºç ï¼Œ<code>getStateAfter(event)</code> è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆè¿›å»çœ‹ä¸‹åšäº†ä»€ä¹ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> State <span class="title">getStateAfter</span><span class="params">(Event event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (event) &#123;</span><br><span class="line">        <span class="keyword">case</span> ON_CREATE:</span><br><span class="line">        <span class="keyword">case</span> ON_STOP:</span><br><span class="line">            <span class="keyword">return</span> CREATED;</span><br><span class="line">        <span class="keyword">case</span> ON_START:</span><br><span class="line">        <span class="keyword">case</span> ON_PAUSE:</span><br><span class="line">            <span class="keyword">return</span> STARTED;</span><br><span class="line">        <span class="keyword">case</span> ON_RESUME:</span><br><span class="line">            <span class="keyword">return</span> RESUMED;</span><br><span class="line">        <span class="keyword">case</span> ON_DESTROY:</span><br><span class="line">            <span class="keyword">return</span> DESTROYED;</span><br><span class="line">        <span class="keyword">case</span> ON_ANY:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unexpected event value "</span> + event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸæ¥æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œé€šè¿‡ä¼ å…¥çš„ <code>Event</code> äº‹ä»¶ï¼Œæ‰¾åˆ°å½“å‰äº‹ä»¶å¯¹åº”çš„ä¸‹ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸçŠ¶æ€ <code>State</code></p><p>æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æ²¡æœ‰åˆ†æ <code>moveToState(State next)</code>, ä»å‡½æ•°åä¸Šï¼Œå¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªçŠ¶æ€ç§»åŠ¨çš„æ–¹æ³•ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬è¿›å…¥æ–¹æ³•å†…å¯ä»¥çœ‹åˆ° </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (mState == next) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå½“å‰çŠ¶æ€å’Œä¸‹ä¸€ä¸ªï¼ˆæ“ä½œåçš„ï¼‰çŠ¶æ€ä¸€è‡´ï¼Œåˆ™ç›´æ¥ <code>return</code> è¿™ä¹Ÿæ˜ ç…§äº†æ³¨é‡Šä¸­çš„é‚£å¥è¯ã€‚</p><h4 id="sync"><a href="#sync" class="headerlink" title="sync()"></a><code>sync()</code></h4><p>ç»§ç»­å°±æ˜¯å°†æ“ä½œçš„ä¸‹ä¸€ä¸ªçŠ¶æ€åšäº†ä¸€æ¬¡è®°å½•ï¼Œä¸­é—´çš„ä¸€äº›åˆ¤æ–­æ¡ä»¶æˆ‘ä»¬ä¸çœ‹ï¼Œé¡ºåºçš„ä¼šçœ‹åˆ°ä¸€ä¸ª <code>sync()</code> æ–¹æ³•ï¼Œå’¦ï¼Œè¿™åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ===&gt; çŠ¶æ€åŒæ­¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Custom list that keeps observers and can handle removals / additions during traversal.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Invariant: at any moment of time for observer1 &amp; observer2:</span></span><br><span class="line"><span class="comment">     * if addition_order(observer1) &lt; addition_order(observer2), then</span></span><br><span class="line"><span class="comment">     * state(observer1) &gt;= state(observer2),</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">private</span> FastSafeIterableMap&lt;LifecycleObserver, ObserverWithState&gt; mObserverMap =</span><br><span class="line">    <span class="keyword">new</span> FastSafeIterableMap&lt;&gt;();</span><br><span class="line"><span class="comment">// happens only on the top of stack (never in reentrance),</span></span><br><span class="line"><span class="comment">// so it doesn't have to take in account parents</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sync</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LifecycleOwner lifecycleOwner = mLifecycleOwner.get();</span><br><span class="line">    <span class="keyword">if</span> (lifecycleOwner == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"LifecycleOwner of this LifecycleRegistry is already"</span></span><br><span class="line">                                        + <span class="string">"garbage collected. It is too late to change lifecycle state."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (!isSynced()) &#123;</span><br><span class="line">        mNewEventOccurred = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">// no need to check eldest for nullability, because isSynced does it for us.</span></span><br><span class="line">        <span class="keyword">if</span> (mState.compareTo(mObserverMap.eldest().getValue().mState) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            backwardPass(lifecycleOwner);</span><br><span class="line">        &#125;</span><br><span class="line">        Entry&lt;LifecycleObserver, ObserverWithState&gt; newest = mObserverMap.newest();</span><br><span class="line">        <span class="keyword">if</span> (!mNewEventOccurred &amp;&amp; newest != <span class="keyword">null</span></span><br><span class="line">            &amp;&amp; mState.compareTo(newest.getValue().mState) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            forwardPass(lifecycleOwner);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mNewEventOccurred = <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªæ–°ä¸œè¥¿ <code>mObserverMap</code> å‘ä¸Šæˆ‘ä»¬æ‰¾ä»–çš„å®ƒç±»å‹ï¼Œè¿™é‡Œå¯¹æ•°æ®ç»“æ„ä¸åšç ”ç©¶ï¼Œç®€å•è¯´ä¸€ä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¹¶æä¾›äº†ä¸€ä¸ª map åšç¼“å†²åŒºï¼Œä¸”æä¾›äº†ä¸€ä¸ªå¯ä»¥å¿«é€Ÿè¿­ä»£çš„ç»“æ„ã€‚</p><p>ç»§ç»­åˆ†ææºç </p><p><code>mState.compareTo(mObserverMap.eldest().getValue().mState) &lt; 0</code> ä»ç¼“å­˜çš„è§‚å¯Ÿè€…ä¸­æ‹¿å‡ºæœ€æ—§çš„çŠ¶æ€ï¼Œä¸å½“å‰çŠ¶æ€è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå°äº 0ï¼Œ è¯´æ˜è§‚å¯Ÿè€…çš„çŠ¶æ€æå‰äºå½“å‰çŠ¶æ€ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œä¸€ä¸ª<code>backwardPass(lifecycleOwner)</code> æ–¹æ³•ï¼Œè®©è§‚å¯Ÿè€…çš„çŠ¶æ€å›é€€åˆ°å½“å‰çŠ¶æ€ä¸Š</p><p><code>mState.compareTo(newest.getValue().mState) &gt; 0</code> è¿™ä¸ªåˆ¤æ–­æ­£å¥½å’Œä¸Šé¢ç›¸åï¼Œè¯´æ˜å½“å‰çš„è§‚å¯Ÿè€…çŠ¶æ€è½åäºå½“å‰çŠ¶æ€ï¼Œé‚£ä¹ˆå°±è®©è§‚å¯Ÿè€…çš„çŠ¶æ€è¿½ä¸Šå½“å‰çŠ¶æ€ï¼Œæ‰§è¡Œ <code>forwardPass(lifecycleOwner)</code></p><h4 id="Lifecycle-State-Sequence"><a href="#Lifecycle-State-Sequence" class="headerlink" title="Lifecycle State Sequence"></a><strong><code>Lifecycle State Sequence</code></strong></h4><p>é€šè¿‡åˆ†æ <code>forwardPass</code> å’Œ <code>backwardPass</code> æ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹åˆ°å…¶å†…éƒ¨åˆè°ƒç”¨äº†ä¸¤ä¸ªæ–¹æ³•, <code>downEvent</code> å’Œ <code>upEvent</code>ï¼Œæˆ‘ä»¬ç§°å‘¼ä¸ºå‡çº§äº‹ä»¶å’Œé™çº§äº‹ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Event <span class="title">downEvent</span><span class="params">(State state)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">           <span class="keyword">case</span> INITIALIZED:</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">           <span class="keyword">case</span> CREATED:</span><br><span class="line">               <span class="keyword">return</span> ON_DESTROY;</span><br><span class="line">           <span class="keyword">case</span> STARTED:</span><br><span class="line">               <span class="keyword">return</span> ON_STOP;</span><br><span class="line">           <span class="keyword">case</span> RESUMED:</span><br><span class="line">               <span class="keyword">return</span> ON_PAUSE;</span><br><span class="line">           <span class="keyword">case</span> DESTROYED:</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unexpected state value "</span> + state);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Event <span class="title">upEvent</span><span class="params">(State state)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">           <span class="keyword">case</span> INITIALIZED:</span><br><span class="line">           <span class="keyword">case</span> DESTROYED:</span><br><span class="line">               <span class="keyword">return</span> ON_CREATE;</span><br><span class="line">           <span class="keyword">case</span> CREATED:</span><br><span class="line">               <span class="keyword">return</span> ON_START;</span><br><span class="line">           <span class="keyword">case</span> STARTED:</span><br><span class="line">               <span class="keyword">return</span> ON_RESUME;</span><br><span class="line">           <span class="keyword">case</span> RESUMED:</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unexpected state value "</span> + state);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬æ€»ç»“å‡º <code>Lifecycle</code> ä¸­ <code>State</code> å’Œ <code>Event</code> çš„æ—¶åºå…³ç³»ï¼Œå¦‚ä¸‹å›¾</p><p><img src="https://github.com/xiaomanwong/static_file/blob/master/images/Lifecycle%20State%20secquece.png?raw=true" alt="Lifecycle State Sequence"></p><p>åŒæ—¶æˆ‘ä»¬ä¹Ÿå›é¡¾ä¸€ä¸‹ï¼Œ<code>getStateAfter()</code> æ–¹æ³•ï¼Œå¯¹äº‹ä»¶å’ŒçŠ¶æ€çš„åˆ¤æ–­ï¼Œä¹Ÿå°±æ˜ç™½äº†çŠ¶æ€å’Œäº‹ä»¶çš„å…³ç³»ã€‚</p><h4 id="dispatchEvent"><a href="#dispatchEvent" class="headerlink" title="dispatchEvent"></a><code>dispatchEvent</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">forwardPass</span><span class="params">(LifecycleOwner lifecycleOwner)</span> </span>&#123;</span><br><span class="line">    Iterator&lt;Entry&lt;LifecycleObserver, ObserverWithState&gt;&gt; ascendingIterator =</span><br><span class="line">        mObserverMap.iteratorWithAdditions();</span><br><span class="line">    <span class="keyword">while</span> (ascendingIterator.hasNext() &amp;&amp; !mNewEventOccurred) &#123;</span><br><span class="line">        Entry&lt;LifecycleObserver, ObserverWithState&gt; entry = ascendingIterator.next();</span><br><span class="line">        ObserverWithState observer = entry.getValue();</span><br><span class="line">        <span class="keyword">while</span> ((observer.mState.compareTo(mState) &lt; <span class="number">0</span> &amp;&amp; !mNewEventOccurred</span><br><span class="line">                &amp;&amp; mObserverMap.contains(entry.getKey()))) &#123;</span><br><span class="line">            pushParentState(observer.mState);</span><br><span class="line">            observer.dispatchEvent(lifecycleOwner, upEvent(observer.mState));</span><br><span class="line">            popParentState();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">backwardPass</span><span class="params">(LifecycleOwner lifecycleOwner)</span> </span>&#123;</span><br><span class="line">    Iterator&lt;Entry&lt;LifecycleObserver, ObserverWithState&gt;&gt; descendingIterator =</span><br><span class="line">        mObserverMap.descendingIterator();</span><br><span class="line">    <span class="keyword">while</span> (descendingIterator.hasNext() &amp;&amp; !mNewEventOccurred) &#123;</span><br><span class="line">        Entry&lt;LifecycleObserver, ObserverWithState&gt; entry = descendingIterator.next();</span><br><span class="line">        ObserverWithState observer = entry.getValue();</span><br><span class="line">        <span class="keyword">while</span> ((observer.mState.compareTo(mState) &gt; <span class="number">0</span> &amp;&amp; !mNewEventOccurred</span><br><span class="line">                &amp;&amp; mObserverMap.contains(entry.getKey()))) &#123;</span><br><span class="line">            Event event = downEvent(observer.mState);</span><br><span class="line">            pushParentState(getStateAfter(event));</span><br><span class="line">            observer.dispatchEvent(lifecycleOwner, event);</span><br><span class="line">            popParentState();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿Ÿåˆ°çš„ä¸¤ä¸ªæ–¹æ³•ç»ˆäºæ¥äº†ï¼Œè¿™é‡Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¯ä»¥å¤æ‚çš„ã€‚åªæ˜¯é€šè¿‡å¾ªç¯æ‰¾åˆ°æ‰€æœ‰çš„è§‚å¯Ÿè€…ï¼Œå¹¶è¿›è¡Œäº‹ä»¶çš„åˆ†å‘<code>observer.dispatchEvent(lifecycleOwner, event)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dispatchEvent</span><span class="params">(LifecycleOwner owner, Event event)</span> </span>&#123;</span><br><span class="line">    State newState = getStateAfter(event);</span><br><span class="line">    mState = min(mState, newState);</span><br><span class="line">    mLifecycleObserver.onStateChanged(owner, event);</span><br><span class="line">    mState = newState;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å“ˆå“ˆï¼Œ åˆæ˜¯ä¸€ä¸ªæ–¹æ³•è¿›å…¥äº†æˆ‘ä»¬çš„è§†çº¿ <code>onStateChanged(owner, event)</code>ï¼Œå†æ¬¡ç‚¹å‡»å»åï¼Œå‘ç°æ˜¯ä¸€ä¸ªæ¥å£ã€‚æŸ¥è¯¢å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šå®ç°ç±»ï¼Œå›°æƒ‘å—ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p><p>ä½†æˆ‘ä»¬åªéœ€è¦å…³æ³¨ <code>ReflectiveGenericLifecycleObserver</code> , æƒ³çŸ¥é“ä¸ºä»€ä¹ˆå—ï¼Ÿ æˆ‘ä¹Ÿæ˜¯çœ‹äº†æºç æ‰æ€»ç»“å‡ºæ¥çš„ã€‚</p><h4 id="ReflectiveGenericLifecycleObserver"><a href="#ReflectiveGenericLifecycleObserver" class="headerlink" title="ReflectiveGenericLifecycleObserver"></a><code>ReflectiveGenericLifecycleObserver</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An internal implementation of &#123;<span class="doctag">@link</span> LifecycleObserver&#125; that relies on reflection.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReflectiveGenericLifecycleObserver</span> <span class="keyword">implements</span> <span class="title">LifecycleEventObserver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object mWrapped;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CallbackInfo mInfo;</span><br><span class="line"></span><br><span class="line">    ReflectiveGenericLifecycleObserver(Object wrapped) &#123;</span><br><span class="line">        mWrapped = wrapped;</span><br><span class="line">        mInfo = ClassesInfoCache.sInstance.getInfo(mWrapped.getClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStateChanged</span><span class="params">(LifecycleOwner source, Event event)</span> </span>&#123;</span><br><span class="line">        mInfo.invokeCallbacks(source, event, mWrapped);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å“ï¼Œ<code>mInfo.invokeCallbacks(source,event,mWrapped);</code> è¿™åˆæ˜¯ä»€ä¹ˆï¼Œæ‹ä¸‹æ¥è¿˜ä»æ²¡è§è¿‡ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡è§è¿‡è¿™ä¸ªç±»çš„åˆå§‹åŒ–å’ŒåŠ è½½è¿‡ç¨‹ï¼Œå¯¹ä¸å¯¹ğŸ˜¨ğŸ˜¨ğŸ˜¨</p><p>æ—¢ç„¶æ˜¯ç±»å˜›ï¼Œé‚£è‚¯å®šæ˜¯è¦åˆ›å»ºçš„ï¼Œé‚£å°±çœ‹ä¸‹æ„é€ å™¨å‘—ã€‚</p><p><code>wrapped</code> è¿™ä¸œè¥¿ï¼Œç»è¿‡äº†ç¼“å­˜ï¼ŒEmmm ï¼Œæˆ‘ä¹Ÿæ˜¯ç‚¹è¿›å» <code>ClassesInfoCache</code> ä¹‹åï¼Œéƒ½äº†å®ƒçš„æ³¨é‡Šæ‰æ˜ç™½çš„ã€‚</p><p>é‚£ <code>wrapped</code> åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé€šè¿‡ <code>ClassesInfoCache</code> å’Œæˆ‘ä»¬è¿½è¸ª <code>ReflectiveGenericLifecycleObserver</code> å¯ä»¥çœ‹å‡ºï¼Œ <code>ClassesInfoCache</code> ç¼“å­˜äº† <code>LifecycleObserver</code> çš„ç±»å¯¹è±¡ï¼Œ<code>ReflectiveGenericLifecycleObserver</code> ä¹Ÿæ˜¯å‘ä¸‹ä¼ é€’ä¸€ä¸ª <code>LifecycleObserver</code>ã€‚ç”±æ­¤æˆ‘ä»¬å¯ä»¥åˆ¤æ–­å‡ºï¼Œå…¶å®è¿™ä¸ª <code>LifecycleObserver</code> å°±æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„è§‚å¯Ÿè€…ã€‚</p><p>è€Œç³»ç»Ÿå¸®æˆ‘åšçš„äº‹å„¿ï¼Œå°±æ˜¯ä½¿ç”¨åå°„æŠ€æœ¯ï¼Œé€šè¿‡æˆ‘ä»¬è‡ªå·±æ ‡æ³¨çš„æ³¨è§£ï¼Œå¹¶æ ¹æ®å½“å‰ç”Ÿå‘½å‘¨æœŸçš„çŠ¶æ€ï¼Œåå°„æ‰§è¡Œæˆ‘ä»¬çš„æ–¹æ³• <code>mInfo.invokeCallback(source event, mWrapped);</code></p><h4 id="reflect-invoke-method"><a href="#reflect-invoke-method" class="headerlink" title="reflect invoke method"></a><code>reflect invoke method</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">invokeCallback</span><span class="params">(LifecycleOwner source, Lifecycle.Event event, Object target)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//noinspection TryWithIdenticalCatches</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (mCallType) &#123;</span><br><span class="line">            <span class="keyword">case</span> CALL_TYPE_NO_ARG:</span><br><span class="line">                mMethod.invoke(target);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CALL_TYPE_PROVIDER:</span><br><span class="line">                mMethod.invoke(target, source);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CALL_TYPE_PROVIDER_WITH_EVENT:</span><br><span class="line">                mMethod.invoke(target, source, event);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Failed to call observer method"</span>, e.getCause());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜è®°å¾—æ–‡ç« å¼€å¤´å¯¹ <code>Lifecycle</code> æ³¨è§£çš„ç¿»è¯‘å—ï¼Ÿ è¿™é‡Œçš„åˆ¤æ–­å°±æ˜¯ä¾æ®å…¶æ³¨è§£æ ‡æ³¨ï¼Œå¹¶å›è°ƒå¯¹åº”çš„å‚æ•°æ–¹æ³•</p><p>è‡³æ­¤ï¼Œä¼¼ä¹æˆ‘ä»¬å·²ç»ä¸èƒ½å†è¿½ä¸‹å»äº†ï¼Œä»£ç æ‰§è¡Œåˆ°è¿™é‡Œå·²ç»ç»“æŸäº†ã€‚</p><p>ä½†æ˜¯ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</p><p>æˆ‘ä»¬è¿˜æœ‰ä¸€å¤§å—æ²¡æœ‰åˆ†æï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</p><h4 id="addObserver"><a href="#addObserver" class="headerlink" title="addObserver()"></a><code>addObserver()</code></h4><p>å‰é¢æˆ‘ä»¬è¯´äº†ä¸€å¤§å †ï¼Œéƒ½æ˜¯å¯¹ <code>Lifecycle</code> å¦‚ä½•å¤„ç†ï¼Œå¹¶ç›‘å¬æˆ‘ä»¬çš„ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ <code>Lifecycle</code>æ˜¯å¦‚ä½•å¤„ç†ç›‘å¬çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å‰é¢ä¸€ç›´éƒ½æ²¡æœ‰è¯´è¿‡ï¼Œè§‚å¯Ÿè€…é‚£é‡Œæ¥çš„ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p><p>å¥½ï¼Œæˆ‘ä»¬ç»§ç»­è§‚å¯Ÿ <code>LifecycleRegister</code> ä¸­çš„ <code>addObserver(LifecycleObserver)</code> è¿™ä¸ªä¹Ÿæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰è§‚å¯Ÿè€…åï¼Œéœ€è¦è°ƒç”¨çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(@NonNull LifecycleObserver observer)</span> </span>&#123;</span><br><span class="line">    State initialState = mState == DESTROYED ? DESTROYED : INITIALIZED;</span><br><span class="line">    ObserverWithState statefulObserver = <span class="keyword">new</span> ObserverWithState(observer, initialState);</span><br><span class="line">    ObserverWithState previous = mObserverMap.putIfAbsent(observer, statefulObserver);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (previous != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    LifecycleOwner lifecycleOwner = mLifecycleOwner.get();</span><br><span class="line">    <span class="keyword">if</span> (lifecycleOwner == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// it is null we should be destroyed. Fallback quickly</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> isReentrance = mAddingObserverCounter != <span class="number">0</span> || mHandlingEvent;</span><br><span class="line">    State targetState = calculateTargetState(observer);</span><br><span class="line">    mAddingObserverCounter++;</span><br><span class="line">    <span class="keyword">while</span> ((statefulObserver.mState.compareTo(targetState) &lt; <span class="number">0</span></span><br><span class="line">            &amp;&amp; mObserverMap.contains(observer))) &#123;</span><br><span class="line">        pushParentState(statefulObserver.mState);</span><br><span class="line">        statefulObserver.dispatchEvent(lifecycleOwner, upEvent(statefulObserver.mState));</span><br><span class="line">        popParentState();</span><br><span class="line">        <span class="comment">// mState / subling may have been changed recalculate</span></span><br><span class="line">        targetState = calculateTargetState(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isReentrance) &#123;</span><br><span class="line">        <span class="comment">// we do sync only on the top level.</span></span><br><span class="line">        sync();</span><br><span class="line">    &#125;</span><br><span class="line">    mAddingObserverCounter--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å“ˆå“ˆï¼Œçœ‹èµ·æ¥ä»£ç å¹¶ä¸æ˜¯å¾ˆå¤šä¸«ï¼ï¼ï¼ï¼   å“¼ï¼Œå¤©çœŸçš„ä½ ï¼ä½†å®ƒå°±æ˜¯è¿™ä¹ˆå¤š</p><p>æˆ‘ä»¬è¿™é‡Œè¦é€è¡Œæ¸…ç‚¹</p><p><code>State initialState = mState == DESTROYED ? DESTROYED : INITIALIZED;</code> å—¯ï¼Œä¸€ä¸Šæ¥å°±åˆå§‹åŒ–äº†ä¸€ä¸ª <code>INITIALIZED</code> çŠ¶æ€çš„çŠ¶æ€ï¼Œå“ˆå“ˆå“ˆï¼Œå¥½æ‹—å£ã€‚</p><p>éšååˆ›å»ºäº†ä¸€ä¸ª <code>ObserverWithState</code> ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„è§‚å¯Ÿè€…ï¼Œä»åå­—ä¸Šæˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯æˆ‘ä»¬ä¼ å…¥çš„è§‚å¯Ÿè€…å’Œæˆ‘ä»¬åˆšåˆšåˆ›å»ºå¥½çš„çŠ¶æ€ã€‚è¿™æ˜¯ä¸ªè£…é¥°å™¨æ¨¡å¼ï¼Œç›®çš„æ˜¯ç»™åŸå¯¹è±¡ï¼Œå¢åŠ ä¸€ä¸ªæ–°å±æ€§ï¼Œä½†åˆä¸æ”¹å˜åŸæ•°æ®ç»“æ„çš„æ–¹æ¡ˆã€‚</p><p>ç´§æ¥ç€åˆæŠŠè¿™ä¸ªè§‚å¯Ÿè€…å’Œå¸¦æœ‰çŠ¶æ€çš„è§‚å¯Ÿè€…ï¼Œæ”¾è¿›äº†äº‹å…ˆå·²ç»åˆ›å»ºå¥½çš„ <code>Map</code> ä¸­ï¼Œä¹Ÿå°±æ˜¯ <code>mObserverMap</code> ç„¶åè¿”å›äº†ä¸ªä¸œè¥¿ï¼Œ é˜…è¯»åå‘ç°ï¼Œåˆå’Œ <code>Lifecycle</code> çš„æ³¨é‡Šå¯¹ä¸Šäº†ã€‚</p><p>ä¹‹åï¼Œè®¡ç®—å‡ºå½“å‰ <code>Activity</code> æˆ– <code>Fragment</code> çš„çŠ¶æ€ï¼Œå¹¶åˆ¤æ–­ï¼Œå¦‚æœå½“å‰è§‚å¯Ÿè€…çš„çŠ¶æ€è½åäº <code>Activity</code> æˆ– <code>Fragment</code> çš„çŠ¶æ€ï¼Œåˆ™ç«‹å³æ‰§è¡Œ<code>dispatchEvent()</code> æ–¹æ³•ï¼Œæ‰§è¡Œå›è°ƒã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è®¤çœŸé˜…è¯»æºç åï¼Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹å‡ºï¼Œå…¶å® <code>Lifecycle</code> çš„æŠ€æœ¯å¾ˆç®€å•ï¼Œåªæœ‰<strong>åå°„</strong>ï¼Œ<strong>è§‚å¯Ÿè€…</strong>ï¼Œ<strong>è£…é¥°å™¨</strong>ï¼Œå®ƒå°†è¿™ä¸‰ä¸ªä¸œè¥¿åº”ç”¨çš„å¾ˆç¥ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œåˆ†ææºç æˆ‘ä»¬ä»ä¸¤æ–¹é¢å…¥æ‰‹</p><ol><li><p><code>addObserver()</code></p><p> è¿™ä¸ªæ–¹æ³•æ˜¯å¯¹ç”¨æˆ·æœ€ç›´æ¥çš„å†…å®¹ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>Observer</code> åï¼Œéƒ½ä¼šé€šè¿‡ <code>add</code> çš„æ–¹å¼ï¼Œå°†æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„è§‚å¯Ÿè€…ä¼ å…¥ï¼Œé‚£ä¹ˆä»è¿™ä¸ªçªç ´å£æˆ‘ä»¬è¿›å…¥æºç åˆ†æè§‚å¯Ÿåˆ°</p><ol><li>ç»™è¦æ·»åŠ çš„<code>Observer</code> ä¸€ä¸ªåˆå§‹çš„çŠ¶æ€ï¼ˆè£…é¥°å™¨æ¨¡å¼ï¼ŒåŒ…è£…æ•°æ®ï¼‰</li><li>å°†æ•°æ®å­˜å‚¨å†æœ¬åœ°ç¼“å­˜ä¸­ ï¼ˆ<code>mObserverMap</code>ï¼‰</li><li>ç«‹å³è¿›è¡ŒçŠ¶æ€åˆ¤æ–­ï¼Œå†³å®šæ˜¯å¦å¤„ç†ç”Ÿå‘½å‘¨æœŸå˜åŒ–</li></ol></li><li><p><code>ReportFragment</code></p><p>ä½œç”¨æ˜¯ï¼Œé™„ç€å† <code>Activity</code> ä¸Šï¼Œç”¨æ¥æ„ŸçŸ¥ <code>Activity</code> çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–ï¼Œä¹Ÿèµ·åˆ°å°†ä¸šåŠ¡ä» <code>Activity</code> ä¸­åˆ†ç¦»å‡ºæ¥ã€‚é€šè¿‡ç”Ÿå‘½æ„ŸçŸ¥ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–ï¼Œæ‰§è¡Œ <code>dispatch()</code> æ–¹æ³•ï¼Œå°†ç”Ÿå‘½å‘¨æœŸäº‹ä»¶åˆ†å‘ç»™å®ƒæ‰€æœ‰çš„è§‚å¯Ÿè€…å»å¤„ç†æ¶ˆæ¯ <code>handleLifecycleEvent</code></p></li><li><p><strong>åå°„</strong></p><p>è¿™é‡Œçš„ä¸œè¥¿æ¯”è¾ƒæŠ½è±¡ï¼Œæ²¡æœ‰ä»»ä½•å†…å®¹æ˜¯èƒ½çœ‹å‡ºæ¥å’Œæˆ‘ä»¬æœ‰ä»€ä¹ˆå…³ç³»çš„ï¼Œ åªè¦ä½ ç†Ÿæ‚‰åå°„ï¼Œé‚£ä¹ˆä½ å°±èƒ½æ˜ç™½å®ƒå†åšä»€ä¹ˆã€‚</p></li><li><p><code>sync()</code></p><p>è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥å¿«é€ŸåŒæ­¥è§‚å¯Ÿè€…çŠ¶æ€ä¸ <code>Activity</code> å’Œ <code>Fragment</code>  ï¼Œç›®çš„ä¹Ÿæ˜¯èƒ½å¤Ÿè®©è§‚å¯Ÿè€…æ‰§è¡Œåˆ°å®ƒæ‰€æœ‰è§‚å¯Ÿçš„æ•°æ®ã€‚ä¸¤ä¸ªæ–¹æ³• <code>forwardPass()</code> å’Œ <code>backwardPass()</code>  æ˜¯å…¶å®ç°çš„åŸç†ã€‚</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼€å§‹æ˜¯åºŸè¯ï¼ˆç¿»è¯‘è‡ªæºç ï¼‰&quot;&gt;&lt;a href=&quot;#å¼€å§‹æ˜¯åºŸè¯ï¼ˆç¿»è¯‘è‡ªæºç ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;å¼€å§‹æ˜¯åºŸè¯ï¼ˆç¿»è¯‘è‡ªæºç ï¼‰&quot;&gt;&lt;/a&gt;å¼€å§‹æ˜¯åºŸè¯ï¼ˆç¿»è¯‘è‡ªæºç ï¼‰&lt;/h2&gt;&lt;p&gt;å®šä¹‰äº†ä¸€ä¸ª Android ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ã€‚ &lt;code&gt;Fragment&lt;/code&gt;å’Œ&lt;code&gt;FragmentActivity&lt;/code&gt;ç±»å®ç°&lt;code&gt;LifecycleOwner&lt;/code&gt;æ¥å£ï¼Œ å¹¶å¯ä»¥é€šè¿‡ &lt;code&gt;getLifecycle()&lt;/code&gt; æ–¹æ³•æ¥è®¿é—®ç”Ÿå‘½å‘¨æœŸã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°&lt;code&gt;LifecycleOwner&lt;/code&gt;åœ¨è‡ªå·±çš„ç±»ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// åœ¨æ­¤ç±»äº‹ä»¶ååˆ†å‘ LifecycleOwner çš„ç›¸å…³æ–¹æ³•çš„è¿”å›æ—¶ã€‚ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Lifecycle.Event.ON_CREATE ï¼Œ Lifecycle.Event.ON_START ï¼Œ Lifecycle.Event.ON_RESUME&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// åœ¨æ­¤ç±»äº‹ä»¶åœ¨ä¹‹å‰åˆ†æ´¾LifecycleOwnerè¢«ç§°ä¸ºçš„ç›¸å…³æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œ Lifecycle.Event.ON_STARTåä¼šè¢«åˆ†æ´¾onStartå›æŠ¥ï¼Œ Lifecycle.Event.ON_STOPä¹‹å‰å°†æ´¾å‡ºonStopè¢«è°ƒç”¨ã€‚ è¿™ç»™ä½ ä¸€å®šçš„ä¿è¯åœ¨å…¶å›½å®¶çš„ä¸»äººåœ¨ä¸åœ¨ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Lifecycle.Event.ON_PAUSE ï¼Œ Lifecycle.Event.ON_STOP ï¼Œ Lifecycle.Event.ON_DESTROY&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Android,Jetpack" scheme="http://xiaoman.ren/tags/Android-Jetpack/"/>
    
  </entry>
  
  <entry>
    <title>RecyclerView</title>
    <link href="http://xiaoman.ren/2020/07/09/RecyclerView/"/>
    <id>http://xiaoman.ren/2020/07/09/RecyclerView/</id>
    <published>2020-07-09T12:33:30.000Z</published>
    <updated>2020-07-09T12:36:43.281Z</updated>
    
    <content type="html"><![CDATA[<h1 id="RechclerView-æ€»ç»“"><a href="#RechclerView-æ€»ç»“" class="headerlink" title="RechclerView æ€»ç»“"></a>RechclerView æ€»ç»“</h1><p><img src="https://github.com/xiaomanwong/static_file/blob/master/images/image-20200709164241306.png?raw=true" alt="image-20200709164241306"></p><p>Recycler Viewï¼š è´Ÿè´£å°† Datas å±•ç¤ºåœ¨è‡ªå·±èº«ä¸Šï¼Œå…¶æœ¬èº«æ˜¯ä¸€ä¸ª ViewGroupï¼Œåªè®¤è¯† Viewï¼Œå› æ­¤éœ€è¦ä¸€ä¸ª Adapter æ¥å°† Datas çš„å†…å®¹è½¬æ¢ä¸º View</p><p>Adapterï¼š è´Ÿè´£ç¿»è¯‘ï¼Œå°† Datas å†…å®¹ï¼Œè½¬æ¢ä¸º Viewï¼Œæ–¹ä¾¿ RecyclerView å±•ç¤º</p><p>ViewHolderï¼š RecyclerView åªä¼šä¸ ViewHolder è¿›è¡Œäº¤äº’ï¼Œå› æ­¤ ViewHolder å……å½“ä¸­é—´ä»¶ï¼Œæ¥å°† Datas çš„å†…å®¹ä¼ é€’ç»™  RecyclerView</p><p>LayoutManagerï¼šè´Ÿè´£å¸ƒå±€ï¼ŒRecyclerView å°†å…¶å­ View çš„å¸ƒå±€ç®¡ç†ï¼Œäº¤ç»™å®ƒæ¥å®Œæˆ</p><p>Recyclerï¼šè´Ÿè´£ç®¡ç† View çš„ç”Ÿå‘½å‘¨æœŸï¼ŒLayoutManager åªç®¡è´Ÿè´£ View çš„å¸ƒå±€ä»»åŠ¡ï¼Œå¯¹å…¶å›æ”¶äº¤ç»™äº† Recycler æ¥å¤„ç†ï¼Œé¿å…é€ æˆä¸å¿…è¦çš„é”™è¯¯</p><p>ItemAnimatorï¼š è´Ÿè´£åŠ¨ç”»ï¼Œå½“ RecyclerView ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼ˆå¢ã€åˆ ç­‰ï¼‰éƒ½ä¼šé€šè¿‡å®ƒæ¥å®Œæˆå¹³æ»‘çš„è¿‡æ¸¡</p><a id="more"></a><h2 id="RecyclerView-çš„ç»˜åˆ¶"><a href="#RecyclerView-çš„ç»˜åˆ¶" class="headerlink" title="RecyclerView çš„ç»˜åˆ¶"></a>RecyclerView çš„ç»˜åˆ¶</h2><p>RecyclerView æ— ç–‘ä¹Ÿæ˜¯ä¸€ä¸ª View ï¼ŒView çš„ç»˜åˆ¶åŒæ ·é€ƒç¦»ä¸äº†ä¸‰å¤§æ­¥éª¤ <code>onMeasure()</code> <code>onLayout()</code> <code>onDraw()</code> </p><h3 id="onMeasure"><a href="#onMeasure" class="headerlink" title="onMeasure"></a>onMeasure</h3><p>LayoutManager è´Ÿè´£ RecyclerView çš„ç»˜åˆ¶ï¼Œå…¶æœ‰ä¸€ä¸ª <code>mAutoMeasure</code> å±æ€§ï¼Œç”¨æ¥æ§åˆ¶æ˜¯å¦å¼€å¯è‡ªåŠ¨æµ‹é‡ï¼Œå¼€å¯æƒ…å†µä¸‹ï¼Œå¸ƒå±€äº¤ç”± <code>RecyclerView</code> ä½¿ç”¨ä¸€å¥—é»˜è®¤çš„æµ‹é‡æœºåˆ¶ï¼›å¦åˆ™ï¼Œè‡ªå®šä¹‰çš„ LayoutManager éœ€è¦é‡å†™ <code>onMeasure</code> æ¥å¤„ç†è‡ªèº«çš„æµ‹é‡å·¥ä½œã€‚</p><ul><li><p>è‡ªåŠ¨æµ‹é‡åŸç†ï¼š</p><p>å½“ RecyclerView çš„å®½é«˜éƒ½ä¸º <code>EXACTLY</code> æ—¶ï¼Œ å¯ä»¥ç›´æ¥è®¾ç½®å¯¹åº”çš„å®½é«˜ï¼Œç„¶åè¿”å›ï¼Œç»“æŸæµ‹é‡</p><p>å¦‚æœå®½é«˜éƒ½ä¸æ—¶ <code>EXACTLY</code> åˆ™ä¼šåœ¨ <code>onMeasure</code> ä¸­å¼€å§‹å¸ƒå±€çš„å¤„ç†ã€‚</p><p>RecyclerView.State è¿™ä¸ªç±»å°è£…äº†å½“å‰ RecyclerView çš„ä¿¡æ¯ã€‚State ä¸­çš„ä¸€ä¸ªå˜é‡ <code>mLayoutStep</code> è®°å½•äº† RecyclerView  å½“å‰çš„å¸ƒå±€çŠ¶æ€</p><ul><li>STEP_START</li><li>STEP_LAYOUT</li><li>STEP_ANIMATIONS</li></ul><p>å¯¹åº”çš„ï¼Œ RecyclerView çš„å¸ƒå±€è¿‡ç¨‹ä¹Ÿåˆ†ä¸ºä¸‰æ­¥ï¼ŒSTEP_START è¡¨ç¤ºå¼€å§‹å¸ƒå±€ï¼Œå¯¹åº”éœ€è¦è°ƒç”¨ <code>dispatchLayoutStep1()</code> æ¥æ‰§è¡Œç¬¬ä¸€æ­¥å¸ƒå±€ï¼Œç»“æŸåï¼Œ <code>mLayoutStep</code> å˜ä¸º STEP_LAYOUT ï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥éœ€è¦è°ƒç”¨ <code>dispatchLayoutStep2()</code> è¿›è¡Œå¸ƒå±€ï¼Œç»“æŸå <code>mLayoutStep</code> å˜ä¸º STEP_ANIMATIONS, ç»§ç»­æ‰§è¡Œç¬¬ä¸‰æ­¥ <code>dispatchLayoutStep3()</code></p><ul><li>dispatchLayoutStep1:  è´Ÿè´£è®°å½•çŠ¶æ€</li><li>dispatchLayoutStep2ï¼šè´Ÿè´£å¸ƒå±€</li><li>dispatchLayoutStep3ï¼šä¸ step1 æ¯”è¾ƒï¼Œæ ¹æ®å˜åŒ–æ¥è§¦å‘åŠ¨ç”»</li></ul><h3 id="onLayout"><a href="#onLayout" class="headerlink" title="onLayout"></a>onLayout</h3></li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    TraceCompat.beginSection(TRACE_ON_LAYOUT_TAG);</span><br><span class="line">    dispatchLayout();</span><br><span class="line">    TraceCompat.endSection();</span><br><span class="line">    mFirstLayoutComplete = <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dispatchLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mState.mIsMeasuring = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(mState.mLayoutStep == State.STEP_START) &#123;</span><br><span class="line">        dispatchLayoutStep1();</span><br><span class="line">        mLayout.setExactMeasureSpecsFrom(<span class="keyword">this</span>);</span><br><span class="line">        dispatchLayoutStep2();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(mAdapterHelper.hasUpdates() </span><br><span class="line">              || mLayout.getWidth() != getWidth() </span><br><span class="line">              || mLayout.getHeight() != getHeight()) &#123;</span><br><span class="line">        <span class="comment">// first 2 steps are done in onMeasure but looks like we have to run again due to changed size</span></span><br><span class="line">        mLayout.setExactMeasureSpecsFrom(<span class="keyword">this</span>);</span><br><span class="line">        dispatchLayoutStep2();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// always make sure we sync them (to ensure mode is exact)</span></span><br><span class="line">        mLayout.setExactMeasureSpecsFrom(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    dispatchLayoutStep3();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  é€šè¿‡ <code>dispatchLayout</code> å¯ä»¥éªŒè¯RecyclerView çš„ layoutä¸‰æ­¥èµ°åŸåˆ™ï¼Œå¦‚æœåœ¨ <code>onMeasure</code> ä¸­å·²ç»å®Œæˆäº† step1 å’Œ step2 ï¼Œåˆ™åªä¼šæ‰§è¡Œ step3ï¼Œå¦åˆ™ï¼Œä¼šåœ¨ <code>onLayout</code> ä¸­ä¾æ¬¡è§¦å‘ä¸‰æ­¥èµ°ã€‚</p><h4 id="dispatchLayoutStep1"><a href="#dispatchLayoutStep1" class="headerlink" title="dispatchLayoutStep1"></a>dispatchLayoutStep1</h4>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dispatchLayoutStep1</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(mState.mRunSimpleAnimations) &#123;</span><br><span class="line">        <span class="keyword">int</span> count = mChildHelper.getChildCount();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> ViewHolder holder = getChildViewHolderInt(mChildHelper.getChildAt(i));</span><br><span class="line">            <span class="keyword">final</span> ItemHolderInfo animationInfo = mItemAnimator.recordPreLayoutInformation(mState, holder, ItemAnimator.buildAdapterChangeFlagsForAnimations(holder), holder.getUnmodifiedPayloads());</span><br><span class="line">            mViewInfoStore.addToPreLayout(holder, animationInfo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mState.mLayoutStep = State.STEP_LAYOUT</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  step çš„ç¬¬ä¸€æ­¥ç›®çš„å°±æ˜¯è®°å½• View çš„çŠ¶æ€ï¼Œå…ˆéå†å½“å‰æ‰€æœ‰ Viewï¼Œä¸€æ¬¡è¿›è¡Œå¤„ç†ï¼ŒmItemAnimator ä¼šæ ¹æ®æ¯ä¸ª View çš„ä¿¡æ¯ï¼Œå°è£…ä¸€ä¸ª ItemHolderInfo, è¿™ä¸ª ItemHolderInfo ä¸­ä¸»è¦åŒ…å«çš„å°±æ˜¯ View çš„ä½ç½®çŠ¶æ€ç­‰ã€‚ç„¶åå°† ItemHodlerInfo å­˜å…¥ mViewInfoStore ä¸­ã€‚åœ¨è¿›å…¥ç¬¬äºŒæ­¥åï¼Œ View çš„ä¿¡æ¯å°±å°†è¢«æ”¹å˜</p><h4 id="dispatchLayoutStep2"><a href="#dispatchLayoutStep2" class="headerlink" title="dispatchLayoutStep2"></a>dispatchLayoutStep2</h4>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dispatchLayoutStep2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    mLayout.onLayoutChildren(mRecycler, mState);</span><br><span class="line">    </span><br><span class="line">    mState.mLayoutStep = State.STATE_ANIMATIONS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  layout çš„ç¬¬äºŒæ­¥å°±æ˜¯çœŸæ­£çš„å¸ƒå±€ Viewã€‚RecyclerView çš„çœŸæ­£å¸ƒå±€æ˜¯ç”± LayoutManger æ¥è´Ÿè´£çš„ï¼Œå…¶ä¸»è¦å·¥ä½œä¹Ÿåœ¨ LayoutManager ä¸­ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">onLayoutChildren</span><span class="params">(RecyclerView.Recycler recycler, RecyclerView.State state)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!mAnchorInfo.mValid </span><br><span class="line">      || mPendingScrollPosition != NO_POSITION </span><br><span class="line">      || mPendingSavedState != <span class="keyword">null</span>) &#123;</span><br><span class="line">        updateAnchorInfoForLayout(recycler, state, mAnchorInfo);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(mAnchorInfo.mLayoutFromEnd) &#123;</span><br><span class="line">        firstLayoutDirection = mShouldReverseLayout </span><br><span class="line">            ? LayoutState.ITEM_DIRECTIONTAIL</span><br><span class="line">            : LayoutState.ITEM_DIRECTION_HEAD;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        firstLayoutDirection = mShouldReverseLayout </span><br><span class="line">            ? LayoutState.ITEM_DIRECTION_HEAD</span><br><span class="line">            : LayoutState.ITEM_DIRECTION_TAIL;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    onAnchorReady(recycler, state, mAnchorInfo, firstLayoutDirection);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(mAnchorInfo.mLayoutFromEnd) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// fill towards end</span></span><br><span class="line">        updateLayouStateToFillEnd(mAnchorInfo);</span><br><span class="line">        fill(recycler, mLayoutState, state, <span class="keyword">false</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// fill towards start</span></span><br><span class="line">        updateLayoutStateToFillStart(mAnchorInfo);</span><br><span class="line">        fill(recycler, mLayoutState, state, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  æµç¨‹å¾ˆè´Ÿè´£ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹</p><ul><li>æ‰¾åˆ° anchorç‚¹</li><li>æ ¹æ® anchor ä¸€ç›´å‘å‰å¸ƒå±€ï¼Œç›´åˆ°å¡«å……æ»¡ anchor ç‚¹å‰é¢çš„æ‰€æœ‰åŒºåŸŸ</li><li><p>æ ¹æ® anchor ä¸€ç›´å‘åå¸ƒå±€ï¼Œç›´åˆ°å¡«å……æ»¡ anchor ç‚¹åé¢çš„æ‰€æœ‰åŒºåŸŸ</p><p>anchor ç‚¹çš„å¯»æ‰¾æ˜¯ç”± <code>updateAnchorInfoForLayout</code> å‡½æ•°è´Ÿè´£ã€‚å‘ä¸‹è¿½è¸ªä¼šçœ‹åˆ° <code>updateAnchorFromChildren</code>  æ–¹æ³•ï¼Œå…¶å†…å®¹ä¸ºï¼Œå…ˆå¯»æ‰¾è¢« focus çš„ childï¼Œ æ‰¾åˆ°ä»¥æ­¤ child ä½œä¸º anchor ï¼Œå¦åˆ™æ ¹æ®å¸ƒå±€æ–¹å‘å¯»æ‰¾æœ€åˆé€‚çš„ child æ¥ä½œä¸º anchorï¼Œå¦‚æœæ‰¾åˆ°åˆ™å°† child çš„ä¿¡æ¯å¤åˆ¶ç»™ anchorInfo ã€‚ <code>anchorInfo</code> ä¸»è¦è®°å½•çš„ä¿¡æ¯å°±æ˜¯ View çš„ç‰©ç†ä½ç½®ä¸ Adapter ä¸­çš„ä½ç½®ã€‚æ‰¾åˆ°åè¿”å› trueï¼Œå¦åˆ™è¿”å› falseï¼Œäº¤ç»™ä¸Šä¸€æ­¥å‡½æ•°åšå¤„ç†ã€‚</p><p>ç»§ç»­å½“æ‰¾åˆ° anchor åï¼Œä¼šæ ¹æ® anchor æ¥å¸ƒå±€ï¼Œé€šè¿‡ fill æ–¹æ³•æ¥å®Œæˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fill</span><span class="params">(RecyclerView.Recycler recycler, LayoutState layoutState, RecyclerView.state state, <span class="keyword">boolean</span> stopOnFocusable)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> start = layoutState.mAvailable;</span><br><span class="line">    <span class="keyword">if</span>(layoutState.mScrollingOffset != LayoutState.SCROLLING_OFFSET_NaN) &#123;</span><br><span class="line">        recycleByLayoutState(recycler, layoutState);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> remainingSpace = layoutState.mAvailable + layoutState.mExtra;</span><br><span class="line">    LayoutChunkResult layoutChunkResult = mLayoutChunkResult;</span><br><span class="line">    <span class="keyword">while</span>((layoutState.mInfinite || remainingSpace &gt; <span class="number">0</span>)</span><br><span class="line">         &amp;&amp; layoutState.hasMore(state)) &#123;</span><br><span class="line">        layoutChunk(recycler, state, layoutState, layoutChunkResult);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> start-layoutState.mAvailable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>recycleByLayoutState</strong> è¿™ä¸ªå‡½æ•°ï¼Œä¼šæ ¹æ®å½“å‰ä¿¡æ¯å¯¹ä¸éœ€è¦çš„ View è¿›è¡Œå›æ”¶:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">recycleByLayoutState</span><span class="params">(RecyclerView.Recycler recycler, LayoutState layoutState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(layoutState.mLayoutDirection == LayoutState.LAYOUT_START) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        recycleViewsFromStart(recycler, layoutState.mScrollingOffset);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­çœ‹ <code>recycleViewsFromStart</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">recycleViewsFromStart</span><span class="params">(RecyclerView.Recycler recycler, <span class="keyword">int</span> dt)</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> limit = dt;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> childCount = getChildCount();</span><br><span class="line">    <span class="keyword">if</span>(mShouldReverseLayout) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++)&#123;</span><br><span class="line">            View child = getChildAt(i);</span><br><span class="line">            <span class="keyword">if</span>(mOrientationHelper.getDecoratedEnd(child) &gt; limit</span><br><span class="line">              || mOrientationHelper.getTransformedEndWithDecoration(child) &gt; limit) &#123;</span><br><span class="line">        recycleChildren(recycler, <span class="number">0</span>, i);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°çš„ä½œç”¨æ—¶éå†æ‰€æœ‰çš„å­ View ,æ‰¾å‡ºé€ƒç¦»è¾¹ç•Œçš„ View è¿›è¡Œå›æ”¶ï¼Œå›æ”¶å‡½æ•°åœ¨ <code>recycleChildren</code> é‡Œï¼Œè€Œè¿™å‡½æ•°åˆè°ƒç”¨äº† <code>removeAndRecycleViewAt</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeAndRecycleViewAt</span><span class="params">(<span class="keyword">int</span> index, Recycler recycler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> View view = getChildAt(index);</span><br><span class="line">    removeViewAt(index);</span><br><span class="line">    recycler.recycleView(view);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°å…ˆè°ƒç”¨ <code>removeViewAt</code> ï¼Œå°† View ä» RecyclerView ä¸­ç§»é™¤ï¼Œç´§æ¥ç€æ˜¯ recycler æ‰§è¡Œäº† View çš„å›æ”¶é€»è¾‘ã€‚åœ¨ fill å‡½æ•°çš„ä¸€å¼€å§‹ä¼šå»å›æ”¶é€ƒç¦»å‡ºå±å¹•çš„ viewã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>((layoutState.mInfinite || remainningSpace &gt; <span class="number">0</span>) </span><br><span class="line">     &amp;&amp; layoutState.hasMore(state)) &#123;</span><br><span class="line">    layoutChunk(recycler, state, layoutState, layoutChunkResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªè¦åˆå‰©ä½™ç©ºé—´ï¼Œå°±ä¼šæ‰§è¡Œ layoutChunk æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">layoutChunk</span><span class="params">(RecyclerView.Recycler recycler, RecyclerView.State stat, LayoutState layoutState, LayoutCHunkResult result)</span></span>&#123;</span><br><span class="line">    View view = layoutState.next(recycler);</span><br><span class="line">    </span><br><span class="line">    LayoutParams params = (LayoutParams) view.getLayoutParams();</span><br><span class="line">    <span class="keyword">if</span>(layoutState.mScrapList == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(mShouldReverseLayout == (layoutState.mLayoutDirection == LayoutState.LAYOUT_START)) &#123;</span><br><span class="line">            addView(view);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            addView(view, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    layoutDecoratedWithMargins(view, left, top, right, bottom);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ layoutState çš„ next æ–¹æ³•è¿”å›äº†ä¸€ä¸ª viewï¼Œ å‡­ç©ºå˜å‡ºä¸€ä¸ª Viewï¼Œ å¾ˆç¥å¥‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">View <span class="title">next</span><span class="params">(RecyclerView.Recycler recycler )</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> View view = recycler.getViewForPosition(mCurrentPosition);</span><br><span class="line">    <span class="keyword">return</span> view;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯è§ view çš„è·å–é€»è¾‘ä¹Ÿæ˜¯ç”± recycler æ¥è´Ÿè´£ï¼Œ æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ¸…æ¥š recycler å¯ä»¥æ ¹æ®ä½ç½®è¿”å›ä¸€ä¸ª View å³å¯ã€‚</p><p>æˆ‘ä»¬åœ¨çœ‹ layoutChunk å¯¹åˆšåˆšç”Ÿæˆçš„ View çš„å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(mShouldReverseLayout == (layoutState.mLayoutDirectoin == LayoutState.LAYOUT_STATE)) &#123;</span><br><span class="line">    addView(view);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    addView(view, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜æ˜¾çš„è°ƒç”¨äº† addView æ–¹æ³•ï¼Œè™½ç„¶è¿™ä¸ªæ–¹æ³•æ˜¯ LayoutManager çš„ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æœ€ç»ˆä¼šå¤šæ¬¡è¾—è½¬è°ƒç”¨åˆ° Recycler View çš„ addView æ–¹æ³•ï¼Œå°† view æ·»åŠ åˆ° RecyclerView ä¸­ã€‚</p><p>dispatchLayoutStep2 æ•´ä¸ªå¸ƒå±€è¿‡ç¨‹ï¼Œå®Œæˆäº†å¯¹ å­ View çš„æµ‹é‡ä¸å¸ƒå±€</p><h4 id="dispatchLayoutStep3"><a href="#dispatchLayoutStep3" class="headerlink" title="dispatchLayoutStep3"></a>dispatchLayoutStep3</h4><p>æœ€åä¸€æ­¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dispatchLayoutStep3</span><span class="params">()</span></span>&#123;</span><br><span class="line">    mState.mLayoutStep = State.STEP_START;</span><br><span class="line">    <span class="keyword">if</span>(mState.mRunSimpleAnimations) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = mChildHelper.getChildCount() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">final</span> ItemHolderInfo animationInfo = mItemAnimator.recordPostLayoutInformation(mState, holder);</span><br><span class="line">            mViewInfoStore.addToPostLayout(holder, animationInfo);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        mViewInfoStore.process(mViewInfoProcessCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯ä¸ç¬¬ä¸€æ­¥å‘¼åº”çš„ï¼Œæ­¤æ—¶å­ View éƒ½å·²å¸ƒå±€å®Œæˆï¼Œæ‰€ä»¥å­ View çš„ä¿¡æ¯éƒ½å‘ç”Ÿäº†å˜åŒ–ã€‚ç¬¬ä¸€æ­¥å‡ºç°çš„ mViewInfoStore å’Œ mItemAnimator å†æ¬¡ç™»åœºï¼Œè¿™æ¬¡ mItemAnimator è°ƒç”¨çš„æ˜¯ recordPostLayoutInformation æ–¹æ³•ï¼Œè€Œ mViewInfoStore è°ƒç”¨çš„æ˜¯ addToPostLayout æ–¹æ³•ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addToPostLayout</span><span class="params">(ViewHolder holder, ItemHolderInfo info)</span> </span>&#123;</span><br><span class="line">    InfoRecord record = mLayoutHolderMap.get(holder);</span><br><span class="line">    <span class="keyword">if</span>(record == <span class="keyword">null</span> ) &#123;</span><br><span class="line">        record = InfoRecord.obtain();</span><br><span class="line">        mLayoutHolderMap.put(holder, record);</span><br><span class="line">    &#125;</span><br><span class="line">    record.postInfo = info;record.flags |= FLAT_POST;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€å mViewInfoStore è°ƒç”¨äº† process æ–¹æ³•ï¼Œæ ¹æ® mViewInfoStore ä¸­çš„ View ä¿¡æ¯ï¼Œæ¥æ‰§è¡ŒåŠ¨ç”»é€»è¾‘ã€‚</p></li></ul><h3 id="ç¼“å­˜é€»è¾‘"><a href="#ç¼“å­˜é€»è¾‘" class="headerlink" title="ç¼“å­˜é€»è¾‘"></a>ç¼“å­˜é€»è¾‘</h3><p>  RecyclerView çš„ç¼“å­˜æ—¶åˆ†ä¸ºå¤šçº§çš„ï¼Œä½†å…¶å®çœŸä¸ªé€»è¾‘å¾ˆå¥½ç†è§£ï¼Œ</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">View <span class="title">getViewForPosition</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">boolean</span> dryRun)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> fromScrap = <span class="keyword">false</span>;</span><br><span class="line">    ViewHolder holder = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(mState.isPreLayout()) &#123;</span><br><span class="line">        holder = getChangedScrapViewForPosition(position);</span><br><span class="line">fromScrap = holder != <span class="keyword">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(hoder == <span class="keyword">null</span>) &#123;</span><br><span class="line">        hodler = getScrapViewForPosition(position, INVALID_TYPE, dryRun);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(holder == <span class="keyword">null</span> )&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> offsetPosition = mAdapterHelper.findPositionOffset(position);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> type = mAdapter.getItemViewType(offsetPosition);</span><br><span class="line">        <span class="keyword">if</span>(mAdapter.hasStableIds())&#123;</span><br><span class="line">            holder = getScrapViewForId(mAdapter.getItemId(offsetPosition), type, dryRun);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(holder == <span class="keyword">null</span> &amp;&amp; mViewCacheExtension != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">final</span> View view = mViewCacheExtension.getViewForPositionAndType(<span class="keyword">this</span>, position, type);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(holder == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// fallback to recycler</span></span><br><span class="line">            holder = getRecyclerViewPool().getRecyclerView(type);</span><br><span class="line">            <span class="keyword">if</span>(holder != <span class="keyword">null</span>)&#123;</span><br><span class="line">                holder.resetInternal();</span><br><span class="line">                <span class="keyword">if</span>(FORCE_INVALIDATE_DISPLAY_LIST)&#123;</span><br><span class="line">                    invalidateDisplayListInt(holder);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(holder == <span class="keyword">null</span> )&#123;</span><br><span class="line">            holder = mAdapter.createViewHolder(RecyclerView.<span class="keyword">this</span>, type);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”Ÿæˆ LayoutParams çš„ä»£ç </span></span><br><span class="line">    <span class="keyword">return</span> holder.itemView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å– View çš„é€»è¾‘å¯ä»¥æ•´ç†ä¸º</p><ul><li>æœç´¢ mChangedScrapï¼Œ å¦‚æœæ‰¾åˆ°åˆ™è¿”å›ç›¸åº”çš„ holder</li><li>æœç´¢ mAttachedScrapä¸ mCachedViewsï¼Œ å¦‚æœæ‰¾åˆ°ä¸” holder æœ‰æ•ˆåˆ™è¿”å›ç›¸åº”çš„ holder</li><li>å¦‚æœè®¾ç½®äº† mViewCacheExtension, å¯¹å…¶è°ƒç”¨ getViewForPositionAndType æ–¹æ³•è¿›è¡Œè·å–ï¼Œè‹¥è¿”å›ç»“æœåˆ™ç”Ÿæˆå¯¹åº”çš„ holder</li><li>æœç´¢ mRecyclerPool, å¦‚æœæ‰¾åˆ°åˆ™è¿”å› Holder</li><li>å¦‚æœä¸Šè¿°è¿‡ç¨‹éƒ½æ²¡æœ‰æ‰¾åˆ°å¯¹é¥®çš„ holder, åˆ™æ‰§è¡Œ Adapter.createViewHolder(); åˆ›å»ºæ–°çš„ ViewHolder å®ä¾‹</li></ul><p>å¯¹äº View çš„å›æ”¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recycleViewHolderInternal</span><span class="params">(ViewHolder holder )</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(holder.isRecyclable()) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!holder.hasAnyOfTheFlags(VieHolder.FLAG_INVALID | ViewHolder.FLAG_REMOVED) | ViewHolder.FLAG_UPDATE) &#123;</span><br><span class="line">            <span class="keyword">int</span> cachedViewSize = mCachedViews.size();</span><br><span class="line">            <span class="keyword">if</span>(cachedViewSize &gt;= mViewCacheMax &amp;&amp; cachedViewSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                recycleCachedViewAt(<span class="number">0</span>);</span><br><span class="line">                cachedViewSize--;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(cachedViewSize &lt; mViewCacheMax) &#123;</span><br><span class="line">                mCachedViews.add(holder);</span><br><span class="line">                cached = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(!cached) &#123;</span><br><span class="line">            addViewHolderToRecycledViewPool(holder);</span><br><span class="line">            recycled = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›æ”¶æ²¡æœ‰åˆ›å»ºå¤æ‚ï¼Œåªæ¶‰åŠåˆ°ä¸¤æ¬¡ç¼“å­˜ï¼Œ mCachedViews å’Œ mRecyclerPool , mCachedViews ç›¸å½“äºä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„ï¼Œå½“æœ‰ä¿¡çš„ View éœ€è¦ç¼“å­˜æ—¶ï¼Œéƒ½ä¼šå°†æ–°çš„ View å­˜å…¥åˆ° mCachedViewsï¼Œ è€Œ mCachedView  åˆ™ä¼šç§»é™¤å¤´éƒ¨å…ƒç´ ï¼Œå¹¶å°†å¤´éƒ¨å…ƒç´ å­˜å‚¨åœ¨ mRecyclerPool ä¸­ï¼Œ å³ mCachedViews ç›¸å½“äºä¸€çº§ç¼“å­˜ï¼Œ mRecyclerPool ç›¸å½“äºäºŒçº§ç¼“å­˜ï¼Œã€‚å¹¶ä¸” mRecyclerPool  æ—¶å¯ä»¥å¤šä¸ª RecyclerView å…±äº«çš„ã€‚</p><h2 id="ä¸-AdapterView-æ¯”è¾ƒ"><a href="#ä¸-AdapterView-æ¯”è¾ƒ" class="headerlink" title="ä¸ AdapterView æ¯”è¾ƒ"></a>ä¸ AdapterView æ¯”è¾ƒ</h2><table><thead><tr><th style="text-align:center">index</th><th style="text-align:center">AdapterView</th><th style="text-align:center">RecyclerView</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">Simple click listener</td><td style="text-align:center">OnItemTouchListener</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">Simple Divider</td><td style="text-align:center">ItemDecoration</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">ListView and GridView</td><td style="text-align:center">LinearLayoutManager<br>GridLayoutManager..</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">RecyclerBin</td><td style="text-align:center">Recycler</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">Header and Footer</td><td style="text-align:center">Partial refresh</td></tr></tbody></table><ul><li><p>ç‚¹å‡»äº‹ä»¶</p><p>ListView åŸç”Ÿæä¾›äº†Item ç‚¹å‡»ã€é•¿å®‰çš„äº‹ä»¶ï¼Œè€Œ RecyclerView  åˆ™éœ€è¦ä½¿ç”¨ onTouchListener ç›¸å¯¹æ¯”è¾ƒå¤æ‚</p></li><li><p>åˆ†å‰²çº¿</p><p>ListView  å¯ä»¥å¾ˆè½»æ¾è®¾æ–½ Divider å±æ€§æ¥æ˜¾ç¤º item ä¹‹é—´çš„åˆ†å‰²çº¿ï¼Œ</p><p>RecyclerView éœ€è¦è‡ªå·±å®ç° ItemDecoration ï¼Œä¸¤è€…æ¯”è¾ƒï¼Œå‰è€…ä½¿ç”¨æ›´ç®€å•ï¼Œåè€…å®šåˆ¶æ€§æ›´å¼º</p></li><li><p>å¸ƒå±€ç±»å‹</p><p>AdapterView æä¾›äº† ListView å’Œ GridView ä¸¤ç§ï¼Œ RecyclerView æä¾›äº† LinearLayoutManger å’Œ GirdLayoutManagerã€‚ç›¸æ¯”è¾ƒ RecyclerView æ›´æ¢å¸ƒå±€æ–¹å¼æ›´è½»æ¾ï¼ŒAdapterView åˆ™éœ€è¦æ›´æ¢ä¸€ä¸ª Viewã€‚</p></li><li><p>ç¼“å­˜æ–¹å¼</p><p>ListView ä½¿ç”¨äº† RecyclerBin ç±»è´Ÿè´£è§†å›¾çš„ç¼“å­˜ï¼ŒRecyclerView ä½¿ç”¨ Recycler è¿›è¡Œç¼“å­˜ï¼ŒåŸç†åŸºæœ¬ä¸€è‡´</p></li></ul><p><strong>ä¸åŒç‚¹</strong></p><ul><li><p>å±€éƒ¨åˆ·æ–°</p><p>ListView ä¸­æƒ³å±€éƒ¨åˆ·æ–°æŸä¸ª item éœ€è¦è‡ªå·±æ¥ç¼–å†™åˆ·æ–°é€»è¾‘ï¼Œ è€Œ RecyclerView ä¸­å¯ä»¥é€šè¿‡ <code>notifyItemChanged(position)</code> æ¥å®Œæˆï¼Œç”šè‡³å¯ä»¥é€šè¿‡ <code>notifyItemChanged(position, payload)</code> ä¼ å…¥ä¸€ä¸ª payload ä¿¡æ¯æ¥åˆ·æ–°å•ä¸ª item ä¸­çš„ç‰¹å®šå†…å®¹ã€‚</p></li><li><p>åŠ¨ç”»</p><p>RecyclerView å†…éƒ¨é€šè¿‡ ItemAnimation ç±»å®Œæˆäº†åŠ¨ç”»æ“ä½œï¼Œè€Œ ListView åšåŠ¨ç”»æ¯”è¾ƒå›°éš¾</p></li><li><p>åµŒå¥—å¸ƒå±€</p><p>RecyclerView å®ç°äº† <code>NestedScrollingChild</code> æ¥å£ï¼Œå¯ä»¥å’Œä¸€åˆ‡åµŒå¥—ç»„ä»¶å¾ˆå¥½çš„å·¥ä½œ</p></li></ul><p><strong>ListView åŸç”Ÿç‰¹ç‚¹</strong></p><ul><li><p>å¤´éƒ¨ä¸å°¾éƒ¨æ”¯æŒ</p><p>ListView åŸç”Ÿæ”¯æŒå¤´éƒ¨å’Œå°¾éƒ¨çš„æ·»åŠ ï¼Œè™½ç„¶ RecyclerView å¯ä»¥é€šè¿‡å®šä¹‰ä¸åŒçš„ Type æ¥åæ”¯æŒï¼Œä½†å®é™…åº”ç”¨ä¸­ï¼Œå°è£…ä¸å¥½ä¼šé€ æˆé—®é¢˜ã€‚å› ä¸º Adapter ä¸­çš„æ•°æ®ä½ç½®ä¸ç‰©ç†æ•°æ®ä½ç½®å‘ç”Ÿäº†åç§»ã€</p></li><li><p>å¤šé€‰</p><p>æ”¯æŒå¤šé€‰å’Œå•é€‰çš„ ListView æ›´æ–¹ä¾¿</p></li><li><p>å¤šæ•°æ®æºæ”¯æŒ</p><p>ListView æä¾›äº† Cursor Adapterï¼Œ ArrayAdapter å¯ä»¥å¾ˆæ–¹ä¾¿ä»æ•°æ®åº“æˆ–è€…æ•°ç»„ä¸­è·å–æ•°æ®ã€‚</p></li></ul><p><strong>æ€»ç»“</strong></p><p>RecyclerView çš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯çµæ´»ï¼Œæ­£æ˜¯å› ä¸ºçµæ´»ï¼Œä¹Ÿç‰ºç‰²äº†å¾ˆå¤šä¾¿åˆ©æ€§ï¼Œè€Œ AdapterView æ¯”è¾ƒåˆ»æ¿ï¼ŒåŸç”Ÿæ–¹æ³•ç»™ä¸å¼€å‘å¾ˆå¤šä¾¿åˆ©ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;RechclerView-æ€»ç»“&quot;&gt;&lt;a href=&quot;#RechclerView-æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;RechclerView æ€»ç»“&quot;&gt;&lt;/a&gt;RechclerView æ€»ç»“&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://github.com/xiaomanwong/static_file/blob/master/images/image-20200709164241306.png?raw=true&quot; alt=&quot;image-20200709164241306&quot;&gt;&lt;/p&gt;
&lt;p&gt;Recycler Viewï¼š è´Ÿè´£å°† Datas å±•ç¤ºåœ¨è‡ªå·±èº«ä¸Šï¼Œå…¶æœ¬èº«æ˜¯ä¸€ä¸ª ViewGroupï¼Œåªè®¤è¯† Viewï¼Œå› æ­¤éœ€è¦ä¸€ä¸ª Adapter æ¥å°† Datas çš„å†…å®¹è½¬æ¢ä¸º View&lt;/p&gt;
&lt;p&gt;Adapterï¼š è´Ÿè´£ç¿»è¯‘ï¼Œå°† Datas å†…å®¹ï¼Œè½¬æ¢ä¸º Viewï¼Œæ–¹ä¾¿ RecyclerView å±•ç¤º&lt;/p&gt;
&lt;p&gt;ViewHolderï¼š RecyclerView åªä¼šä¸ ViewHolder è¿›è¡Œäº¤äº’ï¼Œå› æ­¤ ViewHolder å……å½“ä¸­é—´ä»¶ï¼Œæ¥å°† Datas çš„å†…å®¹ä¼ é€’ç»™  RecyclerView&lt;/p&gt;
&lt;p&gt;LayoutManagerï¼šè´Ÿè´£å¸ƒå±€ï¼ŒRecyclerView å°†å…¶å­ View çš„å¸ƒå±€ç®¡ç†ï¼Œäº¤ç»™å®ƒæ¥å®Œæˆ&lt;/p&gt;
&lt;p&gt;Recyclerï¼šè´Ÿè´£ç®¡ç† View çš„ç”Ÿå‘½å‘¨æœŸï¼ŒLayoutManager åªç®¡è´Ÿè´£ View çš„å¸ƒå±€ä»»åŠ¡ï¼Œå¯¹å…¶å›æ”¶äº¤ç»™äº† Recycler æ¥å¤„ç†ï¼Œé¿å…é€ æˆä¸å¿…è¦çš„é”™è¯¯&lt;/p&gt;
&lt;p&gt;ItemAnimatorï¼š è´Ÿè´£åŠ¨ç”»ï¼Œå½“ RecyclerView ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼ˆå¢ã€åˆ ç­‰ï¼‰éƒ½ä¼šé€šè¿‡å®ƒæ¥å®Œæˆå¹³æ»‘çš„è¿‡æ¸¡&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Android Q æ–‡ä»¶æƒé™é€‚é…</title>
    <link href="http://xiaoman.ren/2020/03/11/Android-Q-%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E9%80%82%E9%85%8D/"/>
    <id>http://xiaoman.ren/2020/03/11/Android-Q-æ–‡ä»¶æƒé™é€‚é…/</id>
    <published>2020-03-11T12:11:41.000Z</published>
    <updated>2020-03-11T12:37:13.921Z</updated>
    
    <content type="html"><![CDATA[<p>éšç€ Android Q çš„å‘å¸ƒï¼Œéšä¹‹è€Œæ¥çš„é€‚é…å·¥ä½œä¹Ÿåœ¨æš—æ½®æ¶ŒåŠ¨ï¼Œè¿™é‡Œè¯´ä¸€ä¸‹ Android Q æ–‡ä»¶å­˜å‚¨ï¼›<br>Android Q åœ¨å¤–éƒ¨å­˜å‚¨è®¾å¤‡ä¸­ä¸ºæ¯ä¸ªåº”ç”¨æä¾›äº†ä¸€ä¸ªâ€œæ²™ç›’â€ï¼Œä»»ä½•å…¶ä»–åº”ç”¨éƒ½æ— æ³•ç›´æ¥è®¿é—®æ‚¨çš„æ²™ç›’æ–‡ä»¶ã€‚ç”±äºæ–‡ä»¶æ˜¯æ‚¨åº”ç”¨çš„ç§æœ‰æ–‡ä»¶ï¼Œå› æ­¤æ‚¨ä¸åœ¨éœ€è¦ä»»ä½•æƒé™å³å¯åœ¨å¤–éƒ¨å­˜å‚¨è®¾å¤‡ä¸­è®¿é—®å’Œä¿å­˜è‡ªå·±çš„è®¾å¤‡ã€‚è¿™æ¬¡æ›´æ–°æœ‰æ•ˆçš„ä¿è¯äº†ç”¨æˆ·æ–‡ä»¶çš„éšç§æ€§ï¼Œä¹Ÿèµšå°‘äº†å¯¹åº”åº”ç”¨æ‰€éœ€è¦çš„æƒé™æ•°é‡ã€‚</p><p>â€œæ²™ç›’â€å°±æ˜¯åº”ç”¨çš„ä¸“å±æ–‡ä»¶ï¼Œå¹¶ä¸”è®¿é—®è¿™ä¸ªæ–‡ä»¶å¤¹æ— éœ€ä»»ä½•æƒé™ã€‚Google æ¨èåº”ç”¨çš„æ²™ç›’å†…å­˜å‚¨æ–‡ä»¶åœ°å€ä¸º<br><code>Context.getExternalFilesDir()</code> ä¸‹çš„æ–‡ä»¶å¤¹ã€‚éœ€è¦ä¼ å…¥ä»¥ä¸‹å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Environment.DIRECTORY_MUSIC</span><br><span class="line">Environment.DIRECTORY_PODCASTS</span><br><span class="line">Environment.DIRECTORY_RINGTONES</span><br><span class="line">Environment.DIRECTORY_ALARMS</span><br><span class="line">Environment.DIRECTORY_NOTIFICATIONS</span><br><span class="line">Environment.DIRECTORY_PICUTRES</span><br><span class="line">Environment.DIRECTORY_MOVIES</span><br></pre></td></tr></table></figure><p>å¯æ ¹æ®å…·ä½“éœ€è¦ï¼Œä¼ å…¥ä¸é€šçš„å‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ä¸€ä¸ªæ–‡ä»¶é€šè¿‡æ–‡ä»¶å¤¹ç±»å‹</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fileName</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> boxType</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> defaultPath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> FileNotFoundException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">default</span> File <span class="title">getFile</span><span class="params">(String fileName, String boxType, String defaultPath)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">    File file;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.Q) &#123;</span><br><span class="line">        file = getCurrentContext().getExternalFilesDir(boxType + File.separator + fileName);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        file = <span class="keyword">new</span> File(defaultPath + fileName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="keyword">null</span> || !file.exists()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FileNotFoundException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> file;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä»¥ä¸Šä»£ç æœªç»æµ‹è¯•ï¼Œå¿˜è§è°…</strong></p><p>æ¥ä¸‹æ¥è¯´ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ç³»ç»Ÿå…¬å…±æ–‡ä»¶ï¼Œæ¯”å¦‚ç›¸å†Œï¼Œç›¸æœºï¼Œä¸‹è½½ç›®å½•ç­‰ï¼Œè¿™é‡Œä»¥è®¿é—®ç›¸å†Œä¸ºä¾‹ï¼š</p><p>è®¿é—®æ²™ç›’å¤–(å…¶ä»–åº”ç”¨)çš„æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œä¾ç„¶éœ€è¦ç”³è¯·æ–‡ä»¶æƒé™ï¼Œ<code>Manifest.permission.READ_EXTERNAL_STORAGE</code> å’Œ <code>Manifest.permission.WRITE_EXTERNAL_STORAGE</code> </p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è·å–ç›¸å†Œèµ„æºçš„ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Uri contentUri = MediaStore.Files.getContentUri(<span class="string">"external"</span>);</span><br><span class="line">            <span class="keyword">final</span> String sortOrder = MediaStore.Files.FileColumns.DATE_MODIFIED + <span class="string">" DESC"</span>;</span><br><span class="line">            <span class="keyword">final</span> String selection =</span><br><span class="line">                    <span class="string">"("</span> + MediaStore.Files.FileColumns.MEDIA_TYPE + <span class="string">"=?"</span></span><br><span class="line">                            + <span class="string">" OR "</span></span><br><span class="line">                            + MediaStore.Files.FileColumns.MEDIA_TYPE + <span class="string">"=?)"</span></span><br><span class="line">                            + <span class="string">" AND "</span></span><br><span class="line">                            + MediaStore.MediaColumns.SIZE + <span class="string">"&gt;0"</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> String[] selectionAllArgs = &#123;String.valueOf(MediaStore.Files.FileColumns.MEDIA_TYPE_IMAGE)&#125;;</span><br><span class="line"></span><br><span class="line">            ContentResolver contentResolver = mContext.getContentResolver();</span><br><span class="line">            String[] projections;</span><br><span class="line">            projections = <span class="keyword">new</span> String[]&#123;MediaStore.Files.FileColumns._ID, MediaStore.MediaColumns.DATA,</span><br><span class="line">                    MediaStore.MediaColumns.DISPLAY_NAME, MediaStore.MediaColumns.DATE_MODIFIED,</span><br><span class="line">                    MediaStore.MediaColumns.MIME_TYPE, MediaStore.MediaColumns.WIDTH, MediaStore</span><br><span class="line">                    .MediaColumns.HEIGHT, MediaStore.MediaColumns.SIZE&#125;;</span><br><span class="line"></span><br><span class="line">            Cursor cursor = contentResolver.query(contentUri, projections, selection, selectionAllArgs, sortOrder);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (cursor != <span class="keyword">null</span> &amp;&amp; cursor.moveToFirst()) &#123;</span><br><span class="line">                        <span class="keyword">int</span> pathIndex = cursor.getColumnIndex(MediaStore.MediaColumns.DATA);</span><br><span class="line">                        <span class="keyword">int</span> mimeTypeIndex = cursor.getColumnIndex(MediaStore.MediaColumns.MIME_TYPE);</span><br><span class="line">                        <span class="keyword">int</span> sizeIndex = cursor.getColumnIndex(MediaStore.MediaColumns.SIZE);</span><br><span class="line">                        <span class="keyword">int</span> widthIndex = cursor.getColumnIndex(MediaStore.MediaColumns.WIDTH);</span><br><span class="line">                        <span class="keyword">int</span> heightIndex = cursor.getColumnIndex(MediaStore.MediaColumns.HEIGHT);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">do</span> &#123;</span><br><span class="line">                            <span class="keyword">long</span> size = cursor.getLong(sizeIndex);</span><br><span class="line">                            <span class="keyword">if</span> (size &lt; <span class="number">1</span>) &#123;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            String type = cursor.getString(mimeTypeIndex);</span><br><span class="line">                            String path = cursor.getString(pathIndex);</span><br><span class="line">                            <span class="keyword">if</span> (TextUtils.isEmpty(path) || TextUtils.isEmpty(type)) &#123;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">int</span> width = cursor.getInt(widthIndex);</span><br><span class="line">                            <span class="keyword">int</span> height = cursor.getInt(heightIndex);</span><br><span class="line">                            <span class="keyword">if</span> (width &lt; <span class="number">1</span> || height &lt; <span class="number">1</span>) &#123;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            File file = <span class="keyword">new</span> File(path);</span><br><span class="line">                            <span class="keyword">if</span> (!file.exists() || !file.isFile()) &#123;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            File parentFile = file.getParentFile();</span><br><span class="line">                            <span class="keyword">if</span> (parentFile != <span class="keyword">null</span>) &#123;</span><br><span class="line">                                images.add(path);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                        &#125; <span class="keyword">while</span> (cursor.moveToNext());</span><br><span class="line"></span><br><span class="line">                        cursor.close();</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure></p><p>é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨å›¾ç‰‡åŠ è½½å·¥å…·å°†å›¾ç‰‡æ˜¾ç¤ºå‡ºæ¥ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>AndroidManifest.xml</code> ä¸­çš„ <code>&lt;application&gt;</code> æ ‡ç­¾ä¸­åŠ å…¥ <code>android:requestLegacyExternalStorage=&quot;true&quot;</code> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;éšç€ Android Q çš„å‘å¸ƒï¼Œéšä¹‹è€Œæ¥çš„é€‚é…å·¥ä½œä¹Ÿåœ¨æš—æ½®æ¶ŒåŠ¨ï¼Œè¿™é‡Œè¯´ä¸€ä¸‹ Android Q æ–‡ä»¶å­˜å‚¨ï¼›&lt;br&gt;Android Q åœ¨å¤–éƒ¨å­˜å‚¨è®¾å¤‡ä¸­ä¸ºæ¯ä¸ªåº”ç”¨æä¾›äº†ä¸€ä¸ªâ€œæ²™ç›’â€ï¼Œä»»ä½•å…¶ä»–åº”ç”¨éƒ½æ— æ³•ç›´æ¥è®¿é—®æ‚¨çš„æ²™ç›’æ–‡ä»¶ã€‚ç”±äºæ–‡ä»¶æ˜¯æ‚¨åº”ç”¨çš„ç§æœ‰æ–‡ä»¶ï¼Œå› æ­¤æ‚¨ä¸åœ¨éœ€è¦ä»»ä½•æƒé™å³
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ASpectJ åˆè¯†</title>
    <link href="http://xiaoman.ren/2020/03/06/ASpectJ-%E5%88%9D%E8%AF%86/"/>
    <id>http://xiaoman.ren/2020/03/06/ASpectJ-åˆè¯†/</id>
    <published>2020-03-06T02:41:22.000Z</published>
    <updated>2020-03-06T08:45:31.105Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¦–å…ˆæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹-AOP"><a href="#é¦–å…ˆæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹-AOP" class="headerlink" title="é¦–å…ˆæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ AOP"></a>é¦–å…ˆæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ AOP</h2><blockquote><p>AOP(é¢å‘åˆ‡é¢ç¼–ç¨‹) è¢«è®¤ä¸ºæ˜¯ OOPï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰ çš„ä¸€ä¸ªå¼ºå¤§è¡¥å……ï¼Œæœ‰äº† AOP ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåˆ†æ•£åœ¨åº”ç”¨å„å¤„çš„è¡Œä¸ºæ”¾åœ¨å¯é‡ç”¨çš„æ¨¡å—ä¸­ï¼Œæœ‰æ•ˆå‡å°‘å†—ä½™ä»£ç ï¼Œå¹¶è®©æˆ‘ä»¬çš„ç±»åªå…³æ³¨è‡ªèº«çš„ä¸»è¦åŠŸèƒ½</p></blockquote><p>é¢å‘åˆ‡é¢ç¼–ç¨‹ AOPï¼ˆaspect oriented programmingï¼‰ï¼Œæ˜¯ä¸€ç§å°†æ¨ªåˆ‡å…³æ³¨ç‚¹ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»çš„ç¼–ç¨‹æ–¹å¼ã€‚æ¯ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹éƒ½é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå„¿ä¸æ˜¯åˆ†æ•£åœ¨å¾ˆå¤šå¤„ä»£ç ä¸­ã€‚è¿™æ ·æˆ‘ä»¬çš„æœåŠ¡æ¨¡å—æ›´åŠ ç®€æ´ï¼Œå› ä¸ºä»–ä»¬åªåŒ…å«äº†ä¸»è¦å…³æ³¨ç‚¹çš„ä»£ç ï¼Œè€Œæ¬¡è¦çš„åŠŸèƒ½æˆ–è€…è¯´æ˜¯è¾…åŠ©çš„åŠŸèƒ½è¢«è½¬ç§»åˆ°åˆ‡é¢ä¸­ã€‚</p><h2 id="AOP-æœ¯è¯­"><a href="#AOP-æœ¯è¯­" class="headerlink" title="AOP æœ¯è¯­"></a>AOP æœ¯è¯­</h2><table><thead><tr><th style="text-align:center">key</th><th style="text-align:center">åˆ«å</th><th>æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">Advice</td><td style="text-align:center">é€šçŸ¥</td><td>åˆ‡é¢çš„å…·ä½“è¡Œä¸ºï¼Œè¦æ‰§è¡Œçš„ä»£ç </td></tr><tr><td style="text-align:center">PointCut</td><td style="text-align:center">åˆ‡ç‚¹</td><td>é€šçŸ¥è¢«åº”ç”¨çš„å…·ä½“ä½ç½®</td></tr><tr><td style="text-align:center">Join Point</td><td style="text-align:center">è¿æ¥ç‚¹</td><td>ç¨‹åºè¿è¡Œæ—¶ï¼Œèƒ½å¤Ÿåº”ç”¨é€šçŸ¥çš„æ‰€æœ‰ç‚¹</td></tr><tr><td style="text-align:center">Aspect</td><td style="text-align:center">åˆ‡é¢</td><td>ä»€ä¹ˆæ—¶å€™åœ¨ä»€ä¹ˆåœ°æ–¹åšä»€ä¹ˆäº‹æƒ…ï¼Œæ˜¯åˆ‡ç‚¹å’Œé€šçŸ¥çš„ç»“åˆ</td></tr><tr><td style="text-align:center">Target</td><td style="text-align:center">ç›®æ ‡å¯¹è±¡</td><td>è¢«åˆ‡å…¥åŠŸèƒ½çš„ç›®æ ‡å¯¹è±¡</td></tr><tr><td style="text-align:center">Introduction</td><td style="text-align:center">å¼•å…¥</td><td>å°†æ–°çš„æ–¹æ³•æˆ–å±æ€§å¼•å…¥åˆ°ç°æœ‰çš„ç±»ä¸­</td></tr><tr><td style="text-align:center">Weaving</td><td style="text-align:center">ç»‡å…¥</td><td>å°†åˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡å¹¶åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹</td></tr></tbody></table><p>AOP åº•å±‚é€šè¿‡ä½¿ç”¨åŠ¨æ€ä»£ç†å®ç°ï¼ŒåŒ…å«ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†å®ç°</li><li>ä½¿ç”¨ cglib å®ç°</li></ol><p><strong>é€šçŸ¥ç±»å‹</strong></p><ol><li>å‰ç½®é€šçŸ¥(Befor)ï¼šåœ¨æ–¹æ³•ä¹‹å‰æ‰§è¡Œ</li><li>åç½®é€šçŸ¥(After)ï¼šåœ¨æ–¹æ³•ä¹‹åæ‰§è¡Œ</li><li>å¼‚å¸¸é€šçŸ¥(AfterThrowing)ï¼šæ–¹æ³•å‡ºç°å¼‚å¸¸æ‰§è¡Œ</li><li>æœ€ç»ˆé€šçŸ¥(AfterReturning)ï¼šåœ¨åç½®ä¹‹åæ‰§è¡Œ</li><li>ç¯ç»•é€šçŸ¥(Around)ï¼šåœ¨æ–¹æ³•ä¹‹å‰å’Œä¹‹åæ‰§è¡Œ</li></ol><h2 id="AspectJ"><a href="#AspectJ" class="headerlink" title="AspectJ"></a>AspectJ</h2><p>AspectJ å®é™…æ˜¯å¯¹ AOP ç¼–ç¨‹æ€æƒ³çš„ä¸€ä¸ªå®è·µï¼Œç›®å‰ç”¨çš„æ¯”è¾ƒç«ï¼Œå®ƒæ˜¯ä¸€ç§é›†åˆå’Œ Java å®Œå…¨ä¸€æ ·çš„è¯­è¨€ï¼Œè€Œä¸”å®Œå…¨å…¼å®¹ Javaã€‚</p><p>å…ˆå†™åˆ°è¿™é‡Œï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é¦–å…ˆæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹-AOP&quot;&gt;&lt;a href=&quot;#é¦–å…ˆæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹-AOP&quot; class=&quot;headerlink&quot; title=&quot;é¦–å…ˆæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ AOP&quot;&gt;&lt;/a&gt;é¦–å…ˆæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ AOP&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;AOP(é¢å‘åˆ‡é¢ç¼–
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>OKHttp é‡å®šå‘æ‹¦æˆªå™¨</title>
    <link href="http://xiaoman.ren/2020/02/20/OKHttp-%E9%87%8D%E5%AE%9A%E5%90%91%E6%8B%A6%E6%88%AA%E5%99%A8/"/>
    <id>http://xiaoman.ren/2020/02/20/OKHttp-é‡å®šå‘æ‹¦æˆªå™¨/</id>
    <published>2020-02-20T09:05:21.000Z</published>
    <updated>2020-02-20T09:07:19.963Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä½¿ç”¨-OKHttp-è¿›è¡Œé‡å®šå‘æ‹¦æˆªå¤„ç†"><a href="#ä½¿ç”¨-OKHttp-è¿›è¡Œé‡å®šå‘æ‹¦æˆªå¤„ç†" class="headerlink" title="ä½¿ç”¨ OKHttp è¿›è¡Œé‡å®šå‘æ‹¦æˆªå¤„ç†"></a>ä½¿ç”¨ OKHttp è¿›è¡Œé‡å®šå‘æ‹¦æˆªå¤„ç†</h1><p>okhttpé‡å®šå‘å­˜åœ¨ä¸¤ä¸ªç¼ºé™·ï¼š</p><ol><li><p>okhttpå¤„ç†301,302é‡å®šå‘æ—¶ï¼Œä¼šæŠŠè¯·æ±‚æ–¹å¼è®¾ç½®ä¸ºGET<br>è¿™æ ·ä¼šä¸¢å¤±åŸæ¥Postè¯·æ±‚ä¸­çš„å‚æ•°ã€‚</p></li><li><p>okhttpé»˜è®¤ä¸æ”¯æŒè·¨åè®®çš„é‡å®šå‘ï¼Œæ¯”å¦‚httpé‡å®šå‘åˆ°https</p></li></ol><p>ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜å†™äº†è¿™ä¸ªæ‹¦æˆªå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedirectInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Request request = chain.request();</span><br><span class="line">        HttpUrl beforeUrl = request.url();</span><br><span class="line">        Response response = chain.proceed(request);</span><br><span class="line">        HttpUrl afterUrl = response.request().url();</span><br><span class="line">        <span class="comment">//1.æ ¹æ®urlåˆ¤æ–­æ˜¯å¦æ˜¯é‡å®šå‘</span></span><br><span class="line">        <span class="keyword">if</span>(!beforeUrl.equals(afterUrl)) &#123;</span><br><span class="line">            <span class="comment">//å¤„ç†ä¸¤ç§æƒ…å†µ 1ã€è·¨åè®® 2ã€åŸå…ˆä¸æ˜¯GETè¯·æ±‚ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (!beforeUrl.scheme().equals(afterUrl.scheme())||!request.method().equals(<span class="string">"GET"</span>)) &#123;</span><br><span class="line">                <span class="comment">//é‡æ–°è¯·æ±‚</span></span><br><span class="line">                Request newRequest = request.newBuilder().url(response.request().url()).build();</span><br><span class="line">                response = chain.proceed(newRequest);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ä½¿ç”¨-OKHttp-è¿›è¡Œé‡å®šå‘æ‹¦æˆªå¤„ç†&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨-OKHttp-è¿›è¡Œé‡å®šå‘æ‹¦æˆªå¤„ç†&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨ OKHttp è¿›è¡Œé‡å®šå‘æ‹¦æˆªå¤„ç†&quot;&gt;&lt;/a&gt;ä½¿ç”¨ OKHttp è¿›è¡Œé‡å®šå‘æ‹¦æˆªå¤„ç†&lt;/h1&gt;&lt;p&gt;ok
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Android å¸¸ç”¨å·¥å…·å’Œæ’ä»¶</title>
    <link href="http://xiaoman.ren/2020/02/20/Android-%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E5%92%8C%E6%8F%92%E4%BB%B6/"/>
    <id>http://xiaoman.ren/2020/02/20/Android-å¸¸ç”¨å·¥å…·å’Œæ’ä»¶/</id>
    <published>2020-02-20T09:04:13.000Z</published>
    <updated>2020-02-20T10:27:58.209Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Android-å¼€å‘å¿…å¤‡æ’ä»¶å’Œå·¥å…·"><a href="#Android-å¼€å‘å¿…å¤‡æ’ä»¶å’Œå·¥å…·" class="headerlink" title="Android å¼€å‘å¿…å¤‡æ’ä»¶å’Œå·¥å…·"></a>Android å¼€å‘å¿…å¤‡æ’ä»¶å’Œå·¥å…·</h1><h2 id="Android-Studio-æ’ä»¶"><a href="#Android-Studio-æ’ä»¶" class="headerlink" title="Android Studio æ’ä»¶"></a>Android Studio æ’ä»¶</h2><table><thead><tr><th>æ’ä»¶å</th><th>æ³¨é‡Š</th></tr></thead><tbody><tr><td>Alibaba Java Coding Guidelines</td><td>é˜¿é‡Œçš„ä»£ç è§„èŒƒæ£€æŸ¥æ’ä»¶ï¼Œç”¨æ¥æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦ç¬¦åˆé©¼å³°å‘½åã€if else, switch els default ç­‰è¯­æ³•ç³–çš„å¥å£®æ€§ï¼›ä»¥åŠå•æ–¹æ³•è¡Œæ•°ä¸è¶…è¿‡ 80 è¡Œï¼Œæé†’â€å•ä¸€èŒè´£åŸåˆ™â€œç­‰ï¼›</td></tr><tr><td>Android Parcelable code generator</td><td>åºåˆ—åŒ– Po ç±»æ—¶ï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆåºåˆ—åŒ–ä»£ç </td></tr><tr><td>CodeGlance</td><td>ä»£ç é¢„è§ˆå›¾ï¼Œåœ¨ç¼–è¾‘çª—å£å³ä¾§æœ‰ä¸€ä¸ªå½“å‰ä»£ç çš„ç¼©ç•¥å›¾ï¼Œå¯ä»¥å½“åšæ»šåŠ¨æ¡ä½¿ç”¨ï¼Œå¯ä»¥å¿«é€Ÿå®šä½ä»£ç </td></tr><tr><td>DataBase Navigator</td><td>æ”¯æŒ Oracleã€MySQLã€SQLiteã€PostgreSQL ä»¥åŠä»»ä½•ç¬¦åˆ JDBC çš„æ•°æ®åº“ï¼›å¢å¼ºæˆ‘ä»¬å¯¹æ•°æ®åº“æ•°æ®çš„è¯»å–ï¼Œå®šä½é—®é¢˜</td></tr><tr><td>FindBugs-IDEA</td><td>å¯ä»¥åˆ†æç°å­˜ä»£ç ä¸­å®¹æ˜“å¼•èµ·å¼‚å¸¸çš„éƒ¨åˆ†ï¼Œå¹¶æä¾›ä¿®æ”¹å»ºè®®</td></tr><tr><td>GsonFormater</td><td>å°† xml å’Œ json è½¬æ¢ä½ pojo ç±»ï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆæ•°æ®æº</td></tr><tr><td>Markdown</td><td>è¯­è¨€å·¥å…·ï¼Œé€šè¿‡è¯­æ³•ç³–ï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆ HTML çš„é¢„è§ˆçª—ï¼Œå†™å‡º GitHub é£æ ¼çš„æŠ€æœ¯æ–‡æ¡£</td></tr><tr><td>Markdown Navigator</td><td>Markdown é¢„è§ˆå·¥å…·ï¼Œå¯ä»¥è§‚å¯Ÿå®æ—¶æ¸²æŸ“çš„ HTML æ–‡æ¡£</td></tr><tr><td>Android Resource Tools</td><td>1. å¯ä»¥ä¸º layout.xml ä¸­ å¸¦ id çš„ View ç”Ÿæˆå˜é‡åŠ findViewById ä»£ç <br>2. ä½¿ç”¨ Google å¯¹ strings.xml è¿›è¡Œç¿»è¯‘ï¼ˆéœ€è¦é…ç½®é•œåƒï¼‰    <br>3. é¢œè‰²æ¸²æŸ“å™¨æ”¯æŒ RGB å’Œ ARGBï¼Œæ–¹ä¾¿é…ç½®é€æ˜åº¦</td></tr><tr><td>Codota</td><td>æ¨¡ç‰ˆä»£ç æŸ¥æ‰¾å™¨ï¼Œå¯ä»¥è¾“å…¥å…³é”®è¯ï¼Œæœç´¢å‡ºç›¸å…³çš„ä¸šåŠ¡ä»£ç ï¼Œæ¯”å¦‚ï¼Œæœç´¢ FileOutputSrteam åˆ™ä¼šæœ‰     ä»¥åŠåœ¨ç¼–è¯‘æ—¶ï¼Œä¼šç»™äºˆç›¸å…³çš„ä»£ç å—æç¤º</td></tr><tr><td>GoodFormatter</td><td>ä¿è¯å¤§å®¶ä»£ç æ ¼å¼åŒ–é£æ ¼ä¸€è‡´ï¼Œé¿å…å› ä¸åŒï¼Œå¯¼è‡´ git åˆå¹¶æ˜¯å‡ºç°å¤§é‡ä¿®æ”¹ï¼›</td></tr><tr><td>ButterknifePlugin</td><td>å¿«é€Ÿç”Ÿæˆ butternkife çš„æ³¨å…¥ä»£ç ï¼Œå‰æéœ€è¦å¼•å…¥ butterknife</td></tr><tr><td>JsonViewer</td><td>å¯ä»¥æ›¿æ¢ postman çš„æ’ä»¶ï¼Œç”¨æ¥è°ƒè¯•æ¥å£</td></tr><tr><td>Git Commit Template</td><td>Git æäº¤è®°å½•æ¨¡ç‰ˆå·¥å…·</td></tr><tr><td>â€”</td><td>â€”</td></tr></tbody></table><a id="more"></a><p><strong>codata</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">zipFile</span><span class="params">(File srcFile, File zipFile)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (FileInputStream fis = <span class="keyword">new</span> FileInputStream(srcFile);</span><br><span class="line">        ZipOutputStream zos = <span class="keyword">new</span> ZipOutputStream(<span class="keyword">new</span> FileOutputStream(zipFile))) &#123;</span><br><span class="line">      zos.putNextEntry(<span class="keyword">new</span> ZipEntry(srcFile.getName()));</span><br><span class="line">      <span class="keyword">int</span> len;</span><br><span class="line">      <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">      <span class="keyword">while</span> ((len = fis.read(buffer)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        zos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">      &#125;</span><br><span class="line">      zos.closeEntry();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>AndroidResourceTools</strong><br><img src="https://github.com/xiaomanwong/static_file/blob/master/images/android_resource_tool_variables.png?raw=true" alt></p><p><img src="https://github.com/xiaomanwong/static_file/blob/master/images/android_resource_tools_code.png?raw=true" alt></p><p> <strong>JsonViewer</strong></p><p> <img src="https://github.com/xiaomanwong/static_file/blob/master/images/WX20200220-145420.png?raw=true" alt></p><h2 id="å¼€å‘å·¥å…·"><a href="#å¼€å‘å·¥å…·" class="headerlink" title="å¼€å‘å·¥å…·"></a>å¼€å‘å·¥å…·</h2><p>é™¤å¿…è¦ AS ä¹‹å¤–ï¼Œéœ€è¦ä»¥ä¸‹å·¥å…·, Mac ç”¨æˆ·å¯ä»¥é€šè¿‡ <a href="https://xclient.info/" target="_blank" rel="noopener">XClient</a> ä¸‹è½½ç ´è§£ç‰ˆè½¯ä»¶</p><table><thead><tr><th>å·¥å…·</th><th>æ³¨é‡Š</th></tr></thead><tbody><tr><td>Sublime Text 3</td><td>æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œé™¤æ­£å¸¸çš„ç¼–è¾‘åŠŸèƒ½å¤–ï¼Œä¸°å¯Œçš„æ’ä»¶åº“è®©å®ƒæ¯” editplusã€plus++ç­‰æ–‡æœ¬ç¼–è¾‘æ›´å¼ºå¤§ï¼›<br><strong>PrettyJson</strong> æ’ä»¶å¯ä»¥å¿«é€Ÿå°†å­—ç¬¦ä¸²æ ¼å¼åŒ–ä¸º JSON æ ¼å¼ï¼Œæ— éœ€å†å»åœ¨çº¿æ‰¾ json æ ¼å¼åŒ–ï¼›ä¹Ÿå¯ä»¥æ ¡éªŒ json çš„åˆæ³•æ€§ï¼›<br>æ”¯æŒåˆ—ç¼–è¾‘ï¼Œå¿«é€Ÿä¿®æ”¹<br> <strong>Markdown</strong> å¯ä»¥ç”¨æ¥å†™ Markdown æ–‡ä»¶ï¼Œä½†ä¸æ”¯æŒæ¸²æŸ“<br><a href="https://www.sublimetext.com/3" target="_blank" rel="noopener">Sublime Text 3 ä¸‹è½½åœ°å€</a></td></tr><tr><td>Postman</td><td>æ¥å£è°ƒè¯•å·¥å…·ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸Šé¢æ¨èçš„ <strong>JsonViewer</strong><br><a href="https://www.postman.com/" target="_blank" rel="noopener">Postman ä¸‹è½½åœ°å€</a></td></tr><tr><td>Fiddlerã€Charles</td><td>æŠ“åŒ…è°ƒè¯•å·¥å…·ï¼Œå¯æŠ“åŒ…ï¼Œä¿®æ”¹å‚æ•°è°ƒè¯•æ¥å£ï¼Œä»»é€‰<br><a href="https://www.telerik.com/fiddler" target="_blank" rel="noopener">Fiddler ä¸‹è½½åœ°å€</a><br><a href="https://www.charlesproxy.com/download/" target="_blank" rel="noopener">Charles ä¸‹è½½åœ°å€</a></td></tr><tr><td>Markdown</td><td>Windows å¯ä½¿ç”¨ Typora, Mac å¯ä»¥ä½¿ç”¨ MWeb Proï¼Œç”ŸæˆæŠ€æœ¯ç±»æ–‡æ¡£ä½¿ç”¨ï¼Œé©¬å…‹é£è±¡åŒå¹³å°éƒ½å¯ä»¥ï¼ˆChrome æ’ä»¶ï¼Œéœ€è¦å‹å¥½è®¿é—®ï¼‰<br><a href="https://typora.io/" target="_blank" rel="noopener">Typora ä¸‹è½½åœ°å€</a><br><a href="https://www.mweb.im/" target="_blank" rel="noopener">MWeb Pro ä¸‹è½½åœ°å€</a></td></tr><tr><td>Vysor</td><td>Android è®¾å¤‡åŒå±å·¥å…·ï¼Œå¯å°†è®¾å¤‡åŒæ­¥åˆ°ç”µè„‘ä¸Šï¼Œæ–¹ä¾¿æˆªå›¾ï¼Œåˆ†äº«å±å¹•ç­‰ï¼Œéœ€è¦å‹å¥½è®¿é—®<br><a href="https://www.vysor.io/" target="_blank" rel="noopener">Vysor ä¸‹è½½åœ°å€</a></td></tr><tr><td>XMind</td><td>è„‘å›¾å·¥å…·ï¼Œç”¨æ¥å†™ç»“æ„<br><a href="https://setapp.com/apps/xmind?campaign=setapp_search_vendor_xmind_abn_brand_en&amp;ci=737183467&amp;adgroupid=41332915427&amp;adpos=1t1&amp;ck=xminds&amp;targetid=kwd-642237838482&amp;match=p&amp;gnetwork=g&amp;creative=204109085004&amp;placement=&amp;placecat=&amp;accname=setapp&amp;gclid=Cj0KCQiA-bjyBRCcARIsAFboWg0rXap6WScthL_2Ft6oHTKmQorcfJduEcko1hDR0byUxsdFGubEsBQaAotvEALw_wcB" target="_blank" rel="noopener">XMind ä¸‹è½½åœ°å€</a></td></tr><tr><td>Beyond Compare</td><td>æ–‡ä»¶æ¯”è¾ƒå™¨ï¼Œæ¯”è¾ƒä¸¤ç»„æ–‡ä»¶çš„å·®å¼‚<br><a href="https://www.scootersoftware.com/download.php" target="_blank" rel="noopener">BeyondCompare ä¸‹è½½åœ°å€</a></td></tr><tr><td>Dash</td><td>æºç æŸ¥çœ‹å™¨ï¼Œ ä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨çº¿çš„ <a href="http://androidos.net.cn/sourcecode" target="_blank" rel="noopener">Android ç¤¾åŒº</a></td></tr><tr><td>PxCook</td><td>äº‘åä½œè®¾è®¡å·¥å…·ï¼Œå¯ç”Ÿæˆç›¸åº”çš„å‰ç«¯ä»£ç ï¼Œè‡ªåŠ¨æµ‹é‡å°ºå¯¸ç­‰ï¼Œæ”¯æŒ Photoshopã€Sketchã€Adobe XDã€‚<a href="https://www.fancynode.com.cn/pxcook" target="_blank" rel="noopener">PxCook ä¸‹è½½åœ°å€</a></td></tr><tr><td>â€”</td><td>â€”</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Android-å¼€å‘å¿…å¤‡æ’ä»¶å’Œå·¥å…·&quot;&gt;&lt;a href=&quot;#Android-å¼€å‘å¿…å¤‡æ’ä»¶å’Œå·¥å…·&quot; class=&quot;headerlink&quot; title=&quot;Android å¼€å‘å¿…å¤‡æ’ä»¶å’Œå·¥å…·&quot;&gt;&lt;/a&gt;Android å¼€å‘å¿…å¤‡æ’ä»¶å’Œå·¥å…·&lt;/h1&gt;&lt;h2 id=&quot;Android-Studio-æ’ä»¶&quot;&gt;&lt;a href=&quot;#Android-Studio-æ’ä»¶&quot; class=&quot;headerlink&quot; title=&quot;Android Studio æ’ä»¶&quot;&gt;&lt;/a&gt;Android Studio æ’ä»¶&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ’ä»¶å&lt;/th&gt;
&lt;th&gt;æ³¨é‡Š&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Alibaba Java Coding Guidelines&lt;/td&gt;
&lt;td&gt;é˜¿é‡Œçš„ä»£ç è§„èŒƒæ£€æŸ¥æ’ä»¶ï¼Œç”¨æ¥æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦ç¬¦åˆé©¼å³°å‘½åã€if else, switch els default ç­‰è¯­æ³•ç³–çš„å¥å£®æ€§ï¼›ä»¥åŠå•æ–¹æ³•è¡Œæ•°ä¸è¶…è¿‡ 80 è¡Œï¼Œæé†’â€å•ä¸€èŒè´£åŸåˆ™â€œç­‰ï¼›&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Android Parcelable code generator&lt;/td&gt;
&lt;td&gt;åºåˆ—åŒ– Po ç±»æ—¶ï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆåºåˆ—åŒ–ä»£ç &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CodeGlance&lt;/td&gt;
&lt;td&gt;ä»£ç é¢„è§ˆå›¾ï¼Œåœ¨ç¼–è¾‘çª—å£å³ä¾§æœ‰ä¸€ä¸ªå½“å‰ä»£ç çš„ç¼©ç•¥å›¾ï¼Œå¯ä»¥å½“åšæ»šåŠ¨æ¡ä½¿ç”¨ï¼Œå¯ä»¥å¿«é€Ÿå®šä½ä»£ç &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DataBase Navigator&lt;/td&gt;
&lt;td&gt;æ”¯æŒ Oracleã€MySQLã€SQLiteã€PostgreSQL ä»¥åŠä»»ä½•ç¬¦åˆ JDBC çš„æ•°æ®åº“ï¼›å¢å¼ºæˆ‘ä»¬å¯¹æ•°æ®åº“æ•°æ®çš„è¯»å–ï¼Œå®šä½é—®é¢˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;FindBugs-IDEA&lt;/td&gt;
&lt;td&gt;å¯ä»¥åˆ†æç°å­˜ä»£ç ä¸­å®¹æ˜“å¼•èµ·å¼‚å¸¸çš„éƒ¨åˆ†ï¼Œå¹¶æä¾›ä¿®æ”¹å»ºè®®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GsonFormater&lt;/td&gt;
&lt;td&gt;å°† xml å’Œ json è½¬æ¢ä½ pojo ç±»ï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆæ•°æ®æº&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Markdown&lt;/td&gt;
&lt;td&gt;è¯­è¨€å·¥å…·ï¼Œé€šè¿‡è¯­æ³•ç³–ï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆ HTML çš„é¢„è§ˆçª—ï¼Œå†™å‡º GitHub é£æ ¼çš„æŠ€æœ¯æ–‡æ¡£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Markdown Navigator&lt;/td&gt;
&lt;td&gt;Markdown é¢„è§ˆå·¥å…·ï¼Œå¯ä»¥è§‚å¯Ÿå®æ—¶æ¸²æŸ“çš„ HTML æ–‡æ¡£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Android Resource Tools&lt;/td&gt;
&lt;td&gt;1. å¯ä»¥ä¸º layout.xml ä¸­ å¸¦ id çš„ View ç”Ÿæˆå˜é‡åŠ findViewById ä»£ç &lt;br&gt;2. ä½¿ç”¨ Google å¯¹ strings.xml è¿›è¡Œç¿»è¯‘ï¼ˆéœ€è¦é…ç½®é•œåƒï¼‰    &lt;br&gt;3. é¢œè‰²æ¸²æŸ“å™¨æ”¯æŒ RGB å’Œ ARGBï¼Œæ–¹ä¾¿é…ç½®é€æ˜åº¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Codota&lt;/td&gt;
&lt;td&gt;æ¨¡ç‰ˆä»£ç æŸ¥æ‰¾å™¨ï¼Œå¯ä»¥è¾“å…¥å…³é”®è¯ï¼Œæœç´¢å‡ºç›¸å…³çš„ä¸šåŠ¡ä»£ç ï¼Œæ¯”å¦‚ï¼Œæœç´¢ FileOutputSrteam åˆ™ä¼šæœ‰     ä»¥åŠåœ¨ç¼–è¯‘æ—¶ï¼Œä¼šç»™äºˆç›¸å…³çš„ä»£ç å—æç¤º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GoodFormatter&lt;/td&gt;
&lt;td&gt;ä¿è¯å¤§å®¶ä»£ç æ ¼å¼åŒ–é£æ ¼ä¸€è‡´ï¼Œé¿å…å› ä¸åŒï¼Œå¯¼è‡´ git åˆå¹¶æ˜¯å‡ºç°å¤§é‡ä¿®æ”¹ï¼›&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ButterknifePlugin&lt;/td&gt;
&lt;td&gt;å¿«é€Ÿç”Ÿæˆ butternkife çš„æ³¨å…¥ä»£ç ï¼Œå‰æéœ€è¦å¼•å…¥ butterknife&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;JsonViewer&lt;/td&gt;
&lt;td&gt;å¯ä»¥æ›¿æ¢ postman çš„æ’ä»¶ï¼Œç”¨æ¥è°ƒè¯•æ¥å£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Git Commit Template&lt;/td&gt;
&lt;td&gt;Git æäº¤è®°å½•æ¨¡ç‰ˆå·¥å…·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;â€”&lt;/td&gt;
&lt;td&gt;â€”&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æ¸…é¦™æœ¨å…»æ®–ï¼ˆå››ï¼‰</title>
    <link href="http://xiaoman.ren/2019/10/17/%E6%B8%85%E9%A6%99%E6%9C%A8%E5%85%BB%E6%AE%96%EF%BC%88%E5%9B%9B%EF%BC%89/"/>
    <id>http://xiaoman.ren/2019/10/17/æ¸…é¦™æœ¨å…»æ®–ï¼ˆå››ï¼‰/</id>
    <published>2019-10-17T09:11:50.000Z</published>
    <updated>2020-02-20T09:13:37.992Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸¢äº†Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· T_T</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸¢äº†Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· T_T&lt;/p&gt;

      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Linux ä¸‹é…ç½® Android Studio ä¸­æ–‡è¾“å…¥</title>
    <link href="http://xiaoman.ren/2019/08/23/Linux-%E4%B8%8B%E9%85%8D%E7%BD%AE-Android-Studio-%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5/"/>
    <id>http://xiaoman.ren/2019/08/23/Linux-ä¸‹é…ç½®-Android-Studio-ä¸­æ–‡è¾“å…¥/</id>
    <published>2019-08-23T02:26:28.000Z</published>
    <updated>2019-08-23T02:32:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘çš„ç”µè„‘æ˜¯æ·±åº¦ Ubuntuï¼Œ æ•ˆæœå’Œ Windows å¾ˆåƒï¼Œä¸ªäººä¸å–œæ¬¢ Windows çš„åŸå› å¾ˆç®€å•ï¼Œç›—ç‰ˆå¤ªå¤šã€‚</p><p>è™½ç„¶ Ubuntu ä¸‹å¾ˆå¤šè½¯ä»¶éƒ½ä¼šå—åˆ°é™åˆ¶ï¼Œä½†æˆ‘æ˜¯ä¸€ä¸ªè½¯ä»¶å·¥ç¨‹å¸ˆï¼Œå¸¸ç”¨çš„å¼€å‘å·¥å…·å¯ä»¥ä½¿ç”¨ï¼Œå°±å¯ä»¥äº†ã€‚</p><p>æœ€è¿‘ä¸€ç›´å›°æ‰°æˆ‘çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œ æ¯å½“æˆ‘ç»™ Android Studio å‡çº§æ—¶ï¼Œå°±ä¼šé‡åˆ°æ— æ³•è¾“å…¥ä¸­æ–‡çš„æƒ…å†µï¼Œæ¯æ¬¡ä¸Šç½‘æŸ¥è¯¢ï¼Œæ€»æ˜¯ç£•ç£•ç»Šç»Šï¼Œä»Šå„¿å°†æ–¹æ³•è®°å½•ä¸‹æ¥ï¼Œä»¥å¤‡ä»¥åéœ€è¦æ˜¯å¥½æ‰¾ã€‚</p><p>é¦–å…ˆï¼Œæ‰“å¼€ Android Studio çš„æ–‡ä»¶ç›®å½• <code>/android-stdio/bin/</code> ï¼Œä½¿ç”¨ Vi å‘½ä»¤æ‰“å¼€æ–‡ä»¶ <code>studio.sh</code>ï¼Œ</p><p>åœ¨æ–‡ä»¶çš„å¼€å¤´ï¼Œè¾“å…¥ä¸‹é¢è¿™ä¸€ä¸²</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export XMODIFIERS=@im=fcitx</span><br><span class="line">export QT_IM_MODULE=fcitx</span><br><span class="line">export GTK_IM_MODULE=&quot;fcitx&quot;</span><br></pre></td></tr></table></figure><p>ç„¶å :wq ä¿å­˜é€€å‡ºã€‚</p><p>æ¥ç€é‡å¯ Android Studio å°±å¯ä»¥äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æˆ‘çš„ç”µè„‘æ˜¯æ·±åº¦ Ubuntuï¼Œ æ•ˆæœå’Œ Windows å¾ˆåƒï¼Œä¸ªäººä¸å–œæ¬¢ Windows çš„åŸå› å¾ˆç®€å•ï¼Œç›—ç‰ˆå¤ªå¤šã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ Ubuntu ä¸‹å¾ˆå¤šè½¯ä»¶éƒ½ä¼šå—åˆ°é™åˆ¶ï¼Œä½†æˆ‘æ˜¯ä¸€ä¸ªè½¯ä»¶å·¥ç¨‹å¸ˆï¼Œå¸¸ç”¨çš„å¼€å‘å·¥å…·å¯ä»¥ä½¿ç”¨ï¼Œå°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;æœ€è¿‘ä¸€ç›´å›°æ‰°æˆ‘çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Android è·å– View çš„å®½é«˜</title>
    <link href="http://xiaoman.ren/2019/08/21/Android-%E8%8E%B7%E5%8F%96-View-%E7%9A%84%E5%AE%BD%E9%AB%98/"/>
    <id>http://xiaoman.ren/2019/08/21/Android-è·å–-View-çš„å®½é«˜/</id>
    <published>2019-08-21T13:54:08.000Z</published>
    <updated>2019-08-21T15:39:32.625Z</updated>
    
    <content type="html"><![CDATA[<p>å®é™…å¼€å‘ä¸­ï¼Œè·å–ä¸€ä¸ª View çš„å®½é«˜æœ‰å¾ˆå¤šä¸­æ–¹æ³•ï¼Œæœ€ç›´æ¥çš„å°±æ˜¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å› View çš„å®½é«˜ï¼Œå•ä½æ˜¯åƒç´ </span></span><br><span class="line"><span class="keyword">int</span> height = view.getHeight();</span><br><span class="line"><span class="keyword">int</span> width = view.getWidth();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å› View çš„åŸå§‹æµ‹é‡é«˜åº¦</span></span><br><span class="line"><span class="keyword">int</span> height = view.getMeasuredHeight();</span><br><span class="line"><span class="keyword">int</span> width = view.getMeasuredWidth();</span><br></pre></td></tr></table></figure><p>æœ‰æ—¶éœ€è¦åœ¨ onCreate æ–¹æ³•ä¸­è·å–æŸä¸ª View ç»„ä»¶çš„å®½åº¦å’Œé«˜åº¦ä¿¡æ¯ï¼Œè€Œç›´æ¥è°ƒç”¨ View ç»„ä»¶çš„ getWidth(), getHeight(), getMeasuredWidth(), getMeasuredHeight(), getTop(), getLeft() ç­‰æ–¹æ³•æ˜¯æ— æ³•è·å–åˆ°çœŸå®å€¼ï¼Œåªä¼šå¾—åˆ° 0 ï¼Œè¿™æ˜¯å› ä¸º View ç»„ä»¶å¸ƒå±€è¦åœ¨ onResume åå›è°ƒ ã€‚<br><a id="more"></a></p><p>å› æ­¤ï¼Œå½“æˆ‘ä»¬éœ€è¦ View çš„å®½é«˜æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>getViewTreeObserver().addOnGlobalLayoutListener()</code> æ¥è·å– View çš„å®½åº¦æˆ–è€…é«˜åº¦ã€‚è¿™æ˜¯è·å¾—ä¸€ä¸ª View çš„å®½åº¦å’Œé«˜åº¦çš„æ–¹æ³•ä¹‹ä¸€ã€‚</p><p><code>onGlobalLayoutListener()</code> æ˜¯ <code>ViewTreeObserver</code> çš„å†…éƒ¨ç±»ï¼Œå½“ä¸€ä¸ªè§†å›¾æ ‘çš„å¸ƒå±€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå¯ä»¥è¢« <code>ViewTreeObserver</code> ç›‘å¬åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³¨å†Œç›‘å¬è§†å›¾çš„è§‚å¯Ÿè€…(observer)ï¼Œ åœ¨è§†å›¾æ ‘çš„å…¨å±€äº‹ä»¶æ”¹å˜æ—¶å¾—åˆ°é€šçŸ¥ã€‚ <code>ViewTreeObserver</code> ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œè€Œæ˜¯é€šè¿‡ <code>getViewTreeObserver()</code> è·å¾—ã€‚</p><p>å…¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>OnGlobalLayoutListener</code> æ¥è·å–ä¸€ä¸ªè§†å›¾çš„çœŸå®é«˜åº¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> height;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> width;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> positionX;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> positionY;</span><br><span class="line">imageView.getViewTreeObserver().addOnGlobalLayoutListener(<span class="keyword">new</span> OnGlobalLayoutListener()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGlobalLayout</span><span class="params">()</span></span>&#123;</span><br><span class="line">        positionX = imageView.getX();</span><br><span class="line">        positionY = imageView.getY();</span><br><span class="line">        height = imageView.getHeight();</span><br><span class="line">        widht = imageView.getWidth();</span><br><span class="line">        imageView.getViewTreeObserver().removeOnGlobalLayoutListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>OnGlobalLayoutListener</code> å¯èƒ½ä¼šè¢«å¤šæ¬¡è§¦å‘ï¼Œå› æ­¤åœ¨å¾—åˆ°äº†é«˜åº¦ä¹‹åï¼Œè¦å°† <code>OnGlobalLayoutListener</code> æ³¨é”€æ‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imageView.getViewTreeObserver().removeOnGlobalLayoutListener(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure><h2 id="ViewTreeObserver"><a href="#ViewTreeObserver" class="headerlink" title="ViewTreeObserver"></a>ViewTreeObserver</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public final class ViewTreeObserver extends Object</span><br><span class="line">java.lang.Object</span><br><span class="line">android.view.ViewTreeObserver</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ªæ³¨å†Œç›‘å¬è§†å›¾çš„è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ï¼Œåœ¨è§†å›¾æ ‘å…¨å±€äº‹ä»¶æ”¹å˜æ—¶å¾—åˆ°é€šçŸ¥ã€‚è¿™ä¸ªå…¨å±€äº‹ä»¶ä¸ä»…åŒ…æ‹¬æ•´ä¸ªæ ‘çš„å¸ƒå±€ï¼Œä»ç»˜ç”»è¿‡ç¨‹å¼€å§‹ï¼Œè§¦æ‘¸æ¨¡å¼çš„æ”¹å˜ç­‰ã€‚ViewTreeObserver ä¸èƒ½å¤Ÿè¢«åº”ç”¨ç¨‹åºå®ä¾‹åŒ–ï¼Œå› ä¸ºå®ƒæ˜¯ç”±è§†å›¾æä¾› <code>getViewTreeObserver()</code></p><p><strong>åŸºæœ¬å¸¸ç”¨çš„æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“åœ¨ä¸€ä¸ªè§†å›¾ä¹¦ä¸­çš„ç„¦ç‚¹çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€è¦è°ƒç”¨çš„å›è°ƒå‡½æ•°æ¥å£</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ViewTreeObserver</span>.<span class="title">OnGlobalFocusChangeListener</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“åœ¨ä¸€ä¸ªè§†å›¾æ ‘ä¸­å…¨å±€å¸ƒå±€å‘ç”Ÿæ”¹å˜æ—¶æˆ–è€…è§†å›¾æ ‘ä¸­çš„æŸä¸ªè§†å›¾çš„å¯è§†åŒ–çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ViewTreeObserver</span>.<span class="title">OnGlobalLayoutListener</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“ä¸€ä¸ªè§†å›¾æ ‘å°†è¦ç»˜åˆ¶æ—¶</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ViewTreeObserver</span>.<span class="title">OnPreDrawListener</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“ä¸€ä¸ªè§†å›¾æ ‘ä¸­çš„ç»„ä»¶å‘ç”Ÿæ»šåŠ¨æ—¶</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ViewTreeObserver</span>.<span class="title">OnScrollChangedListener</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“ä¸€ä¸ªè§†å›¾æ ‘ä¸­çš„è§¦æ‘¸æ¨¡å¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç”¨äºç›‘å¬ touch å’Œé touch çš„è½¬æ¢</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ViewTreeObserver</span>.<span class="title">OnTouchModeChangeListener</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬å¸ƒå±€çš„å˜åŒ–</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ViewTreeObserver</span>.<span class="title">OnGlobalLayoutLitener</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ ViewTreeObserver æ˜¯å¦å¯ç”¨ï¼Œä¸å¯ç”¨æ—¶ï¼Œä»»ä½•æ–¹æ³•è°ƒç”¨éƒ½ä¼šæŠ¥é”™</span></span><br><span class="line">getViewTreeObserver().isAlive();</span><br><span class="line"></span><br><span class="line">addOnWindowAttachListener</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">removeOnGlobalFocusChangeListener</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">removeOnScrollChangedListener</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">removeOnTouchModeChangeListener</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“æ•´ä¸ªå¸ƒå±€å‘ç”Ÿæ”¹å˜æ—¶é€šçŸ¥ç›¸åº”çš„æ³¨å†Œç›‘å¬å™¨ã€‚å¦‚æœä½ å¼ºåˆ¶å¯¹è§†å›¾å¸ƒå±€æˆ–è€…åœ¨ä¸€ä¸ªæ²¡æœ‰é™„åŠ åˆ°ä¸€ä¸ªçª—å£çš„è§†å›¾çš„å±‚æ¬¡ç»“æ„æˆ–è€…åœ¨GONEçŠ¶æ€ä¸‹ï¼Œå®ƒå¯ä»¥è¢«æ‰‹åŠ¨çš„è°ƒç”¨ </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dispatchOnGlobalLayout</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// å½“ä¸€ä¸ªè§†å›¾æ ‘å°†è¦ç»˜åˆ¶æ—¶é€šçŸ¥ç›¸åº”çš„æ³¨å†Œç›‘å¬å™¨ï¼Œå¦‚æœè¿”å› trueï¼Œ åˆ™è¿™ä¸ªç»˜åˆ¶å°†è¢«å–æ¶ˆå¹¶é‡æ–°è®¡åˆ’ã€‚å¦‚æœå¼ºåˆ¶å¯¹è§†å›¾å¸ƒå±€æˆ–è€…åœ¨ä¸€ä¸ªæ²¡æœ‰é™„åŠ åˆ°ä¸€ä¸ªçª—å£çš„è§†å›¾çš„å±‚æ¬¡ç»“æ„æˆ–è€…ä¸€ä¸ªåœ¨ gone çŠ¶æ€ä¸‹ï¼Œå°†è¢«æ‰‹åŠ¨è°ƒç”¨</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dispatchOnPreDraw</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å®é™…å¼€å‘ä¸­ï¼Œè·å–ä¸€ä¸ª View çš„å®½é«˜æœ‰å¾ˆå¤šä¸­æ–¹æ³•ï¼Œæœ€ç›´æ¥çš„å°±æ˜¯ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è¿”å› View çš„å®½é«˜ï¼Œå•ä½æ˜¯åƒç´ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; height = view.getHeight();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; width = view.getWidth();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è¿”å› View çš„åŸå§‹æµ‹é‡é«˜åº¦&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; height = view.getMeasuredHeight();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; width = view.getMeasuredWidth();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æœ‰æ—¶éœ€è¦åœ¨ onCreate æ–¹æ³•ä¸­è·å–æŸä¸ª View ç»„ä»¶çš„å®½åº¦å’Œé«˜åº¦ä¿¡æ¯ï¼Œè€Œç›´æ¥è°ƒç”¨ View ç»„ä»¶çš„ getWidth(), getHeight(), getMeasuredWidth(), getMeasuredHeight(), getTop(), getLeft() ç­‰æ–¹æ³•æ˜¯æ— æ³•è·å–åˆ°çœŸå®å€¼ï¼Œåªä¼šå¾—åˆ° 0 ï¼Œè¿™æ˜¯å› ä¸º View ç»„ä»¶å¸ƒå±€è¦åœ¨ onResume åå›è°ƒ ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://xiaoman.ren/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Java Reference</title>
    <link href="http://xiaoman.ren/2019/08/09/Java%20%E5%90%84%E5%BC%95%E7%94%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
    <id>http://xiaoman.ren/2019/08/09/Java å„å¼•ç”¨ä¹‹é—´çš„åŒºåˆ«/</id>
    <published>2019-08-09T13:54:08.000Z</published>
    <updated>2019-08-12T02:51:05.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Reference-å¼•ç”¨"><a href="#Reference-å¼•ç”¨" class="headerlink" title="Reference å¼•ç”¨"></a>Reference å¼•ç”¨</h2><p>ç»§æ‰¿è‡ª Objectï¼Œ æœ‰ SoftReference, WeakReference, PhantomReference ä¸‰ä¸ªç›´æ¥å­ç±»ã€‚</p><p>ä¸‰ä¸ªå­ç±»çš„æ„é€ æ–¹æ³•ä¸­æ¶‰åŠåˆ° ReferenceQueue å’Œ Referentï¼š</p><ul><li>Referentï¼š è¢«å¼•ç”¨å¯¹è±¡</li><li>ReferenceQueueï¼šå½“å¼•ç”¨ï¼ˆè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰çš„ Referent è¢«å›æ”¶åï¼Œè¯¥å¼•ç”¨ï¼ˆè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰ä¼šè¢« enqueue åˆ°è¿™ä¸ª ReferenceQueue ä¸­ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReferenceTest</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span>ã€€</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.finalize();</span><br><span class="line">            System.out.println(<span class="string">"in Person finalize"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="StrongReference-å¼ºå¼•ç”¨"><a href="#StrongReference-å¼ºå¼•ç”¨" class="headerlink" title="StrongReference å¼ºå¼•ç”¨"></a>StrongReference å¼ºå¼•ç”¨</h2><p>Java ä¸­ä½¿ç”¨çš„æœ€å¤šï¼Œæ™®é€šçš„å¼•ç”¨ <code>Object obj = new Object();  Person p = new Person();</code> éƒ½å±äº<code>å¼ºå¼•ç”¨</code> </p><p>å¼ºå¼•ç”¨æœ¬èº«å­˜å‚¨åœ¨æ ˆä¸­ï¼Œnew å‡ºæ¥çš„å¯¹è±¡å­˜å‚¨åœ¨å †ä¸­ã€‚æ ˆä¸­ä¿å­˜çš„å¼•ç”¨æŒ‡å‘å †ä¸­å¯¹è±¡çš„åœ°å€ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå½“å¼•ç”¨ä¸åœ¨æŒ‡å‘å †ä¸­å¯¹è±¡çš„åœ°å€æ—¶ï¼ˆperson = nullï¼‰ GC collector å°±å¼€å§‹è€ƒè™‘å¯¹æ­¤å†…å­˜ï¼ˆå †ä¸­çš„å¯¹è±¡ï¼‰è¿›è¡Œå›æ”¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person p = <span class="keyword">new</span> Person();</span><br></pre></td></tr></table></figure><p>person å°±æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œå¼ºå¼•ç”¨ä¸ä¼šè¢« GCï¼Œå³ä½¿å†…å­˜ä¸å¤ŸæŠ›å‡º OOM æ—¶ä¹Ÿä¸ä¼šè¢«å›æ”¶ã€‚</p><h2 id="SoftReference-è½¯å¼•ç”¨"><a href="#SoftReference-è½¯å¼•ç”¨" class="headerlink" title="SoftReference è½¯å¼•ç”¨"></a>SoftReference è½¯å¼•ç”¨</h2><p>è½¯å¼•ç”¨æ™®é€šä½¿ç”¨å½¢å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Person p = <span class="keyword">new</span> Person();</span><br><span class="line">SoftReference&lt;Person&gt; sr = <span class="keyword">new</span> SoftReference&lt;Person&gt;(person);</span><br></pre></td></tr></table></figure><p>å¼ºå¼•ç”¨ person ä½œä¸ºå‚æ•°ï¼Œåˆ›å»ºäº†ä¸€ä¸ªè½¯å¼•ç”¨å¯¹è±¡ sr, ä¸‹é¢æ˜¯ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testSofeReference</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå¼ºå¼•ç”¨å¯¹è±¡</span></span><br><span class="line">    Person person = <span class="keyword">new</span> Person();</span><br><span class="line">    System.out.println(<span class="string">"person å¯¹è±¡ä¸º"</span> + person);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºè½¯å¼•ç”¨å¯¹è±¡</span></span><br><span class="line">    SoftReference&lt;Person&gt; sr = <span class="keyword">new</span> SoftReference&lt;Person&gt;(person);</span><br><span class="line">    person = <span class="keyword">null</span>; <span class="comment">// ä¹‹å‰ new å‡ºçš„ Person å¯¹è±¡ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œé™¤é JVM éœ€è¦å†…å­˜(OOM ä¹‹å‰)</span></span><br><span class="line">    <span class="keyword">if</span>(sr.get() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡è¿›å…¥ GC æµç¨‹"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡å°šæœªè¢«å›æ”¶"</span> + sr.get());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    System.gc();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(sr.get() == <span class="keyword">null</span>)&#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡è¿›å…¥ GC æµç¨‹"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡å°šæœªè¢«å›æ”¶"</span> + sr.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šé¢çš„ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">person å¯¹è±¡ä¸º com.example.ReferenceTest$Person@522d9d8c</span><br><span class="line">person å¯¹è±¡å°šæœªè¢«å›æ”¶ com.example.ReferenceTest$Person@522d9d8c</span><br><span class="line">person å¯¹è±¡å°šæœªè¢«å›æ”¶ com.example.ReferenceTest$Person@522d9d8c</span><br></pre></td></tr></table></figure><ul><li>å½“æ‰§è¡Œ person = null åï¼Œå †å†…å­˜çš„ Person å¯¹è±¡ä¸å†æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘å®ƒï¼Œä½†æ­¤æ—¶è¿˜å­˜åœ¨ sr å¼•ç”¨çš„å¯¹è±¡æŒ‡å‘ Person å¯¹è±¡ã€‚æ­¤æ—¶è°ƒç”¨ sr.get() æ–¹æ³•ï¼Œè¿”å› Person å¯¹è±¡ï¼Œå³ä¹‹å‰å †ä¸­çš„å¼ºå¼•ç”¨å¯¹è±¡äº†ã€‚æˆ‘ä»¬å¯ä»¥åˆç†çŒœæµ‹GC collector å¾ˆæœ‰å¯èƒ½å°šæœªè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œæ‰€ä»¥æ­¤æ—¶ sr.get() æ–¹æ³•è¿”å›ä¸ä¸ºç©ºã€‚</li><li>æˆ‘ä»¬ç»§ç»­æ‰§è¡Œ <code>System.gc()</code> å¼ºåˆ¶è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œæ‰“å°ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œ sr.get() è¿”å›ä¾ç„¶ä¸ä¸ºç©ºï¼Œè¯´æ˜ Person å¯¹è±¡ä¾æ—§æ²¡æœ‰è¢«å›æ”¶ã€‚</li></ul><p><strong>è½¯å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡è¦è¿›è¡Œå›æ”¶ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</strong></p><ol><li>æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼ˆå†…å­˜ä¸­çš„ Person å¯¹è±¡ï¼‰</li><li>JVM éœ€è¦å†…å­˜æ—¶ï¼Œå³åœ¨æŠ›å‡º OOM ä¹‹å‰</li></ol><p><strong>æ€»ç»“ï¼š</strong> SoftReference å˜ç›¸å»¶é•¿äº†å…¶åªæ˜¯å¯¹è±¡å æ®å †å†…å­˜çš„æ—¶é—´ï¼Œç›´åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸è¶³æ—¶åƒåœ¾å›æ”¶æ‰å›æ”¶æ­¤å †å†…å­˜ç©ºé—´ã€‚</p><p><strong>è½¯å¼•ç”¨è¿˜å¯ä»¥å’Œä¸€ä¸ª ReferenceQueue ä¸€èµ·ä½¿ç”¨ï¼Œ</strong> å½“ SoftReference çš„ Referent è¢«å›æ”¶ä»¥åï¼Œè¿™ä¸ª SoftReference ä¼šè¢«è‡ªåŠ¨ enqueue åˆ°è¿™ä¸ª ReferenctQueue ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testSoftReferenceWithQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Person person = <span class="keyword">new</span> Person();</span><br><span class="line">    System.out.println(<span class="string">"person å¯¹è±¡ä¸ºï¼š"</span> + person);</span><br><span class="line">    </span><br><span class="line">    ReferenceQueue&lt;Person&gt; queue = <span class="keyword">new</span> ReferenceQueue&lt;&gt;();</span><br><span class="line">    SoftReference&lt;Person&gt; sr = <span class="keyword">new</span> SoftReference&lt;&gt;(person, queue);</span><br><span class="line">    </span><br><span class="line">    person = <span class="keyword">null</span>; <span class="comment">// ä¹‹å‰ new å‡ºçš„ Person å¯¹è±¡ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œé™¤é JVM éœ€è¦å†…å­˜ ï¼ˆOOM å‰ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span>(sr.get() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡è¿›å…¥ GC æµç¨‹"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡å°šæœªè¢«å›æ”¶"</span> + sr.get());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">"åŠ å…¥ ReferenceQueue çš„å¯¹è±¡ä¸ºï¼š"</span> + queue.poll());</span><br><span class="line">    </span><br><span class="line">    System.gc();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(sr.get() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡è¿›å…¥ GC æµç¨‹"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡å°šæœªè¢«å›æ”¶"</span> + sr.get());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">"åŠ å…¥ ReferenceQueue çš„å¯¹è±¡ä¸ºï¼š "</span> + queue.poll());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šè¿°ä¾‹å­ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">person å¯¹è±¡ä¸º com.example.ReferenceTest$Person@522d9d8c</span><br><span class="line">person å¯¹è±¡å°šæœªè¢«å›æ”¶ com.example.ReferenceTest$Person@522d9d8c</span><br><span class="line">åŠ å…¥ ReferenceQueue çš„å¯¹è±¡ä¸º null</span><br><span class="line">person å¯¹è±¡å°šæœªè¢«å›æ”¶ com.example.ReferenceTest$Person@522d9d8c</span><br><span class="line">åŠ å…¥ ReferenceQueue çš„å¯¹è±¡ä¸º null</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> å½“ SoftReference æˆ– WeakReference çš„ get() æ–¹æ³•è¿”å› null æ—¶ï¼Œä»…è¡¨æ˜å…¶æŒ‡ç¤ºçš„å¯¹è±¡å·²ç»è¿›å…¥åƒåœ¾å›æ”¶æµç¨‹ï¼Œæ­¤æ—¶å¯¹è±¡ä¸ä¸€å®šå·²ç»è¢«åƒåœ¾å›æ”¶ã€‚</p><p>è€Œåªæœ‰ç¡®è®¤è¢«åƒåœ¾å›æ”¶åï¼Œå¦‚æœæœ‰ ReferenceQueue ï¼Œå…¶å¼•ç”¨æ‰ä¼šè¢«æ”¾ç½®äº ReferenceQueue ä¸­ã€‚</p><h2 id="WeakReference-å¼±å¼•ç”¨"><a href="#WeakReference-å¼±å¼•ç”¨" class="headerlink" title="WeakReference å¼±å¼•ç”¨"></a>WeakReference å¼±å¼•ç”¨</h2><p>å¼±å¼•ç”¨çš„ä¸€èˆ¬ä½¿ç”¨å½¢å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testWeakReference</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Person person = <span class="keyword">new</span> Person();</span><br><span class="line">    System.out.println(<span class="string">"person å¯¹è±¡ä¸ºï¼š "</span> + person);</span><br><span class="line">    </span><br><span class="line">    WeakReference&lt;Person&gt; wr = <span class="keyword">new</span> WeakReference&lt;&gt;(person);</span><br><span class="line">    person = <span class="keyword">null</span>; <span class="comment">// è¢« GC åï¼Œä¹‹å‰ new å‡ºçš„ Person å¯¹è±¡ä¼šç«‹å³è¢«å›æ”¶ï¼Œè¿›å…¥ GC æµç¨‹ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (wr.get() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡è¿›å…¥ GC æµç¨‹"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡å°šæœªè¢«å›æ”¶"</span> + wr.get());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    System.gc();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (wr.get() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡è¿›å…¥ GC æµç¨‹"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡å°šæœªè¢«å›æ”¶"</span> + wr.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">person å¯¹è±¡ä¸º com.example.ReferenceTest$Person@522d9d8c</span><br><span class="line">person å¯¹è±¡å°šæœªè¢«å›æ”¶ com.example.ReferenceTest$Person@522d9d8c</span><br><span class="line">person å¯¹è±¡è¿›å…¥ GC æµç¨‹</span><br><span class="line">in Person finalize</span><br></pre></td></tr></table></figure><ul><li><p>å½“æ‰§è¡Œ <code>person = null</code> åï¼Œå †å†…å­˜çš„  Person å¯¹è±¡ä¸å†æœ‰ä»»ä½•å¼•ç”¨æŒ‡å‘å®ƒï¼Œä½†æ­¤æ—¶è¿˜å­˜åœ¨ wr å¼•ç”¨çš„å¯¹è±¡æŒ‡å‘ Person å¯¹è±¡ã€‚</p><p>æ­¤æ—¶è°ƒç”¨ <code>wr.get()</code> æ–¹æ³•ï¼Œè¿”å› Person å¯¹è±¡ï¼Œå³ä¹‹å‰å †ä¸­çš„å¼ºå¼•ç”¨å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥åˆç†çŒœæµ‹ GC collector å¾ˆæœ‰å¯èƒ½å°šæœªè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œæ‰€ä»¥æ­¤æ—¶ <code>wr.get()</code> æ–¹æ³•è¿”å›ä¸ä¸ºç©ºã€‚</p></li><li><p>ç»§ç»­æ‰§è¡Œ <code>System.gc()</code> å¼ºåˆ¶æ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œæ‰“å°ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œ<code>wr.get()</code> è¿”å›ä¸ºç©º â€œperson å¯¹è±¡è¿›å…¥ GC æµç¨‹â€ ï¼Œä¸”æ‰§è¡Œäº†é™æ€å†…éƒ¨ç±»ä¸­çš„ finalize æ–¹æ³•ã€‚è¯´æ˜ Person å¯¹è±¡è¢«å›æ”¶ï¼Œè¿›å…¥åƒåœ¾å›æ”¶æµç¨‹ã€‚</p></li></ul><p><strong>å¼±å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡è¦è¿›è¡Œå›æ”¶ï¼Œåªéœ€è¦æ»¡è¶³æ¡ä»¶ï¼š</strong></p><p>â€‹    æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘å¼±å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼ˆå†…å­˜ä¸­çš„ Person å¯¹è±¡ï¼‰</p><p><strong>æ€»ç»“ï¼š</strong></p><p>â€‹    WeakReference ä¸æ”¹å˜åŸæœ‰çš„å¼ºå¼•ç”¨ç‹¬äº«çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä¸€æ—¦å…¶æŒ‡ç¤ºå¯¹è±¡æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨å¯¹è±¡æ—¶ï¼Œæ­¤å¯¹è±¡å³è¿›å…¥æ­£å¸¸çš„åƒåœ¾å›æ”¶æµç¨‹ã€‚</p><p><strong>å…¶ä¸»è¦ä½¿ç”¨åœºæ™¯è§äºï¼š</strong> </p><p>â€‹    å½“å‰å·²æœ‰å¼ºå¼•ç”¨æŒ‡å‘å¼ºå¼•ç”¨å¯¹è±¡ï¼Œæ­¤æ—¶ç”±äºä¸šåŠ¡éœ€è¦ï¼Œéœ€è¦å¢åŠ å¯¹æ­¤å¯¹è±¡çš„å¼•ç”¨ï¼ŒåŒæ—¶åˆä¸å¸Œæœ›æ”¹å˜æ­¤å¼•ç”¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œæ­¤æ—¶ <code>WeakReference</code> æ­£å¥½ç¬¦åˆéœ€æ±‚ï¼Œå¸¸è§äºä¸€äº›ä¸ç”Ÿå‘½å‘¨æœŸçš„åœºæ™¯ä¸­ï¼Œæ¯”å¦‚ Activity ä¸­çš„ Handler çš„ä½¿ç”¨ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜æ³„éœ²éœ€è¦ç”¨åˆ°å¼±å¼•ç”¨ã€‚</p><p>ä¸ SoftReference ä¸€æ ·ï¼Œå¯ä»¥åŒ ReferenceQueue ä¸€èµ·ä½¿ç”¨ã€‚å½“ WeakReference çš„ Referent è¢«å›æ”¶ä»¥åï¼Œè¿™ä¸ª WeakReference ä¼šè¢«è‡ªåŠ¨ enqueue åˆ°è¿™ä¸ª ReferenceQueue ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testWeakReferenceWithQueue</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    Person person = <span class="keyword">new</span> Person();</span><br><span class="line">    System.out.println(<span class="string">"person å¯¹è±¡ä¸º "</span> + person);</span><br><span class="line">    </span><br><span class="line">    ReferenceQueue&lt;Person&gt; queue = <span class="keyword">new</span> ReferenceQueue&lt;&gt;();</span><br><span class="line">    WeakReference&lt;Person&gt; wr = <span class="keyword">new</span> WeakReference&lt;&gt;(person, queue);</span><br><span class="line">    System.out.println(<span class="string">"wr å¯¹è±¡ä¸º "</span> + wr);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (wr.get() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡è¿›å…¥ GC æµç¨‹"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡å°šæœªè¢«å›æ”¶"</span> + wr.get());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">"Whether or not this reference has been enqueued:"</span> + wr.isEnqueued());</span><br><span class="line">    System.out.println(<span class="string">"Queue item: "</span> + queue.pull());</span><br><span class="line">    </span><br><span class="line">    System.gc();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (wr.get() == <span class="keyword">null</span>) &#123;<span class="comment">// ä»…æ˜¯è¡¨åæŒ‡ç¤ºçš„å¯¹è±¡å·²ç»è¿›å…¥åƒåœ¾å›æ”¶æµç¨‹ï¼Œæ­¤æ—¶å¯¹è±¡ä¸ä¸€å®šå·²ç»è¢«åƒåœ¾å›æ”¶ï¼Œåªæœ‰ç¡®è®¤è¢«åƒåœ¾å›æ”¶åï¼Œå¦‚æœæœ‰ ReferenceQueue ï¼Œå…¶å¼•ç”¨æ‰ä¼šè¢«æ”¾ç½®äº ReferenceQueue ä¸­ã€‚</span></span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡è¿›å…¥ GC æµç¨‹"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"person å¯¹è±¡å°šæœªè¢«å›æ”¶"</span> + wr.get());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ç¡®ä¿åƒåœ¾å›æ”¶çº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œ</span></span><br><span class="line">        Thread.sleep(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Whether or not this reference has been enqueued: "</span> + wr.isEnqueued());</span><br><span class="line">    System.out.println(<span class="string">"queue item: "</span> + queue.poll());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œç»“æœï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">person å¯¹è±¡ä¸º com.example.ReferenceTEst$Person@522d9d8c</span><br><span class="line">wr å¯¹è±¡ä¸º java.lang.ref.WeakReference@603828d2</span><br><span class="line">person å¯¹è±¡å°šæœªè¢«å›æ”¶ com.example.ReferenceTEst$Person@522d9d8c</span><br><span class="line">Whether or not this reference has been enqueued: false</span><br><span class="line">queue item: null</span><br><span class="line">person å¯¹è±¡è¿›å…¥å›æ”¶æµç¨‹</span><br><span class="line">in Person finalize</span><br><span class="line">Whether or not this reference has been enqueued: true</span><br><span class="line">queue item: java.lang.ref.WeakReference@603828d2</span><br></pre></td></tr></table></figure><p>ä»ç¬¬äºŒè¡Œåˆ°æœ€åè¡Œå¯ä»¥çœ‹å‡ºï¼Œ person è¿›å…¥ GC æµç¨‹åï¼Œwr è¢«åŠ å…¥åˆ° queue ä¸­ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><p>â€‹     å½“ SoftReference æˆ–è€… WeakReference çš„ get() æ–¹æ³•è¿”å› null æ—¶ï¼Œä»…è¡¨ç¤ºå…¶æŒ‡ç¤ºå¯¹è±¡å·²ç»è¿›å…¥åƒåœ¾å›æ”¶æµç¨‹ï¼Œæ­¤æ—¶å¯¹è±¡ä¸ä¸€å®šå·²ç»è¢«åƒåœ¾å›æ”¶ã€‚</p><p>â€‹    è€Œåªæœ‰ç¡®è®¤è¢«åƒåœ¾å›æ”¶åï¼Œå¦‚æœæœ‰ ReferenceQueueï¼Œ å…¶å¼•ç”¨æ‰ä¼šè¢«æ”¾ç½®äº ReferenceQueue ä¸­ã€‚</p><h2 id="PhantomReference-è™šå¼•ç”¨"><a href="#PhantomReference-è™šå¼•ç”¨" class="headerlink" title="PhantomReference è™šå¼•ç”¨"></a>PhantomReference è™šå¼•ç”¨</h2><p>è™šå¼•ç”¨æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang.ref;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.ref.Reference;</span><br><span class="line"><span class="keyword">import</span> java.lang.ref.ReferenceQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhantomReference</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Reference</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PhantomReference</span><span class="params">(T var1, ReferenceQueue&lt;? <span class="keyword">super</span> T&gt; var2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.(var1, var2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>PhantomReference åªæœ‰ä¸€ä¸ªæ„é€ å‡½æ•° <code>PhantomReference(T referenct, ReferenceQueue&lt;? super T&gt; q)</code>  å› æ­¤ï¼ŒPhantomReference ä½¿ç”¨å¿…é¡»ç»“åˆ ReferenceQueueï¼›</li><li>ä¸ç®¡æœ‰æ— å¼ºå¼•ç”¨æŒ‡å‘ PhantomReference çš„æŒ‡ç¤ºå¯¹è±¡ï¼Œ PhantomReference çš„ get() æ–¹æ³•è¿”å›ç»“æœéƒ½æ˜¯ null</li></ul><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testPhantomReference</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Person person = <span class="keyword">new</span> Person();</span><br><span class="line">    System.out.println(<span class="string">"person å¯¹è±¡ä¸º"</span> + person);</span><br><span class="line">    </span><br><span class="line">    ReferenceQueue&lt;Person&gt; queue = <span class="keyword">new</span> ReferenceQueue&lt;&gt;();</span><br><span class="line">    PhantomReference&lt;Person&gt; pr = <span class="keyword">new</span> PhantomReference&lt;&gt;(person, queue);</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">"pr å¯¹è±¡ä¸º"</span> + pr);</span><br><span class="line">    System.out.println(<span class="string">"pr.get() = "</span> + pr.get());</span><br><span class="line">    </span><br><span class="line">    person = <span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    System.gc();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">// ç¡®ä¿åƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">        Thread.sleep(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">"queue item: "</span> + queue.poll());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œç»“æœï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">person å¯¹è±¡ä¸º com.example.ReferenceTEst$Person@522d9d8c</span><br><span class="line">pr å¯¹è±¡ä¸º java.lang.ref.PhantomReference@60e35b53</span><br><span class="line">pr.get() = null</span><br><span class="line">in Person finalize</span><br><span class="line">queue ite: java.lang.ref.PhantomReference@60e35b53</span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“ï¼š</strong></p><p>â€‹    ä¸ WeakReference ä¸€æ ·ï¼Œä¸æ”¹å˜åŸæœ‰çš„å¼ºå¼•ç”¨å¯¹è±¡çš„åƒåœ¾å›æ”¶æœºåˆ¶ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥è¢«åƒåœ¾å›æ”¶ã€‚è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶åçš„æ´»åŠ¨ï¼ˆç›‘å¬å¹¶æ‰å»å¿…è¦çš„è¡ŒåŠ¨ï¼‰</p><p><strong>ç”¨é€”ï¼š</strong></p><p>â€‹    å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p><p>â€‹    ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­åŒ»ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥è™šå¼•ç”¨æ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚</p><p>â€‹    ç¨‹åºå¦‚æœå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰æ‰å»å¿…è¦çš„è¡ŒåŠ¨ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Reference-å¼•ç”¨&quot;&gt;&lt;a href=&quot;#Reference-å¼•ç”¨&quot; class=&quot;headerlink&quot; title=&quot;Reference å¼•ç”¨&quot;&gt;&lt;/a&gt;Reference å¼•ç”¨&lt;/h2&gt;&lt;p&gt;ç»§æ‰¿è‡ª Objectï¼Œ æœ‰ SoftReference, WeakReference, PhantomReference ä¸‰ä¸ªç›´æ¥å­ç±»ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‰ä¸ªå­ç±»çš„æ„é€ æ–¹æ³•ä¸­æ¶‰åŠåˆ° ReferenceQueue å’Œ Referentï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Referentï¼š è¢«å¼•ç”¨å¯¹è±¡&lt;/li&gt;
&lt;li&gt;ReferenceQueueï¼šå½“å¼•ç”¨ï¼ˆè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰çš„ Referent è¢«å›æ”¶åï¼Œè¯¥å¼•ç”¨ï¼ˆè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰ä¼šè¢« enqueue åˆ°è¿™ä¸ª ReferenceQueue ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ReferenceTest&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Person&lt;/span&gt;ã€€&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; String name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String name)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.name = name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;finalize&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Throwable &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.finalize();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.println(&lt;span class=&quot;string&quot;&gt;&quot;in Person finalize&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://xiaoman.ren/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Android å†…å­˜ç®¡ç†</title>
    <link href="http://xiaoman.ren/2019/08/04/Android%20%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"/>
    <id>http://xiaoman.ren/2019/08/04/Android å†…å­˜ç®¡ç†/</id>
    <published>2019-08-04T13:54:08.000Z</published>
    <updated>2019-08-12T08:11:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>å†…å­˜ç®¡ç†çš„ç›®çš„å°±æ˜¯æˆ‘ä»¬åœ¨å¼€å‘ä¸­æ€ä¹ˆæœ‰æ•ˆçš„é¿å…æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå‡ºç°å†…å­˜æ³„éœ²é—®é¢˜ã€‚å†…å­˜æ³„éœ²ç®€çŸ­ç²—ä¿—çš„è®²ï¼Œå°±æ˜¯è¯¥è¢«é‡Šæ”¾çš„å¯¹è±¡æ²¡æœ‰é‡Šæ”¾ï¼Œä¸€ç›´è¢«æŸä¸ªæˆ–æŸäº›å®ä¾‹æ‰€æŒæœ‰å´ä¸è¢«ä½¿ç”¨ï¼Œå¯¼è‡´ GC ä¸èƒ½å›æ”¶ã€‚</p><h2 id="Java-å†…å­˜åˆ†é…ç­–ç•¥"><a href="#Java-å†…å­˜åˆ†é…ç­–ç•¥" class="headerlink" title="Java å†…å­˜åˆ†é…ç­–ç•¥"></a>Java å†…å­˜åˆ†é…ç­–ç•¥</h2><p>Java ç¨‹åºè¿è¡Œæ—¶çš„å†…å­˜åˆ†é…ç­–ç•¥æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯é™æ€åˆ†é…ã€æ ˆå¼åˆ†é…å’Œå †å¼åˆ†é…ã€‚å¯¹åº”çš„ä¸‰ç§å­˜å‚¨ç­–ç•¥ä½¿ç”¨çš„å†…å­˜ç©ºé—´ä¸»è¦åˆ†åˆ«æ˜¯é™æ€å­˜å‚¨åŒºï¼ˆæ–¹æ³•åŒºï¼‰ã€æ ˆåŒºå’Œå †åŒºã€‚</p><ul><li>é™æ€å­˜å‚¨åŒºï¼ˆæ–¹æ³•åŒºï¼‰ï¼šä¸»è¦å­˜æ”¾é™æ€æ•°æ®ï¼Œå…¨å±€ static æ•°æ®å’Œå¸¸é‡ã€‚è¿™å—å†…å­˜åœ¨ç¨‹åºç¼–è¯‘æ—¶å°±å·²ç»åˆ†é…å¥½ï¼Œå¹¶ä¸”åœ¨ç¨‹åºæ•´ä¸ªè¿è¡ŒæœŸé—´éƒ½å­˜åœ¨ã€‚</li><li>æ ˆåŒºï¼šå½“æ–¹æ³•è¢«æ‰§è¡Œæ—¶ï¼Œæ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ï¼ˆå…¶ä¸­åŒ…æ‹¬åŸºç¡€æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨ï¼‰éƒ½åœ¨æ ˆä¸Šåˆ›å»ºï¼Œå¹¶åœ¨æ–¹æ³•æ‰§è¡Œç»“æŸæ—¶è¿™äº›å±€éƒ¨å˜é‡æ‰€æŒæœ‰çš„å†…å­˜å°†ä¼šè‡ªåŠ¨è¢«é‡Šæ”¾ã€‚å› æ­¤æ ˆå†…å­˜åˆ†é…è¿ç®—å†…ç½®äºå¤„ç†å™¨çš„æŒ‡ä»¤é›†ä¸­ï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯åˆ†é…çš„å†…å­˜å®¹é‡æœ‰é™ã€‚</li><li>å †åŒºï¼šåˆç§°åŠ¨æ€å†…å­˜åˆ†é…ï¼Œé€šå¸¸å°±æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ç›´æ¥ new å‡ºæ¥çš„å†…å­˜ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡çš„å®ä¾‹ã€‚è¿™éƒ¨åˆ†å†…å­˜åœ¨ä¸ä½¿ç”¨æ—¶ï¼Œå°†ä¼šç”± Java åƒåœ¾å›æ”¶å™¨è´Ÿè´£å›æ”¶ã€‚</li></ul><a id="more"></a><h2 id="å †ä¸æ ˆçš„åŒºåˆ«ï¼š"><a href="#å †ä¸æ ˆçš„åŒºåˆ«ï¼š" class="headerlink" title="å †ä¸æ ˆçš„åŒºåˆ«ï¼š"></a>å †ä¸æ ˆçš„åŒºåˆ«ï¼š</h2><p>åœ¨æ–¹æ³•ä½“å†…å®šä¹‰çš„ï¼ˆå±€éƒ¨å˜é‡ï¼‰ä¸€äº›åŸºæœ¬ç±»å‹çš„å˜é‡å’Œå¯¹è±¡çš„å¼•ç”¨éƒ½æ˜¯åœ¨æ–¹æ³•çš„æ ˆå†…å­˜ä¸­åˆ†é…çš„ã€‚å½“åœ¨ä¸€æ®µæ–¹æ³•å—ä¸­å®šä¹‰ä¸€ä¸ªå˜é‡æ—¶ï¼ŒJava å°±ä¼šåœ¨æ ˆä¸­ä¸ºè¯¥å˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼Œå½“è¶…è¿‡è¯¥å˜é‡çš„ä½œç”¨åŸŸåï¼Œè¯¥å˜é‡ä¹Ÿå°±æ— æ•ˆäº†ï¼Œåˆ†é…ç»™å®ƒçš„å†…å­˜ç©ºé—´ä¹Ÿå°†è¢«é‡Šæ”¾æ‰ï¼Œè¯¥å†…å­˜ç©ºé—´å¯ä»¥è¢«é‡æ–°ä½¿ç”¨ã€‚</p><p>å †å†…å­˜ç”¨æ¥å­˜æ”¾æ‰€æœ‰ç”± new åˆ›å»ºçš„å¯¹è±¡ï¼ˆåŒ…æ‹¬è¯¥å¯¹è±¡å…¶ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼‰å’Œæ•°ç»„ã€‚åœ¨å †ä¸­åˆ†é…çš„å†…å­˜ï¼Œå°†ç”± Java åƒåœ¾å›æ”¶å™¨æ¥è‡ªåŠ¨ç®¡ç†ã€‚åœ¨å †ä¸­äº§ç”Ÿäº†ä¸€ä¸ªæ•°ç»„æˆ–è€…å¯¹è±¡åï¼Œè¿˜å¯ä»¥åœ¨æ ˆä¸­å®šä¹‰ä¸€ä¸ªç‰¹æ®Šå˜é‡ï¼Œè¿™ä¸ªå˜é‡çš„å–å€¼ç­‰äºæ•°ç»„æˆ–è€…å¯¹è±¡åœ¨å†…å­˜ä¸­çš„é¦–åœ°å€ï¼Œè¿™ä¸ªç‰¹æ®Šçš„å˜é‡å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„å¼•ç”¨å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå¼•ç”¨å˜é‡æ¥è®¿é—®å †ä¸­çš„å¯¹è±¡æˆ–è€…æ•°ç»„ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sample</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> s1 = <span class="number">0</span>;</span><br><span class="line">    Sample sample1 = <span class="keyword">new</span> Sample();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> s2 = <span class="number">1</span>;</span><br><span class="line">        Sample sample2 = <span class="keyword">new</span> Sample();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Sample sample3 = <span class="keyword">new</span> Sample();</span><br></pre></td></tr></table></figure><p>Sample ç±»çš„å±€éƒ¨å˜é‡ s2 å’Œå¼•ç”¨å˜é‡ sample2 éƒ½æ˜¯å­˜åœ¨äºæ ˆä¸­ï¼Œä½† smaple2 æŒ‡å‘çš„å¯¹è±¡æ˜¯å­˜åœ¨äºå †ä¸­ã€‚ sample3 æŒ‡å‘çš„å¯¹è±¡å­˜æ”¾åœ¨å †ä¸­ï¼ŒåŒ…æ‹¬è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰æˆå‘˜å˜é‡ s1 å’Œ sample1ï¼Œ è€Œå®ƒè‡ªå·±å­˜åœ¨ä¸æ ˆä¸­ã€‚</p><p><strong>ç»“è®ºï¼š</strong></p><ul><li>å±€éƒ¨å˜é‡çš„è„šæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨å­˜å‚¨åœ¨æ ˆä¸­ï¼Œå¼•ç”¨çš„å¯¹è±¡å®ä½“å­˜å‚¨äºå †ä¸­ã€‚â€”â€” å› ä¸ºä»–ä»¬å±äºæ–¹æ³•ä¸­çš„å˜é‡ï¼Œç”Ÿå‘½å‘¨æœŸéšæ–¹æ³•è€Œç»“æŸ</li><li>æˆå‘˜å˜é‡å…¨éƒ¨å­˜å‚¨äºå †ä¸­ï¼ˆåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¼•ç”¨å’Œå¼•ç”¨çš„å¯¹è±¡å®ä½“ï¼‰ã€‚â€”â€” å› ä¸ºä»–ä»¬å±äºç±»ï¼Œç±»å¯¹è±¡ç»ˆç©¶æ˜¯è¦è¢« new å‡ºæ¥ä½¿ç”¨çš„ã€‚</li></ul><h2 id="Java-æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜"><a href="#Java-æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜" class="headerlink" title="Java æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜"></a>Java æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜</h2><p>Java çš„å†…å­˜ç®¡ç†å°±æ˜¯å¯¹è±¡çš„åˆ†é…å’Œé‡Šæ”¾çš„é—®é¢˜ã€‚åœ¨ Java ä¸­ï¼Œcoder éœ€è¦é€šè¿‡å…³é”®å­— new ä¸ºæ¯ä¸€ä¸ªå¯¹è±¡ç”³è¯·æ–°çš„å­˜å‚¨ç©ºé—´ï¼ˆåŸºæœ¬ç±»å‹é™¤å¤–ï¼‰ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨ å †ï¼ˆHeapï¼‰ä¸­åˆ†é…ç©ºé—´ã€‚å¦å¤–å¯¹è±¡çš„é‡Šæ”¾æ˜¯ç”± GC å†³å®šå’Œæ‰§è¡Œçš„ï¼Œåœ¨ Java ä¸­ï¼Œå†…å­˜åˆ†é…æ˜¯ç”± coder å®Œæˆçš„ï¼Œè€Œå†…å­˜é‡Šæ”¾æ˜¯ç”± GC å®Œæˆçš„ã€‚è¿™ç§æ”¶æ”¯ä¸¤æ¡çº¿çš„æ–¹æ³•ç®€åŒ–äº† coder çš„å·¥ä½œã€‚åŒæ—¶ä¹ŸåŠ é‡äº† JVM çš„å·¥ä½œã€‚ä¹Ÿæ˜¯ Java ç¨‹åºè¿è¡Œé€Ÿåº¦æ…¢çš„åŸå› ä¹‹ä¸€ã€‚å› ä¸º GC ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾å¯¹è±¡ï¼Œ GC å¿…é¡»ç›‘æ§æ¯ä¸€ä¸ªå¯¹è±¡çš„è¿è¡ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬å¯¹è±¡çš„ç”³è¯·ã€å¼•ç”¨ã€è¢«å¼•ç”¨ã€èµ‹å€¼ç­‰ï¼ŒGC éƒ½éœ€è¦ç›‘æ§ã€‚</p><p>ç›‘æ§å¯¹è±¡çŠ¶æ€æ˜¯ä¸ºäº†æ›´å‡†ç¡®ã€åŠæ—¶åœ°é‡Šæ”¾å¯¹è±¡ï¼Œè€Œé‡Šæ”¾å¯¹è±¡çš„æ ¹æœ¬åŸåˆ™å°±æ˜¯è¯¥å¯¹è±¡ä¸åœ¨è¢«å¼•ç”¨ã€‚</p><p><img src="https://camo.githubusercontent.com/ba01b8ae9af4a5e588251316c826bf3e0e695f35/687474703a2f2f7777772e69626d2e636f6d2f646576656c6f706572776f726b732f636e2f6a6176612f6c2d4a6176614d656d6f72794c65616b2f312e676966" alt></p><p>Java ä½¿ç”¨æœ‰å‘å›¾çš„æ–¹å¼è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œå¯ä»¥æ¶ˆé™¤å¼•ç”¨å¾ªç¯çš„é—®é¢˜ï¼Œä¾‹å¦‚æœ‰ä¸‰ä¸ªå¯¹è±¡ï¼Œç›¸äº’å¼•ç”¨ï¼Œåªè¦ä»–ä»¬å’Œæ ¹è¿›ç¨‹ä¸å¯è¾¾ï¼Œé‚£ä¹ˆ GC å°±å¯ä»¥å›æ”¶ä»–ã€‚è¿™ç§ç®¡ç†æ–¹å¼çš„æœ‰ç‚¹æ˜¯ç®¡ç†å†…å­˜çš„ç²¾åº¦é«˜ï¼Œä½†æ˜¯æ•ˆç‡ä½ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Java-ä¸­çš„å†…å­˜æ³„éœ²"><a href="#ä»€ä¹ˆæ˜¯-Java-ä¸­çš„å†…å­˜æ³„éœ²" class="headerlink" title="ä»€ä¹ˆæ˜¯ Java ä¸­çš„å†…å­˜æ³„éœ²"></a>ä»€ä¹ˆæ˜¯ Java ä¸­çš„å†…å­˜æ³„éœ²</h2><p>åœ¨ Java ä¸­ï¼Œå†…å­˜æ³„éœ²å°±æ˜¯å­˜åœ¨ä¸€äº›è¢«åˆ†é…çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡æœ‰ä¸¤ä¸ªç‰¹ç‚¹ã€‚</p><ul><li>è¿™äº›å¯¹è±¡æ˜¯å¯è¾¾çš„ï¼Œå³åœ¨æœ‰å‘å›¾ä¸­ï¼Œå­˜åœ¨é€šè·¯ä¸å…¶ç›¸è¿</li><li>è¿™äº›å¯¹è±¡æ˜¯æ— ç”¨çš„ï¼Œå³ç¨‹åºä»¥åä¸ä¼šåœ¨ä½¿ç”¨è¿™äº›å¯¹è±¡ã€‚</li></ul><p>å¦‚æœæ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œè¿™äº›å¯¹è±¡å°±å¯ä»¥åˆ¤å®šä¸º Java ä¸­çš„å†…å­˜æ³„éœ²ï¼Œè¿™äº›å¯¹è±¡ä¸ä¼šè¢« GC å›æ”¶ï¼Œä½†å´æ˜¯å ç”¨ç€å†…å­˜ã€‚</p><p>å¯¹äºç¨‹åºçŒ¿æ¥è¯´ï¼Œ GC åŸºæœ¬æ˜¯é€æ˜çš„ï¼Œä¸å¯è§çš„ã€‚è™½ç„¶æˆ‘ä»¬åªæœ‰å‡ ä¸ªå‡½æ•°å¯ä»¥æ–¹ä½ GCï¼Œ ä¾‹å¦‚è¿è¡Œ GC çš„å‡½æ•° <code>System.gc()</code>ï¼Œä½†æ˜¯æ ¹æ® Java è¯­è¨€è§„èŒƒå®šä¹‰ï¼Œè¯¥å‡½æ•°ä¸ä¿è¯ JVM çš„åƒåœ¾å›æ”¶å™¨ä¸€å®šä¼šæ‰§è¡Œã€‚å› ä¸ºï¼Œä¸åŒçš„ JVM å®ç°ç€å¯èƒ½ä½¿ç”¨ä¸åŒçš„ç®—æ³•ç®¡ç† GCã€‚ é€šå¸¸ GC çš„çº¿ç¨‹ä¼˜å…ˆçº§æ¯”è¾ƒä½ã€‚ JVM è°ƒç”¨ GC çš„ç­–ç•¥ä¹Ÿæœ‰å¾ˆå¤šç§ï¼Œæœ‰çš„æ˜¯å†…å­˜ä½¿ç”¨è¾¾åˆ°ä¸€å®šæˆéƒ½æ—¶ï¼Œ GC æ‰å¼€å§‹å·¥ä½œï¼›ä¹Ÿæœ‰å®šæ—¶æ‰§è¡Œï¼Œæœ‰çš„æ˜¯å¹³ç¼“æ‰§è¡Œ GCï¼Œ æœ‰çš„æ˜¯ä¸­æ–­å¼æ‰§è¡Œ GCã€‚ é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒè¿™äº›ã€‚é™¤éåœ¨ä¸€äº›ç‰¹å®šçš„åœºåˆï¼Œ GC çš„æ‰§è¡Œå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œä¾‹å¦‚å¯¹äºåŸºäº Web çš„å®æ—¶ç³»ç»Ÿï¼Œå¦‚ç½‘ç»œæ¸¸æˆç­‰ï¼Œç”¨æˆ·ä¸å¸Œæœ› GC çªç„¶ç»ˆç«¯åº”ç”¨ç¨‹åºæ‰§è¡Œè€Œè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦è°ƒæ•´ GC çš„å‚æ•°ï¼Œè®© GC èƒ½å¤Ÿé€šè¿‡å¹³ç¼“çš„æ–¹å¼é‡Šæ”¾å†…å­˜ï¼Œä¾‹å¦‚å°†åƒåœ¾å›æ”¶åˆ†è§£ä¸ºä¸€ç³»åˆ—çš„å°æ­¥éª¤æ‰§è¡Œï¼Œ Sun æä¾›äº† HotSpot JVM æ”¯æŒè¿™ä¸€ç‰¹æ€§ã€‚</p><p>åŒæ ·ç»™å‡ºä¸€ä¸ª Java å†…å­˜æ³„éœ²çš„å…¸å‹ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Vector v = <span class="keyword">new</span> Vector(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    Object o = <span class="keyword">new</span> Object();</span><br><span class="line">    v.add(o);</span><br><span class="line">    o = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¾ªç¯ç”³è¯· Object å¯¹è±¡ï¼Œå¹¶å°†æ‰€ç”³è¯·çš„å¯¹è±¡æ”¾å…¥ä¸€ä¸ª Vector ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä»…ä»…é‡Šæ”¾å¼•ç”¨æœ¬èº«ï¼Œé‚£ä¹ˆ Vector ä»ç„¶åº”ç”¨è¯¥å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªå¯¹è±¡å¯¹ GC æ¥è¯´æ˜¯ä¸å¯å›æ”¶çš„ã€‚å› æ­¤ï¼Œå¦‚æœå¯¹è±¡åŠ å…¥åˆ° Vector åï¼Œè¿˜å¿…é¡»ä» Vector ä¸­åˆ é™¤ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°† Vector å¯¹è±¡è®¾ç½®ä¸º nullã€‚</p><h2 id="è¯¦ç»†çš„-Java-ä¸­çš„å†…å­˜æ³„éœ²"><a href="#è¯¦ç»†çš„-Java-ä¸­çš„å†…å­˜æ³„éœ²" class="headerlink" title="è¯¦ç»†çš„ Java ä¸­çš„å†…å­˜æ³„éœ²"></a>è¯¦ç»†çš„ Java ä¸­çš„å†…å­˜æ³„éœ²</h2><h3 id="Java-å†…å­˜å›æ”¶æœºåˆ¶"><a href="#Java-å†…å­˜å›æ”¶æœºåˆ¶" class="headerlink" title="Java å†…å­˜å›æ”¶æœºåˆ¶"></a>Java å†…å­˜å›æ”¶æœºåˆ¶</h3><p>ä¸è®ºé‚£ç§è¯­è¨€çš„å†…å­˜åˆ†é…æ–¹å¼ï¼Œéƒ½éœ€è¦è¿”å›æ‰€åˆ†é…çš„çœŸå®åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¿”å›ä¸€ä¸ªæŒ‡é’ˆåˆ°å†…å­˜å—çš„é¦–åœ°å€ã€‚Java ä¸­å¯¹è±¡æ˜¯é‡‡ç”¨ new æˆ–è€…åå°„çš„æ–¹æ³•åˆ›å»ºçš„ï¼Œè¿™äº›å¯¹è±¡çš„åˆ›å»ºéƒ½æ˜¯åœ¨å †ï¼ˆHeapï¼‰ä¸­åˆ†é…çš„ã€‚æ‰€æœ‰å¯¹è±¡çš„å›æ”¶éƒ½æ˜¯ç”± Java è™šæ‹Ÿæœºé€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶å®Œæˆã€‚ GC ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾å¯¹è±¡ï¼Œä¼šç›‘æ§æ¯ä¸ªå¯¹è±¡çš„è¿è¡ŒçŠ¶æ€ï¼Œå¯¹ä»–ä»¬çš„ç”³è¯·ã€å¼•ç”¨ã€è¢«å¼•ç”¨ã€èµ‹å€¼ç­‰çŠ¶å†µè¿›è¡Œç›‘æ§ï¼Œ Java ä¼šä½¿ç”¨æœ‰å‘å›¾çš„æ–¹å¼è¿›è¡Œç®¡ç†å†…å­˜ï¼Œå®æ—¶ç›‘æ§å¯¹è±¡æ˜¯å¦å¯ä»¥åˆ°è¾¾ï¼Œå¦‚æœä¸å¯ä»¥åˆ°è¾¾ï¼Œåˆ™å°†å…¶å›æ”¶ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ¶ˆé™¤å¼•ç”¨çš„å¾ªç¯é—®é¢˜ã€‚åœ¨ Java è¯­è¨€ä¸­ï¼Œåˆ¤æ–­ä¸€ä¸ªå†…å­˜ç©ºé—´æ˜¯å¦ç¬¦åˆåƒåœ¾å›æ”¶æ ‡å‡†æœ‰ä¸¤ä¸ªï¼š</p><pre><code>1. ç»™å¯¹è±¡èµ‹äºˆäº†ç©ºå€¼ null   2. ç»™å¯¹è±¡èµ‹äºˆäº†æ–°å€¼ï¼Œè¿™æ ·é‡æ–°åˆ†é…äº†å†…å­˜ç©ºé—´ã€‚</code></pre><h3 id="Java-å†…å­˜æ³„æ¼å¼•èµ·çš„åŸå› "><a href="#Java-å†…å­˜æ³„æ¼å¼•èµ·çš„åŸå› " class="headerlink" title="Java å†…å­˜æ³„æ¼å¼•èµ·çš„åŸå› "></a>Java å†…å­˜æ³„æ¼å¼•èµ·çš„åŸå› </h3><p>å†…å­˜æ³„éœ²æ˜¯æŒ‡æ— ç”¨å¯¹è±¡ï¼ˆä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼‰æŒç»­å æœ‰å†…å­˜æ´»æ— ç”¨å¯¹è±¡çš„å†…å­˜å¾—ä¸åˆ°åŠæ—¶é‡Šæ”¾ï¼Œä»è€Œé€ æˆå†…å­˜ç©ºé—´çš„æµªè´¹ç§°ä¸ºå†…å­˜æ³„æ¼ã€‚å†…å­˜æ³„æ¼æœ‰æ—¶ä¸ä¸¥é‡ï¼Œä¸æ˜“å¯Ÿè§‰ï¼Œè¿™æ ·å¼€å‘è€…å°±ä¸çŸ¥é“å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œä½†æœ‰æ—¶ä¹Ÿå¾ˆä¸¥é‡ï¼Œä¼šæç¤º Out of memoryã€‚</p><p>Java å†…å­˜æ³„æ¼çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„å¼•ç”¨å°±å¾ˆå¯èƒ½å‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œå°½ç®¡çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡å·²ç»ä¸å†éœ€è¦ï¼Œä½†æ˜¯å› ä¸ºé•¿ç”Ÿå‘½å‘¨æœŸæŒæœ‰å®ƒçš„å¼•ç”¨è€Œå¯¼è‡´ä¸èƒ½è¢«é‡Šæ”¾å›æ”¶ï¼Œè¿™å°±æ˜¯ Java ä¸­å†…å­˜æ³„æ¼çš„å‘ç”Ÿåœºæ™¯ï¼Œä¸»è¦æœ‰ä¸€ä¸‹å‡ å¤§ç±»ï¼š</p><ol><li><p>é™æ€é›†åˆç±»å¼•èµ·çš„å†…å­˜æ³„æ¼ï¼š</p><p>åƒ HashMapã€Vector ç­‰çš„ä½¿ç”¨æœ€å®¹æ˜“å‡ºç°å†…å­˜æ³„æ¼ï¼Œè¿™äº›é™æ€å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå’Œåº”ç”¨ç¨‹åºä¸€è‡´ï¼Œä»–ä»¬æ‰€å¼•ç”¨çš„æ‰€æœ‰çš„å¯¹è±¡ Object ä¹Ÿä¸èƒ½è¢«é‡Šæ”¾ï¼Œå› ä¸ºä»–ä»¬ä¹Ÿå°†ä¸€ç›´è¢« Vector ç­‰å¼•ç”¨ç€ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Static Vector v = <span class="keyword">new</span> Vercor(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    Object o = <span class="keyword">new</span> Object();</span><br><span class="line">    v.add(o);</span><br><span class="line">    o = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¾ªç¯ç”³è¯· <code>Object</code> å¯¹è±¡ï¼Œå¹¶å°†æ‰€ç”³è¯·çš„å¯¹è±¡æ”¾å…¥ä¸€ä¸ª Vector ä¸­ï¼Œå¦‚æœä»…ä»…é‡Šæ”¾å¼•ç”¨æœ¬èº«ï¼ˆo = nullï¼‰ï¼Œé‚£ä¹ˆ Vector ä»ç„¶å¼•ç”¨è¯¥å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªå¯¹è±¡å¯¹ GC æ¥è¯´æ˜¯ä¸å¯ä¼šè¯´çš„ã€‚å› æ­¤å¯¹è±¡åŠ å…¥åˆ° Vector åï¼Œ è¿˜å¿…é¡»ä» Vector ä¸­åˆ é™¤ï¼Œæœ€ç®€å•çš„æ˜¯å°† Vector è®¾ç½®ä¸º nullã€‚</p></li><li><p>å½“é›†åˆé‡Œé¢çš„å¯¹è±¡å±æ€§è¢«ä¿®æ”¹åï¼Œå†è°ƒç”¨ remove() æ–¹æ³•æ—¶ï¼Œä¸èµ·ä½œç”¨</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Set&lt;Person&gt; set = <span class="keyword">new</span> HashSet&lt;Person&gt;();</span><br><span class="line">    Person p1 = <span class="keyword">new</span> Person(<span class="string">"å”åƒ§"</span>, <span class="string">"pwd1"</span>, <span class="number">25</span>);</span><br><span class="line">    Person p2 = <span class="keyword">new</span> Person(<span class="string">"å­™æ‚Ÿç©º"</span>, <span class="string">"pwd2"</span>, <span class="number">24</span>);</span><br><span class="line">    Person p3 = <span class="keyword">new</span> Person(<span class="string">"çŒªå…«æˆ’"</span>, <span class="string">"pwd3"</span>, <span class="number">26</span>);</span><br><span class="line">    </span><br><span class="line">    set.add(p1);</span><br><span class="line">    set.add(p2);</span><br><span class="line">    set.add(p3);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"æ€»å…±æœ‰ï¼š"</span> + set.size() + <span class="string">" ä¸ªå…ƒç´ "</span>);<span class="comment">// ç»“æœï¼š æ€»å…±æœ‰ 3 ä¸ªå…ƒç´ </span></span><br><span class="line">    p3.setAge(<span class="number">2</span>); <span class="comment">// ä¿®æ”¹ p3 çš„å¹´é¾„ï¼Œæ­¤æ—¶ p3 å…ƒç´ å¯¹åº”çš„ hashcode å€¼å‘ç”Ÿæ”¹å˜</span></span><br><span class="line">    </span><br><span class="line">    set.remove(p3); <span class="comment">// remove æ‰ï¼Œé€ æˆå†…å­˜æ³„éœ²</span></span><br><span class="line">    </span><br><span class="line">    set.add(p3); <span class="comment">// é‡æ–°æ·»åŠ ï¼ŒæˆåŠŸ</span></span><br><span class="line">    </span><br><span class="line">   System.out.println(<span class="string">"æ€»å…±æœ‰ï¼š"</span> + set.size() + <span class="string">" ä¸ªå…ƒç´ "</span>); <span class="comment">// ç»“æœï¼šæ€»å…±æœ‰ 4 ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">for</span> (Person person : set) &#123;</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç›‘å¬å™¨</p><p>åœ¨ Java å˜æˆä¸­ï¼Œæˆ‘ä»¬éœ€è¦å’Œç›‘å¬å™¨æ‰“äº¤é“ï¼Œé€šå¸¸ä¸€ä¸ªåº”ç”¨å½“ä¸­ä¼šæœ‰å¤šä¸ªç›‘å¬å™¨ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ä¸€ä¸ªæ§ä»¶çš„ä¾‹å¦‚<code>addXXXXListener()</code> ç­‰æ–¹æ³•æ¥å¢åŠ ç›‘å¬å™¨ï¼Œä½†å¾€å¾€åœ¨é‡Šæ”¾å¯¹è±¡çš„æ—¶å€™ï¼Œå´æ²¡æœ‰è®°ä½å»åˆ é™¤è¿™äº›ç›‘å¬å™¨ï¼Œä»è€Œå¢åŠ äº†å†…å­˜æ³„æ¼çš„æœºä¼šã€‚</p></li><li><p>å„ç§è¿æ¥</p><p>æ¯”å¦‚æ•°æ®åº“è¿æ¥ï¼ˆdataSourse.getConnection()ï¼‰ã€ ç½‘ç»œè¿æ¥(socket) å’Œ io è¿æ¥ï¼Œé™¤éå…¶æ˜¾ç¤ºçš„è°ƒç”¨äº†å…¶ <code>close()</code> æ–¹æ³•å°†å…¶è¿æ¥å…³é—­ï¼Œå¦åˆ™æ˜¯ä¸ä¼šè‡ªåŠ¨è¢« GC å›æ”¶çš„ã€‚å¯¹äº Resultset å’Œ Statement å¯¹è±¡å¯ä»¥ä¸è¿›è¡Œæ˜¾ç¤ºå›æ”¶ï¼Œä½† Connection ä¸€å®šè¦æ˜¾ç¤ºå›æ”¶ï¼Œå› ä¸º Connection åœ¨ä»»ä½•æ—¶å€™éƒ½æ— æ³•è‡ªåŠ¨å›æ”¶ï¼Œè€Œ Connection ä¸€æ—¦å›æ”¶ï¼Œ Resultset å’Œ Statement å¯¹è±¡å°±ä¼šç«‹å³2ä¸º NULLã€‚ ä½†æ˜¯å¦‚æœä½¿ç”¨è¿æ¥æ± ï¼Œæƒ…å†µå°±ä¸ä¸€æ ·äº†ï¼Œé™¤äº†è¦æ˜¾ç¤ºåœ°å…³é—­é“¾æ¥ï¼Œè¿˜å¿…é¡»æ˜¾ç¤ºåœ°å…³é—­ Resultset å’Œ Statement å¯¹è±¡ï¼ˆå…³é—­å…¶ä¸­ä¸€ä¸ªï¼Œ å¦å¤–ä¸€ä¸ªä¹Ÿä¼šå…³é—­ï¼‰ï¼Œå¦åˆ™å°±ä¼šé€ æˆå¤§é‡çš„ Statement å¯¹è±¡æ— æ³•é‡Šæ”¾ï¼Œä»è€Œå¼•èµ·å†…å­˜æ³„æ¼ã€‚è¿™ç§æƒ…å†µä¸‹ä¸€èˆ¬éƒ½ä¼šåœ¨ try é‡Œé¢å»è¿æ¥ï¼Œåœ¨ finally é‡Œé¢é‡Šæ”¾è¿æ¥ã€‚</p></li><li><p>å†…éƒ¨ç±»å’Œå¤–éƒ¨æ¨¡å—çš„å¼•ç”¨</p><p>å†…éƒ¨ç±»çš„å¼•ç”¨æ˜¯æ¯”è¾ƒå®¹æ˜“é—å¿˜çš„ä¸€ç§ï¼Œè€Œä¸”ä¸€æ—¦æ²¡é‡Šæ”¾å¯èƒ½å¯¼è‡´ä¸€ç³»åˆ—çš„åç»­ç±»å¯¹è±¡æ²¡æœ‰é‡Šæ”¾ã€‚æ­¤å¤– coder è¿˜è¦å°å¿ƒå¤–éƒ¨æ¨¡å—ä¸ç»æ„çš„å¼•ç”¨ï¼Œä¾‹å¦‚ coder A è´Ÿè´£ A æ¨¡å—ï¼Œè°ƒç”¨äº† B æ¨¡å—çš„ä¸€ä¸ªæ–¹æ³•ï¼š <code>public void registerMsg(Object b);</code> è¿™ç§è°ƒç”¨å°±è¦å°å¿ƒï¼Œä¼ å…¥äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¾ˆå¯èƒ½æ¨¡å— B å°±ä¿æŒäº†å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™æ—¶å€™å°±éœ€è¦æ³¨æ„æ¨¡å— B æ˜¯å¦æä¾›å“åº”çš„æ“ä½œå»é™¤å¼•ç”¨ã€‚</p></li><li><p>å•ä¾‹æ¨¡å¼</p><p>ä¸æ­£ç¡®çš„ä½¿ç”¨å•ä¾‹æ¨¡å¼æ˜¯å¼•èµ·å†…å­˜æ³„æ¼çš„ä¸€ä¸ªå¸¸è§é—®é¢˜ï¼Œå•åˆ©å¯¹è±¡åœ¨åˆå§‹åŒ–åï¼Œå°†åœ¨ JVM çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å­˜åœ¨ï¼ˆä»¥é™æ€å˜é‡çš„æ–¹å¼ï¼‰ï¼Œå¦‚æœå•ä¾‹å¯¹è±¡æŒæœ‰å¤–éƒ¨çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†ä¸èƒ½è¢« JVM æ­£å¸¸å›æ”¶ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">A</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        B.getInstance().setA(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// B é‡‡ç”¨å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> A a;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> B instance = <span class="keyword">new</span> B();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">b</span> <span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> B <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instacne;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setA</span> <span class="params">(A a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.a = a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// .........</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ B é‡‡ç”¨ singleton æ¨¡å¼ï¼Œ å®ƒæŒæœ‰ä¸€ä¸ª A å¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œè¿™ä¸ªç±»çš„å¯¹è±¡å°†ä¸èƒ½è¢«å›æ”¶ã€‚æƒ³è±¡ä¸‹å¦‚æœ A æ˜¯ä¸ªæ¯”è¾ƒå¤æ‚çš„å¯¹è±¡æˆ–è€…é›†åˆç±»å‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p></li></ol><h2 id="Android-ä¸­å¸¸è§çš„å†…å­˜æ³„æ¼æ±‡æ€»"><a href="#Android-ä¸­å¸¸è§çš„å†…å­˜æ³„æ¼æ±‡æ€»" class="headerlink" title="Android  ä¸­å¸¸è§çš„å†…å­˜æ³„æ¼æ±‡æ€»"></a>Android  ä¸­å¸¸è§çš„å†…å­˜æ³„æ¼æ±‡æ€»</h2><h3 id="é›†åˆç±»æ³„æ¼"><a href="#é›†åˆç±»æ³„æ¼" class="headerlink" title="é›†åˆç±»æ³„æ¼"></a>é›†åˆç±»æ³„æ¼</h3><p>é›†åˆç±»å¦‚æœä»…ä»…æœ‰æ·»åŠ å…ƒç´ çš„æ–¹æ³•ï¼Œè€Œæ²¡æœ‰ç›¸åº”çš„åˆ é™¤æœºåˆ¶ï¼Œå¯¼è‡´å†…å­˜è¢«å ç”¨ã€‚å¦‚æœè¿™ä¸ªé›†åˆç±»æ˜¯å…¨å±€æ€§çš„å˜é‡ï¼ˆæ¯”å¦‚ç±»ä¸­çš„é™æ€å±æ€§ï¼Œå…¨å±€æ€§çš„ map ç­‰å³æœ‰é™æ€å¼•ç”¨æˆ– final ä¸€ç›´æŒ‡å‘å®ƒï¼‰ï¼Œé‚£ä¹ˆæ²¡æœ‰ç›¸åº”çš„åˆ é™¤æœºåˆ¶ï¼Œå¾ˆå¯èƒ½å¯¼è‡´é›†åˆæ‰€å ç”¨çš„å†…å­˜åªå¢ä¸å‡ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­å°±æ˜¯å…¶ä¸­ä¸€ç§æƒ…å†µï¼Œå½“ç„¶å®é™…ä¸Šæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­è‚¯å®šä¸ä¼šè¿™æ ·è°¢ä»£ç ï¼Œä½†ç¨ä¸æ³¨æ„è¿˜æ˜¯å¾ˆå®¹æ˜“å‡ºç°è¿™ç§æƒ…å†µã€‚</p><h3 id="å•ä¾‹é€ æˆçš„å†…å­˜æ³„éœ²"><a href="#å•ä¾‹é€ æˆçš„å†…å­˜æ³„éœ²" class="headerlink" title="å•ä¾‹é€ æˆçš„å†…å­˜æ³„éœ²"></a>å•ä¾‹é€ æˆçš„å†…å­˜æ³„éœ²</h3><p>ç”±äºå•åˆ©çš„é™æ€ç‰¹æ€§ä½¿å¾—å…¶ç”Ÿå‘½å‘¨æœŸè·Ÿåº”ç”¨ä¸€æ ·é•¿ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨ä¸æ°å½“çš„è¯ï¼Œå¾ˆå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AppManager instance;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">AppManager</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connect = connect;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AppManager <span class="title">getInstance</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> AppManager(context);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„å•ä¾‹æ¨¡å¼ï¼Œå½“åˆ›å»ºè¿™ä¸ªå•ä¾‹çš„æ—¶å€™ï¼Œç”±äºéœ€è¦ä¼ å…¥ä¸€ä¸ª Contextï¼Œ æ‰€ä»¥è¿™ä¸ª Context çš„ç”Ÿå‘½å‘¨æœŸçš„é•¿çŸ­è‡³å…³é‡è¦ï¼š</p><ol><li>å¦‚æœæ­¤æ—¶ä¼ å…¥çš„æ˜¯ Application çš„ Contextï¼Œ å› ä¸º Application çš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯è¿™ä¸ªåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥è¿™å°†æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</li><li>å¦‚æœæ­¤æ—¶ä¼ å…¥çš„æ˜¯ Activity çš„ Contextï¼Œå½“è¿™ä¸ª Context æ‰€å¯¹åº”çš„ Activity é€€å‡ºæ—¶ï¼Œç”±äºè¯¥ Context çš„åº”ç”¨è¢«å•ä¾‹å¯¹è±¡æ‰€æŒæœ‰ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸç­‰äºæ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥å½“å‰ Activity é€€å‡ºæ—¶ï¼Œå®ƒçš„å†…å­˜å¹¶ä¸ä¼šè¢«é‡Šæ”¾ï¼Œå°±ä¼šé€ æˆæ³„æ¼ã€‚</li></ol><p><strong>æ­£ç¡®çš„æ–¹å¼åº”ä¿®æ”¹ä¸ºï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppManager</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AppManager instance;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">AppManager</span> <span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = context.getApplicationContext();<span class="comment">// ä½¿ç”¨ Application çš„ context</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AppManager <span class="title">getInstance</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> AppManager(context);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…è¿™æ ·å†™ï¼Œè¿ Context éƒ½ä¸ç”¨ä¼ è¿›æ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ä½ çš„ Application ä¸­æ·»åŠ ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œ getContext() è¿”å› Application çš„ context</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">context = getApplicationContext();</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å…¨å±€çš„ Context</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> è¿”å›å…¨å±€çš„ context å¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Context <span class="title">getContext</span><span class="params">()</span></span>&#123;</span><br><span class="line">    reutnr context;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AppManager instance;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">AppManager</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = MyApplication.getContext();<span class="comment">// ä½¿ç”¨ Application çš„ context</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> staitc AppManager <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> AppManager();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒ¿åå†…éƒ¨ç±»-éé™æ€å†…éƒ¨ç±»å’Œå¼‚æ­¥çº¿ç¨‹"><a href="#åŒ¿åå†…éƒ¨ç±»-éé™æ€å†…éƒ¨ç±»å’Œå¼‚æ­¥çº¿ç¨‹" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»/éé™æ€å†…éƒ¨ç±»å’Œå¼‚æ­¥çº¿ç¨‹"></a>åŒ¿åå†…éƒ¨ç±»/éé™æ€å†…éƒ¨ç±»å’Œå¼‚æ­¥çº¿ç¨‹</h3><p>éé™æ€å†…éƒ¨ç±»åˆ›å»ºé™æ€å®ä¾‹é€ æˆçš„å†…å­˜æ³„æ¼</p><p>æœ‰çš„æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šåœ¨å¯åŠ¨é¢‘ç¹çš„ Activity ä¸­ï¼Œä¸ºäº†é¿å…é‡å¤åˆ›å»ºç›¸åŒèµ„æºï¼Œå¯èƒ½ä¼šå‡ºç°è¿™ç§å†™æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> staitc TestResource mResource = <span class="keyword">null</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">if</span>(mResource == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mResource = <span class="keyword">new</span> TestResource();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//....</span></span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestResource</span> </span>&#123;</span><br><span class="line">            <span class="comment">//....</span></span><br><span class="line">            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±åœ¨ Activity å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªéé™æ€å†…éƒ¨ç±»çš„å•ä¾‹ï¼Œæ¯æ¬¡å¯åŠ¨ Activity éƒ½ä¼šä½¿ç”¨è¯¥å•åˆ©çš„æ•°æ®ï¼Œè¿™æ ·è™½ç„¶é¿å…äº†èµ„æºçš„é‡å¤åˆ›å»ºï¼Œä¸è¿‡è¿™ç§å†™æ³•å´é€ æˆäº†å†…å­˜å†™æ³„æ¼ï¼Œå› ä¸º<strong>éé™æ€å†…éƒ¨ç±»é»˜è®¤ä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨</strong>ï¼Œè€Œè¯¥éé™æ€å†…éƒ¨ç±»åˆåˆ›å»ºäº†ä¸€ä¸ªé™æ€å®ä¾‹ï¼Œè¯¥å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸå’Œåº”ç”¨ä¸€æ ·é•¿ï¼Œè¿™å°±å¯¼è‡´äº†è¯¥é™æ€å®ä¾‹ä¸€ç›´ä¼šæŒæœ‰è¯¥ Activity çš„å¼•ç”¨ï¼Œå¯¼è‡´ Activity çš„å†…å­˜èµ„æºä¸èƒ½æ­£å¸¸å›æ”¶ã€‚æ­£ç¡®çš„åšæ³•ï¼š</p><p>å°†è¯¥å†…éƒ¨ç±»è®¾ä¸ºé™æ€å†…éƒ¨ç±»æˆ–è€…å°†è¯¥å†…éƒ¨ç±»æŠ½å–å‡ºæ¥å°è£…æˆå•ä¾‹ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ Contextï¼Œ æŒ‰ç…§ä¸Šä¸€ä¸ªæ–¹æ³•æ¨èä½¿ç”¨ Application ä¸­çš„ Contextã€‚ å½“ç„¶ Application çš„ Context ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½éšä¾¿ä¹±ç”¨ï¼Œå¯¹äºæœ‰äº›åœ°æ–¹åˆ™æ˜¯å¿…é¡»ä½¿ç”¨ Activity çš„ Context ï¼Œå¯¹äº Applicationï¼ŒServiceï¼Œ Activity ä¸‰è€…çš„ Context çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p><p><img src="https://camo.githubusercontent.com/dee4aecb8a80c4e73337b56ee01cbffa2a8049dd/687474703a2f2f696d672e626c6f672e6373646e2e6e65742f32303135313132333134343232363334393f73706d3d353137362e3130303233392e626c6f67636f6e742e392e437455316334" alt="Application, Service, Activity çš„ Context ä½¿ç”¨åœºæ™¯"></p><p>å…¶ä¸­ï¼šNO1 è¡¨ç¤º Application å’Œ Service å¯ä»¥å¯åŠ¨ä¸€ä¸ª Activityï¼Œä¸è¿‡éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ task ä»»åŠ¡é˜Ÿåˆ—ã€‚è€Œå¯¹äº Dialog è€Œè¨€ï¼Œåªæœ‰åœ¨ Activity ä¸­æ‰èƒ½åˆ›å»ºã€‚</p><h3 id="åŒ¿åå†…éƒ¨ç±»"><a href="#åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»"></a>åŒ¿åå†…éƒ¨ç±»</h3><p>Android å¼€å‘ç»å¸¸ä¼šç»§æ‰¿å®ç° Activity/Fragment/Viewï¼Œ æ­¤æ—¶å¦‚æœä½ ä½¿ç”¨äº†åŒ¿åç±»ï¼Œå¹¶è¢«å¼‚æ­¥çº¿ç¨‹æŒæœ‰ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•æªæ–½è¿™æ ·ä¸€å®šä¼šå¯¼è‡´æ³„æ¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    Runnable ref1 = <span class="keyword">new</span> MyRunnable();</span><br><span class="line">    Runnable ref2 = <span class="keyword">new</span> Runnable ()&#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">           ....</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ref1 å’Œ ref2 çš„åŒºåˆ«æ˜¯ï¼Œ ref2 ä½¿ç”¨äº†åŒ¿åå†…éƒ¨ç±»ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿è¡Œæ—¶ï¼Œè¿™ä¸¤ä¸ªå¼•ç”¨çš„å†…å­˜ï¼š</p><p><img src="https://camo.githubusercontent.com/2b1a52551d828d9640f23ee7c2802476b02ccec3/687474703a2f2f696d67322e746263646e2e636e2f4c312f3436312f312f666230356666366432653638663330396239346464383433353263383161636665306165383339653f73706d3d353137362e3130303233392e626c6f67636f6e742e31302e437455316334" alt></p><p>å¯ä»¥çœ‹åˆ° ref1 æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚</p><p>ä½† ref2 è¿™ä¸ªåŒ¿åç±»çš„å®ç°å¯¹è±¡é‡Œé¢å¤šäº†ä¸€ä¸ªå¼•ç”¨ï¼š</p><p>this$0 è¿™ä¸ªå¼•ç”¨æŒ‡å‘ MainActivity.thisï¼Œ ä¹Ÿå°±æ˜¯è¯´å½“å‰çš„ MainActivity å®ä¾‹ä¼šè¢« ref2 æŒæœ‰ï¼Œå¦‚æœå°†è¿™ä¸ªå¼•ç”¨å†ä¼ å…¥ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹ï¼Œæ­¤çº¿ç¨‹å’Œæ­¤ Activity ç”Ÿå‘½å‘¨æœŸä¸ä¸€è‡´çš„æ—¶å€™ï¼Œå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</p><h3 id="Handler-é€ æˆçš„å†…å­˜æ³„æ¼"><a href="#Handler-é€ æˆçš„å†…å­˜æ³„æ¼" class="headerlink" title="Handler é€ æˆçš„å†…å­˜æ³„æ¼"></a>Handler é€ æˆçš„å†…å­˜æ³„æ¼</h3><p>Handler çš„ä½¿ç”¨é€ æˆçš„å†…å­˜æ³„æ¼é—®é¢˜åº”è¯¥è¯´æ˜¯æœ€å¸¸è§çš„ï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸ºäº†é¿å… ANR è€Œä¸åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œè€—æ—¶æ“ä½œï¼Œåœ¨å¤„ç†ç½‘ç»œä»»åŠ¡æˆ–è€…å°è£…ä¸€äº›è¯·æ±‚å›è°ƒç­‰ api éƒ½å€ŸåŠ© Handler æ¥å¤„ç†ï¼Œä½† Handler ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå¯¹äº Handler çš„ä½¿ç”¨ä»£ç ç¼–å†™ä¸è§„èŒƒå°±æœ‰å¯èƒ½é€ æˆå†…å­˜æ³„æ¼ã€‚å¦å¤–ï¼Œæˆ‘ä»¬çŸ¥é“ Handlerã€Message å’Œ MessageQueue éƒ½æ˜¯ç›¸äº’å…³è”åœ¨ä¸€èµ·çš„ï¼Œä¸‡ä¸€ Handler å‘é€çš„ Message å°šæœªè¢«å¤„ç†ï¼Œåˆ™è¯¥ Message åŠå‘é€å®ƒçš„ Handler å¯¹è±¡å°†è¢«çº¿ç¨‹ MessageQueue ä¸€ç›´æŒæœ‰ã€‚</p><p>ç”±äº Handler å±äº TLSï¼ˆThread Local Storageï¼‰å˜é‡ï¼Œç”Ÿå‘½å‘¨æœŸå’Œ Activity æ˜¯ä¸ä¸€è‡´çš„ã€‚å› æ­¤è¿™ç§å®ç°æ–¹å¼ä¸€èˆ¬å¾ˆéš¾ä¿è¯è·Ÿ View æˆ–è€… Activity çš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ— æ³•æ­£ç¡®é‡Šæ”¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Handler mLeakyHandler = <span class="keyword">new</span> Handerl()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundler savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="comment">// post a message and delay its execution for 10 minutes.</span></span><br><span class="line">        mLeakHandler.postDelayed(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">                ...</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">1000</span> * <span class="number">6</span> * <span class="number">10</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// go back to the previous Activity</span></span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¯¥ä¾‹ä¸­ï¼Œç”Ÿå‘½äº†ä¸€ä¸ªå»¶æ—¶ 10 åˆ†é’Ÿæ‰§è¡Œçš„æ¶ˆæ¯ Messageï¼Œ mLeakyHandler å°†å…¶ push è¿›äº†æ¶ˆæ¯é˜Ÿåˆ— MessageQueue ä¸­ã€‚å½“ Activity è¢« finish() æ‰ï¼Œå»¶æ—¶ä»»åŠ¡çš„ Message è¿˜ä¼šç»§ç»­å­˜åœ¨äºä¸»çº¿ç¨‹ä¸­ï¼Œå®ƒæŒæœ‰è¯¥ Activity çš„ Handler å¼•ç”¨ï¼Œæ­¤æ—¶ finish() æ‰çš„ Activity å°±ä¸ä¼šè¢«å›æ”¶ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ï¼ˆ<strong>å›  Handler ä¸ºéé™æ€å†…éƒ¨ç±»ï¼Œä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œåœ¨è¿™é‡Œå°±æ˜¯ MainActivity</strong>ï¼‰.</p><p>ä¿®å¤æ–¹æ³•ï¼šåœ¨ Activity ä¸­é¿å…ä½¿ç”¨éé™æ€å†…éƒ¨ç±»ï¼Œæ¯”å¦‚ä¸Šé¢æˆ‘ä»¬å°† Handler ç”Ÿå‘½ä¸ºé™æ€çš„ï¼Œåˆ™å…¶å­˜æ´»æœŸå’Œ Activityçš„ ç”Ÿå‘½å‘¨æœŸæ— å…³äº†ï¼ŒåŒæ—¶é€šè¿‡å¼±å¼•ç”¨çš„æ–¹å¼å¼•å…¥ Activityï¼Œé¿å…ç›´æ¥å°† Activity ä½œä¸º Context ä¼ å…¥ï¼Œ å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Instence of static inner classes do not bold an implicit reference to their outer class</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> WeakReference&lt;SampleActivity&gt; mActivity;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyHandler</span> <span class="params">(SampleActivity activity)</span> </span>&#123;</span><br><span class="line">            mActivity = <span class="keyword">new</span> WeakReference&lt;SampleActivity&gt;(activity);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span> <span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            SampleActivity activity = mActivity.get();</span><br><span class="line">            <span class="keyword">if</span>(activity != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">//....</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MyHandler mHandler = <span class="keyword">new</span> MyHandler(<span class="keyword">this</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Instance of anonymous classes do not hold an implicit </span></span><br><span class="line"><span class="comment">    * reference to their outer class when they are "static"</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Runnable sRunnable = <span class="keyword">new</span> Runnable ()&#123;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundler savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Post a message and delay its execution for 10 mintues.</span></span><br><span class="line">        mHandler.postDelay(sRunnable, <span class="number">1000</span> * <span class="number">60</span> * <span class="number">10</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// go back to the previous Activity</span></span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»¼è¿°ï¼Œ å³æ¨èä½¿ç”¨é™æ€å†…éƒ¨ç±» + WeakReference è¿™ç§æ–¹å¼ã€‚æ¯æ¬¡ä½¿ç”¨å‰æ³¨æ„åˆ¤ç©ºã€‚</p><p>å‰é¢æåˆ°çš„ WeakReferenceï¼Œæ‰€ä»¥è¿™é‡Œç®€å•è¯´ä¸‹ Java ä¸­å¯¹è±¡çš„å‡ ç§å¼•ç”¨ç±»å‹ã€‚</p><p>Java å¯¹å¼•ç”¨åˆ†ä¸º StrongReferenceï¼Œ SoftReferenceï¼Œ WeakReferenceå’Œ PhantomReference å››ç§ã€‚</p><table><thead><tr><th>çº§åˆ«</th><th>å›æ”¶æ—¶æœº</th><th>ç”¨é€”</th><th>ç”Ÿå­˜æ—¶é—´</th></tr></thead><tbody><tr><td>å¼º(StrongReference)</td><td>ä»æ¥ä¸ä¼š</td><td>å¯¹è±¡çš„ä¸€èˆ¬çŠ¶æ€</td><td>JVM åœæ­¢è¿è¡Œæ—¶ç»ˆæ­¢</td></tr><tr><td>è½¯(SoftReference)</td><td>åœ¨å†…å­˜ä¸è¶³æ—¶</td><td>è”åˆ ReferenceQueue æ„é€ æœ‰æ•ˆæœŸçŸ­/å å†…å­˜å¤§/ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡çš„äºŒçº§é«˜é€Ÿç¼“å†²å™¨(å†…å­˜ä¸è¶³æ‰æ¸…ç©º)</td><td>å†…å­˜ä¸è¶³æ—¶ç»ˆæ­¢</td></tr><tr><td>å¼±ï¼ˆWeakReferenceï¼‰</td><td>åœ¨åƒåœ¾å›æ”¶æ—¶</td><td>è”åˆ ReferenceQueue æ„é€ æœ‰æ•ˆæœŸçŸ­/å å†…å­˜å¤§/ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡çš„ä¸€çº§é«˜é€Ÿç¼“å†²å™¨(ç³»ç»Ÿå‘ç”Ÿ gc åˆ™æ¸…ç©º)</td><td>gc è¿è¡Œåç»ˆæ­¢</td></tr><tr><td>è™šï¼ˆPhantomReferenceï¼‰</td><td>åœ¨åƒåœ¾å›æ”¶æ—¶</td><td>è”åˆ ReferenceQueue æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„æ´»åŠ¨</td><td>gc è¿è¡Œåç»ˆæ­¢</td></tr></tbody></table><p>åœ¨ Android åº”ç”¨å¼€å‘ä¸­ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜æº¢å‡ºï¼Œåœ¨å¤„ç†ä¸€äº›å ç”¨å†…å­˜å¤§è€Œä¸”ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡æ—¶å€™ï¼Œå¯ä»¥å°½é‡åº”ç”¨è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨æŠ€æœ¯ã€‚</p><p>è½¯/å¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼ŒJava è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”å¾—çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚åˆ©ç”¨è¿™ä¸ªé˜Ÿåˆ—å¯ä»¥å¾—çŸ¥è¢«å›æ”¶çš„è½¯/å¼±å¼•ç”¨çš„å¯¹è±¡åˆ—è¡¨ï¼Œä»è€Œä¸ºç¼“å†²å™¨æ¸…æ¥šå·²å¤±æ•ˆçš„è½¯/å¼±å¼•ç”¨ã€‚</p><p>å‡è®¾æˆ‘ä»¬çš„åº”ç”¨ä¼šç”¨åˆ°å¤§é‡çš„é»˜è®¤å›¾ç‰‡ï¼Œæ¯”å¦‚åº”ç”¨ä¸­æœ‰é»˜è®¤çš„å¤´åƒï¼Œé»˜è®¤æ¸¸æˆå›¾æ ‡ç­‰ç­‰ï¼Œè¿™äº›å›¾ç‰‡å¾ˆå¤šåœ°æ–¹ä¼šç”¨åˆ°ã€‚å¦‚æœæ¯æ¬¡å»è¯»å–å›¾ç‰‡ï¼Œç”±äºè¯»å–æ–‡ä»¶éœ€è¦ç¡¬ä»¶æ“ä½œï¼Œé€Ÿåº¦å¾ˆæ…¢ï¼Œä¼šå¯¼è‡´æ€§èƒ½è¾ƒä½ã€‚æ‰€ä»¥æˆ‘ä»¬è€ƒè™‘å°†å›¾ç‰‡ç¼“å­˜èµ·æ¥ï¼Œéœ€è¦çš„æ—¶å€™ç›´æ¥ä»å†…å­˜ä¸­è¯»å–ã€‚ä½†æ˜¯ç”±äºå›¾ç‰‡å ç”¨ç©ºé—´æ¯”è¾ƒå¤§ï¼Œç¼“å­˜å¾ˆå¤šå›¾ç‰‡éœ€è¦å¾ˆå¤šçš„å†…å­˜ï¼Œå°±å¯èƒ½æ¯”è¾ƒå®¹æ˜“å‘ç”Ÿ OutOfMemery å¼‚å¸¸ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨è½¯/å¼±å¼•ç”¨æŠ€æœ¯æ¥é¿å…è¿™ä¸ªé—®é¢˜å‘ç”Ÿã€‚ä»¥ä¸‹æ˜¯é«˜é€Ÿç¼“å†²å™¨çš„é›å½¢ï¼š</p><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ª HashMapï¼Œä¿å­˜è½¯å¼•ç”¨å¯¹è±¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private Map&lt;String, SoftReference&lt;Bitmap&gt;&gt; imageCache = new HashMap&lt;String, SoftReference&lt;Bitmap&gt;&gt;();</span><br></pre></td></tr></table></figure><p>å†å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œä¿å­˜ bitmap çš„è½¯å¼•ç”¨åˆ° HashMapã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public class CacheBySoftRef &#123;</span><br><span class="line">    // å…ˆå®šä¹‰ä¸€ä¸ª HashMapï¼Œä¿å­˜è½¯å¼•ç”¨å¯¹è±¡</span><br><span class="line">    private Map&lt;String, SoftReference&lt;Bitmap&gt;&gt; imageCache = new HashMap&lt;String, SoftReference&lt;Bitmap&gt;&gt;();</span><br><span class="line">    </span><br><span class="line">    // å†å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œä¿å­˜ bitmap çš„è½¯å¼•ç”¨åˆ° HashMapã€‚</span><br><span class="line">    public void addBitmapToCache(String path) &#123;</span><br><span class="line">        // å¼ºå¼•ç”¨çš„ Bitmap å¯¹è±¡</span><br><span class="line">        Bitmap bitmap = BitmapFactory.decodeFile(path);</span><br><span class="line">        // è½¯å¼•ç”¨çš„ bitmap å¯¹è±¡</span><br><span class="line">        SoftReference&lt;Bitmap&gt; softBitmap = new SoftReference&lt;Bitmap&gt;(bitmap);</span><br><span class="line">        imageCache.put(path, softBitmap);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // è·å–çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ SoftReference çš„ get() æ–¹æ³•å¾—åˆ° bitmap å¯¹è±¡</span><br><span class="line">    public Bitmap getBitmapByPath(String path) &#123;</span><br><span class="line">        // ä»ç¼“å­˜ä¸­å–è½¯å¼•ç”¨çš„ bitmap å¯¹è±¡</span><br><span class="line">        SoftReference&lt;Bitmap&gt; softBitmap = imageCache.get(path);</span><br><span class="line">        // åˆ¤æ–­æ˜¯å¦å­˜åœ¨è½¯å¼•ç”¨</span><br><span class="line">        if (softBitmap == null)  return;</span><br><span class="line">        // é€šè¿‡è½¯å¼•ç”¨å–å‡º bitmap å¯¹è±¡ï¼Œå¦‚æœç”±äºå†…å­˜ä¸è¶³ Bitmap è¢«å›æ”¶ï¼Œå°†å–åˆ°ç©ºï¼Œå¦‚æœæœªè¢«å›æ”¶ï¼Œåˆ™å¯é‡å¤ä½¿ç”¨ï¼Œæé«˜é€Ÿåº¦</span><br><span class="line">        Bitmap bitmap = softBitmap.get();</span><br><span class="line">        return bitmap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è½¯å¼•ç”¨ä»¥åï¼Œåœ¨ OutOfMemory å¼‚å¸¸å‘ç”Ÿä¹‹å‰ï¼Œè¿™äº›ç¼“å­˜çš„å›¾ç‰‡èµ„æºçš„å†…å­˜ç©ºé—´å¯ä»¥è¢«é‡Šæ”¾æ‰ï¼Œä»è€Œé¿å…å†…å­˜è¾¾åˆ°ä¸Šçº¿ï¼Œé¿å… Crash å‘ç”Ÿã€‚</p><p>å¦‚æœåªæ˜¯æƒ³é¿å… OutOfMemory å¼‚å¸¸çš„å‘ç”Ÿï¼Œåˆ™å¯ä»¥ä½¿ç”¨è½¯å¼•ç”¨ã€‚å¦‚æœå¯¹äºåº”ç”¨çš„æ€§èƒ½æ›´åœ¨æ„ï¼Œæƒ³å°½å¿«å›æ”¶ä¸€äº›å ç”¨å†…å­˜æ¯”è¾ƒå¤§çš„å¯¹è±¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¼±å¼•ç”¨ã€‚</p><p>å¦å¤–å¯ä»¥æ ¹æ®å¯¹è±¡<strong>æ˜¯å¦ç»å¸¸ä½¿ç”¨</strong>æ¥åˆ¤æ–­é€‰æ‹©è½¯å¼•ç”¨è¿˜æ˜¯å¼±å¼•ç”¨ã€‚å¦‚æœå¯¹è±¡å¯èƒ½ä¼šç»å¸¸ä½¿ç”¨ï¼Œå°±å°½å¯èƒ½çš„ä½¿ç”¨è½¯å¼•ç”¨ã€‚å¦‚æœå¯¹è±¡ä¸è¢«ä½¿ç”¨çš„å¯èƒ½æ€§æ›´å¤§ï¼Œå°±ç”¨å¼±å¼•ç”¨ã€‚</p><p>å‰é¢æ‰€è¯´ï¼Œåˆ›å»ºä¸€ä¸ªé™æ€çš„ Handler å†…éƒ¨ç±»ï¼Œç„¶åå¯¹ Handler æŒæœ‰çš„å¯¹è±¡ä½¿ç”¨å¼±å¼•ç”¨ï¼Œè¿™æ ·åœ¨å›æ”¶æ—¶ä¹Ÿå¯ä»¥å›æ”¶ Handler æŒæœ‰çš„å¯¹è±¡ï¼Œä½†æ˜¯è¿™æ ·åšè™½ç„¶é¿å…äº† Activity çš„æ³„æ¼ï¼Œä¸è¿‡ Looper çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œè¿˜æ˜¯å¯èƒ½ä¼šæœ‰å¾…å¤„ç†çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ Activity çš„ onDestory() æ—¶ï¼Œæˆ–è€… Stop æ—¶åº”è¯¥ç§»é™¤æ¶ˆæ¯é˜Ÿåˆ— MessageQueue ä¸­çš„æ¶ˆæ¯ã€‚</p><p>ç§»é™¤æ¶ˆæ¯é˜Ÿåˆ—ä¸­ Message çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">removeCallbacks</span><span class="params">(Runnable r)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">removeCallbacks</span><span class="params">(Runnable r, Objject token)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">removeCallbacksAndMessages</span><span class="params">(Object token)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">removeMessages</span><span class="params">(<span class="keyword">int</span> what)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">removeMessages</span><span class="params">(<span class="keyword">int</span> what, Object object)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="å°½é‡é¿å…ä½¿ç”¨-static-æˆå‘˜å˜é‡"><a href="#å°½é‡é¿å…ä½¿ç”¨-static-æˆå‘˜å˜é‡" class="headerlink" title="å°½é‡é¿å…ä½¿ç”¨ static æˆå‘˜å˜é‡"></a>å°½é‡é¿å…ä½¿ç”¨ static æˆå‘˜å˜é‡</h3><p>å¦‚æœæˆå‘˜å˜é‡è¢«å£°æ˜ä¸º static, é‚£æˆ‘ä»¬éƒ½çŸ¥é“å…¶ç”Ÿå‘½å‘¨æœŸå°†ä¸æ•´ä¸ª APP è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸä¸€æ ·ã€‚</p><p>è¿™ä¼šå¯¼è‡´ä¸€äº›åˆ—é—®é¢˜ï¼Œå¦‚æœä½ çš„ APP è¿›ç¨‹è®¾è®¡ä¸Šæ˜¯å¸¸é©»å†…å­˜çš„ï¼Œé‚£å³ä½¿ APP åˆ‡åˆ°åå°ï¼Œè¿™éƒ¨åˆ†å†…å­˜ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾ã€‚æŒ‰ç…§ç°åœ¨æ‰‹æœº APP å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå å†…å­˜è¾ƒå¤§çš„åå°é›†æˆå°†ä¼˜å…ˆå›æ”¶ï¼Œå› ä¸ºå¦‚æœæ­¤ APP åšè¿‡è¿›ç¨‹äº’ç›¸ä¿æ´»ï¼Œé‚£ä¼šé€ æˆ APP åœ¨åå°é¢‘ç¹é‡å¯ã€‚å½“æ‰‹æœºå®‰è£…äº†ä½ å‚ä¸å¼€å‘çš„ APP ä»¥åä¸€å¤œæ—¶é—´æ‰‹æœºè¢«æ¶ˆè€—ç©ºäº†ç”µé‡ã€æµé‡ï¼Œä½ çš„ APP ä¸å¾—ä¸è¢«ç”¨æˆ·å¸è½½æˆ–è€…é™é»˜ã€‚</p><p>ä¿®å¤æ–¹æ³•æ˜¯ï¼š</p><p>ä¸è¦åœ¨ç±»åˆå§‹åŒ–æ—¶åˆå§‹åŒ–é™æ€æˆå‘˜ã€‚å¯ä»¥è€ƒè™‘ lazy åˆå§‹åŒ–ã€‚æ¶æ„è®¾è®¡ä¸Šè¦æ­»å¥½æ˜¯å¦çœŸçš„æœ‰å¿…è¦è¿™æ ·åšï¼Œå°½é‡é¿å…ã€‚å¦‚æœæ¶æ„éœ€è¦è¿™ä¹ˆè®¾è®¡ï¼Œé‚£ä¹ˆæ­¤å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä½ æœ‰è´£ä»»ç®¡ç†èµ·æ¥ã€‚</p><h3 id="é¿å…-Override-finalize"><a href="#é¿å…-Override-finalize" class="headerlink" title="é¿å… Override finalize()"></a>é¿å… Override finalize()</h3><ol><li><p>finalize æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶é—´ä¸ç¡®å®šï¼Œä¸èƒ½ä¾èµ–å®ƒæ¥é‡Šæ”¾ç´§ç¼ºçš„èµ„æºï¼Œæ—¶é—´ä¸ç¡®å®šçš„åŸå› æ˜¯ï¼šè™šæ‹Ÿæœºè°ƒç”¨ GC çš„æ—¶é—´ä¸ç¡®å®š finalize daemon çº¿ç¨‹è¢«è°ƒåº¦åˆ°çš„æ—¶é—´ä¸ç¡®å®šã€‚</p></li><li><p>finalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼ŒåŠæ—¶å¯¹è±¡è¢«å¤æ´»ï¼Œå¦‚æœå·²ç»æ‰§è¡Œè¿‡ finalize æ–¹æ³•ï¼Œå†æ¬¡è¢« GC æ—¶ï¼Œä¹Ÿä¸ä¼šå†æ‰§è¡Œï¼ŒåŸå› æ˜¯ï¼š</p><p>å«æœ‰ finalize æ–¹æ³•çš„ Object æ˜¯åœ¨ new çš„æ—¶å€™ï¼Œç”±è™šæ‹Ÿæœºç”Ÿæˆäº†ä¸€ä¸ª finalize reference åœ¨æ¥å¼•ç”¨åˆ°è¯¥ Objectçš„ï¼Œè€Œåœ¨finalize æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼Œè¯¥ Object æ‰€å¯¹åº”çš„ finalize Reference ä¼šè¢«é‡Šæ”¾æ‰ã€‚å³ä½¿åœ¨è¿™ä¸ªæ—¶å€™æŠŠè¯¥Object å¤æ´»ï¼ˆå³ç”¨å¼ºå¼•ç”¨å¼•ç”¨ä½è¯¥ Objectï¼‰ï¼Œå†ç¬¬äºŒæ¬¡è¢« GC çš„æ—¶å€™ï¼Œç”±äºæ²¡æœ‰äº† finalize Reference ä¸ä¹‹å¯¹åº”ï¼Œæ‰€ä»¥ finalize æ–¹æ³•ä¸ä¼šå†æ‰§è¡Œã€‚</p></li><li><p>å«æœ‰ finalize æ–¹æ³•çš„ Object éœ€è¦è‡³å°‘ç»è¿‡ä¸¤è½® GC æ‰æœ‰å¯èƒ½è¢«é‡Šæ”¾ã€‚</p></li></ol><h3 id="èµ„æºæœªå…³é—­é€ æˆçš„å†…å­˜æ³„æ¼"><a href="#èµ„æºæœªå…³é—­é€ æˆçš„å†…å­˜æ³„æ¼" class="headerlink" title="èµ„æºæœªå…³é—­é€ æˆçš„å†…å­˜æ³„æ¼"></a>èµ„æºæœªå…³é—­é€ æˆçš„å†…å­˜æ³„æ¼</h3><p>å¯¹äºä½¿ç”¨äº† BroadcastRevicer, ContentObserver, Fileï¼Œ æ¸¸æ ‡ Cursorï¼Œ Streamï¼Œ Bitmap ç­‰èµ„æºçš„ä½¿ç”¨ï¼Œåº”è¯¥åœ¨ Activity é”€æ¯æ—¶åŠæ—¶å…³é—­æˆ–è€…æ³¨é”€ï¼Œå¦åˆ™è¿™äº›èµ„æºå°†ä¸ä¼šè¢«å›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚</p><h3 id="ä¸€äº›ä¸è‰¯ä»£ç é€ æˆçš„å†…å­˜å‹åŠ›"><a href="#ä¸€äº›ä¸è‰¯ä»£ç é€ æˆçš„å†…å­˜å‹åŠ›" class="headerlink" title="ä¸€äº›ä¸è‰¯ä»£ç é€ æˆçš„å†…å­˜å‹åŠ›"></a>ä¸€äº›ä¸è‰¯ä»£ç é€ æˆçš„å†…å­˜å‹åŠ›</h3><p>æœ‰äº›ä»£ç å¹¶ä¸é€ æˆå†…å­˜æ³„æ¼ï¼Œä½†æ˜¯ä»–ä»¬ï¼Œ æˆ–æ˜¯å¯¹æ²¡ä½¿ç”¨çš„å†…å­˜æ²¡è¿›è¡Œæœ‰æ•ˆåŠæ—¶çš„é‡Šæ”¾ï¼Œæˆ–æ˜¯æ²¡æœ‰æœ‰æ•ˆçš„åˆ©ç”¨å·²æœ‰çš„å¯¹è±¡è€Œæ˜¯é¢‘ç¹çš„ç”³è¯·æ–°å†…å­˜ã€‚</p><p>æ¯”å¦‚: Bitmap æ²¡æœ‰è°ƒç”¨ recycle(), å¯¹äº Bitmap å¯¹è±¡åœ¨ä¸ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆè°ƒç”¨  recycle(), é‡Šæ”¾å†…å­˜ï¼Œç„¶åè®¾ç½®ä¸º nullã€‚ å› ä¸ºåŠ è½½ bitmap å¯¹è±¡çš„å†…å­˜ç©ºé—´ï¼Œä¸€éƒ¨åˆ†æ˜¯ Java çš„ï¼Œ ä¸€éƒ¨åˆ†æ˜¯ C çš„ï¼ˆå› ä¸º Bitmap åˆ†é…çš„åº•å±‚æ˜¯é€šè¿‡ JNI è°ƒç”¨çš„ï¼‰ã€‚è€Œè¿™ä¸ª recycle() å°±æ˜¯é’ˆå¯¹ C éƒ¨åˆ†çš„å†…å­˜é‡Šæ”¾ã€‚æ„é€  Adapter æ—¶ï¼Œæ²¡æœ‰ä½¿ç”¨ç¼“å­˜çš„ convertViewï¼Œ æ¯æ¬¡éƒ½åœ¨åˆ›å»ºæ–°çš„ converViewã€‚ è¿™é‡Œæ¨èä½¿ç”¨ ViewHolderã€‚ </p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯¹ Activity ç­‰ç»„ä»¶çš„å¼•ç”¨åº”è¯¥æ§åˆ¶åœ¨ Activity çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼›å¦‚æœä¸èƒ½å°±è€ƒè™‘ä½¿ç”¨ <code>getApplicationContext</code> æˆ–è€… <code>getApplication</code> ,ä»¥é¿å… Activity è¢«å¤–éƒ¨é•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡å¼•ç”¨è€Œæ³„æ¼ã€‚</p><p>å°½é‡ä¸è¦åœ¨é™æ€å˜é‡æˆ–è€…é™æ€å†…éƒ¨ç±»ä¸­ä½¿ç”¨éé™æ€å¤–éƒ¨æˆå‘˜å˜é‡ï¼ˆåŒ…æ‹¬ contextï¼‰ï¼Œå³ä½¿è¦ä½¿ç”¨ï¼Œä¹Ÿè¦è€ƒè™‘é€‚æ—¶æŠŠå¤–éƒ¨æˆå‘˜å˜é‡ç½®ç©ºï¼›ä¹Ÿå¯ä»¥åœ¨å†…éƒ¨ç±»ä¸­ä½¿ç”¨å¼±å¼•ç”¨æ¥å¼•ç”¨å¤–éƒ¨ç±»çš„å˜é‡ã€‚</p><p>å¯¹ç”Ÿå‘½å‘¨æœŸæ¯” Activity é•¿çš„å†…éƒ¨ç±»å¯¹è±¡ï¼Œå¹¶ä¸”å†…éƒ¨ç±»ä¸­ä½¿ç”¨äº†å¤–éƒ¨ç±»çš„æˆå‘˜å˜é‡ï¼Œå¯ä»¥è¿™æ ·é¿å…å†…å­˜æ³„æ¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å°†å†…éƒ¨ç±»æ”¹ä¸ºé™æ€å†…éƒ¨ç±»</span><br><span class="line">é™æ€å†…éƒ¨ç±»ä¸­ä½¿ç”¨å¼±å¼•ç”¨æ¥å¼•ç”¨å¤–éƒ¨æˆå‘˜çš„æˆå‘˜å˜é‡</span><br></pre></td></tr></table></figure><p>Handler çš„æŒæœ‰çš„å¼•ç”¨å¯¹è±¡æœ€å¥½ä½¿ç”¨å¼±å¼•ç”¨ï¼Œèµ„æºé‡Šæ”¾æ—¶ï¼Œä¹Ÿå¯ä»¥æ¸…ç©º Handler ä¸­çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚åœ¨ Activity onStop æˆ–è€… onDestory çš„æ—¶å€™ï¼Œå–æ¶ˆæ‰è¯¥ Handler å¯¹è±¡çš„ Message å’Œ Runnableã€‚</p><p>åœ¨ Java çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œä¹Ÿè¦è€ƒè™‘å…¶å¯¹è±¡é‡Šæ”¾ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨ä¸ä½¿ç”¨æŸå¯¹è±¡æ˜¯ï¼Œæ˜¾å¼åœ°å°†æ­¤å¯¹è±¡èµ‹å€¼ä¸º null, æ¯”å¦‚ä½¿ç”¨å®Œ Bitmap åï¼Œå…ˆè°ƒç”¨ recycle()ï¼Œ å†èµ‹ nullï¼Œ æ¸…ç©ºå¯¹å›¾ç‰‡ç­‰èµ„æºæœ‰ç›´æ¥å¼•ç”¨æˆ–ç®€æ´å¼•ç”¨çš„æ•°ç»„ï¼ˆä½¿ç”¨ array.clear(); array=nullï¼‰ç­‰ï¼Œæœ€å¥½éµå¾ªè°åˆ›å»ºè°é‡Šæ”¾çš„åŸåˆ™ã€‚</p><p>æ­£ç¡®å…³é—­èµ„æºï¼Œå¯¹äºä½¿ç”¨äº† BroadcastReceivedï¼Œ ContentObserver, File, Cursor, Stream, Bitmap ç­‰èµ„æºçš„ä½¿ç”¨ï¼Œåº”è¯¥åœ¨ Activity é”€æ¯æ—¶åŠæ—¶å…³é—­æˆ–è€…æ³¨é”€ã€‚</p><p>ä¿æŒå¯¹å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„æ•æ„Ÿï¼Œç‰¹åˆ«æ³¨æ„å•ä¾‹ï¼Œé™æ€å¯¹è±¡ï¼Œå…¨å±€æ€§é›†åˆç­‰çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å†…å­˜ç®¡ç†çš„ç›®çš„å°±æ˜¯æˆ‘ä»¬åœ¨å¼€å‘ä¸­æ€ä¹ˆæœ‰æ•ˆçš„é¿å…æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå‡ºç°å†…å­˜æ³„éœ²é—®é¢˜ã€‚å†…å­˜æ³„éœ²ç®€çŸ­ç²—ä¿—çš„è®²ï¼Œå°±æ˜¯è¯¥è¢«é‡Šæ”¾çš„å¯¹è±¡æ²¡æœ‰é‡Šæ”¾ï¼Œä¸€ç›´è¢«æŸä¸ªæˆ–æŸäº›å®ä¾‹æ‰€æŒæœ‰å´ä¸è¢«ä½¿ç”¨ï¼Œå¯¼è‡´ GC ä¸èƒ½å›æ”¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;Java-å†…å­˜åˆ†é…ç­–ç•¥&quot;&gt;&lt;a href=&quot;#Java-å†…å­˜åˆ†é…ç­–ç•¥&quot; class=&quot;headerlink&quot; title=&quot;Java å†…å­˜åˆ†é…ç­–ç•¥&quot;&gt;&lt;/a&gt;Java å†…å­˜åˆ†é…ç­–ç•¥&lt;/h2&gt;&lt;p&gt;Java ç¨‹åºè¿è¡Œæ—¶çš„å†…å­˜åˆ†é…ç­–ç•¥æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯é™æ€åˆ†é…ã€æ ˆå¼åˆ†é…å’Œå †å¼åˆ†é…ã€‚å¯¹åº”çš„ä¸‰ç§å­˜å‚¨ç­–ç•¥ä½¿ç”¨çš„å†…å­˜ç©ºé—´ä¸»è¦åˆ†åˆ«æ˜¯é™æ€å­˜å‚¨åŒºï¼ˆæ–¹æ³•åŒºï¼‰ã€æ ˆåŒºå’Œå †åŒºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é™æ€å­˜å‚¨åŒºï¼ˆæ–¹æ³•åŒºï¼‰ï¼šä¸»è¦å­˜æ”¾é™æ€æ•°æ®ï¼Œå…¨å±€ static æ•°æ®å’Œå¸¸é‡ã€‚è¿™å—å†…å­˜åœ¨ç¨‹åºç¼–è¯‘æ—¶å°±å·²ç»åˆ†é…å¥½ï¼Œå¹¶ä¸”åœ¨ç¨‹åºæ•´ä¸ªè¿è¡ŒæœŸé—´éƒ½å­˜åœ¨ã€‚&lt;/li&gt;
&lt;li&gt;æ ˆåŒºï¼šå½“æ–¹æ³•è¢«æ‰§è¡Œæ—¶ï¼Œæ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ï¼ˆå…¶ä¸­åŒ…æ‹¬åŸºç¡€æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨ï¼‰éƒ½åœ¨æ ˆä¸Šåˆ›å»ºï¼Œå¹¶åœ¨æ–¹æ³•æ‰§è¡Œç»“æŸæ—¶è¿™äº›å±€éƒ¨å˜é‡æ‰€æŒæœ‰çš„å†…å­˜å°†ä¼šè‡ªåŠ¨è¢«é‡Šæ”¾ã€‚å› æ­¤æ ˆå†…å­˜åˆ†é…è¿ç®—å†…ç½®äºå¤„ç†å™¨çš„æŒ‡ä»¤é›†ä¸­ï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯åˆ†é…çš„å†…å­˜å®¹é‡æœ‰é™ã€‚&lt;/li&gt;
&lt;li&gt;å †åŒºï¼šåˆç§°åŠ¨æ€å†…å­˜åˆ†é…ï¼Œé€šå¸¸å°±æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ç›´æ¥ new å‡ºæ¥çš„å†…å­˜ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡çš„å®ä¾‹ã€‚è¿™éƒ¨åˆ†å†…å­˜åœ¨ä¸ä½¿ç”¨æ—¶ï¼Œå°†ä¼šç”± Java åƒåœ¾å›æ”¶å™¨è´Ÿè´£å›æ”¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://xiaoman.ren/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Handler çº¿ç¨‹é€šä¿¡åŸºç¡€æµç¨‹</title>
    <link href="http://xiaoman.ren/2019/08/01/Handler%20%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1%E5%9F%BA%E7%A1%80%E6%B5%81%E7%A8%8B/"/>
    <id>http://xiaoman.ren/2019/08/01/Handler çº¿ç¨‹é€šä¿¡åŸºç¡€æµç¨‹/</id>
    <published>2019-08-01T13:54:08.000Z</published>
    <updated>2019-08-15T12:31:50.813Z</updated>
    
    <content type="html"><![CDATA[<p>Android ä¸­çº¿ç¨‹é€šä¿¡é çš„å°±æ˜¯ Handlerã€Looperã€Messageã€MessageQueue è¿™å››ä¸ªã€‚</p><h2 id="Looper"><a href="#Looper" class="headerlink" title="Looper"></a>Looper</h2><p>åœ¨ Looper ä¸­ï¼Œç»´æŒä¸€ä¸ª Thread å¯¹è±¡ä»¥åŠ MessageQueueï¼Œ é€šè¿‡ Looper çš„æ„é€ å‡½æ•°å¯ä»¥çœ‹å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">Looper</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>&#123;</span><br><span class="line">    mQueue = <span class="keyword">new</span> MessageQueue(quitAllowed);<span class="comment">// ä¼ å…¥çš„å‚æ•°ä»£è¡¨è¿™ä¸ª Queue æ˜¯å¦èƒ½å¤Ÿè¢«é€€å‡º</span></span><br><span class="line">    mThread = Thread.currentThread();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Looper åœ¨æ„é€ å‡½æ•°é‡Œåšäº†ä¸¤ä»¶äº‹å„¿ï¼š</p><ol><li>å°†çº¿ç¨‹å¯¹è±¡æŒ‡å‘äº†åˆ›å»ºçš„ Looper çš„çº¿ç¨‹</li><li>åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„  MessageQueue</li></ol><p>åˆ†æå®Œæ„é€ å‡½æ•°åï¼Œçœ‹ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•</p><ol><li>looper.loop()</li><li>looper.prepare()</li></ol><a id="more"></a><h3 id="looper-loop"><a href="#looper-loop" class="headerlink" title="looper.loop()"></a>looper.loop()</h3><p>åœ¨å½“å‰çº¿ç¨‹ä¸­å¯åŠ¨ä¸€ä¸ª Message loop æœºåˆ¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Looper me = myLooper();<span class="comment">// è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„ Looper</span></span><br><span class="line">    <span class="keyword">if</span>(me == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"No Looper; Looper.prepare() wasn`t called on this thread"</span>);        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> MessageQueue queue = me.mQueue();<span class="comment">// è·å–ä¸ Looper ç»‘å®šçš„ MessageQueue</span></span><br><span class="line">    <span class="comment">// make sure the identity of this thread is that of the local process,</span></span><br><span class="line">    <span class="comment">// And keep track of what that identity token actuall is.</span></span><br><span class="line">    Binder.clearCallingIdentity();</span><br><span class="line">    fianl <span class="keyword">long</span> ident = Binder.clearCallingIdentity();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿›å…¥æ­»å¾ªç¯ï¼Œä¸æ–­è·å–å¯¹è±¡ï¼Œåˆ†å‘å¯¹è±¡åˆ° Handler ä¸­å»æ¶ˆè´¹</span></span><br><span class="line">    <span class="keyword">for</span>(;;) &#123;</span><br><span class="line">        Message msg = queue.next();<span class="comment">// ä¸æ–­è·å–ä¸‹ä¸€ä¸ª message å¯¹è±¡ï¼Œè¿™é‡Œå¯èƒ½ä¼šé€ æˆé˜»å¡ã€‚</span></span><br><span class="line">        <span class="keyword">if</span>(msg == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// No message idicates that the message queue is quittig.</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// This must be in a local variable, in case a UI event sets the logger</span></span><br><span class="line">        Printer logging = me.mLogging;</span><br><span class="line">        <span class="keyword">if</span>(logging != <span class="keyword">null</span>) &#123;</span><br><span class="line">            logging.println(<span class="string">"&gt;&gt;&gt; Dispatching to "</span> + msg.target + <span class="string">" "</span> + msg.callback _ <span class="string">": "</span> + msg.what);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œå¼€å§‹åˆ†å‘ Message </span></span><br><span class="line">        msg.target.dispatchMessage(msg);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(logging != <span class="keyword">null</span>) &#123;</span><br><span class="line">            logging.println(<span class="string">"&lt;&lt;&lt;&lt;&lt; Finished to "</span> + msg.target + <span class="string">" "</span> + msg.callback);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Make sure that during the course of dispatching the identity of the thread wasn`t corrupted.</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> newIdent = Binder.clearCallingIdentity();</span><br><span class="line">        <span class="keyword">if</span>(ident != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Log.wtf(TAG, <span class="string">"Thread identity changed from 0x"</span></span><br><span class="line">                        + Long.toHexString(ident) + <span class="string">" to 0x"</span></span><br><span class="line">                        + Long.toHexString(newIdent) + <span class="string">" while dispatching to "</span></span><br><span class="line">                        + msg.target.getClass().getName() + <span class="string">" "</span></span><br><span class="line">                        + msg.callback + <span class="string">" what="</span> + msg.what);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å½“åˆ†å‘å®Œ Message åï¼Œå½“ç„¶è¦æ ‡è®°å°†è¯¥ Message ä¸º â€œæ­£åœ¨ä½¿ç”¨â€</span></span><br><span class="line">        msg.recycleUnchecked();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œæœ€é‡è¦çš„æ–¹æ³•æ˜¯ï¼š</p><ol><li><code>queue.next()</code></li><li><code>msg.target.dispatchMessage(msg)</code></li><li><code>msg.recycleUnchecked()</code></li></ol><p>å…¶å® Looper ä¸­æœ€é‡è¦çš„éƒ¨åˆ†éƒ½æ˜¯ç”± Messageã€MessageQueue ç»„æˆçš„ï¼Œè¿™æ®µä»£ç è®¾è®¡åˆ°çš„å››ä¸ªå¯¹è±¡ï¼Œä»–ä»¬å½¼æ­¤çš„å…³ç³»å¦‚ä¸‹:</p><ol><li>MessageQueueï¼š è£…é£Ÿç‰©çš„å®¹å™¨</li><li>Message ï¼šè¢«è£…çš„é£Ÿç‰©</li><li>Handler ï¼ˆmsg.target å®é™…ä¸Šå°±æ˜¯ Handlerï¼‰ï¼šé£Ÿç‰©çš„æ¶ˆè´¹è€…</li><li>Looperï¼šè´Ÿè´£åˆ†å‘é£Ÿç‰©çš„äºº</li></ol><h3 id="looper-prepare-åœ¨å½“å‰çº¿ç¨‹å…³è”ä¸€ä¸ª-Lopper-å¯¹è±¡"><a href="#looper-prepare-åœ¨å½“å‰çº¿ç¨‹å…³è”ä¸€ä¸ª-Lopper-å¯¹è±¡" class="headerlink" title="looper.prepare() åœ¨å½“å‰çº¿ç¨‹å…³è”ä¸€ä¸ª Lopper å¯¹è±¡"></a>looper.prepare() åœ¨å½“å‰çº¿ç¨‹å…³è”ä¸€ä¸ª Lopper å¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(sThreadLocal.get() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Only one Lopper may be created per thread"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœ¨å½“å‰çº¿ç¨‹ç»‘å®šä¸€ä¸ª looper</span></span><br><span class="line">    mThreadLocal.set(<span class="keyword">new</span> Looper(quiteAllowed));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåšäº†ä¸¤ä»¶äº‹å„¿ï¼š</p><ol><li>åˆ¤æ–­å½“å‰çº¿ç¨‹æœ‰æ²¡æœ‰ Looperï¼Œå¦‚æœæœ‰åˆ™æŠ›å‡ºå¼‚å¸¸ï¼ˆåœ¨è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ï¼ŒAndroid è§„å®šä¸€ä¸ªçº¿ç¨‹åªèƒ½æ‹¥æœ‰ä¸€ä¸ªä¸è‡ªå·±å…³è”çš„ Looperã€‚</li><li>å¦‚æœæœ‰çš„è¯ï¼Œé‚£ä¹ˆå°±è®¾ç½®ä¸€ä¸ªæ–°çš„ Looper åˆ°å½“å‰çº¿ç¨‹ã€‚</li></ol><h3 id="Handler-çš„ä½¿ç”¨"><a href="#Handler-çš„ä½¿ç”¨" class="headerlink" title="Handler çš„ä½¿ç”¨"></a>Handler çš„ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Handler handler = <span class="keyword">new</span> Handler ()&#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// handle your message</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ Handler çš„æ„é€ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç©ºå‚æ„é€ ä¸ä¹‹å¯¹åº”</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callbacck, <span class="keyword">boolean</span> async)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¤§å§¨æ³„æ¼æé†’log</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// è·å–ä¸åˆ›å»º Handler çº¿ç¨‹çš„ Looper</span></span><br><span class="line">    mLooper = Looper.myLooper();</span><br><span class="line">    <span class="keyword">if</span>(mLooper == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RunntimeException(<span class="string">"Can`t create handler inside thread that has not called Looper.prepare()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å– Looper ç»‘å®šçš„ MessageQueue</span></span><br><span class="line">    <span class="comment">// å› ä¸ºä¸€ä¸ª Looper åªæœ‰ä¸€ä¸ª MessageQueueï¼Œ ä¹Ÿå°±æ˜¯ä¸å½“å‰çº¿ç¨‹ç»‘å®šçš„ MessageQueue</span></span><br><span class="line">    mQueue = mLooper.mQueue;</span><br><span class="line">    mCallback = callback;</span><br><span class="line">    mAsynchronous = async;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>Looper.loop() æ­»å¾ªç¯ä¸­çš„ msg.target æ˜¯ä»€ä¹ˆæ—¶å€™è¢«èµ‹å€¼çš„ï¼Ÿ</li><li>handler.handleMessage(msg) åœ¨ä»€ä¹ˆæ—¶å€™è¢«å›è°ƒçš„ï¼Ÿ</li></ol><p><strong>A1:</strong> Looper.loop() æ­»å¾ªç¯ä¸­çš„ msg.target æ˜¯ä»€ä¹ˆèµ‹å€¼çš„å‘¢ï¼Ÿè¦åˆ†æè¿™ä¸ªé—®é¢˜ï¼Œè‡ªç„¶çš„å°±æƒ³åˆ°ä»å‘é€æ¶ˆæ¯å¼€å§‹ï¼Œæ— è®ºæ˜¯ handler.sendMessage(msg)  è¿˜æ˜¯ handler.sendEmptyMessage(what)ï¼Œ æœ€åéƒ½å¯ä»¥è¿½æº¯åˆ°ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendMessageAtTime</span><span class="params">(Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¼•ç”¨ Handler ä¸­çš„ MessageQueue</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ª MessageQueue å°±æ˜¯åˆ›å»º Looper æ—¶è¢«åˆ›å»ºçš„ MessageQueue</span></span><br><span class="line">    MessageQueue queue = mQueue;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(queue == <span class="keyword">null</span>) &#123;</span><br><span class="line">        RuntimeException e = <span class="keyword">new</span> RuntimeException(</span><br><span class="line">        <span class="keyword">this</span> + <span class="string">" sendMessageAtTime() called withe no mQueue"</span>);</span><br><span class="line">        Log.w(<span class="string">"Looper"</span>, e.getMessage(), e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†æ–°æ¥çš„ Message åŠ å…¥åˆ° MessageQueue ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ <code>enququeMessage(queue, msg, uptimeMillis)</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">enququeMessage</span><span class="params">(MessageQueue, queue, Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</span><br><span class="line">   msg.target = <span class="keyword">this</span>;</span><br><span class="line">   <span class="keyword">if</span>(mAsynchronous) &#123;</span><br><span class="line">        msg.setAsynchronous(<span class="keyword">true</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> queue.enqueueMessage(msg, uptimeMillis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>A2</strong>:  handler.handleMessage(msg) åœ¨ä»€ä¹ˆæ—¶å€™è¢«å›è°ƒï¼Ÿé€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¾ˆæ˜ç¡®çŸ¥é“ï¼Œ Message ä¸­çš„ target æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™èµ‹å€¼çš„ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æä¸‹åœ¨ Looper.loop() ä¸­å‡ºç°è¿‡çš„ dispatchMessage(msg) æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">diapatchMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(msg.callback != <span class="keyword">null</span>) &#123;</span><br><span class="line">        handleCallback(msg);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(mCallback != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(mCallback.handleMessage(msg)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        handleMessage(msg); <span class="comment">// å¼€å§‹å›è°ƒ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥æ¸…æ¥šçš„çŸ¥é“ Handler, Looper, Message, MessageQueue è¿™å››è€…çš„å…³ç³»ä»¥åŠå¦‚ä½•åˆä½œäº†ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å½“æˆ‘ä»¬è°ƒç”¨ handler.sendMessage(msg)ï¼› æ–¹æ³•å‘é€ä¸€ä¸ª Message æ—¶ï¼Œ å®é™…ä¸Šè¿™ä¸ª Message æ˜¯å‘é€åˆ°ä¸å½“å‰çº¿ç¨‹ç»‘å®šçš„ä¸€ä¸ª MessageQueue ä¸­ï¼Œç„¶åä¸å½“å‰çº¿ç¨‹ç»‘å®šçš„ Looper å°†ä¼šä¸æ–­çš„ä» MessageQueue ä¸­å–å‡ºæ–°çš„ Messageï¼Œ è°ƒç”¨ msg.target.dispatchMessage(msg) æ–¹æ³•å°†æ¶ˆæ¯å‘é€åˆ°ä¸ Message ç»‘å®šçš„ handler.handleMessage() æ–¹æ³•ä¸­ã€‚</p><p>ä¸€ä¸ª Thread å¯¹åº”å¤šä¸ª Handlerï¼Œ ä¸€ä¸ª Thread å¯¹åº”ä¸€ä¸ª Looper å’Œ MessageQueueï¼Œ Handler ä¸ Thread å…±äº« Looper å’Œ MessageQueueã€‚ Message åªæ˜¯æ¶ˆæ¯çš„è½½ä½“ï¼Œå°†ä¼šè¢«å‘é€åˆ°ä¸çº¿ç¨‹ç»‘å®šçš„å”¯ä¸€çš„ MessageQueue ä¸­ï¼Œå¹¶ä¸”è¢«ä¸çº¿ç¨‹ç»‘å®šçš„å”¯ä¸€çš„ Looper åˆ†å‘ï¼Œè¢«å…¶è‡ªèº«ç»‘å®šçš„ Handler æ¶ˆè´¹ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Android ä¸­çº¿ç¨‹é€šä¿¡é çš„å°±æ˜¯ Handlerã€Looperã€Messageã€MessageQueue è¿™å››ä¸ªã€‚&lt;/p&gt;
&lt;h2 id=&quot;Looper&quot;&gt;&lt;a href=&quot;#Looper&quot; class=&quot;headerlink&quot; title=&quot;Looper&quot;&gt;&lt;/a&gt;Looper&lt;/h2&gt;&lt;p&gt;åœ¨ Looper ä¸­ï¼Œç»´æŒä¸€ä¸ª Thread å¯¹è±¡ä»¥åŠ MessageQueueï¼Œ é€šè¿‡ Looper çš„æ„é€ å‡½æ•°å¯ä»¥çœ‹å‡º&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Looper&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; quitAllowed)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mQueue = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MessageQueue(quitAllowed);&lt;span class=&quot;comment&quot;&gt;// ä¼ å…¥çš„å‚æ•°ä»£è¡¨è¿™ä¸ª Queue æ˜¯å¦èƒ½å¤Ÿè¢«é€€å‡º&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mThread = Thread.currentThread();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Looper åœ¨æ„é€ å‡½æ•°é‡Œåšäº†ä¸¤ä»¶äº‹å„¿ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°†çº¿ç¨‹å¯¹è±¡æŒ‡å‘äº†åˆ›å»ºçš„ Looper çš„çº¿ç¨‹&lt;/li&gt;
&lt;li&gt;åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„  MessageQueue&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åˆ†æå®Œæ„é€ å‡½æ•°åï¼Œçœ‹ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;looper.loop()&lt;/li&gt;
&lt;li&gt;looper.prepare()&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="Handler" scheme="http://xiaoman.ren/tags/Handler/"/>
    
  </entry>
  
  <entry>
    <title>æ¸…é¦™æœ¨å…»æ®–ï¼ˆä¸‰ï¼‰</title>
    <link href="http://xiaoman.ren/2019/06/23/%E6%B8%85%E9%A6%99%E6%9C%A8%E5%85%BB%E6%AE%96%EF%BC%88%E4%B8%89%EF%BC%89/"/>
    <id>http://xiaoman.ren/2019/06/23/æ¸…é¦™æœ¨å…»æ®–ï¼ˆä¸‰ï¼‰/</id>
    <published>2019-06-23T11:49:19.000Z</published>
    <updated>2019-06-23T14:34:03.441Z</updated>
    
    <content type="html"><![CDATA[<p>è·ç¦»ä¸Šä¸€æ¬¡æ›´æ–°å·²ç»è¿‡å»ä¸€ä¸ªåŠæœˆäº†ï¼Œè¯·ä¸è¦æ‹…å¿ƒï¼Œä»–è¿˜åœ¨ï¼<br>ä½œä¸ºç»¿æ¤å°ç™½ï¼ŒçœŸçœŸåˆ‡åˆ‡çš„ä½“éªŒå…»æ®–çš„å¿«ä¹ã€ä¸æƒŠå¿ƒåŠ¨é­„çš„æ—¶å€™ï¼Œæ˜¯ä¸ä¼šæƒ³èµ·æ¥è¦è®°å½•åšå®¢çš„ã€‚</p><p>è¿™æ¬¡å†™è¿™ç¯‡æ–‡ç« çš„ç›®çš„ï¼Œä¾ç„¶è¿˜æ˜¯è¦è®°å½•ä¸€ä¸‹å®ƒçš„æˆé•¿ï¼Œé­é‡ï¼Œä»¥åŠä¸€äº›å…»æ®–è¿‡ç¨‹ä¸­çš„ç»éªŒã€‚å¥½å•¦ï¼Œå¤©ä¹Ÿä¸æ—©äº†ï¼Œå’±ä¹Ÿå¾—å¼„ç‚¹å¹²è´§äº†ã€‚</p><p>ç»¿æ¤å°ç™½ï¼Œåœ¨ä¸Šæ‰‹æ¸…é¦™æœ¨åï¼ŒæŸ¥è¯¢åˆ°çš„ä¸€äº›å…»æ®–çš„ç†è®ºçŸ¥è¯†ï¼Œåœ¨è¿™ä¸€ä¸ªåŠæœˆçš„æ—¶é—´é‡Œå¾—åˆ°äº†å¾ˆä¸¥å³»çš„æŒ‘æˆ˜ã€‚ç»§ä¸Šæ¬¡ä¸ºå®ƒæ›¿æ¢äº†æ–°å®¶ä¹‹åï¼Œå®ƒå°±ä¸åœ¨æ˜¯ä»å‰çš„é‚£ä¸ªå¯çˆ±çš„å­©å­äº†ï¼Œæ·˜æ°”çš„ç‹ ï¼›ç°åœ¨é€ çš„ï¼ˆä¸œåŒ—è¯ï¼Œæœ¬äººä¸œåŒ—æ»´ï¼Œæ„æ€æ˜¯å°†è‡ªå·±çš„èº«ä½“ï¼Œå¤–è¡¨ï¼Œæˆ–å…¶ä»–å¼„å¾—ç ´è´¥ä¸å ªï¼‰è¿˜èƒ½å¯çœ‹å‡ºç‚¹æ¨¡æ ·æ¥ã€‚</p><p>è¿™æ®µæ—¶é—´ï¼Œå®ƒç»å†çš„æ‰å¶ã€æ¯é»„ã€æ—±æ¶ã€‚å“ˆå“ˆï¼Œä½ ä»¬æœ‰æ²¡æœ‰æ„Ÿè§‰åˆ°ä»–å¾ˆå¯æ€œã€‚ä½†ä¸è®ºæ€æ ·ï¼Œä»–ç°åœ¨æ­£åœ¨èŒå£®çš„æˆé•¿ä¸­ï¼Œå·²ç»é€ƒç¦»äº†æ³•æµ·ã€‚</p><p>ç°åœ¨çš„å®ƒï¼Œè™½ç„¶å·²ç»æ²¡æœ‰äº†æŒ¡ä½çš„æç¹å¶èŒ‚ï¼Œä½†ä¹Ÿæ²¡æœ‰åƒæˆ‘è¿™æ²¡ç¨‹åºå‘˜ä¸€æ ·ï¼Œå¯¸è‰ä¸ç”Ÿã€‚é‚£æˆ‘ä»¬å°±æ¥ä¸‹æ¥å°±è¿˜æ˜¯è¯´è¯´å®ƒçš„å…»æ®–æ³¨æ„äº‹é¡¹å§ï¼š</p><a id="more"></a><ul><li>æ‰å¶</li></ul><p>æ‰å¶æ˜¯æ­£å¸¸ç°è±¡ï¼Œåœ¨ç»¿æ¤æ›´æ–°æ–°çš„ç¯å¢ƒï¼Œç§»æ¤åˆ°æ–°çš„ç›†ä¸­æ—¶ï¼Œéƒ½ä¼šå› éœ€è¦å¯¹æ–°ç¯å¢ƒçš„é€‚åº”å„¿æ‰å¶ï¼Œè¿‡å‡ å¤©ä¹‹åå°±å¥½äº†ï¼Œæ›´æ¢æ–°ç›†åï¼Œå°†æ°´æµ‡é€ï¼Œé™æ­¢å‡ å¤©ï¼ˆè¶…è¿‡æ­£å¸¸æµ‡æ°´å‘¨æœŸï¼‰ï¼Œä½†ä¹Ÿè¦è€ƒè™‘çªç„¶çš„è“„æ°´èƒ½åŠ›ä»¥åŠåœŸå£¤çš„æ½®æ¹¿ç¨‹åº¦ã€‚</p><ul><li>é»„å¶</li></ul><p>é»„å¶ä¸€èˆ¬æ˜¯å‘ç”Ÿåœ¨æ°´åˆ†è¿‡å¤§ï¼Œå¯¼è‡´æ ¹éƒ¨è…çƒ‚æ—¶ä¼šå‘ç”Ÿï¼Œå› æ­¤æˆ‘åœ¨æµ‡æ°´æ—¶ï¼Œè¦å…³æ³¨ä¸€ä¸‹çªç„¶ä¸­æ°´åˆ†çš„å«é‡ï¼Œé€‚é‡ä¸”æœ‰è§„å¾‹çš„æµ‡æ°´ï¼Œå¯¹ç»¿æ¤çš„å‘è‚²æ˜¯æœ‰å¥½å¤„çš„ã€‚</p><ul><li>åœŸå£¤</li></ul><p>èµ·åˆæˆ‘çš„æµ‡æ°´é¢‘ç‡æ˜¯ 3-5 å¤©æµ‡ä¸€æ¬¡ï¼Œä½†æˆ‘å‘ç°ä»–ç»å¸¸æ²¡æœ‰ç²¾ç¥ï¼Œè”«è”«çš„ï¼Œæ¯æ¬¡æµ‡æ°´æ—¶ï¼Œè§‚å¯ŸåœŸå£¤éƒ½å·²ç»è¦å¹²é€äº†ï¼Œç„¶åæˆ‘å°±æ”¹ä¸º 2-3 å¤©æµ‡æ°´ä¸€æ¬¡ï¼Œæ…¢æ…¢çš„ä»–æ¯”ä»¥å‰æ›´åŠ æ²¹ç»¿ï¼Œç²¾ç¥é¢è²Œæ›´åŠ æŒºæ‹”ã€‚ç”±æ­¤å‘¢ï¼Œæ€»ç»“ä¸‹æ¥åœŸå£¤è“„æ°´èƒ½åŠ›å¯¹æ¤ç‰©çš„ç”Ÿé•¿æˆæ­£æ¯”å…³ç³»ï¼Œæ‰€ä»¥é€‰æ‹©å¥½çš„åœŸå£¤ï¼Œæ›´æœ‰åŠ©äºå®ƒçš„ç”Ÿé•¿ã€‚ç›®å‰å®ƒçš„åœŸå£¤è¿˜æ˜¯è‡ªä»ä»–æ¥åˆ°æˆ‘è¿™é‡Œå•†å®¶é€çš„ï¼ŒåœŸå£¤å¾ˆç¨€æ¾ï¼Œæ‚è´¨æ¯”è¾ƒå¤šï¼Œè“„æ°´èƒ½åŠ›ä¹Ÿä¸€èˆ¬ï¼Œç­‰åˆ°ä»–åœ¨æ‰“ä¸€ç‚¹ï¼Œä¸ºä»–æ¢ä¸€ä¸ªæ–°å®¶çš„æ—¶å€™ï¼Œä¼šè€ƒè™‘ç»™ä»–æ¢ä¸€ä¸ªåœŸå£¤ã€‚æ¯•ç«Ÿå¤§è‡ªç„¶çš„åŠ›é‡æ˜¯å¾ˆåºå¤§çš„ï¼Œä¹Ÿè®¸é‚£æ—¶ä»–ä¼šæˆé•¿ä¸ºå‚å¤©å¤§æ ‘å§ã€‚</p><p><strong>æ€»ç»“</strong></p><p>æ€»ä¹‹ï¼Œè€è¯è®²â€æœ‰å¿—è€…äº‹ç«Ÿæˆâ€œï¼Œåªè¦ç”¨äº†çœŸå¿ƒï¼Œå°±ä¸€å®šä¼šæœ‰æ”¶è·ï¼›ä¸è®ºæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œæˆ‘ä»¬éƒ½è¦å°†ä»–çœ‹åšæ˜¯æˆ‘ä»¬æˆåŠŸè·¯ä¸Šçš„ç»éªŒï¼Œä¸éª„ä¸é¦ã€‚</p><p>ä¹ æƒ¯æ˜¯å…»æˆçš„ï¼Œå°±åƒå®ƒä¸€æ ·ï¼Œè™½ç„¶å®ƒåœ¨é‚£é‡Œï¼Œä¹Ÿä¸ä¼šåŒæˆ‘è®²è¯ï¼Œä¹Ÿä¸ä¼šåŒæˆ‘äº’åŠ¨ï¼Œå°±é‚£æ ·é™é™çš„çœ‹ç€æˆ‘ï¼Œè€Œå“ªä¸€å¤©çœ‹ä¸è§å®ƒçš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿä¼šå¾ˆæƒ³å®ƒï¼Œæœ‰æ—¶ä¹Ÿä¸åè‡ªå·±çš„ç›®å…‰ï¼Œå¤šçœ‹å‡ çœ¼ï¼Œåªå¸Œæœ›å®ƒèƒ½å¤Ÿæ‹™é•¿æˆé•¿ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è·ç¦»ä¸Šä¸€æ¬¡æ›´æ–°å·²ç»è¿‡å»ä¸€ä¸ªåŠæœˆäº†ï¼Œè¯·ä¸è¦æ‹…å¿ƒï¼Œä»–è¿˜åœ¨ï¼&lt;br&gt;ä½œä¸ºç»¿æ¤å°ç™½ï¼ŒçœŸçœŸåˆ‡åˆ‡çš„ä½“éªŒå…»æ®–çš„å¿«ä¹ã€ä¸æƒŠå¿ƒåŠ¨é­„çš„æ—¶å€™ï¼Œæ˜¯ä¸ä¼šæƒ³èµ·æ¥è¦è®°å½•åšå®¢çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ¬¡å†™è¿™ç¯‡æ–‡ç« çš„ç›®çš„ï¼Œä¾ç„¶è¿˜æ˜¯è¦è®°å½•ä¸€ä¸‹å®ƒçš„æˆé•¿ï¼Œé­é‡ï¼Œä»¥åŠä¸€äº›å…»æ®–è¿‡ç¨‹ä¸­çš„ç»éªŒã€‚å¥½å•¦ï¼Œå¤©ä¹Ÿä¸æ—©äº†ï¼Œå’±ä¹Ÿå¾—å¼„ç‚¹å¹²è´§äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç»¿æ¤å°ç™½ï¼Œåœ¨ä¸Šæ‰‹æ¸…é¦™æœ¨åï¼ŒæŸ¥è¯¢åˆ°çš„ä¸€äº›å…»æ®–çš„ç†è®ºçŸ¥è¯†ï¼Œåœ¨è¿™ä¸€ä¸ªåŠæœˆçš„æ—¶é—´é‡Œå¾—åˆ°äº†å¾ˆä¸¥å³»çš„æŒ‘æˆ˜ã€‚ç»§ä¸Šæ¬¡ä¸ºå®ƒæ›¿æ¢äº†æ–°å®¶ä¹‹åï¼Œå®ƒå°±ä¸åœ¨æ˜¯ä»å‰çš„é‚£ä¸ªå¯çˆ±çš„å­©å­äº†ï¼Œæ·˜æ°”çš„ç‹ ï¼›ç°åœ¨é€ çš„ï¼ˆä¸œåŒ—è¯ï¼Œæœ¬äººä¸œåŒ—æ»´ï¼Œæ„æ€æ˜¯å°†è‡ªå·±çš„èº«ä½“ï¼Œå¤–è¡¨ï¼Œæˆ–å…¶ä»–å¼„å¾—ç ´è´¥ä¸å ªï¼‰è¿˜èƒ½å¯çœ‹å‡ºç‚¹æ¨¡æ ·æ¥ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ®µæ—¶é—´ï¼Œå®ƒç»å†çš„æ‰å¶ã€æ¯é»„ã€æ—±æ¶ã€‚å“ˆå“ˆï¼Œä½ ä»¬æœ‰æ²¡æœ‰æ„Ÿè§‰åˆ°ä»–å¾ˆå¯æ€œã€‚ä½†ä¸è®ºæ€æ ·ï¼Œä»–ç°åœ¨æ­£åœ¨èŒå£®çš„æˆé•¿ä¸­ï¼Œå·²ç»é€ƒç¦»äº†æ³•æµ·ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨çš„å®ƒï¼Œè™½ç„¶å·²ç»æ²¡æœ‰äº†æŒ¡ä½çš„æç¹å¶èŒ‚ï¼Œä½†ä¹Ÿæ²¡æœ‰åƒæˆ‘è¿™æ²¡ç¨‹åºå‘˜ä¸€æ ·ï¼Œå¯¸è‰ä¸ç”Ÿã€‚é‚£æˆ‘ä»¬å°±æ¥ä¸‹æ¥å°±è¿˜æ˜¯è¯´è¯´å®ƒçš„å…»æ®–æ³¨æ„äº‹é¡¹å§ï¼š&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç»¿æ¤" scheme="http://xiaoman.ren/tags/%E7%BB%BF%E6%A4%8D/"/>
    
  </entry>
  
  <entry>
    <title>æ¸…é¦™æœ¨å…»æ®–ï¼ˆäºŒï¼‰</title>
    <link href="http://xiaoman.ren/2019/05/08/%E6%B8%85%E9%A6%99%E6%9C%A8%E5%85%BB%E6%AE%96%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>http://xiaoman.ren/2019/05/08/æ¸…é¦™æœ¨å…»æ®–ï¼ˆäºŒï¼‰/</id>
    <published>2019-05-08T03:02:23.000Z</published>
    <updated>2019-06-23T14:33:59.121Z</updated>
    
    <content type="html"><![CDATA[<p>å¿ƒå¿ƒåˆ‡åˆ‡,æ¯å¤©éƒ½ä¼šå…³æ³¨å®ƒçš„å˜åŒ–,å¯æƒœå¿ƒæ€¥åƒä¸å¾—çƒ­è±†è…;ç»è¿‡äº†å‡ å¤©, å‘ç°å®ƒæœ‰ä¸€äº›æ¯å¶å’Œå¹²æ,ä½ æ˜¯åœ¨å‘æˆ‘å®£æˆ˜å—?????ä¸Šç½‘æŸ¥è¯¢äº†ä¸€ä¸‹å‘ç°å…¶å®æ˜¯æ¤ç‰©åœ¨æ›´æ¢äº†ç¯å¢ƒä¹‹å,éœ€è¦ä¸€æ®µæ—¶é—´çš„é€‚åº”,æ¯å¶å¹²æå±äºæ­£å¸¸ç°è±¡, å“ˆå“ˆå“ˆ,è¿˜å¥½ä½ ä¸æ˜¯å«Œå¼ƒæˆ‘çš„å°å±‹.</p><p>è®°å¾—é«˜ä¸­é‚£ä¼š,æ¯å¤©éƒ½åœ¨ä¹¦æœ¬çš„æµ·æ´‹é‡Œé£˜è¡,ç”Ÿç‰©å­¦è‡ªåœ¨å…¶ä¸­,å˜´è¾¹ä¹Ÿæ€»æ˜¯åœ¨èƒŒè¯µç€æ¤ç‰©çš„â€å…‰åˆä½œç”¨â€,â€å‘¼å¸ä½œç”¨â€,è¿™äº›çŸ¥è¯†æ—©å·²æ·±æ·±é“­è®°åœ¨å¿ƒä¸­,åˆ»å°åœ¨è„‘æµ·,æŒ¥ä¹‹ä¸å».</p><p>æ¤ç‰©ç™½å¤©è¿›è¡Œå…‰åˆä½œç”¨,å¸æ”¶äºŒæ°§åŒ–ç¢³,é‡Šæ”¾æ°§æ°”;å¤œæ™šå‘¼å¸ä½œç”¨å¸æ”¶æ°§æ°”,é‡Šæ”¾äºŒæ°§åŒ–ç¢³.è¿™äº›çŸ¥è¯†è®©æˆ‘è®¤è¯†äº†ä¸–ç•Œ,ç„¶è€Œå¹¶æ²¡æœ‰è®©æˆ‘è®¤è¯†ä»–.èµ·åˆè¿˜æ˜¯å‚»ä¹ä¹çš„æ¯å¤©å‡ºé—¨ä¸Šç­æ—¶,æŠŠèŠ±æ”¾åœ¨çª—å°ä¸Š,æ‰“å¼€çª—å­,è®©ä»–æ²æµ´é˜³å…‰,æ¥å—æ´—ç¤¼;å¯æœ€è¿‘åœ¨æµè§ˆä¸€äº›ç½‘ç«™æ—¶,æ³¨æ„åˆ°ä¸€å¥è¯è®©æˆ‘å›°æƒ‘ä¸å·²â€”-â€œç»™äºˆæ¤ç‰©å……è¶³çš„å…‰ç…§,å¯ä»¥æ”¾åœ¨é˜³å°ä¸Š,ä½†è¦é¿å…å¤ªé˜³å…‰ç›´å°„â€. æˆ‘æ‡µäº†,æˆ‘çœŸçš„æ‡µäº†, æ—¢ç„¶éƒ½é€‰æ‹©æ”¾åœ¨çª—å°ä¸Š,éš¾é“çª—å°ä¸Šçš„é˜³å…³å°±ä¸æ˜¯å¤ªé˜³ç›´å°„äº†å˜›????? æˆ‘å¾ˆå›°æƒ‘, çˆ±ç¢ç£¨çš„æˆ‘åœ¨æƒ³, çª—å°ä¸Šæœ‰ç»ç’ƒ,Uhâ€¦ éš¾é“æ˜¯éš”ç€ä¸€å±‚ç»ç’ƒå°±ä¸ç®—ç›´å°„äº†å—,, å“, è¿™ä¸ªé—®é¢˜,åˆ°ç°åœ¨æˆ‘ä¹Ÿæ²¡æœ‰æƒ³æ¸…æ¥š.åœ¨ç»è¿‡ä¸æ–­çš„æŸ¥è¯¢æˆ‘å‘ç°å…¶å®æ¤ç‰©è¿›è¡Œå…‰åˆä½œç”¨å¹¶ä¸æ˜¯ä¹‹å¯ä»¥æœ‰å¤ªé˜³å…‰æ‰å¯ä»¥.</p><a id="more"></a><p>æ¤ç‰©è¿›è¡Œå…‰åˆä½œç”¨,å¶ç»¿ä½“æ˜¯ä¸»è¦åŠŸè‡£,é«˜ç­‰æ¤ç‰©çš„å…‰åˆè‰²ç´ ä¸»è¦æœ‰å¶ç»¿ç´ å’Œç±»èƒ¡èåœç´ ,åœ¨é¢œè‰²ä¸Šå¶ç»¿ç´ (å¶ç»¿ç´ a å’Œå¶ç»¿è‰² b) ä¸»è¦å‘ˆç»¿è‰², ç±»èƒ¡èåœç´ (èƒ¡èåœç´ å’Œå¶é»„ç´ ) å‘ˆé»„è‰².å¶ç»¿ç´ å¸æ”¶å…‰çš„èƒ½åŠ›æå¼º,è€Œå¯¹æ¤ç‰©å…‰åˆä½œç”¨èµ·åˆ°ä½œç”¨çš„æ˜¯æ³¢é•¿åœ¨ 640 ~ 670 nm çš„çº¢å…‰éƒ¨åˆ†å’Œæ³¢é•¿åœ¨ 430 ~ 450 çš„è“ç´«å…‰éƒ¨åˆ†;å› ä¸ºå¤ªé˜³å…‰ä¸æ˜¯å•ä¸€çš„å…‰,åˆ°è¾¾åœ°è¡¨åæ³¢é•¿åœ¨ 300nm ~ 2600 nm, åªæœ‰æ³¢é•¿åœ¨ 390 ~ 770 nmä¸ºå¯è§å…‰(ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„çº¢æ©™é»„ç»¿é’è“ç´«,åŠå…¶æ··åˆè‰²),è‡ªç„¶å¤ªé˜³å…‰æ˜¯å¯ä»¥æ»¡è¶³æ¤ç‰©è¿›è¡Œå…‰åˆä½œç”¨çš„,åŒæ—¶,æˆ‘ä»¬æ—¥å¸¸çš„ç…§æ˜ç¯ä¾‹å¦‚:ç™½ç‚½ç¯,è§å…‰ç¯,LED ç¯,ä»–ä»¬ä¹Ÿå¯æ»¡è¶³æ¤ç‰©è¿›è¡Œå…‰åˆä½œç”¨,ä½†ä»–ä»¬çš„æ³¢é•¿ä¸èƒ½æ»¡è¶³æ¤ç‰©å…‰åˆä½œç”¨çš„æ‰€æœ‰æ³¢é•¿é€‰æ‹©, åªèƒ½æ˜¯å•ä¸€, æ¯”å¦‚åªæ»¡è¶³çº¢å…‰æˆ–è“ç´«å…‰.ä½¿ç”¨ç…§æ˜ç¯è¿›è¡Œå…‰ç…§,åªä¼šå¯¼è‡´æ¤ç‰©ç¼ºå°‘ä¸€äº›å…ƒç´ ;æ·˜å®ä¸Šä¹Ÿæœ‰ä¸“é—¨ä¹°æ¤ç‰©å…‰åˆä½œç”¨éœ€è¦çš„çº¢å…‰å’Œè“å…‰çš„ç¯,ä½†æ€æ ·éƒ½ä¸å¦‚æ¤ç‰©åœ¨å¤–é¢æ™’å‡ å°æ—¶,å¤§è‡ªç„¶å°±æ˜¯è¿™ä¹ˆç¥å¥‡.</p><p>æ˜¨å¤©ä¸ºæˆ‘çš„å°å¿ƒå¿µç§»æ¤äº†æ–°å±…,å› ä¸ºåˆšåˆšæ”¶åˆ°ä»–æ—¶,ä»–çš„å®¶æœ‰ç‚¹ç ´è´¥,ç´¢æ€§å°±ä¸ºä»–æ¢ä¸ªè±ªå®….å…ˆç”¨å°é“²é“²æ¾ä»–çš„æ ¹åŸº(ä¸è¦è´´ç€ä»–,ä¸ç„¶ä¼šä¼¤å®³åˆ°å“¦),è¦ä¸è¦ç”¨åŠ›å»æ‹”,ä¼¤åˆ°æ ¹éƒ¨,å°±å†ä¹Ÿæ•‘ä¸æ´»äº†.æ…¢æ…¢çš„,è¦ç»†å¿ƒ,å¾…æ•´ä½“éƒ½å¾ˆæ¾åŠ¨,èƒ½å¤Ÿè¿æ ¹å¸¦åœŸçš„,ä¸€èµ·ä»ç›†ä¸­å¸¦å‡º,åœ¨æ–°å®¶å…ˆç»™ä»–æŒ–å¥½å®¹èº«ä¹‹æ‰€,ç”¨æ‰‹æ‹–ä½ä»–,ç»†å¿ƒçš„æ”¾åœ¨æ–°å®¶å¤„,å¹¶åŸ‹å¥½,ç„¶åå°‘é‡çš„ç»™äºˆä¸€äº›æ°´åˆ†, è®©ä»–çš„å®¶æ ¹åŸºæ›´å¤¯å®,ä¸è¦è¿‡åº¦æµ‡æ°´,ä½†ä¹Ÿè¦æµ‡å¤´,ä¿æŒåœŸå£¤æ¾å¼›,è¿™æ ·æ°§æ°”æ‰èƒ½è¿›å…¥åˆ°åœŸå£¤,è®©æ ¹éƒ¨èƒ½å¤Ÿå……åˆ†çš„è¿›è¡Œå‘¼å¸ä½œç”¨.ä¸€ç›´æ–°å®¶å,å°å¿ƒå¿µå±äºè„†å¼±çš„æ—¶å€™,è¿™æ—¶ä¸è¦è®©ä»–åœ¨é˜³å…‰ä¸‹æš´æ™’,ä¸åˆ©äºæ ¹éƒ¨åœ¨æ–°å®¶è½æ ¹.</p><p>æ–°å®¶å·²ç»å®‰æ’å¦¥å½“,ä¹‹åå°±æ˜¯ç”¨å¿ƒå»è§‚å¯Ÿä»–çš„å˜åŒ–,ä¿æŒé€šé£,å’Œå…‰ç…§,ä»–æ‰ä¼šèŒå£®æˆé•¿.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¿ƒå¿ƒåˆ‡åˆ‡,æ¯å¤©éƒ½ä¼šå…³æ³¨å®ƒçš„å˜åŒ–,å¯æƒœå¿ƒæ€¥åƒä¸å¾—çƒ­è±†è…;ç»è¿‡äº†å‡ å¤©, å‘ç°å®ƒæœ‰ä¸€äº›æ¯å¶å’Œå¹²æ,ä½ æ˜¯åœ¨å‘æˆ‘å®£æˆ˜å—?????ä¸Šç½‘æŸ¥è¯¢äº†ä¸€ä¸‹å‘ç°å…¶å®æ˜¯æ¤ç‰©åœ¨æ›´æ¢äº†ç¯å¢ƒä¹‹å,éœ€è¦ä¸€æ®µæ—¶é—´çš„é€‚åº”,æ¯å¶å¹²æå±äºæ­£å¸¸ç°è±¡, å“ˆå“ˆå“ˆ,è¿˜å¥½ä½ ä¸æ˜¯å«Œå¼ƒæˆ‘çš„å°å±‹.&lt;/p&gt;
&lt;p&gt;è®°å¾—é«˜ä¸­é‚£ä¼š,æ¯å¤©éƒ½åœ¨ä¹¦æœ¬çš„æµ·æ´‹é‡Œé£˜è¡,ç”Ÿç‰©å­¦è‡ªåœ¨å…¶ä¸­,å˜´è¾¹ä¹Ÿæ€»æ˜¯åœ¨èƒŒè¯µç€æ¤ç‰©çš„â€å…‰åˆä½œç”¨â€,â€å‘¼å¸ä½œç”¨â€,è¿™äº›çŸ¥è¯†æ—©å·²æ·±æ·±é“­è®°åœ¨å¿ƒä¸­,åˆ»å°åœ¨è„‘æµ·,æŒ¥ä¹‹ä¸å».&lt;/p&gt;
&lt;p&gt;æ¤ç‰©ç™½å¤©è¿›è¡Œå…‰åˆä½œç”¨,å¸æ”¶äºŒæ°§åŒ–ç¢³,é‡Šæ”¾æ°§æ°”;å¤œæ™šå‘¼å¸ä½œç”¨å¸æ”¶æ°§æ°”,é‡Šæ”¾äºŒæ°§åŒ–ç¢³.è¿™äº›çŸ¥è¯†è®©æˆ‘è®¤è¯†äº†ä¸–ç•Œ,ç„¶è€Œå¹¶æ²¡æœ‰è®©æˆ‘è®¤è¯†ä»–.èµ·åˆè¿˜æ˜¯å‚»ä¹ä¹çš„æ¯å¤©å‡ºé—¨ä¸Šç­æ—¶,æŠŠèŠ±æ”¾åœ¨çª—å°ä¸Š,æ‰“å¼€çª—å­,è®©ä»–æ²æµ´é˜³å…‰,æ¥å—æ´—ç¤¼;å¯æœ€è¿‘åœ¨æµè§ˆä¸€äº›ç½‘ç«™æ—¶,æ³¨æ„åˆ°ä¸€å¥è¯è®©æˆ‘å›°æƒ‘ä¸å·²â€”-â€œç»™äºˆæ¤ç‰©å……è¶³çš„å…‰ç…§,å¯ä»¥æ”¾åœ¨é˜³å°ä¸Š,ä½†è¦é¿å…å¤ªé˜³å…‰ç›´å°„â€. æˆ‘æ‡µäº†,æˆ‘çœŸçš„æ‡µäº†, æ—¢ç„¶éƒ½é€‰æ‹©æ”¾åœ¨çª—å°ä¸Š,éš¾é“çª—å°ä¸Šçš„é˜³å…³å°±ä¸æ˜¯å¤ªé˜³ç›´å°„äº†å˜›????? æˆ‘å¾ˆå›°æƒ‘, çˆ±ç¢ç£¨çš„æˆ‘åœ¨æƒ³, çª—å°ä¸Šæœ‰ç»ç’ƒ,Uhâ€¦ éš¾é“æ˜¯éš”ç€ä¸€å±‚ç»ç’ƒå°±ä¸ç®—ç›´å°„äº†å—,, å“, è¿™ä¸ªé—®é¢˜,åˆ°ç°åœ¨æˆ‘ä¹Ÿæ²¡æœ‰æƒ³æ¸…æ¥š.åœ¨ç»è¿‡ä¸æ–­çš„æŸ¥è¯¢æˆ‘å‘ç°å…¶å®æ¤ç‰©è¿›è¡Œå…‰åˆä½œç”¨å¹¶ä¸æ˜¯ä¹‹å¯ä»¥æœ‰å¤ªé˜³å…‰æ‰å¯ä»¥.&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç»¿æ¤" scheme="http://xiaoman.ren/tags/%E7%BB%BF%E6%A4%8D/"/>
    
  </entry>
  
  <entry>
    <title>æ¸…é¦™æœ¨å…»æ®–ï¼ˆä¸€ï¼‰</title>
    <link href="http://xiaoman.ren/2019/05/04/%E6%B8%85%E9%A6%99%E6%9C%A8%E5%85%BB%E6%AE%96%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>http://xiaoman.ren/2019/05/04/æ¸…é¦™æœ¨å…»æ®–ï¼ˆä¸€ï¼‰/</id>
    <published>2019-05-04T13:54:08.000Z</published>
    <updated>2019-05-04T14:52:51.315Z</updated>
    
    <content type="html"><![CDATA[<p>æ¿€åŠ¨çš„å¿ƒï¼Œé¢¤æŠ–çš„æ‰‹ï¼Œäº¬ä¸œä¸Šé¢åŠ¨åŠ¨æ‰‹ã€‚<br>å“ˆå“ˆï¼Œå¾ˆä¹…å°±æœ‰æƒ³å…»ä¸€ä¸ªç»¿æ¤çš„æƒ³æ³•ï¼Œç»è¿‡äº†åŠå¹´çš„æŒ£æ‰ï¼Œç»ˆäºåœ¨ 3 å¤©å‰åŠ¨èµ·äº†æ‰‹ï¼Œå…¥æ‰‹ä¸€æ ª<strong>æ¸…é¦™æœ¨</strong>ï¼Œæ®è€æ¿è¯´ï¼Œæ¸…é¦™æœ¨å¯ä»¥æ•£å‘å‡ºé¦™å‘³ï¼Œå……æ»¡æ•´ä¸ªæˆ¿é—´ï¼Œé¦™æ°”å››æº¢ï¼ˆè¿˜æœªé‰´å®šï¼Œåˆšæ”¶åˆ°ï¼Œæ­£æ€€ç€æ¿€åŠ¨çš„å¿ƒåœ¨å†™ï¼‰ã€‚</p><p><img src="https://raw.githubusercontent.com/boywithsmalleyes/static_file/master/images/WechatIMG68.jpeg" alt="æ¸…é¦™æœ¨"></p><p>å…¶å®å¯¹è¿™ææœ‰ä¸€ç‚¹å°å¤±æœ›ï¼Œå°±æ˜¯ä¸ªå¤´å¤ªå°ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œå’±ä¿©ç†¬å‘—ï¼Œæ—©æ™šä½ ä¼šé•¿å¤§çš„ã€‚<br><a id="more"></a></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘æ˜¯ä¸€åªç¨‹åºç‹—ï¼Œè¿™ç§å¼ é£ç»£èŠ±çš„äº‹å„¿ï¼Œç€å®è®©æˆ‘å¤´ç–¼äº†ä¸€ç•ªï¼›å¹³æ—¥é‡Œååœ¨ç”µè„‘å‰ï¼Œå™¼é‡Œå•ªå•¦çš„æ•²ç€é”®ç›˜ï¼Œä¹¦å†™ç€ä¸€è¡Œè¡Œ ABCï¼ˆçªç„¶æƒ³èµ·ä¸€é¦–æ­Œã€Šéƒ½é€‰ Cã€‹ï¼‰ï¼Œå¾œå¾‰åœ¨ç¼–ç çš„ä¸–ç•Œé‡Œã€‚å¿½ç„¶ä¹‹é—´ï¼Œç”Ÿæ´»ä¸­å¤šäº†ä¸€æ ªç»¿æ¤ï¼Œè®©é‚£ä»½éšè—åœ¨æˆ‘èº«ä½“æŸå¤„å¤šå¹´çš„å°çˆ±å¿ƒåˆå¦‚é›¨åæ˜¥ç¬‹ä¸€èˆ¬ï¼ŒèŒå‘äº†èµ·æ¥ã€‚å¯æ˜¯å•Šï¼Œåœ¨ç¼–ç çš„ä¸–ç•Œé‡Œï¼Œæˆ‘å¯ä»¥è£…è£…æ ·å­ï¼Œä½†åœ¨ ta çš„ä¸–ç•Œé‡Œï¼Œæˆ‘åªèƒ½è£…å­™å­ã€‚</p><p>è‡ªæ­¤ä¹‹åï¼Œæˆ‘å°†è¸ä¸Šç»¿æ¤çš„å…»æŠ¤ä¹‹é“ï¼Œåƒé‡Œä¹‹è¡Œå§‹äºè¶³ä¸‹ï¼Œå°±è¯·ä½ æŠŠæˆ‘å¸¦å…¥åˆ°ä½ çš„ä¸–ç•Œé‡Œï¼Œæ·±å…¥çš„äº†è§£å¹¶çˆ±ä¸Šä½ å§ã€‚</p><p>OKï¼Œè¯´æ­£äº‹å„¿ï¼Œå…ˆæ¥ä»‹ç»ä¸€ä¸‹<strong>æ¸…é¦™æœ¨</strong>ï¼š</p><p>æ¸…é¦™æœ¨éå¸¸æ”¶åˆ°èŠ±å‹çš„å–œçˆ±ï¼Œæ˜¯ä¸€ç§éå¸¸ç†æƒ³çš„ç›†æ ½æ¤ç‰©ï¼Œç›†æ™¯æ¸…é¦™æœ¨æ‘†æ”¾åœ¨å®¤å†…ï¼Œèƒ½è¥é€ å‡ºä¸€ç§é‡å¤–å±±æ°´æ ‘æœ¨ç§»å…¥å®¶å†…çš„æ„Ÿè§‰ï¼Œè‡ªç„¶æ¸…æ–°ã€‚åŸæœ¬ç”Ÿé•¿æˆ‘å›½çš„äº‘è„‘ä¸­éƒ¨ã€åŒ—éƒ¨åŠå››å·å—éƒ¨ç­‰é«˜æµ·æ‹”çš„å¹²çƒ­æ²³è°·åœ°å¸¦ï¼Œå…·æœ‰è€é˜´æ€§ï¼Œå–œå¥½æš–ï¼Œç”Ÿé•¿ç¼“æ…¢ï¼Œå¯¿å‘½é•¿ç­‰ç‰¹ç‚¹ï¼ˆè¿™ä¹Ÿä¼šæˆ‘é€‰æ‹©æ · ta çš„åŸå› ï¼‰ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªå…»èŠ±çš„ APPï¼Œ<a href="https://itunes.apple.com/cn/app/%E5%85%BB%E8%8A%B1%E5%A4%A7%E5%85%A8-%E5%85%BB%E8%8A%B1%E4%BA%BA%E7%9A%84%E5%9C%88%E5%AD%90/id1245612230?mt=8" target="_blank" rel="noopener">å…»èŠ±å¤§å…¨</a>ï¼Œæˆ‘å°±æ˜¯åœ¨è¿™ä¸Šå­¦ä¹ å…»èŠ±çš„æŠ€æœ¯åŠæ³¨æ„äº‹é¡¹çš„ã€‚</p><p>è™½ç„¶æˆ‘å¹¶æ²¡æœ‰ç»ç†è¿‡ ta çš„å‡ºç”Ÿï¼Œä½†åé¢çš„è·¯æˆ‘æƒ³å’Œä½ ä¸€èµ·ã€‚ä¸ºä½ æ•´ç†å‘å‹ï¼ˆä¿®å‰ªæå¶ï¼‰ã€ä¸ºä½ å®‰å®¶ä¹ä¸šï¼ˆä¸Šç›†å®šå‹ï¼‰ï¼Œå‘µæŠ¤ä½ ï¼ˆåœŸå£¤å’Œæ°´åˆ†ï¼‰ï¼Œä¸€è·¯å‰è¡Œï¼ˆå…‰ç…§å’Œæ¸©åº¦ï¼‰ã€‚</p><p>è™½ç„¶ APP ä¸Šä»‹ç»äº†<strong>æ¸…é¦™æœ¨</strong>ä¸€äº›å–œå¥½ï¼Œä¹Ÿæä¾›äº†ä¸€äº›å…»æ®–æ–¹æ³•ï¼Œä½†èº«åœ¨é—¨å¤–æ±‰çš„æˆ‘è¿˜æ˜¯å¯¹ç»¿æ¤ç•Œçš„æœ¯è¯­æ„Ÿåˆ°å¤´ç–¼ï¼Œä¸‹é¢æ¥ä»‹ç»ä¸€ä¸‹</p><table><thead><tr><th>æœ¯è¯­</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>è§å¹²è§æ¹¿</td><td>è§å¹²ï¼šåœŸå£¤å¹²æ¶¸ï¼Œè¡¨é¢çœ‹ä¸åˆ°æ½®æ¹¿ã€‚ è§æ¹¿ï¼šæµ‡æ°´æ—¶ï¼Œçœ‹åœŸå£¤å…¨éƒ¨æµ¸æ¹¿ã€‚</td></tr><tr><td>æµ‡æ°´è¦æµ‡é€</td><td>æµ‡æ°´æ—¶ï¼Œè§åˆ°æ°´ä»åº•éƒ¨å­”æµå‡º</td></tr></tbody></table><p>è¿™ä¸ªè¡¨æ ¼æ˜¯æˆ‘åœ¨çœ‹æ¸…é¦™æœ¨å…»æ®–äº‹é¡¹æ—¶é‡åˆ°çš„é—®é¢˜ï¼Œä»¥åä¼šç»§ç»­æ›´æ–°ã€‚<br>è™½ç„¶è¿™ä¸ªæœ¯è¯­åˆšåˆ°çœ‹çš„æ—¶å€™ï¼Œä¸€è„¸æ‡µã€‚æˆ‘ä¹Ÿè¯·æ•™äº†æˆ‘çš„åŒäº‹å…³äºå…»æŠ¤çš„é—®é¢˜ï¼Œä»–ä¹Ÿç»†å¿ƒçš„è§£é‡Šäº†ï¼Œè€Œä¸”è¿˜ç‰¹åˆ«ç…§é¡¾æˆ‘è¿™ä¸ªå°ç™½ï¼Œç”¨å¾ˆç”ŸåŠ¨çš„æ¯”å–»è®©æˆ‘ç†è§£é€äº†è¿™äº›å±äºã€‚</p><p>é‚£ä¹ˆè¿™é‡Œæˆ‘åœ¨è¯¦ç»†çš„è¯´ä¸€ä¸‹æˆ‘çš„ç†è§£ï¼š</p><ul><li>è§å¹²è§æ¹¿ï¼šè¦è§£é‡Šçš„å’Œä¸Šé¢çš„å«ä¹‰ä¸€æ ·ï¼Œé‚£ä¹ˆæˆ‘è¿˜è¦è¡¥å……çš„éƒ¨åˆ†å°±æ˜¯ï¼ŒåœŸå£¤æ˜¯è‡ªä¸Šè€Œä¸‹å¹²çš„ï¼Œ å› æ­¤è¡¨é¢ä¸Šè™½ç„¶å¹²äº†ï¼Œä½†æ˜¯åœŸå£¤å†…éƒ¨å…¶å®è¿˜æ²¡æœ‰å¹²ï¼Œå°¤å…¶æ˜¯åœŸå£¤åº•éƒ¨ï¼ˆæ¤ç‰©çš„æ ¹éƒ¨ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘åœŸå£¤ä¸­æ’å…¥ä¸€æ ¹æœ¨æ£ï¼ˆè¦æ’åˆ°åº•å„¿å“¦ğŸ˜ï¼‰ï¼Œä¸“é—¨ç”¨æ¥æ£€æµ‹åœŸå£¤æ¹¿åº¦ï¼Œæ‹”å‡ºæ—¶è®°ä½æœ¨æ£è£¸éœ²åœ¨åœŸå£¤å¤–é¢çš„ä½ç½®ï¼Œæ‹”å‡ºåç”¨æ½®æ¹¿çš„éƒ¨ä½å»è®¡ç®—ä½ç½®ã€‚ä¿æŒæ ¹éƒ¨çš„æ¹¿æ¶¦ï¼Œå¯ä»¥ä¿ƒè¿›æ¤ç‰©æ ¹ç³»çš„å‘å±•ï¼Œå› æ­¤ä¸éœ€è¦ç»å¸¸ç»™æ¤ç‰©æµ‡æ°´ã€‚è§æ¹¿ä¹Ÿå°±æ˜¯æµ‡æ°´æ—¶ï¼Œä¿è¯åœŸå£¤æ¹¿æ¶¦å³å¯ã€‚</li><li>æµ‡æ°´è¦æµ‡é€ï¼šå½“æˆ‘çœ‹åˆ°æ—¶æˆ‘ä¹Ÿå’Œçº³é—·ä»€ä¹ˆæ„æ€ï¼Œè€Œä¸”å’Œä¸Šé¢çš„è§æ¹¿ä¼¼ä¹åˆå†²çªï¼Œåˆ°åº•æ˜¯è§åˆ°åœŸå£¤æ¹¿äº†å°±å¯ä»¥ï¼Œè¿˜æ˜¯è¦æµ‡é€ï¼Ÿé‚£ä»€ä¹ˆåˆæ˜¯æµ‡é€å‘¢ï¼Ÿç»è¿‡æˆ‘çš„è°ƒç ”å’Œå’¨è¯¢ï¼Œç»ˆäºå¼„æ˜ç™½ï¼Œè¿™äº›æƒ…å†µæ˜¯å’ŒåœŸå£¤çš„æˆåˆ†æœ‰å…³ç³»ï¼Œå› ä¸ºåœŸå£¤çš„é€æ°”æ€§ã€ä¿æ°´æ€§éƒ½å¯¹æ¤ç‰©å‘è‚²æœ‰å¾ˆå¤§å½±å“ï¼Œä¸€æ—¦æœ‰é—®é¢˜ï¼Œå¾ˆå¯èƒ½å¯¼è‡´å¶å­å‘é»„ï¼Œè„±è½ï¼Œç”šè‡³æ­»äº¡ã€‚Emmm  æˆ‘ä»¬è¯´æµ‡é€çš„äº‹å„¿ï¼ŒèŠ±ç›†åº•éƒ¨æ˜¯æœ‰ä¸€ä¸ªå°å£çš„ï¼ˆä¸å…»èŠ±æ ¹éƒ¨ä¸æ‡‚äº‹å¹²å˜›çš„ï¼Œå°æ—¶å€™å¸®å¦ˆå¦ˆæµ‡èŠ±ï¼Œæ°´ä»é‚£æ¼å‡ºæ¥ï¼Œè¿˜ä»¥ä¸ºæµªè´¹äº†å‘¢ï¼‰ã€‚å› ä¸ºåœŸå£¤æˆåˆ†ä¸åŒï¼Œå¸æ°´ã€è“„æ°´èƒ½åŠ›ä¹Ÿä¸åŒï¼Œå…·ä½“åœŸå£¤æˆåˆ†å…ˆä¸ä»‹ç»ï¼Œç®€å•è¯´ä¸‹åŸç†â€”å¯ä»¥å…ˆæµ‡ä¸€éå¿«æ°´ï¼Œå°±æ˜¯å°†æ°´åˆ†å‡åŒ€çš„æ´’åœ¨åœŸå£¤çš„è¡¨é¢ï¼Œä¸è¦ç•™å¹²ï¼Œéƒ½æµ¸æ¹¿ï¼Œè§ç›†åœ°æœ‰æ°´åˆ†æµå‡ºå³å¯ï¼Œç­‰åˆ° 10 åˆ†é’Ÿä¹‹åï¼Œåœ¨è¿›è¡Œä¸€æ¬¡æµ‡æ°´ï¼ŒåŒæ ·æ˜¯å‡åŒ€çš„æµ‡ï¼Œå¹¶åº•éƒ¨æœ‰æ°´æµå‡ºå³å¯ã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯æµ‡é€äº†ã€‚</li></ul><blockquote><p>å°ç™½åœ¨è¿™çŒ®ä¸‘äº†ï¼Œåç»­ä¼šæŒç»­æ›´æ–°</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ¿€åŠ¨çš„å¿ƒï¼Œé¢¤æŠ–çš„æ‰‹ï¼Œäº¬ä¸œä¸Šé¢åŠ¨åŠ¨æ‰‹ã€‚&lt;br&gt;å“ˆå“ˆï¼Œå¾ˆä¹…å°±æœ‰æƒ³å…»ä¸€ä¸ªç»¿æ¤çš„æƒ³æ³•ï¼Œç»è¿‡äº†åŠå¹´çš„æŒ£æ‰ï¼Œç»ˆäºåœ¨ 3 å¤©å‰åŠ¨èµ·äº†æ‰‹ï¼Œå…¥æ‰‹ä¸€æ ª&lt;strong&gt;æ¸…é¦™æœ¨&lt;/strong&gt;ï¼Œæ®è€æ¿è¯´ï¼Œæ¸…é¦™æœ¨å¯ä»¥æ•£å‘å‡ºé¦™å‘³ï¼Œå……æ»¡æ•´ä¸ªæˆ¿é—´ï¼Œé¦™æ°”å››æº¢ï¼ˆè¿˜æœªé‰´å®šï¼Œåˆšæ”¶åˆ°ï¼Œæ­£æ€€ç€æ¿€åŠ¨çš„å¿ƒåœ¨å†™ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/boywithsmalleyes/static_file/master/images/WechatIMG68.jpeg&quot; alt=&quot;æ¸…é¦™æœ¨&quot;&gt;&lt;/p&gt;
&lt;p&gt;å…¶å®å¯¹è¿™ææœ‰ä¸€ç‚¹å°å¤±æœ›ï¼Œå°±æ˜¯ä¸ªå¤´å¤ªå°ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œå’±ä¿©ç†¬å‘—ï¼Œæ—©æ™šä½ ä¼šé•¿å¤§çš„ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="ç»¿æ¤" scheme="http://xiaoman.ren/tags/%E7%BB%BF%E6%A4%8D/"/>
    
  </entry>
  
  <entry>
    <title>OkHttp Intercept</title>
    <link href="http://xiaoman.ren/2019/04/30/OkHttp-Intercept/"/>
    <id>http://xiaoman.ren/2019/04/30/OkHttp-Intercept/</id>
    <published>2019-04-30T12:42:02.000Z</published>
    <updated>2019-06-23T14:36:03.652Z</updated>
    
    <content type="html"><![CDATA[<p>OKHttp åœ¨å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°,è¿™é‡Œä»‹ç»ä¸€ä¸‹ OKHttp çš„æ‹¦æˆªå™¨(interceptor)çš„å‡ ä¸ªä½¿ç”¨ä¾‹å­</p><p>è¦æ˜¯ç”¨æ‹¦æˆªå™¨å¾ˆç®€å•,æˆ‘ä»¬åªéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª interceptor ç±», å¹¶å®ç° Interceptor æ¥å£, åŒæ—¶é‡å†™ intercept æ–¹æ³•.</p><p>è¿™é‡Œä»‹ç»ä¸¤ç§ Interceptor çš„å®ä¾‹</p><a id="more"></a><h2 id="Log-æ—¥å¿—-LogInterceptor"><a href="#Log-æ—¥å¿—-LogInterceptor" class="headerlink" title="Log æ—¥å¿— (LogInterceptor)"></a>Log æ—¥å¿— (LogInterceptor)</h2><p>Log åœ¨å¼€å‘è°ƒè¯•ä¸­çš„é‡è¦æ€§, ä¸è¨€è€Œå–», ä¸€ä¸ªå¥½çš„æ—¥å¿—æ•°æ®,èƒ½å¤Ÿä¸ºå¼€å‘æ—¶æä¾›å¾ˆå¤šå¸®åŠ©,å¯ä»¥é€šè¿‡ Log æ¥è·å–å½“å‰ç¨‹åºçš„æ‰§è¡ŒçŠ¶æ€, é¡ºåºç­‰ç­‰.</p><p>è¿™é‡Œä»‹ç»çš„ Log æ—¥å¿—æ‹¦æˆªå™¨,ä¸»è¦æ˜¯è´Ÿè´£åœ¨ç½‘ç»œè¯·æ±‚æ—¶,æˆªè·è¯·æ±‚ä¸­çš„ä¿¡æ¯,å¹¶å°†è¯·æ±‚ä¿¡æ¯ä»¥ Log çš„æ–¹å¼è¾“å‡ºåˆ°æ§åˆ¶å°ä¸Š,å¯å±•ç°å½“å‰è¯·æ±‚åœ°å€,è¯·æ±‚å‚æ•°,ä»¥åŠè¯·æ±‚ç»“æœç­‰.</p><p>è¯ä¸å¤šè¯´, ä¸Šä»£ç .</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è‡ªå®šä¹‰ log æ‹¦æˆªå™¨,è¾“å…¥è¯·æ±‚åœ°å€,è¯·æ±‚å‚,è¯·æ±‚ç»“æœ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            <span class="comment">// æ‹¦æˆªè¯·æ±‚ä¿¡æ¯,è·å–è¯·æ±‚åœ°å€åŠè¯·æ±‚å‚æ•°</span></span><br><span class="line">            Request request = chain.request();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">long</span> t1 = System.nanoTime();</span><br><span class="line">            <span class="comment">// è·å–è¯·æ±‚æ–¹å¼</span></span><br><span class="line">            String method = request.method();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"POST"</span>.equals(method)) &#123;</span><br><span class="line">                StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                <span class="keyword">if</span> (request.body() <span class="keyword">instanceof</span> FormBody) &#123;</span><br><span class="line">                    FormBody body = (FormBody) request.body();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; body.size(); i++) &#123;</span><br><span class="line">                        sb.append(body.encodedName(i) + <span class="string">"="</span> + body.encodedValue(i) + <span class="string">","</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    sb.delete(sb.length() - <span class="number">1</span>, sb.length());</span><br><span class="line">                    LogUtils.d(TAG, String.format(<span class="string">"Sending request %s on %s %n%s %nRequestParams:&#123;%s&#125;"</span>,</span><br><span class="line">                            request.url(), chain.connection(), request.headers(), sb.toString()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                LogUtils.d(TAG, String.format(<span class="string">"Sending request %s on %s %n%s"</span>,</span><br><span class="line">                        request.url(), chain.connection(), request.headers()));</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">// è·å–å“åº”ä¿¡æ¯</span></span><br><span class="line">            Response response = chain.proceed(request);</span><br><span class="line">            <span class="keyword">long</span> t2 = System.nanoTime();</span><br><span class="line">            LogUtils.d(TAG, String.format(<span class="string">"Received response for %s in %.1fms%n%s"</span>,</span><br><span class="line">                    response.request().url(), (t2 - t1) / <span class="number">1e6</span>d, response.headers()));</span><br><span class="line"></span><br><span class="line">            MediaType contentType = response.body().contentType();</span><br><span class="line">            String content = response.body().string();</span><br><span class="line">            LogUtils.d(TAG, content);</span><br><span class="line">            ResponseBody wrappedBody = ResponseBody.create(contentType, content);</span><br><span class="line">            <span class="keyword">return</span> response.newBuilder().body(wrappedBody).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="åŠ å‚"><a href="#åŠ å‚" class="headerlink" title="åŠ å‚"></a>åŠ å‚</h2><p>åŠ å‚çš„æ„ä¹‰åœ¨äº,åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­, éœ€è¦ä¼ é€’ä¸€äº›åŸºæœ¬å‚æ•°,è¿™äº›å‚æ•°æ˜¯åŸºæœ¬ä¿æŒä¸å˜çš„, è€Œè¿™äº›å‚æ•°åˆæ˜¯åå°éœ€è¦æ ¡éªŒçš„ä¾é ,æˆ‘ä»¬ä¿—ç§°ä»–ä»¬ä¸º<strong>å…¬å‚</strong>, å¦‚æœåœ¨è¯·æ±‚è¿‡ç¨‹ä¸­åœ¨æ¯ä¸€ä¸ªæ¥å£é‡Œé¢éƒ½å»æ·»åŠ è¿™äº›å‚æ•°,æ˜¾å¾—éå¸¸ç¹ç,è€Œä¸”éº»çƒ¦,åç»­äººå‘˜æ¥æ‰‹,åˆä¼šä¸çŸ¥æ‰€æª,ç»´æŠ¤èµ·æ¥ç›¸å½“ä¸æ–¹ä¾¿.</p><p>å› æ­¤,åœ¨è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯é€šè¿‡è¯·æ±‚æ‹¦æˆªå™¨,é€šè¿‡æ‹¦æˆªå™¨å»æ·»åŠ è¿™äº›å‚æ•°.</p><h3 id="å…¬å‚æ‹¦æˆªå™¨"><a href="#å…¬å‚æ‹¦æˆªå™¨" class="headerlink" title="å…¬å‚æ‹¦æˆªå™¨"></a>å…¬å‚æ‹¦æˆªå™¨</h3><p>åœ¨è¯·æ±‚ä¸­,å¢åŠ ä¸€äº›å…¬å…±çš„å‚æ•°.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonParamsInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; queryParamsMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; paramsMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; headerParamsMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; headerLinesList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        Request request = chain.request();</span><br><span class="line">        Request.Builder requestBuilder = request.newBuilder();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// process header params inject</span></span><br><span class="line">        Headers.Builder headerBuilder = request.headers().newBuilder();</span><br><span class="line">        <span class="keyword">if</span> (headerParamsMap.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            Iterator iterator = headerParamsMap.entrySet().iterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                Map.Entry entry = (Map.Entry) iterator.next();</span><br><span class="line">                headerBuilder.add((String) entry.getKey(), (String) entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (headerLinesList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String line : headerLinesList) &#123;</span><br><span class="line">                headerBuilder.add(line);</span><br><span class="line">            &#125;</span><br><span class="line">            requestBuilder.headers(headerBuilder.build());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// process header params end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// process queryParams inject whatever it's GET or POST</span></span><br><span class="line">        <span class="keyword">if</span> (queryParamsMap.size() &gt; <span class="number">0</span> &amp;&amp; <span class="string">"GET"</span>.equals(request.method())) &#123;</span><br><span class="line"><span class="comment">//        if (queryParamsMap.size() &gt; 0) &#123;</span></span><br><span class="line">            request = injectParamsIntoUrl(request, requestBuilder, queryParamsMap);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// process post body inject</span></span><br><span class="line">        <span class="keyword">if</span> (paramsMap != <span class="keyword">null</span> &amp;&amp; paramsMap.size() &gt; <span class="number">0</span> &amp;&amp; <span class="string">"POST"</span>.equals(request.method())) &#123;</span><br><span class="line">            <span class="keyword">if</span> (request.body() <span class="keyword">instanceof</span> FormBody) &#123;</span><br><span class="line">                FormBody.Builder newFormBodyBuilder = <span class="keyword">new</span> FormBody.Builder();</span><br><span class="line">                <span class="keyword">if</span> (paramsMap.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    Iterator iterator = paramsMap.entrySet().iterator();</span><br><span class="line">                    <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                        Map.Entry entry = (Map.Entry) iterator.next();</span><br><span class="line">                        newFormBodyBuilder.add((String) entry.getKey(), (String) entry.getValue());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                FormBody oldFormBody = (FormBody) request.body();</span><br><span class="line">                <span class="keyword">int</span> paramSize = oldFormBody.size();</span><br><span class="line">                <span class="keyword">if</span> (paramSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; paramSize; i++) &#123;</span><br><span class="line">                        newFormBodyBuilder.add(oldFormBody.name(i), oldFormBody.value(i));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                requestBuilder.post(newFormBodyBuilder.build());</span><br><span class="line">                request = requestBuilder.build();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (request.body() <span class="keyword">instanceof</span> MultipartBody) &#123;</span><br><span class="line">                MultipartBody.Builder multipartBuilder = <span class="keyword">new</span> MultipartBody.Builder().setType(MultipartBody.FORM);</span><br><span class="line"></span><br><span class="line">                Iterator iterator = paramsMap.entrySet().iterator();</span><br><span class="line">                <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                    Map.Entry entry = (Map.Entry) iterator.next();</span><br><span class="line">                    multipartBuilder.addFormDataPart((String) entry.getKey(), (String) entry.getValue());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                List&lt;MultipartBody.Part&gt; oldParts = ((MultipartBody) request.body()).parts();</span><br><span class="line">                <span class="keyword">if</span> (oldParts != <span class="keyword">null</span> &amp;&amp; oldParts.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (MultipartBody.Part part : oldParts) &#123;</span><br><span class="line">                        multipartBuilder.addPart(part);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                requestBuilder.post(multipartBuilder.build());</span><br><span class="line">                request = requestBuilder.build();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.proceed(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">canInjectIntoBody</span><span class="params">(Request request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.equals(request.method(), <span class="string">"POST"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        RequestBody body = request.body();</span><br><span class="line">        <span class="keyword">if</span> (body == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        MediaType mediaType = body.contentType();</span><br><span class="line">        <span class="keyword">if</span> (mediaType == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.equals(mediaType.subtype(), <span class="string">"x-www-form-urlencoded"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// func to inject params into url</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Request <span class="title">injectParamsIntoUrl</span><span class="params">(Request request, Request.Builder requestBuilder, Map&lt;String, String&gt; paramsMap)</span> </span>&#123;</span><br><span class="line">        HttpUrl.Builder httpUrlBuilder = request.url().newBuilder();</span><br><span class="line">        <span class="keyword">if</span> (paramsMap.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            Iterator iterator = paramsMap.entrySet().iterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                Map.Entry entry = (Map.Entry) iterator.next();</span><br><span class="line">                httpUrlBuilder.addEncodedQueryParameter((String) entry.getKey(), (String) entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">            requestBuilder.url(httpUrlBuilder.build());</span><br><span class="line">            <span class="keyword">return</span> requestBuilder.build();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> request;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">bodyToString</span><span class="params">(<span class="keyword">final</span> RequestBody request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> RequestBody copy = request;</span><br><span class="line">            <span class="keyword">final</span> Buffer buffer = <span class="keyword">new</span> Buffer();</span><br><span class="line">            <span class="keyword">if</span> (copy != <span class="keyword">null</span>)</span><br><span class="line">                copy.writeTo(buffer);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">            <span class="keyword">return</span> buffer.readUtf8();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"did not work"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        CommonParamsInterceptor interceptor;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            interceptor = <span class="keyword">new</span> CommonParamsInterceptor();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">addParam</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">            interceptor.paramsMap.put(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">addParamsMap</span><span class="params">(Map&lt;String, String&gt; paramsMap)</span> </span>&#123;</span><br><span class="line">            interceptor.paramsMap.putAll(paramsMap);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">addHeaderParam</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">            interceptor.headerParamsMap.put(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">addHeaderParamsMap</span><span class="params">(Map&lt;String, String&gt; headerParamsMap)</span> </span>&#123;</span><br><span class="line">            interceptor.headerParamsMap.putAll(headerParamsMap);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">addHeaderLine</span><span class="params">(String headerLine)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> index = headerLine.indexOf(<span class="string">":"</span>);</span><br><span class="line">            <span class="keyword">if</span> (index == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unexpected header: "</span> + headerLine);</span><br><span class="line">            &#125;</span><br><span class="line">            interceptor.headerLinesList.add(headerLine);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">addHeaderLinesList</span><span class="params">(List&lt;String&gt; headerLinesList)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (String headerLine : headerLinesList) &#123;</span><br><span class="line">                <span class="keyword">int</span> index = headerLine.indexOf(<span class="string">":"</span>);</span><br><span class="line">                <span class="keyword">if</span> (index == -<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unexpected header: "</span> + headerLine);</span><br><span class="line">                &#125;</span><br><span class="line">                interceptor.headerLinesList.add(headerLine);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">addQueryParam</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">            interceptor.queryParamsMap.put(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">addQueryParamsMap</span><span class="params">(Map&lt;String, String&gt; queryParamsMap)</span> </span>&#123;</span><br><span class="line">            interceptor.queryParamsMap.putAll(queryParamsMap);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> CommonParamsInterceptor <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> interceptor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŠ ç­¾æ‹¦æˆªå™¨"><a href="#åŠ ç­¾æ‹¦æˆªå™¨" class="headerlink" title="åŠ ç­¾æ‹¦æˆªå™¨"></a>åŠ ç­¾æ‹¦æˆªå™¨</h3><p>äº’è”ç½‘æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ç¯å¢ƒ,å±é™©æ— å¤„ä¸åœ¨,åŠ å¯†é€šä¿¡æ˜¯å®‰å…¨çš„åŸºç¡€.</p><p>åŠ å¯†çš„æ–¹å¼åˆæœ‰å¾ˆå¤š,æ¯”å¦‚å¯¹ç§°åŠ å¯†/éå¯¹ç§°åŠ å¯†/Hash(ä¸¥æ ¼çš„è¯´ä¸æ˜¯åŠ å¯†),è¿™é‡Œå…ˆä¸å¯¹åŠ å¯†è¿›è¡Œä»‹ç»,æˆ‘ä»¬èŠèŠåŠ ç­¾;</p><p>åŠ ç­¾,å…¶å®å°±æ˜¯ç»™æŠ¥æ–‡åšä¸€ä¸ªæ‘˜è¦,ç›¸åŒçš„ç­¾åç®—æ³•å¾—åˆ°çš„æ‘˜è¦æ˜¯ç›¸åŒçš„,æ¯”å¦‚MD5, SH1, SH256ç­‰, ç®€å•çš„åŠ ç­¾å¹¶ä¸èƒ½é˜²æ­¢ç¯¡æ”¹,å› ä¸ºæ”»å‡»è€…å¯ä»¥ç¯¡æ”¹å,è‡ªå·±ç”Ÿæˆæ–°çš„ç­¾å.æœåŠ¡ç«¯éªŒç­¾è¿˜æ˜¯å¯ä»¥é€šè¿‡çš„,å› æ­¤åŠ ç­¾æ—¶ä¸€å®šè¦åŒ…å«ä¸€äº›ç§æœ‰çš„ä¸œè¥¿,æ¯”å¦‚ç§é’¥.</p><p>è¿™é‡Œä»‹ç»ä¸€ç§åŠ ç­¾æ–¹å¼,</p><blockquote><p> åŠ å¯†è§„åˆ™</p></blockquote><ol><li>æ ¹æ®è¯·æ±‚å‚æ•° key è¿›è¡Œæ’åº</li><li>æŒ‰æ’å¥½çš„é¡ºåºç»„è£…æˆ key=value&amp;key=value å½¢å¼çš„å­—ç¬¦ä¸²</li><li>å°†ä¸Šè¿°å­—ç¬¦ä¸²æ‹¼æ¥  ,æœ€ç»ˆå½¢æˆ key=value&amp;key=valueçš„å­—ç¬¦ä¸²</li><li>å°†å­—ç¬¦ä¸² md5, ç”Ÿæˆ auth.</li></ol><p>ä¸€ä¸ªç®€å•çš„åŠ ç­¾é€»è¾‘å°±æ˜¯è¿™æ ·,ä¸‹é¢ä»£ç å°±æ˜¯å¯¹è¿™ç§è§„åˆ™çš„å®ç°,çœ‹ä»£ç â†“â†“â†“â†“</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizeInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"AuthorizeInterceptor"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆ auth çš„ç§é’¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String authKey;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰è®¾å¤‡ mid,ç”¨æ¥ç”Ÿæˆ auth</span></span><br><span class="line"><span class="comment">     * æ•°æ®ç”± Builder ç±»ä¼ å…¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String mid = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">AuthorizeInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Request request = chain.request();</span><br><span class="line">        Request.Builder requestBuilder = request.newBuilder();</span><br><span class="line">        String url = request.url().toString();</span><br><span class="line">        LogUtils.d(TAG, url);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"POST"</span>.equals(request.method())) &#123;</span><br><span class="line">            request = injectionParamIntoBody(request, requestBuilder);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"GET"</span>.equals(request.method())) &#123;</span><br><span class="line">            request = injectionAuthIntoUrl(request, requestBuilder);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.proceed(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * GET è¯·æ±‚æ–¹å¼, ç”Ÿæˆæˆæƒå’Œæ·»åŠ æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestBuilder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Request <span class="title">injectionAuthIntoUrl</span><span class="params">(Request request, Request.Builder requestBuilder)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è·å–åˆ°è¯·æ±‚åœ°å€api</span></span><br><span class="line">        HttpUrl newHttpUrl = request.url();</span><br><span class="line">        TreeMap&lt;String, String&gt; authMap = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//é€šè¿‡è¯·æ±‚åœ°å€(æœ€åˆå§‹çš„è¯·æ±‚åœ°å€)è·å–åˆ°å‚æ•°åˆ—è¡¨</span></span><br><span class="line">        Set&lt;String&gt; parameterNames = newHttpUrl.queryParameterNames();</span><br><span class="line">        <span class="keyword">for</span> (String key : parameterNames) &#123;</span><br><span class="line">            <span class="comment">//å¾ªç¯å‚æ•°åˆ—è¡¨,è·å–å‚æ•°value,</span></span><br><span class="line">                String paramValue = newHttpUrl.queryParameter(key);</span><br><span class="line">                <span class="keyword">if</span> (!TextUtils.isEmpty(paramValue)) &#123;</span><br><span class="line">                    authMap.put(key, paramValue);</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        HttpUrl.Builder newBuilder =</span><br><span class="line">                request.url().newBuilder()</span><br><span class="line">                        .addEncodedQueryParameter(<span class="string">"auth"</span>, assembleAuth(authMap, <span class="keyword">false</span>));</span><br><span class="line">        requestBuilder.url(newBuilder.build());</span><br><span class="line">        <span class="keyword">return</span> requestBuilder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†å‚æ•°æ³¨å…¥åˆ° POST è¯·æ±‚çš„ body ä¸­</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestBuilder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Request <span class="title">injectionParamIntoBody</span><span class="params">(Request request, Request.Builder requestBuilder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request.body() <span class="keyword">instanceof</span> FormBody) &#123;</span><br><span class="line">            <span class="comment">// å¤„ç†æ­£å¸¸è¡¨å•è¯·æ±‚æ–¹å¼</span></span><br><span class="line">            FormBody oldFormBody = (FormBody) request.body();</span><br><span class="line">            <span class="keyword">return</span> assembleFormBody(request, oldFormBody, requestBuilder);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (request.body() <span class="keyword">instanceof</span> MultipartBody) &#123;</span><br><span class="line">            <span class="keyword">return</span> assembleMultipartBody(request, requestBuilder);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> request;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºæµåª’ä½“å‚æ•°çš„ body</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> builder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Request <span class="title">assembleMultipartBody</span><span class="params">(Request request, Request.Builder builder)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¤„ç†æµçš„è¯·æ±‚æ–¹å¼</span></span><br><span class="line">        MultipartBody body = (MultipartBody) request.body();</span><br><span class="line">        TreeMap&lt;String, String&gt; authMap = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line">        <span class="comment">// è·å–å‚æ•° key åŠ value æ•°æ®, å°†æ•°æ®å†™å…¥åˆ° TreeMap ä¸­è¿›è¡Œæ’åº</span></span><br><span class="line">        <span class="keyword">if</span> (body != <span class="keyword">null</span> &amp;&amp; body.parts().size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (MultipartBody.Part part : body.parts()) &#123;</span><br><span class="line">                <span class="comment">// åªå¤„ç† contentType ä¸ºç©º,æˆ–ä¸º text çš„æƒ…å†µ, image ä¸Šä¼ å›¾ç‰‡çš„å­—æ®µ,ä¸è¿›è¡Œå¤„ç†</span></span><br><span class="line">                <span class="keyword">if</span> (part.body().contentType() == <span class="keyword">null</span></span><br><span class="line">                        || !<span class="string">"image"</span>.equals(part.body().contentType().type())</span><br><span class="line">                        || <span class="string">"text"</span>.equals(part.body().contentType().type())) &#123;</span><br><span class="line">                    Headers headers = part.headers();</span><br><span class="line">                    <span class="comment">// ä» header ä¸­è·å– Key, form-data; name= çš„å­—æ®µè¿‡æ»¤è·å–key</span></span><br><span class="line">                    <span class="comment">// ç­›é€‰æ‰ basic, è·å–åˆ°å½“å‰ header,å¯¹åº”çš„ RequestBody, é€šè¿‡ buffer çš„æ–¹å¼,è·å–åˆ° value</span></span><br><span class="line">                    <span class="comment">// å°† key å’Œ value å¡«å……åˆ° TreeMap ä¸­</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; headers.names().size(); i++) &#123;</span><br><span class="line">                        String headerName = headers.value(i);</span><br><span class="line">                        <span class="keyword">if</span> (headerName.contains(<span class="string">"form-data; name="</span>)) &#123;</span><br><span class="line">                            String key = headerName.replace(<span class="string">"form-data; name="</span>, <span class="string">""</span>).replace(<span class="string">"\""</span>, <span class="string">""</span>);</span><br><span class="line">                                String value = body2String(part.body());</span><br><span class="line">                                <span class="keyword">if</span> (!TextUtils.isEmpty(value)) &#123;</span><br><span class="line">                                    authMap.put(key, body2String(part.body()));</span><br><span class="line">                                &#125;</span><br><span class="line">                                                   &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        MultipartBody.Builder multipartBuilder = <span class="keyword">new</span> MultipartBody.Builder().setType(MultipartBody.FORM);</span><br><span class="line">        multipartBuilder.addFormDataPart(<span class="string">"auth"</span>, assembleAuth(authMap, <span class="keyword">false</span>));</span><br><span class="line">        List&lt;MultipartBody.Part&gt; oldParts = ((MultipartBody) request.body()).parts();</span><br><span class="line">        <span class="keyword">if</span> (oldParts != <span class="keyword">null</span> &amp;&amp; oldParts.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (MultipartBody.Part part : oldParts) &#123;</span><br><span class="line">                multipartBuilder.addPart(part);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        builder.post(multipartBuilder.build());</span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»º Auth æ•°æ®</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * TreeMap æ•°æ®,æŒ‰ç…§å­—æ¯é¡ºåºè‡ªåŠ¨æ’åºå,éå†æ•°æ®,æ‹¼æ¥æˆ key=value&amp;key=value çš„å½¢å¼,</span></span><br><span class="line"><span class="comment">     * Map æ‹¼æ¥å®Œæˆå,åœ¨å…¶åéœ€è¦å†æ¬¡æ‹¼æ¥ä¸Š</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * æœ€åå°†æ•°æ® MD5 è½¬åŒ–ä¸º 32 ä½å°å†™å¹¶è¿”å›</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> treeMap      æ„å»º Auth çš„å…·ä½“æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isNeedDecode æ˜¯å¦éœ€è¦è§£ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿”å› auth æ•°æ® </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">assembleAuth</span><span class="params">(TreeMap&lt;String, String&gt; treeMap, <span class="keyword">boolean</span> isNeedDecode)</span> </span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">if</span> (treeMap.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; stringStringEntry : treeMap.entrySet()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    stringBuilder.append(stringStringEntry.getKey())</span><br><span class="line">                            .append(<span class="string">"="</span>)</span><br><span class="line">                            .append(isNeedDecode</span><br><span class="line">                                    ? URLDecoder.decode(stringStringEntry.getValue(), <span class="string">"UTF-8"</span>)</span><br><span class="line">                                    : stringStringEntry.getValue())</span><br><span class="line">                            .append(<span class="string">"&amp;"</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        treeMap.clear();</span><br><span class="line">        stringBuilder</span><br><span class="line">                .append(authKey);</span><br><span class="line">        Log.d(TAG, stringBuilder.toString());</span><br><span class="line">        <span class="keyword">return</span> MD5.MD5(stringBuilder.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * body è½¬ string è·å–å®é™…å‚æ•°å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body Part body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> part ä¸­å†™å¦‚çš„å‚æ•°æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">body2String</span><span class="params">(RequestBody body)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (body != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Buffer buffer = <span class="keyword">new</span> Buffer();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                body.writeTo(buffer);</span><br><span class="line">                Charset charset = Charset.forName(<span class="string">"UTF-8"</span>);</span><br><span class="line">                MediaType contentType = body.contentType();</span><br><span class="line">                <span class="keyword">if</span> (contentType != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    charset = contentType.charset(charset);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">assert</span> charset != <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">return</span> buffer.readString(charset);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»„è£… Form è¡¨å•è¯·æ±‚æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> oldFormBody</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestBuilder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Request <span class="title">assembleFormBody</span><span class="params">(Request request, FormBody oldFormBody, Request.Builder requestBuilder)</span> </span>&#123;</span><br><span class="line">        TreeMap&lt;String, String&gt; authMap = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line">        <span class="comment">// éå†è¯·æ±‚å‚æ•°,éç©ºå‚æ•°,æ·»åŠ åˆ°é›†åˆä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; oldFormBody.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(oldFormBody.encodedValue(i))) &#123;</span><br><span class="line">                authMap.put(oldFormBody.encodedName(i), oldFormBody.encodedValue(i));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (authMap.size() != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç”Ÿæˆ auth æ•°æ®</span></span><br><span class="line">            FormBody.Builder newFormBody = <span class="keyword">new</span> FormBody.Builder();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; oldFormBody.size(); i++) &#123;</span><br><span class="line">                newFormBody.addEncoded(oldFormBody.encodedName(i), oldFormBody.encodedValue(i));</span><br><span class="line">            &#125;</span><br><span class="line">            newFormBody.add(<span class="string">"auth"</span>, assembleAuth(authMap, <span class="keyword">true</span>));</span><br><span class="line">            requestBuilder.method(request.method(), newFormBody.build());</span><br><span class="line">            <span class="keyword">return</span> requestBuilder.build();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> request;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Builder æ„é€ å‡½æ•°,ç”¨æ¥è®¾ç½® Authorize çš„ç›¸å…³å‚æ•°,åŠåˆ›å»ºå·¥ä½œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">        AuthorizeInterceptor authorizeInterceptor;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            authorizeInterceptor = <span class="keyword">new</span> AuthorizeInterceptor();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">setMid</span><span class="params">(String mid)</span> </span>&#123;</span><br><span class="line">            authorizeInterceptor.mid = mid;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">setAuthKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">            authorizeInterceptor.authKey = key;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> AuthorizeInterceptor <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> authorizeInterceptor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥åŠ ç­¾æ–¹å¼,è®²è¯·æ±‚å‚æ•°æ‹¼æ¥ä¸º <code>key=value</code> çš„æ–¹å¼, éš¾ç‚¹åœ¨äºå¦‚ä½•ä» OkHttp ä¸­è·å–è¿™äº›å‚æ•°,åœ¨ GET è¯·æ±‚å’Œ POST çš„å¤„ç†æ–¹å¼åˆä¸åŒ,ä»£ç ä¸­ POST è¯·æ±‚æ–¹å¼,åˆä¼šæ ¹æ®è¯·æ±‚ä¼ é€’çš„ <code>contentType</code> è€Œåˆæœ‰æ‰€ä¸åŒ,è¿™é‡Œä»‹ç»äº†<code>Form</code>è¡¨å•æäº¤å’Œ <code>Multipart</code> ä¸Šä¼ æ–‡ä»¶çš„å‚æ•°è·å–æ–¹å¼,å…¶ä»–çš„è¯·ä¸¾ä¸€åä¸‰.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;OKHttp åœ¨å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°,è¿™é‡Œä»‹ç»ä¸€ä¸‹ OKHttp çš„æ‹¦æˆªå™¨(interceptor)çš„å‡ ä¸ªä½¿ç”¨ä¾‹å­&lt;/p&gt;
&lt;p&gt;è¦æ˜¯ç”¨æ‹¦æˆªå™¨å¾ˆç®€å•,æˆ‘ä»¬åªéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª interceptor ç±», å¹¶å®ç° Interceptor æ¥å£, åŒæ—¶é‡å†™ intercept æ–¹æ³•.&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä»‹ç»ä¸¤ç§ Interceptor çš„å®ä¾‹&lt;/p&gt;
    
    </summary>
    
    
      <category term="OkHttp" scheme="http://xiaoman.ren/tags/OkHttp/"/>
    
  </entry>
  
  <entry>
    <title>å¤šä¸ª ssh å…¬é’¥æäº¤ä»£ç åˆ°ä¸åŒå¹³å°</title>
    <link href="http://xiaoman.ren/2019/04/17/%E5%A4%9A%E4%B8%AA-ssh-%E5%85%AC%E9%92%A5%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E5%88%B0%E4%B8%8D%E5%90%8C%E5%B9%B3%E5%8F%B0/"/>
    <id>http://xiaoman.ren/2019/04/17/å¤šä¸ª-ssh-å…¬é’¥æäº¤ä»£ç åˆ°ä¸åŒå¹³å°/</id>
    <published>2019-04-17T14:09:21.000Z</published>
    <updated>2019-06-23T14:35:50.288Z</updated>
    
    <content type="html"><![CDATA[<p>ä½œä¸ºä¸€ä¸ªæŠ€æœ¯å¼€å‘äººå‘˜ï¼Œå…ä¸äº†åœ¨ <code>github</code> ä»¥åŠ <code>gitlab</code> ä»¥åŠå…¶ä»– <code>git</code> å¹³å°ä¸Šè¿›è¡Œä»£ç ç®¡ç†ï¼›<br>å·¥ä½œä¸­æ‚¨å¯èƒ½ä½¿ç”¨ <code>svn</code> ï¼ˆè¿™ä¸åœ¨æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´ï¼‰,ä¹Ÿæœ‰å¯èƒ½ä½¿ç”¨ <code>git</code>, ç”Ÿæ´»ä¸­ï¼Œæ‚¨å¯èƒ½ä¼šå°†ä¸€äº›å†…å®¹åˆ†äº«åˆ°ä½ çš„ <code>github</code> ä¸Šï¼Œ ä¾›å¤§å®¶å‚é˜…ã€‚</p><p><code>git</code> åˆ›å»ºç‰ˆæœ¬åº“å¾ˆå®¹æ˜“ï¼Œ <code>clone</code> ä»£ç ä¹Ÿä»…ä»…æ˜¯ç®€å•çš„ä¸€å¥ <code>git clone https://github.com/xxxx.git</code>ï¼Œå¼‚æˆ–æ˜¯ <code>git clone git@github.com:xxxxx.git</code>ï¼›å½“ç„¶ï¼Œä½¿ç”¨ <code>https</code> çš„æ–¹å¼ç®€å•æ˜“æ“ä½œï¼ˆæœ¬äººè®¤ä¸ºæ˜¯ä¸€ä¸ªå‚»ç“œç›¸æœºï¼‰ï¼Œä½†æ˜¯é€šè¿‡ä½¿ç”¨ <code>https</code> çš„æ–¹å¼ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦è¾“å…¥è´¦å·å’Œå¯†ç çš„æƒ…å†µï¼Œè¿™å¤§å¤§çš„åŠ å¤§äº†å®‰å…¨é—®é¢˜ï¼Œè™½ç„¶æŸ dear çš„å›¾å½¢åŒ–å·¥å…·ï¼Œä¼šå¸®åŠ©æˆ‘ä»¬ remeber è´¦å·å’Œå¯†ç ï¼Œé¿å…äº†é‡å¤è¾“å…¥ï¼Œä½†è¿™ä¸åœ¨æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´ï¼ˆä¸ªäººå¾ˆé„™è§†ä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢çš„ï¼‰ï¼Œæ¥ä¸‹æ¥è¦è¯´çš„å°±æ˜¯ä½¿ç”¨ <code>SSH</code> çš„æ–¹å¼æ¥å¤„ç† <code>git</code> çš„ç‰ˆæœ¬ç®¡ç†ã€‚</p><a id="more"></a><h2 id="ç”Ÿæˆ-SSH-å¯†é’¥"><a href="#ç”Ÿæˆ-SSH-å¯†é’¥" class="headerlink" title="ç”Ÿæˆ SSH å¯†é’¥"></a>ç”Ÿæˆ SSH å¯†é’¥</h2><p>ä½¿ç”¨ <code>SSH</code> åˆ›å»ºä¸€å¥—å…¬å¯†é’¥ï¼Œå°†å…¬é’¥æ·»åŠ åˆ°ä½ è¦ä½¿ç”¨çš„ <code>Git</code> å¹³å°è´¦æˆ·ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;your email addr&quot; -f ~/.ssh/github</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ol><li><code>-f</code> åé¢çš„å‚æ•°æ˜¯ç”¨æ¥è‡ªå®šä¹‰ SSH KEY çš„å­˜æ”¾è·¯å¾„ï¼Œå¦‚æœä¸éœ€è¦ä¹Ÿå¯ä»¥è‡ª -f å¼€å§‹çœç•¥</li><li>å‘½ä»¤è¾“å…¥å®Œæˆåï¼Œè¿å‡»3ä¸‹å›è½¦å°±å¯ä»¥ï¼Œä¸éœ€è¦å¤„ç†æ“ä½œï¼ˆé™¤éä½ å¾ˆæƒ³å¤„ç†ï¼‰</li></ol><h2 id="æ·»åŠ ç”Ÿæˆçš„-SSH-å…¬é’¥"><a href="#æ·»åŠ ç”Ÿæˆçš„-SSH-å…¬é’¥" class="headerlink" title="æ·»åŠ ç”Ÿæˆçš„ SSH å…¬é’¥"></a>æ·»åŠ ç”Ÿæˆçš„ SSH å…¬é’¥</h2><p>æ·»åŠ  ssh å…¬é’¥åˆ° <code>github</code> **</p><ol><li><p>æ‰“å¼€ <code>https://github.com/settings/profile</code> ï¼Œé€‰æ‹© <code>SSH and GPG keys</code></p><p> <img src="https://raw.githubusercontent.com/boywithsmalleyes/static_file/master/images/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20190425135335.png" alt></p></li><li><p>ç‚¹å‡» <code>New SSH key</code></p><ol><li>title å¯ä»¥éšä¾¿å†™ï¼Œå»ºè®®è§åçŸ¥æ„ï¼Œèƒ½çŸ¥é“æ˜¯å“ªå°è®¾å¤‡</li><li>key é€šè¿‡åˆšåˆšé€šè¿‡ <code>SSH</code> å‘½ä»¤ç”Ÿæˆçš„ <code>.pub</code> æ–‡ä»¶ä¸­å¤åˆ¶å³å¯ã€‚æ–‡ä»¶è·¯å¾„ <code>.ssh/id_rsa.pub</code> å¼‚æˆ–æ˜¯å­˜åœ¨æ‚¨ <code>-f</code> ä¹‹åæŒ‡å®šçš„ç›®å½•ã€‚</li><li>ç‚¹å‡» <code>add SSH key</code></li></ol></li></ol><h2 id="é…ç½®å¤šä¸ª-ssh"><a href="#é…ç½®å¤šä¸ª-ssh" class="headerlink" title="é…ç½®å¤šä¸ª ssh"></a>é…ç½®å¤šä¸ª ssh</h2><p>é…ç½®å¤šä¸ª <code>ssh</code> æ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ol><li>å¦‚æœä½ æœªæŒ‡å®šå…¬é’¥çš„å­˜å‚¨è·¯å¾„ï¼Œé‚£ä¹ˆä½ éœ€è¦ä¸€ä¸ªä¸€ä¸ªçš„æ‰‹åŠ¨å»åˆ›å»ºï¼Œå¹¶é…ç½® <code>ssh</code> å…¬é’¥åˆ°å¯¹åº”å¹³å°ï¼Œå¦åˆ™ï¼Œåç»­çš„ <code>ssh</code> åˆ›å»ºè¿‡ç¨‹ï¼Œ ä¼šè¦†ç›–æ‰ä¹‹å‰åˆ›å»ºçš„ã€‚</li><li><code>ssh-keygen</code> ä¼šåŒæ—¶åˆ›å»º <code>id_rsa</code> å’Œ <code>id_rsa.pub</code> ä¸¤ä¸ªæ–‡ä»¶ï¼Œ <code>.pub</code> æ˜¯å…¬é’¥ï¼Œ ä¸å¸¦åç¼€çš„æ˜¯ä½ çš„ç§é’¥ã€‚</li><li>åŒæ—¶é…ç½®å¤šä¸ª <code>ssh</code> æ—¶ï¼Œéœ€è¦æ‚¨ä¿ç•™ç§é’¥åœ¨ <code>.ssh</code> ç›®å½•ä¸‹ï¼Œä¸ºä¿è¯å¤šå¹³å°éƒ½å¯ä»¥ä½¿ç”¨ï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹ <code>id_rsa</code> æ–‡ä»¶çš„åç§°ï¼Œ<code>.pub</code> å°±éšä¾¿äº†ï¼Œé…ç½®å®Œï¼Œå°±æ²¡ç”¨äº†ã€‚</li><li><p>å°†å¯†é’¥æ·»åŠ åˆ° <code>ssh-agent</code> ä¸­</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add ~.ssh/id_rsa</span><br></pre></td></tr></table></figure></li></ol><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹ agent ä¸­çš„å¯†é’¥</span><br><span class="line">ssh-add -l</span><br><span class="line"># æŸ¥çœ‹ agent ä¸­çš„å…¬é’¥</span><br><span class="line">ssh-add -L</span><br><span class="line"># åˆ é™¤ agent ä¸­çš„å¯†é’¥</span><br><span class="line">ssh-add -d .ssh/id_xxx.pub</span><br></pre></td></tr></table></figure></code></pre><h2 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><p>è¯´äº†åŠå¤©ï¼Œç»ˆäºåˆ°é‡ç‚¹äº†</p><ol><li><p>åœ¨ <code>~/.ssh</code> ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª <code>config</code> æ–‡ä»¶</p><p> å¯¹ï¼Œæ²¡æœ‰é”™ï¼Œå°±æ˜¯ä¸€ä¸ªè¿åç¼€éƒ½æ²¡æœ‰çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ç”¨æ¥å­˜å‚¨æ‚¨çš„æ‰€æœ‰å¹³å°ä¿¡æ¯ï¼Œä»¥åŠå¹³å°å¯¹åº”ä½¿ç”¨çš„ <code>ssh</code> å¯†é’¥ã€‚<br> <code>touch config</code></p></li><li><p>æ·»åŠ ä»¥ä¸‹é…ç½®ä¿¡æ¯</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># github</span><br><span class="line">Host github.com # ä¹Ÿå¯ä»¥æ˜¯æ•°å­— ip åœ°å€ï¼ŒåŠ ä¸åŠ  http/https éƒ½æ— æ‰€è°“</span><br><span class="line">HostName github.com # åŒä¸Š</span><br><span class="line">PreferredAuthentications publickey # è¿™é‡Œä¸è¦ä¿®æ”¹</span><br><span class="line">IdentityFile ~/.ssh/id_rsa_github # è¿™é‡Œçš„æ–‡ä»¶åä¿®æ”¹ä¸ºè¯¥å¹³å°å¯¹åº”çš„å¯†é’¥</span><br><span class="line"></span><br><span class="line"># gitlab</span><br><span class="line">Host å…¬å¸ gitlab åœ°å€</span><br><span class="line">HostName å…¬å¸ gitlab åœ°å€</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~/.ssh/id_rsa_gitlab</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure></li></ol><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>å‘½ä»¤ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hi boywithsmalleyes! You&apos;ve successfully authenticated, but GitHub does not provide shell access.</span><br></pre></td></tr></table></figure><p>åªéœ€è¦æ›¿æ¢åé¢çš„ <code>git</code>ä»“åº“åœ°å€, å…¶ä»–ç‰ˆæœ¬åº“éƒ½å¯ä»¥è¿›è¡Œæµ‹è¯•ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>è¯´äº†åŠå¤©ï¼Œ è¿˜æ˜¯è¦è®°ä½ä¸€ç‚¹ï¼Œæ—¢ç„¶è¦ä½¿ç”¨ <code>ssh</code> çš„æ–¹å¼è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œé‚£ä¹ˆåœ¨ <code>clone</code> ä»£ç æ—¶ï¼Œä¹Ÿè¦ä½¿ç”¨ <code>ssh</code> æ–¹å¼ï¼Œ ä¸ç„¶æˆ‘è¯´äº†è¿™ä¹ˆåŠå¤©ï¼Œéƒ½æ˜¯ç™½æ‰¯ã€‚</p><blockquote><p>æ–‡ç« å†…å®¹æœ‰ç‘•ç–µï¼Œè¯·ç»™äºˆæŒ‡æ­£æ‰¹è¯„</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œä¸ºä¸€ä¸ªæŠ€æœ¯å¼€å‘äººå‘˜ï¼Œå…ä¸äº†åœ¨ &lt;code&gt;github&lt;/code&gt; ä»¥åŠ &lt;code&gt;gitlab&lt;/code&gt; ä»¥åŠå…¶ä»– &lt;code&gt;git&lt;/code&gt; å¹³å°ä¸Šè¿›è¡Œä»£ç ç®¡ç†ï¼›&lt;br&gt;å·¥ä½œä¸­æ‚¨å¯èƒ½ä½¿ç”¨ &lt;code&gt;svn&lt;/code&gt; ï¼ˆè¿™ä¸åœ¨æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´ï¼‰,ä¹Ÿæœ‰å¯èƒ½ä½¿ç”¨ &lt;code&gt;git&lt;/code&gt;, ç”Ÿæ´»ä¸­ï¼Œæ‚¨å¯èƒ½ä¼šå°†ä¸€äº›å†…å®¹åˆ†äº«åˆ°ä½ çš„ &lt;code&gt;github&lt;/code&gt; ä¸Šï¼Œ ä¾›å¤§å®¶å‚é˜…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;git&lt;/code&gt; åˆ›å»ºç‰ˆæœ¬åº“å¾ˆå®¹æ˜“ï¼Œ &lt;code&gt;clone&lt;/code&gt; ä»£ç ä¹Ÿä»…ä»…æ˜¯ç®€å•çš„ä¸€å¥ &lt;code&gt;git clone https://github.com/xxxx.git&lt;/code&gt;ï¼Œå¼‚æˆ–æ˜¯ &lt;code&gt;git clone git@github.com:xxxxx.git&lt;/code&gt;ï¼›å½“ç„¶ï¼Œä½¿ç”¨ &lt;code&gt;https&lt;/code&gt; çš„æ–¹å¼ç®€å•æ˜“æ“ä½œï¼ˆæœ¬äººè®¤ä¸ºæ˜¯ä¸€ä¸ªå‚»ç“œç›¸æœºï¼‰ï¼Œä½†æ˜¯é€šè¿‡ä½¿ç”¨ &lt;code&gt;https&lt;/code&gt; çš„æ–¹å¼ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦è¾“å…¥è´¦å·å’Œå¯†ç çš„æƒ…å†µï¼Œè¿™å¤§å¤§çš„åŠ å¤§äº†å®‰å…¨é—®é¢˜ï¼Œè™½ç„¶æŸ dear çš„å›¾å½¢åŒ–å·¥å…·ï¼Œä¼šå¸®åŠ©æˆ‘ä»¬ remeber è´¦å·å’Œå¯†ç ï¼Œé¿å…äº†é‡å¤è¾“å…¥ï¼Œä½†è¿™ä¸åœ¨æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´ï¼ˆä¸ªäººå¾ˆé„™è§†ä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢çš„ï¼‰ï¼Œæ¥ä¸‹æ¥è¦è¯´çš„å°±æ˜¯ä½¿ç”¨ &lt;code&gt;SSH&lt;/code&gt; çš„æ–¹å¼æ¥å¤„ç† &lt;code&gt;git&lt;/code&gt; çš„ç‰ˆæœ¬ç®¡ç†ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Git" scheme="http://xiaoman.ren/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>Java åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯æ•°å­—çš„æ–¹æ³•</title>
    <link href="http://xiaoman.ren/2019/04/16/Java-%E5%88%A4%E6%96%AD%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%98%AF%E5%90%A6%E6%98%AF%E6%95%B0%E5%AD%97%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>http://xiaoman.ren/2019/04/16/Java-åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯æ•°å­—çš„æ–¹æ³•/</id>
    <published>2019-04-16T09:47:06.000Z</published>
    <updated>2019-04-17T13:55:55.390Z</updated>
    
    <content type="html"><![CDATA[<ul><li>ä½¿ç”¨ Javaè‡ªå¸¦çš„å‡½æ•°</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public static boolean isNumeric (String str) &#123;</span><br><span class="line">    for (int i = str.length(); --i &gt;=0) &#123;</span><br><span class="line">          if (!Character.isDigit(str.charAt(i))) &#123;</span><br><span class="line">                return false;</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><ul><li>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</li></ul><p>æ–¹æ³•ä¸€:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static boolean isNumeric(String str) &#123;</span><br><span class="line">    Pattern pattern = Pattern.compile(&quot;^[-\\+]?[\\d]*$&quot;);</span><br><span class="line">    return pattern.matcher(str).matches();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static boolean isNumeric(String str) &#123;</span><br><span class="line">    if (str != null &amp;&amp; !&quot;&quot;.equals(str.trim())) &#123;</span><br><span class="line">          return s.matches(&quot;^[0-9]*$&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•ä¸‰:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> public static boolean isNumeric (String str) &#123;</span><br><span class="line">    Pattern pattern = Pattern.compile(&quot;[0-9]*&quot;);</span><br><span class="line">    return pattern.matcher(str).matcher();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ ASCII ç </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public static boolean isNumeric (String str) &#123;</span><br><span class="line">    for (int i = str.length(); --i&gt;=0;) &#123;</span><br><span class="line">        int chr = str.charAt(i);</span><br><span class="line">        if (chr &lt; 48 || chr &gt; 57) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ¤æ–­æ˜¯ä¸æ˜¯æµ®ç‚¹å‹æ•°æ®</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static boolean isDouble(String str) &#123;</span><br><span class="line">    Pattern pattern = Pattern.compile(&quot;^[-\\+]?[.\\d]*$&quot;);</span><br><span class="line">    return pattern.matcher(str).matches();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ Javaè‡ªå¸¦çš„å‡½æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public static boolean isNumeric (String str) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    for (int i = str.length(); --i &amp;gt;=0) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          if (!Character.isDigit(str.charAt(i))) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                return false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return true;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://xiaoman.ren/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Android ä¸­è®¾ç½®å…¨å±çš„æ–¹æ³•</title>
    <link href="http://xiaoman.ren/2019/04/16/Android-%E4%B8%AD%E8%AE%BE%E7%BD%AE%E5%85%A8%E5%B1%8F%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>http://xiaoman.ren/2019/04/16/Android-ä¸­è®¾ç½®å…¨å±çš„æ–¹æ³•/</id>
    <published>2019-04-16T09:46:31.000Z</published>
    <updated>2019-04-17T13:55:03.516Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å¼€å‘ä¸­,æˆ‘ä»¬ç»å¸¸éœ€è¦æŠŠæˆ‘ä»¬çš„åº”ç”¨è®¾ç½®ä¸ºå…¨å±,è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼: ä¸€æ˜¯åœ¨ä»£ç ä¸­è®¾ç½®; äºŒæ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®</p><h1 id="ä¸€-åœ¨ä»£ç ä¸­è®¾ç½®"><a href="#ä¸€-åœ¨ä»£ç ä¸­è®¾ç½®" class="headerlink" title="ä¸€. åœ¨ä»£ç ä¸­è®¾ç½®"></a>ä¸€. åœ¨ä»£ç ä¸­è®¾ç½®</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class BaseActivity extends Activity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(saveInstanceState);</span><br><span class="line">        // æ— title</span><br><span class="line">        requestWindowFeature(Window.FEATURE_NO_TITLE);</span><br><span class="line">        // å…¨å±</span><br><span class="line">        getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼ºè°ƒä¸€ç‚¹: <strong> è®¾ç½®å…¨å±çš„ä¸¤æ®µä»£ç ,å¿…é¡»åœ¨ <code>setContentView()</code> ä¹‹å‰è°ƒç”¨,ä¸ç„¶ä¼šæŠ¥é”™ </strong></p><h1 id="äºŒ-åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹"><a href="#äºŒ-åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹" class="headerlink" title="äºŒ. åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹"></a>äºŒ. åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;manifest </span><br><span class="line">  xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">  package=&quot;com.android.test&quot;</span><br><span class="line">  android:versionCode=&quot;1&quot;</span><br><span class="line">  ndroid:versionName=&quot;1.0&quot;&gt;</span><br><span class="line">  &lt;application android:icon=&quot;@drawable/icon&quot;</span><br><span class="line">    android:lable=&quot;@string/app_name&gt;</span><br><span class="line">    &lt;activity android:name=&quot;.BaseActivity&quot; </span><br><span class="line">        android:theme=&quot;@android:style/Theme.NotitleBar.Fullscreen&quot;</span><br><span class="line">        android:lable=&quot;@string/app_name&quot;&gt;</span><br><span class="line">        &lt;intent-filter&gt;</span><br><span class="line">            &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt;</span><br><span class="line">            &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;/&gt;</span><br><span class="line">        &lt;/intent-filter&gt;</span><br><span class="line">  &lt;/application&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•,ä¼šåœ¨åº”ç”¨è¿è¡Œå,çœ‹åˆ°ä¸€ä¸ªçŸ­æš‚çš„çŠ¶æ€æ¥, ç„¶åæ‰å…¨å±, è€Œç¬¬äºŒç§æ–¹æ³•æ˜¯ä¸ä¼šæœ‰è¿™ç§æƒ…å†µçš„,å¤§å®¶æ ¹æ®éœ€è¦è‡ªè¡Œé€‰æ‹©.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨å¼€å‘ä¸­,æˆ‘ä»¬ç»å¸¸éœ€è¦æŠŠæˆ‘ä»¬çš„åº”ç”¨è®¾ç½®ä¸ºå…¨å±,è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼: ä¸€æ˜¯åœ¨ä»£ç ä¸­è®¾ç½®; äºŒæ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®&lt;/p&gt;
&lt;h1 id=&quot;ä¸€-åœ¨ä»£ç ä¸­è®¾ç½®&quot;&gt;&lt;a href=&quot;#ä¸€-åœ¨ä»£ç ä¸­è®¾ç½®&quot; class=&quot;headerlink&quot; title=&quot;ä¸€. åœ¨ä»£ç ä¸­è®¾ç½®&quot;&gt;&lt;/a&gt;ä¸€
      
    
    </summary>
    
    
      <category term="Android" scheme="http://xiaoman.ren/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Android è·å– IP åœ°å€</title>
    <link href="http://xiaoman.ren/2019/04/16/Android-%E8%8E%B7%E5%8F%96-IP-%E5%9C%B0%E5%9D%80/"/>
    <id>http://xiaoman.ren/2019/04/16/Android-è·å–-IP-åœ°å€/</id>
    <published>2019-04-16T09:46:00.000Z</published>
    <updated>2019-04-17T13:54:55.501Z</updated>
    
    <content type="html"><![CDATA[<p>å¼€å‘ä¸­ç»å¸¸ä¼šéœ€è¦åˆ¤æ–­å½“å‰æ˜¯å¦è¿æ¥ç½‘ç»œ, WiFi æˆ– ç§»åŠ¨æ•°æ®è¿æ¥åˆ¤æ–­çš„éœ€æ±‚,</p><p><strong>ç¬¬ä¸€ç§æ–¹æ³•: </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WifiManager wifiManager = (WifiManager) getSystemService(WIFI_SERVICE);  </span><br><span class="line">WifiInfo wifiInfo = wifiManager.getConnectionInfo();  </span><br><span class="line"><span class="keyword">int</span> ipAddress = wifiInfo.getIpAddress();</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ–¹å¼è·å–åˆ°çš„ IP åœ°å€ä¸ºä¸€ä¸²æ•°å­—,æˆ‘ä»¬å¹¶ä¸èƒ½çœ‹æ‡‚,å› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œè½¬æ¢:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String ip = (ipAddress &amp; 0xff) + &quot;.&quot; + (ipAddress&gt;&gt;8 &amp; 0xff) + &quot;.&quot; + (ipAddress&gt;&gt;16 &amp; 0xff) + &quot;.&quot; + (ipAddress &gt;&gt; 24 &amp; 0xff);</span><br></pre></td></tr></table></figure><p>è¿™æ ·è½¬æ¢ä¹‹å,æˆ‘ä»¬è·å–åˆ°çš„ IP åœ°å€å°±æ˜¯æˆ‘ä»¬å¹³æ—¶è®¤è¯†çš„, æ¯”å¦‚: 192.168.1.108</p><p>è¿™ç§æ–¹æ³•åœ¨é£è¡Œæ¨¡å¼ä¸‹è·å–åˆ°çš„ IP åœ°å€ä¸º 0.0.0.0</p><p><strong>ç¬¬äºŒç§æ–¹æ³•:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  public String getLocalIpAddress() &#123;  </span><br><span class="line">    try &#123;  </span><br><span class="line">        for (Enumeration&lt;NetworkInterface&gt; en = NetworkInterface.getNetworkInterfaces(); en.hasMoreElements();) &#123;  </span><br><span class="line">            NetworkInterface intf = en.nextElement();  </span><br><span class="line">            for (Enumeration&lt;InetAddress&gt; enumIpAddr = intf.getInetAddresses(); enumIpAddr.hasMoreElements();) &#123;  </span><br><span class="line">                InetAddress inetAddress = enumIpAddr.nextElement();  </span><br><span class="line">                if (!inetAddress.isLoopbackAddress()) &#123;  </span><br><span class="line">                    return inetAddress.getHostAddress().toString();  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125; catch (SocketException ex) &#123;  </span><br><span class="line">        Log.e(LOG_TAG, ex.toString());  </span><br><span class="line">    &#125;  </span><br><span class="line">    return null;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ–¹å¼æ˜¯æ¯”è¾ƒé€šç”¨çš„,åœ¨WiFiå’Œ3G/4G çŠ¶æ€ä¸‹,éƒ½å¯ä»¥è·å–åˆ°æ­£ç¡®çš„åœ°å€.æ¯”å¦‚: fe80::8e3a:e3ff:fe45:a018</p><p>è¿™ç§æ–¹æ³•åœ¨æ‰‹æœºå¤„äºé£è¡ŒçŠ¶æ€ä¸‹æ—¶, è·å–åˆ°çš„ IP åœ°å€ä¸º null</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¼€å‘ä¸­ç»å¸¸ä¼šéœ€è¦åˆ¤æ–­å½“å‰æ˜¯å¦è¿æ¥ç½‘ç»œ, WiFi æˆ– ç§»åŠ¨æ•°æ®è¿æ¥åˆ¤æ–­çš„éœ€æ±‚,&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸€ç§æ–¹æ³•: &lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;
      
    
    </summary>
    
    
      <category term="Android" scheme="http://xiaoman.ren/tags/Android/"/>
    
  </entry>
  
</feed>
